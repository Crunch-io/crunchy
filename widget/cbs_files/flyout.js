define(["jquery","version!fly/utils/object-helper","version!fly/components/base","components/dropdown","version!fly/components/loading"],function(e,s){e.widget("cbsnews.flyout",e.fly.base,{options:{requestUrl:null,requestData:null,responseKey:"flyout",classContainer:"flyout-content",loader:{template:'<a class="{baseClass} {stateClass}"><span class="text">{text}</span></a>'}},isLoaded:!1,isLoading:!1,loader:null,_create:function(s){var t=this.options;this._setup(),this.$content=e("<div>").addClass(t.classContainer),this.$element.dropdown({selectorTrigger:"a",event:"hover",shown:e.proxy(this.show,this)})},show:function(){this.isLoaded||this.isLoading||this._load(),this._trigger("shown")},_load:function(){var s=this,t=this.options;this.loader||(this.loader=e.fly.loading(this.options.loader),this.$content.append(this.loader.$element).appendTo(this.$element)),this.loader.add(),this.isLoading=!0,e.ajax({dataType:"json",url:t.requestUrl,data:t.requestData}).done(e.proxy(this._handleResponse,this)).always(function(){s.loader.remove(),s.isLoading=!1})},_handleResponse:function(e){var t=this.options,o=s.deepFind(e,t.responseKey)||{};o.html&&(this.$content.html(o.html),this.isLoaded=!0)}})});