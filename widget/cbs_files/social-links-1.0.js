define(["jquery","version!fly/managers/debug","version!fly/utils/string-vars","version!fly/components/base"],function(t,i,e){var n=t.support.touch?"vclick":"click",o=i.init("socialLinks");t.widget("fly.socialLinks",t.fly.base,{options:{title:"",url:"",description:"",shortUrl:"",via:"",data:{},popupWidth:620,popupHeight:440,location:null},isLoading:!1,popupId:"popup",linkId:"link",links:{facebook:"http://www.facebook.com/sharer.php?u={url}&t={title}",reddit:"http://reddit.com/submit?url={url}&title={title}",digg:"http://digg.com/submit?url={url}&title={title}",stumbleupon:"http://www.stumbleupon.com/submit?url={url}",twitter:function(t){var i="https://twitter.com/intent/tweet?text={title}&related={related}";return i+=t.shortUrl?"&url={shortUrl}&counturl={url}":"&url={url}",i+=t.via?"&via={via}":""},delicious:"http://del.icio.us/post?url={url}&title={title}",googleplus:"https://plus.google.com/share?url={url}&utm_content={title}&utm_campaign=&utm_medium=share%2Bbutton",linkedin:"http://www.linkedin.com/shareArticle?mini=true&url={url}&title={title}&summary={description}",pinterest:"http://pinterest.com/pin/create/button/?url={url}&media={media}&description={description}",tumblr:"http://www.tumblr.com/share/link?url={url}&description={description}",whatsapp:function(i){var n={ios:{match:/(ipad|iphone|ipod)/,store:"https://itunes.apple.com/app/whatsapp-messenger/id310633997",url:"whatsapp://send?text={title}%20{url}"},androidChrome:{match:"androidChrome",store:"market://details?id=com.whatsapp",url:"intent://send?text={title}%20{url}#Intent;package=com.whatsapp;scheme=whatsapp;end;"},android:{match:"android",store:"market://details?id=com.whatsapp",url:"whatsapp://send?text={title}%20{url}"}},o=window.navigator.userAgent.toLowerCase();for(var r in n)if(r=n[r],o.match(r.match)){r.url=e.compile(r.url,i,["urlencode"]);var l=t("<iframe />").css("display","none").attr("src",r.url).appendTo("body");return setTimeout(function(){window.open(r.store,"_blank"),l.remove()},300),!1}},print:function(){return window.print(),!1},email:"mailto:?subject={title}&body={url}%0D%0D{description}"},_create:function(){var t=(this.options,{});this._setup(),t[n+" [data-"+this.popupId+"]"]="_handlePopup",t[n+" [data-"+this.linkId+"]"]="_handleLink",this._on(this.$element,t)},_handlePopup:function(i){var e=t(i.currentTarget),n=e.data(this.popupId);i.preventDefault(),this.$el=e,this._setupClickEvent(i,{el:e,name:n}),this.popup(i,n)},_handleLink:function(i){var e=t(i.currentTarget),n=e.data(this.linkId);i.preventDefault(),this.$el=e,this._setupClickEvent(i,{el:e,name:n}),this.link(i,n)},_getLink:function(i){var n=this.links[i.toLowerCase()],o=this._getLinkData();return t.isFunction(n)&&(n=n(o)),n=e.compile(n,o,["urlencode"])},setLink:function(t,i){this.links[t]=i},_getLinkData:function(){var i=this.options;return t.extend({title:i.title,description:i.description,url:i.url,shortUrl:i.shortUrl,via:i.via},i.data)},popup:function(t,i){var e=this._getLink(i),n=this._getPopUpCoords(),o=this.$el;e&&(window.open(e,"button_share","width="+n.width+", height="+n.height+", left="+n.left+", top="+n.top+", personalbar=0, toolbar=0, scrollbars=1, resizable=1"),this._setupLoadEvent(t,{el:o,name:i,type:this.popupId}))},link:function(t,i){var e=this._getLink(i),n=this.$el;e&&(this._setupLoadEvent(t,{el:n,name:i,type:this.linkId}),window.location=e)},_getPopUpCoords:function(t,i){var e=this.options,n=t||e.popupWidth,o=i||e.popupHeight,r=screen.width,l=screen.height;return{left:Math.round(r/2-n/2),top:l>o?Math.round(l/2-o/2):0,width:r>n?n:r,height:l>o?o:l}},_setupClickEvent:function(i,e){i=i||null;var n=this.options.location;n&&t.extend(e,{location:n}),o.log("clicked"),this._trigger("clicked",null,e)},_setupLoadEvent:function(i,e){i=i||null;var n=this.options.location;n&&t.extend(e,{location:n}),this._trigger("loaded",i,e)}})});