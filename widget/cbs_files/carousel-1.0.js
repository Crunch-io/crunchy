define(["jquery","version!fly/utils/string-helper","version!fly/components/base"],function(e,t){var i=e.support.touch?"vclick":"click";e.widget("fly.carousel",e.fly.base,{options:{currentSlide:0,numOfVisibleSlides:1,incrementAmount:1,slideHeight:null,slideWidth:null,hidePreviousOnFirstSlide:!1,updatePagination:!1,pageUrlAttribute:"page-location",autoplayDelay:6e3,autoplayPauseOnHover:!0,autoplayPauseOnBlur:!0,classSelected:"selected",classActive:"active",classFocus:"focused",transitionType:"fade",transitionDuration:400,transitionEasing:"linear"},transitionTypes:{fade:{init:function(){var e=this.options;this.vertical=!1,this.items.slides.$elements.not("."+e.classSelected).hide()},showSlide:function(t){var i=this.options;e(this.items.slides.$elements[i.currentSlide]).fadeOut(i.transitionDuration,i.transitionEasing),e(this.items.slides.$elements[t]).fadeIn(i.transitionDuration,i.transitionEasing)}},slideHorizontal:{init:function(){var e=this.options;this.items.canvas.$element.css("left",-this.slideWidth*e.currentSlide)},showSlide:function(e){var t=this.options;this.items.canvas.$element.animate({left:-this.slideWidth*e},t.transitionDuration,t.transitionEasing)}},slideHorizontalInfinite:{init:function(){var e=this.options;this.infinite=!0,this.items.canvas.$element.css("left","0"),e.slideWidth&&-1==e.incrementAmount&&(e.incrementAmount=Math.floor(this.items.container.$element.width()/parseInt(e.slideWidth)))},showSlide:function(t){var i=this.options;if(t>0)this.items.canvas.$element.animate({left:-this.slideWidth*t},i.transitionDuration,i.transitionEasing,function(){for(var i=0;t>i;i++)this.items.canvas.$element.append(this.items.slides.$elements[i]);this.items.canvas.$element.css("left","0"),this.items.slides.$elements=e(this.items.slides.selector,this.$element)}.bind(this));else if(0>t){for(var s=this.items.slides.$elements.length-1;s>=this.items.slides.$elements.length+t;s--)this.items.canvas.$element.prepend(this.items.slides.$elements[s]);this.items.canvas.$element.css("left",this.slideWidth*t+"px"),this.items.slides.$elements=e(this.items.slides.selector,this.$element),this.items.canvas.$element.animate({left:"0"},i.transitionDuration,i.transitionEasing)}}},slideVertical:{init:function(){var e=this.options;this.vertical=!0,this.items.canvas.$element.css("top",-e.slideHeight*e.currentSlide)},showSlide:function(e){var t=this.options;this.items.canvas.$element.animate({top:-t.slideHeight*e},t.transitionDuration,t.transitionEasing)}},slideVerticalInfinite:{init:function(){var e=this.options;this.infinite=!0,this.vertical=!0,this.items.canvas.$element.css("top",-e.slideHeight*e.currentSlide)},showSlide:function(t){var i=this.options;if(t>0)this.items.canvas.$element.animate({top:-i.slideHeight*t},i.transitionDuration,i.transitionEasing,function(){for(var i=0;t>i;i++)this.items.canvas.$element.append(this.items.slides.$elements[i]);this.items.canvas.$element.css("top","0"),this.items.slides.$elements=e(this.items.slides.selector,this.$element)}.bind(this));else if(0>t){for(var s=this.items.slides.$elements.length-1;s>=this.items.slides.$elements.length+t;s--)this.items.canvas.$element.prepend(this.items.slides.$elements[s]);this.items.canvas.$element.css("top",i.slideHeight*t+"px"),this.items.slides.$elements=e(this.items.slides.selector,this.$element),this.items.canvas.$element.animate({top:"0"},i.transitionDuration,i.transitionEasing)}}}},_create:function(i){var s=this.options;this._setup(),this.items={viewport:{selector:'[data-item="viewport"]'},canvas:{selector:'[data-item="canvas"]'},slides:{selector:'[data-item="slide"]'},next:{selector:'[data-to="next"]'},prev:{selector:'[data-to="prev"]'},jumps:{selector:'[data-to]:not([data-to="next"], [data-to="prev"])'}},e.each(this.items,function(t,i){this.items[t].$elements=e(i.selector,this.$element),this.items[t].$element=this.items[t].$elements.length>0?e(this.items[t].$elements[0]):null}.bind(this)),this.items.container={$element:this.items.viewport.$element.parent()},this.infinite||(e(this.items.slides.$elements[s.currentSlide]).addClass(s.classSelected),this.items.jumps.$elements.length>0&&e('[data-to="'+s.currentSlide+'"]',this.items.jumps.$elements).addClass(s.classSelected)),this.$element.addClass(t.fromCamelCase(s.transitionType)),this.transitionTypes[s.transitionType].init.bind(this)(),this._setupEvents(),this.vertical||(this.items.viewport.$element.height(s.slideHeight),this.items.canvas.$element.height(s.slideHeight),this.items.slides.$elements.height(s.slideHeight),this.setWidths()),this.$element.addClass(s.classActive),e(this.items.slides.$elements[s.currentSlide]).addClass(s.classSelected),this.items.jumps.$elements.length>0&&e(this.items.jumps.$elements[s.currentSlide]).addClass(s.classSelected),s.hidePreviousOnFirstSlide&&s.currentSlide>0&&this.checkPreviousButton(s.currentSlide),s.autoplayDelay>0&&this.autoplay()},_setupEvents:function(){var t=this,s=t.options,n={};n[i+" "+this.items.next.selector]="next",n[i+" "+this.items.prev.selector]="previous",this.infinite||(n[i+" "+this.items.jumps.selector]=function(i){t["goto"](parseInt(e(i.target).data("to"),10))}),this.items.slides.$elements.on("hover",function(i){t.items.slides.$elements.removeClass(s.classFocus),e(this).addClass(s.classFocus)}),this.vertical||this._on(this.$window,{resize:function(e){t.setWidths()}}),s.autoplayDelay>0&&(s.autoplayPauseOnHover&&e.extend(n,{mouseenter:function(e){t.interval&&t.pause()},mouseleave:function(e){t.interval||t.autoplay()}}),s.autoplayPauseOnBlur&&this._on(this.$window,{blur:function(e){t.interval&&t.pause()},focus:function(e){t.interval||t.autoplay()}})),this._on(this.$element,n)},_autoplayNextSlide:function(){var e=this.options;this.showSlide(this.infinite?e.incrementAmount:(e.currentSlide+e.incrementAmount)%this.items.slides.$elements.length)},_updatePushState:function(e){history.pushState&&history.pushState(null,null,e)},showSlide:function(t){var i=this.options;this.transitionTypes[i.transitionType].showSlide.bind(this)(t),this.infinite||(this.items.slides.$elements.removeClass(i.classSelected),this.items.jumps.$elements.removeClass(i.classSelected),e(this.items.slides.$elements[t]).addClass(i.classSelected),this.items.jumps.$elements.length>0&&e(this.items.jumps.$elements[t]).addClass(i.classSelected),i.currentSlide=t),i.updatePagination&&this._updatePushState(e(this.items.slides.$elements[t]).data(i.pageUrlAttribute)),this._trigger("slidechanged")},next:function(){var e=this.options;this.pause(!0),this.showSlide(this.infinite?e.incrementAmount:(e.currentSlide+e.incrementAmount)%this.items.slides.$elements.length),e.hidePreviousOnFirstSlide&&this.checkPreviousButton(e.currentSlide),this._trigger("next")},previous:function(){var e=this.options;this.pause(!0),this.showSlide(this.infinite?-e.incrementAmount:(e.currentSlide+this.items.slides.$elements.length-e.incrementAmount)%this.items.slides.$elements.length),e.hidePreviousOnFirstSlide&&this.checkPreviousButton(e.currentSlide),this._trigger("previous")},"goto":function(e){var t=this.options;this.pause(!0),this.showSlide(e),t.hidePreviousOnFirstSlide&&this.checkPreviousButton(e),this._trigger("goto")},autoplay:function(){var e=this.options;e.autoplayDelay>0&&(this.interval=setInterval(this._autoplayNextSlide.bind(this),e.autoplayDelay),this._trigger("play"))},pause:function(e){var t=this.options;clearInterval(this.interval),this.interval=null,this._trigger("pause"),e&&(t.autoplayDelay=0,this._trigger("stop"))},setWidths:function(){var e=this.options;this.slideWidth=e.slideWidth?parseInt(e.slideWidth):this.items.container.$element.width()/this.options.numOfVisibleSlides,this.items.slides.$elements.width(this.slideWidth),this.items.canvas.$element.width(this.slideWidth*this.items.slides.$elements.length),this.items.canvas.$element.css("left",-this.slideWidth*e.currentSlide)},checkPreviousButton:function(t){0===t?e(this.items.prev.selector).css("visibility","hidden"):e(this.items.prev.selector).css("visibility","visible")}})});