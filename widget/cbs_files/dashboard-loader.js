define(["jquery","version!fly/utils/string-helper","managers/tealium","version!fly/managers/ad","version!fly/libs/jquery.cookie","components/load-external"],function(i,t,a,o){var s=i.support.touch?"vclick":"click";i.widget("cbsnews.dashboardLoader",i.cbsnews.loadExternal,{options:{slideWidth:300,slidePadding:20,selector:{toggle:'[data-item="close"]',thread:'[data-item="thread"]'},minimizedOnLaunch:!1},container:null,dashboard:null,adLoaded:!1,minimizeDashboard:!1,$window:null,$body:null,_create:function(){var a=this.options,o={};jQuery.browser.mozilla?$body=i("html"):jQuery.browser.msie?$body=i(document):$body=i("body"),this.$window=i(window),this.$body=i(document.body),this._setup(),this.minimizeDashboard=a.minimizedOnLaunch||t.toBool(i.cookie("collectionDashboardMin")),this.container=this._getContainer(),$body.height()<=this.$window.height()?this.load(i.proxy(this._displayDashboard,this)):this.$window.one("scroll",i.proxy(function(){this.load(i.proxy(this._displayDashboard,this))},this)),o[s+' [data-item="close"]']="_toggleDashboard",o[s+a.selector.thread]="_showDashboard",this._on(this.container,o)},_displayDashboard:function(i){i&&(this.dashboard=i),this.$body.addClass("dashboard-visible"),this._toggleDashboard(),this._trigger("contentAvailable",null,{$content:i})},_toggleDashboard:function(i){this.$body.toggleClass("dashboard-minimized",this.minimizeDashboard),this.minimizeDashboard||this.adLoaded||this._updateAd(),i&&(i.preventDefault(),this._updateState()),this.minimizeDashboard=!this.minimizeDashboard},_showDashboard:function(i){i.preventDefault(),this.minimizeDashboard=!1,this._displayDashboard()},_updateAd:function(){var t=i("body").data("suppress-ads");if(1==t)return void this.container.find(".ad-unit").hide();var s=i("#deepstory-dashboard").data("ad");s&&(o.init({ad:s,viewGuid:a.getViewGuid()}),o.loadAds(),this.adLoaded=!0,this._positionAd())},_positionAd:function(){var t=this.options,a=this.container.find(".scroll-left"),o=a.width()+parseInt(i(".scroll-left").css("border-right-width")),s=2*(t.slideWidth+2*t.slidePadding);left=s+o,this.container.find(".ad-unit").css("left",left+"px")},_updateState:function(){i.cookie("collectionDashboardMin",this.minimizeDashboard,{path:"/"})}})});