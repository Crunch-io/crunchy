/*! iFrame Resizer (iframeSizer.min.js ) - v2.5.1 - 2014-06-06
 *  Desc: Force cross domain iframes to size to content.
 *  Requires: iframeResizer.contentWindow.min.js to be loaded into the target frame.
 *  Copyright: (c) 2014 David J. Bradshaw - dave@bradshaw.net
 *  License: MIT
 */

/*!
 * jQuery Cookie Plugin v1.2
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */

/*
Copyright 2013 Michael Countis

MIT License: http://opensource.org/licenses/MIT

 This library taps into XFP's logger function to trigger events,
 and creates googletag.on() and googletag.off() functions for subcribing
 and unsubscribing to these events.

 There is a risk that XFP changes its logging signature and breaks this code,
 so know the risk and don't use it for anything mission critical

*/

/*! jQuery UI - v1.9.2 - 2012-12-11
* http://jqueryui.com
* Includes: jquery.ui.widget.js
* Copyright (c) 2012 jQuery Foundation and other contributors Licensed MIT */

/**
 * easyXDM
 * http://easyxdm.net/
 * Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.

// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell

// The above copyright notice and this permission notice shall be included in

/*!
* jQuery throttle / debounce - v1.1 - 3/7/2010
* http://benalman.com/projects/jquery-throttle-debounce-plugin/
*
* Copyright (c) 2010 "Cowboy" Ben Alman
* Dual licensed under the MIT and GPL licenses.
* http://benalman.com/about/license/
*/

// Script: jQuery throttle / debounce: Sometimes, less is more!
//
// *Version: 1.1, Last updated: 3/7/2010*
//
// Project Home - http://benalman.com/projects/jquery-throttle-debounce-plugin/
// GitHub - http://github.com/cowboy/jquery-throttle-debounce/
// Source - http://github.com/cowboy/jquery-throttle-debounce/raw/master/jquery.ba-throttle-debounce.js
// (Minified) - http://github.com/cowboy/jquery-throttle-debounce/raw/master/jquery.ba-throttle-debounce.min.js (0.7kb)
//
// About: License
//
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
//
// About: Examples
//
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
//
// Throttle - http://benalman.com/code/projects/jquery-throttle-debounce/examples/throttle/
// Debounce - http://benalman.com/code/projects/jquery-throttle-debounce/examples/debounce/
//
// About: Support and Testing
//
// Information about what version or versions of jQuery this plugin has been
// tested with, what browsers it has been tested in, and where the unit tests
// reside (so you can test it yourself).
//
// jQuery Versions - none, 1.3.2, 1.4.2
// Browsers Tested - Internet Explorer 6-8, Firefox 2-3.6, Safari 3-4, Chrome 4-5, Opera 9.6-10.1.
// Unit Tests - http://benalman.com/code/projects/jquery-throttle-debounce/unit/
//
// About: Release History
//
// 1.1 - (3/7/2010) Fixed a bug in <jQuery.throttle> where trailing callbacks
// executed later than they should. Reworked a fair amount of internal
// logic as well.
// 1.0 - (3/6/2010) Initial release as a stand-alone project. Migrated over
// from jquery-misc repo v0.4 to jquery-throttle repo v1.0, added the
// no_trailing throttle parameter and debounce functionality.
//
// Topic: Note for non-jQuery users
//
// jQuery isn't actually required for this plugin, because nothing internal
// uses any jQuery methods or properties. jQuery is just used as a namespace
// under which these methods can exist.
//
// Since jQuery isn't actually required for this plugin, if jQuery doesn't exist
// when this plugin is loaded, the method described below will be created in
// the `Cowboy` namespace. Usage will be exactly the same, but instead of
// $.method() or jQuery.method(), you'll need to use Cowboy.method().

/*! nanoScrollerJS - v0.7.2
* http://jamesflorentino.github.com/nanoScrollerJS/
* Copyright (c) 2013 James Florentino; Licensed MIT */

/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/

/*! CBSI-PLAYER v1.3.1 2016-09-06 3:45:25 PM PDT */

if(define("jquery",[],function(){return jQuery}),!function(){"use strict";function e(e,t,i){"addEventListener"in window?e.addEventListener(t,i,!1):"attachEvent"in window&&e.attachEvent("on"+t,i)}function t(){var e,t=["moz","webkit","o","ms"];for(e=0;e<t.length&&!A;e+=1)A=window[t[e]+"RequestAnimationFrame"];A||i(" RequestAnimationFrame not supported")}function i(e){I.log&&"object"==typeof console&&console.log(_+"[Host page"+y+"]"+e)}function n(e){function t(){function e(){o(A),a(),I.resizedCallback(A)}l(e,A,"resetPage")}function n(e){var t=e.id;i(" Removing iFrame: "+t),e.parentNode.removeChild(e),I.closedCallback(t),i(" --")}function s(){var e=b.substr(E).split(":");return{iframe:document.getElementById(e[0]),id:e[0],height:e[1],width:e[2],type:e[3]}}function d(e){var t=Number(I["max"+e]),n=Number(I["min"+e]),s=e.toLowerCase(),a=Number(A[s]);if(n>t)throw new Error("Value for min"+e+" can not be greater than max"+e);i(" Checking "+s+" is in range "+n+"-"+t),n>a&&(a=n,i(" Set "+s+" to min value")),a>t&&(a=t,i(" Set "+s+" to max value")),A[s]=""+a}function u(){var t=e.origin,n=A.iframe.src.split("/").slice(0,3).join("/");if(I.checkOrigin&&(i(" Checking connection is from: "+n),""+t!="null"&&t!==n))throw new Error("Unexpected message received from: "+t+" for "+A.iframe.id+". Message was: "+e.data+". This error can be disabled by adding the checkOrigin: false option.");return!0}function h(){return _===(""+b).substr(0,E)}function c(){var e=A.type in{"true":1,"false":1};return e&&i(" Ignoring init message from meta parent page"),e}function p(){var e=b.substr(b.indexOf(":")+m+6);i(" MessageCallback passed: {iframe: "+A.iframe.id+", message: "+e+"}"),I.messageCallback({iframe:A.iframe,message:e}),i(" --")}function g(){if(null===A.iframe)throw new Error("iFrame ("+A.id+") does not exist on "+y);return!0}function f(){switch(A.type){case"close":n(A.iframe),I.resizedCallback(A);break;case"message":p();break;case"reset":r(A);break;case"init":t(),I.initCallback(A.iframe);break;default:t()}}var b=e.data,A={};h()&&(i(" Received: "+b),A=s(),d("Height"),d("Width"),!c()&&g()&&u()&&(f(),v=!1))}function s(){null===b&&(b={x:void 0!==window.pageXOffset?window.pageXOffset:document.documentElement.scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop},i(" Get position: "+b.x+","+b.y))}function a(){null!==b&&(window.scrollTo(b.x,b.y),i(" Set position: "+b.x+","+b.y),b=null)}function r(e){function t(){o(e),d("reset","reset",e.iframe)}i(" Size reset requested by "+("init"===e.type?"host page":"iFrame")),s(),l(t,e,"init")}function o(e){function t(t){e.iframe.style[t]=e[t]+"px",i(" IFrame ("+e.iframe.id+") "+t+" set to "+e[t]+"px")}I.sizeHeight&&t("height"),I.sizeWidth&&t("width")}function l(e,t,n){n!==t.type&&A?(i(" Requesting animation frame"),A(e)):e()}function d(e,t,n){i("["+e+"] Sending msg to iframe ("+t+")"),n.contentWindow.postMessage(_+t,"*")}function u(){function t(){function e(e){1/0!==I[e]&&0!==I[e]&&(u.style[e]=I[e]+"px",i(" Set "+e+" = "+I[e]+"px"))}e("maxHeight"),e("minHeight"),e("maxWidth"),e("minWidth")}function n(e){return""===e&&(u.id=e="iFrameResizer"+g++,i(" Added missing iframe ID: "+e)),e}function s(){i(" IFrame scrolling "+(I.scrolling?"enabled":"disabled")+" for "+h),u.style.overflow=!1===I.scrolling?"hidden":"auto",u.scrolling=!1===I.scrolling?"no":"yes"}function a(){("number"==typeof I.bodyMargin||"0"===I.bodyMargin)&&(I.bodyMarginV1=I.bodyMargin,I.bodyMargin=""+I.bodyMargin+"px")}function o(){return h+":"+I.bodyMarginV1+":"+I.sizeWidth+":"+I.log+":"+I.interval+":"+I.enablePublicMethods+":"+I.autoResize+":"+I.bodyMargin+":"+I.heightCalculationMethod+":"+I.bodyBackground+":"+I.bodyPadding+":"+I.tolerance}function l(t){e(u,"load",function(){var e=v;d("iFrame.onload",t,u),!e&&I.heightCalculationMethod in S&&r({iframe:u,height:0,width:0,type:"init"})}),d("init",t,u)}var u=this,h=n(u.id);s(),t(),a(),l(o())}function h(e){if("object"!=typeof e)throw new TypeError("Options is not an object.")}function c(){function e(e){if("IFRAME"!==e.tagName)throw new TypeError("Expected <IFRAME> tag, found <"+e.tagName+">.");u.call(e)}function t(e){e=e||{},h(e);for(var t in D)D.hasOwnProperty(t)&&(I[t]=e.hasOwnProperty(t)?e[t]:D[t])}return function(i,n){t(i),Array.prototype.forEach.call(document.querySelectorAll(n||"iframe"),e)}}function p(e){e.fn.iFrameResize=function(t){return h(t),I=e.extend({},D,t),this.filter("iframe").each(u).end()}}var g=0,v=!0,f="message",m=f.length,_="[iFrameSizer]",E=_.length,y="",b=null,A=window.requestAnimationFrame,S={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},I={},D={autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,enablePublicMethods:!1,heightCalculationMethod:"offset",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,scrolling:!1,sizeHeight:!0,sizeWidth:!1,tolerance:0,closedCallback:function(){},initCallback:function(){},messageCallback:function(){},resizedCallback:function(){}};t(),e(window,"message",n),"jQuery"in window&&p(jQuery),"function"==typeof define&&define.amd?define("libs/iframe-resizer.min",[],function(){return c()}):window.iFrameResize=c()}(),function(){function e(){n=new t,window.addEventListener("message",n.getMessageFromAd,!1)}function t(){var e=this;e._connections={},e._debug_mode={},window.prGarabageCollect=function(){for(var t in e._connections)e.removeAd(t)},window.prGarbageCollect=function(){for(var t in e._connections)e.removeAd(t)},e.createConnection=function(t){var a=t.id,r=t.index,o=null,l={},d={};if(e.log(a,"attempting to find iframe for connection"),document.getElementById("profr"+a))e.log(a,"pr iframe found, connection in progress"),o=document.getElementById("profr"+a);else for(var u=document.getElementsByTagName("iframe"),h=0;h<u.length;h++)try{u[h].contentWindow.prPlacementId==a&&(e.log(a,"non-pr iframe found with matching prPlacementId, connection in progress"),o=u[h])}catch(c){e.error(a,"no iframe contentWindow['prPlacementId'] found")}if(null!=o){e.log(a,"connection listeners and callbacks initialized, connection complete"),e._connections[a]=new i(a,o);for(var p in e._connections[a]._iframe.getBoundingClientRect())l[p]=e._connections[a]._iframe.getBoundingClientRect()[p];try{d={body:{width:document.body.offsetWidth,height:document.body.offsetHeight},iframe:l,window:{width:s.width.target[s.width.prefix+"Width"],height:s.height.target[s.height.prefix+"Height"]},scroll:{x:window.scrollX,y:window.scrollY}}}catch(c){n.error(e._id,"getBoundingClientRect is not supported by this browser")}window.addEventListener("orientationchange",e._connections[a].getBrowserSize,!1),window.addEventListener("resize",e._connections[a].getBrowserSize,!1),window.addEventListener("scroll",e._connections[a].windowScrollHandler,!1),e._connections[a].setAdSlotTarget(r),e._connections[a].getBrowserSize(),e._connections[a].incrementTrackingCount(),e._connections[a].sendMessageToAd({updatePubPageInfo:d})}else e.error(a,"no pr ad found in any iframe")},e.destroyConnection=function(t){window.removeEventListener("orientationchange",e._connections[t].getBrowserSize,!1),window.removeEventListener("resize",e._connections[t].getBrowserSize,!1),window.removeEventListener("scroll",e._connections[t].windowScrollHandler,!1),e._connections[t].removeAllListeners()},e.error=function(t,i){e._debug_mode[t]&&console.log("prPubConnection error ("+t+") - "+i)},e.getMessageFromAd=function(t){var i,n,a;try{i=JSON.parse(t.data),n=i.id,a=i.messages}catch(r){return}null==s&&(s={},s.width={},s.height={},e.getViewport("Width"),e.getViewport("Height"));for(var o in a){var l=o,d=a[o];if(!(/addCustomStyles/.test(l)||/addDirectStyles/.test(l)||/addListener/.test(l)||/debug/.test(l)||/destroy/.test(l)||/hide/.test(l)||/init/.test(l)||/wrapElements/.test(l)||/overwriteImportantStyles/.test(l)||/remove/.test(l)||/removeListener/.test(l)||/reveal/.test(l)||/setAdOffset/.test(l)||/setAdPosition/.test(l)||/setAdSize/.test(l)||/setAdSlotTarget/.test(l)))return;switch(e.log(n,"message received ("+l+")"),e.log(n,d),l){case"addCustomStyles":e._connections[n].setCustomStyles(d);break;case"addDirectStyles":e._connections[n].setDirectStyles(d);break;case"addListener":e._connections[n].addListener(d);break;case"debug":e.setDebugMode(n,d);break;case"destroy":e.destroyConnection(n);break;case"hide":e._connections[n].hideAd();break;case"init":e.createConnection(d);break;case"wrapElements":e._connections[n].wrapElements(d);break;case"overwriteImportantStyles":e._connections[n].overwriteImportantStyles(d);break;case"remove":e.removeAd(n);break;case"removeListener":e._connections[n].removeListener(d);break;case"reveal":e._connections[n].revealAd();break;case"setAdOffset":e._connections[n].setAdOffset(d);break;case"setAdPosition":e._connections[n].setAdPosition(d);break;case"setAdSize":e._connections[n].setAdSize(d);break;case"setAdSlotTarget":e._connections[n].setAdSlotTarget(d)}}},e.getViewport=function(e){var t=e,i=t.toLowerCase(),n=window.document,a=n.documentElement;if(void 0===window["inner"+t])s[i].target=a,s[i].prefix="client";else if(window["inner"+t]!=a["client"+t]){var r=document.createElement("body");r.id="pr-viewport-test-body",r.style.cssText="overflow: scroll;";var o=document.createElement("div");o.id="pr-viewport-test-div",o.style.cssText="position: absolute; top: -1000px;",o.innerHTML="<style>@media("+i+": "+a["client"+t]+"px){body#pr-viewport-test-body div#pr-viewport-test-div{"+i+": 7px! important}}</style>",r.appendChild(o),a.insertBefore(r,n.head),7==o["offset"+t]?(s[i].target=a,s[i].prefix="client"):(s[i].target=window,s[i].prefix="inner"),a.removeChild(r)}else s[i].target=window,s[i].prefix="inner"},e.log=function(t,i){e._debug_mode[t]&&("string"==typeof i?console.log("prPubConnection log ("+t+") - "+i):console.log(i))},e.removeAd=function(t){e.destroyConnection(t),e._connections[t].removeCustomStyles(),e._connections[t].getAdSlotTarget(e._ad_slot_index).style.height="0px",e._connections[t]._iframe.parentNode.removeChild(e._connections[t]._iframe),delete e._connections[t],delete e._debug_mode[t]},e.setDebugMode=function(t,i){e._debug_mode[t]=i},e.warning=function(t,i){e._debug_mode[t]&&console.log("prPubConnection warning ("+t+") - "+i)}}function i(e,t){var i=this;i._ad_is_shown=!0,i._ad_has_shown=!1,i._ad_slot_height=null,i._ad_slot_index=null,i._ad_slot_target=null,i._ad_styles_applied={},i._id=e,i._iframe=t,i._listeners={},i._tracking_buffer=.5,i._tracking_count=0,i._tracking_timeout=null,i.addListener=function(e){var t,n=e.target,s=e.type;switch(n){case"document":t=document;break;case"window":t=window;break;default:t=document.getElementById(n)}i._listeners[n]||(i._listeners[n]={}),t.addEventListener(s,i.customEventFunction,!1),i._listeners[n][s]="added"},i.applyCustomStyles=function(){var e=i._ad_styles_applied;for(var t in e){var n=i.getAdSlotTarget(parseInt(t)),s=i._ad_styles_applied[t];for(var a in s)n.style[a]=i._ad_styles_applied[t][a]}},i.customEventFunction=function(e){var t,s,a,r={},o={};for(var l in e)r[l]=e[l];switch(r.currentTarget.window?(t=window,s="window"):r.currentTarget.write?(t=document,s="document"):(t=document.getElementById(r.target.id),s=r.target.id),a=r.type,r.currentTarget=null,r.explicitOriginalTarget=null,r.originalTarget=null,r.srcElement=null,r.target=null,r.toElement=null,r.view=null,a){case"resize":r.innerWidth=window.innerWidth,r.innerHeight=window.innerHeight;break;case"scroll":r.scrollX=t.scrollX,r.scrollY=t.scrollY}try{for(var d in i._iframe.getBoundingClientRect())o[d]=i._iframe.getBoundingClientRect()[d];r.rect=o}catch(u){n.error(i._id,"getBoundingClientRect is not supported by this browser")}try{var h=JSON.stringify(r);i.sendMessageToAd({dispatchCustomEvent:{name:"custom"+s+a,event:h}})}catch(u){try{for(var l in r)"string"!=typeof r[l]&&"number"!=typeof r[l]&&"rect"!==l&&delete r[l];var h=JSON.stringify(r);i.sendMessageToAd({dispatchCustomEvent:{name:"custom"+s+a,event:h}})}catch(u){n.error(i._id,"cyclic structure found in listener event object, cannot send event to ad"),n.log(i._id,r)}}},i.getAdSlotSize=function(){var e=i._ad_slot_target.offsetWidth,t=i._ad_slot_target.offsetHeight;i.sendMessageToAd({setAdSlotSize:{width:e,height:t}})},i.getAdSlotTarget=function(e){var t;if(void 0!=e&&null!=e&&""!=e){t=i._iframe;for(var n=0;e>n;n++)t=t.parentNode}else t=i._ad_slot_target;return t},i.getBrowserSize=function(){window.setTimeout(function(){var e=s.width.target[s.width.prefix+"Width"],t=s.height.target[s.height.prefix+"Height"];i.getAdSlotSize(),i.updateBodySize(),i.updateIframeRect(),i.updateWindowSize(),i.sendMessageToAd({browserSizeUpdated:{width:e,height:t}})},0)},i.hideAd=function(){if(window.clearTimeout(i._tracking_timeout),i._tracking_count/1e3<i._tracking_buffer&&(i._tracking_count=i._tracking_buffer,i.sendMessageToAd({fireNonImpression:null})),i._ad_is_shown){i._ad_is_shown=!1;var e=i.getAdSlotTarget(i._ad_slot_index);_ad_slot_height=e.offsetHeight,e.style.height="0px",e.style.overflow="hidden",i.removeCustomStyles()}},i.incrementTrackingCount=function(){i._tracking_count+=10,i._tracking_timeout=window.setTimeout(i.incrementTrackingCount,10)},i.overwriteImportantStyles=function(e){for(var t in e){var i=document.querySelectorAll(t),n=e[t],s="";for(var a in n)s+=a+": "+n[a]+" !important; ";for(var r=0;r<i.length;r++)i[r].style.cssText=s}},i.removeAllListeners=function(){for(var e in i._listeners){var t;switch(e){case"window":t=window;break;case"document":t=document;break;default:t=document.getElementById(e)}for(var n in i._listeners[e])"added"==i._listeners[e][n]&&(t.removeEventListener(n,i.customEventFunction,!1),i._listeners[e][n]="removed")}},i.removeCustomStyles=function(){var e=i._ad_styles_applied;for(var t in e){var n=i.getAdSlotTarget(parseInt(t)),s=i._ad_styles_applied[t];for(var a in s)n.style[a]="initial"}},i.removeListener=function(e){var t,s=e.target,a=e.type;switch(s){case"window":t=window;break;case"document":t=document;break;default:t=document.getElementById(target)}t.removeEventListener(a,i.customEventFunction,!1);try{i._listeners[s][a]="removed"}catch(r){n.error(i._id,"trying to remove event listener that has not yet been added")}},i.revealAd=function(){i._ad_is_shown||(i._ad_is_shown=!0,i.getAdSlotTarget(i._ad_slot_index).style.height=_ad_slot_height+"px"),i.applyCustomStyles()},i.sendMessageToAd=function(e){i._iframe.contentWindow.postMessage(JSON.stringify(e),"*")},i.setAdOffset=function(e){for(var t in e)i._iframe.style[t]=e[t];i.updateIframeRect()},i.setAdPosition=function(e){i._iframe.style.position=e,i.updateIframeRect()},i.setAdSize=function(e){for(var t in e){var n=e[t];i._iframe.setAttribute(t,n.replace(/px/g,"")),i._ad_slot_target.style[t]=n}i.updateIframeRect()},i.setAdSlotTarget=function(e){i._ad_slot_index=parseInt(e),i._ad_slot_target=i._iframe;for(var t=0;t<i._ad_slot_index;t++)i._ad_slot_target=i._ad_slot_target.parentNode},i.setCustomStyles=function(e){var t=i._ad_slot_index,s=i.getAdSlotTarget(t);if(i._ad_is_shown){i._ad_styles_applied[t]||(i._ad_styles_applied[t]={});for(var a in e)i._ad_styles_applied[t][a]=e[a],s.style[a]=e[a]}else n.warning(i._id,"attempting to add custom styles to the ad slot while it is hidden")},i.setDirectStyles=function(e){for(var t in e)for(var i=document.querySelectorAll(t),n=e[t],s=0;s<i.length;s++)for(var a in n)i[s].style[a]=n[a]},i.updateBodySize=function(e){var t={body:{width:document.body.offsetWidth,height:document.body.offsetHeight}};i.sendMessageToAd({updatePubPageInfo:t})},i.updateIframeRect=function(){try{var e={iframe:{}};for(var t in i._iframe.getBoundingClientRect())e.iframe[t]=i._iframe.getBoundingClientRect()[t];i.sendMessageToAd({updatePubPageInfo:e})}catch(s){n.error(i._id,"getBoundingClientRect is not supported by this browser")}},i.updateWindowSize=function(){var e={window:{width:s.width.target[s.width.prefix+"Width"],height:s.height.target[s.height.prefix+"Height"]}};i.sendMessageToAd({updatePubPageInfo:e})},i.windowScrollHandler=function(e){var t={scroll:{x:window.scrollX,y:window.scrollY}};i.sendMessageToAd({updatePubPageInfo:t})},i.wrapElements=function(e){var t,i=e["class"]||"",n=Array.prototype.slice.call(document.querySelectorAll(e.elements)),s=e.id,a=e.max||n.length,r=e.min||0,o=e.tag,l=e.to;t=o?document.createElement(o):document.createElement("div"),t.id=s,t.className=i;for(var d=r;a>d;d++){var u=n[d];d===r&&u.parentNode.insertBefore(t,u),t.appendChild(u)}l&&document.querySelectorAll(l)[0].appendChild(t)}}var n,s=null;e()}(),!window.console)var console={dir:function(){},info:function(){},log:function(){},warn:function(){}};define("libs/pointroll.resp.lib",function(){}),window.uuid||(window.uuid={}),"undefined"==typeof window.uuid.v4&&(window.uuid.v4=function(){var e,t,i="";for(e=0;32>e;e++)t=16*Math.random()|0,(8==e||12==e||16==e||20==e)&&(i+="-"),i+=(12==e?4:16==e?3&t|8:t).toString(16);return i}),define("fly/libs/uuid.v4",function(){}),function(){"use strict";var e=null,t=function(e,t){return!0};define("version",{version:"1.0",load:function(i,n,s,a){var r,o,l=a.config.version;if(!l)throw new Error("A version config has not been setup");if(!l[i])throw new Error("A version was not specified for module: "+i);if(e&&(o=l[i],!t(o,e)))throw new Error('An incompatiable version of "'+i+'" was loaded. "'+o+'" was loaded, but "'+e+'" is required.');r=i+"-"+a.config.version[i],n([r],function(e){s(e)})},normalize:function(t){var i=/\(([^)]*)\)/.exec(t);return e=null,i&&(e=i[1],t=t.substring(0,i.index)),t}})}(),define("fly/utils/string-helper-1.0",["jquery"],function(e){return{capitalize:function(e){return e.replace(/\b[a-z]/g,function(e){return e.toUpperCase()})},lowerFirst:function(e){return e.charAt(0).toLowerCase()+e.slice(1)},toBool:function(e){return e===!0||"true"===e||"1"===e?!0:!1},toCleanArray:function(t,i){return i=i||",",t="string"==typeof t?e.map(t.split(i),e.trim):e.makeArray(t),t=e.grep(t,function(e){return e})},toCamelCase:function(e,t){return t=t||"-",e.replace(new RegExp("(\\"+t+"[a-z])","g"),function(e){return e.toUpperCase().replace(t,"")})},fromCamelCase:function(e,t){return t=t||"-",e.replace(/[A-Z]/g,function(e){return t+e.toLowerCase()})},toEventName:function(e){return e.replace(/^on([A-Z])/,function(e){return e.charAt(2).toLowerCase()})},isEventOption:function(e){return/^on([A-Z])/.test(e)}}}),define("fly/utils/url-helper-1.0",["jquery"],function(e){return{getParam:function(e){var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return t?t[1]:null},getParamAsArray:function(e){var t=this.getParam(e);return t?t.split(","):null},getAllParams:function(){var e=window.location.search.substring(1),t=e.split("&"),i={};if(""===e)return{};for(var n=0;n<t.length;n++){var s=t[n].split("=");i[unescape(s[0])]=unescape(s[1])}return i},getHashParam:function(e){var t=window.location.hash.substring(1),i="",n="";if(-1!=t.indexOf(e)){if(i=t.substring(t.indexOf(e)),-1!=i.indexOf("&")){var s=i.split("&");n=s[0].split("=")}else n=i.split("=");return n[1]}return!1},paramExists:function(e){return window.location.href.match("[\\?&]"+e+"([=&#]|$)")?!0:!1}}}),define("fly/libs/jquery.cookie-1.2",["jquery"],function(e){function t(e){return e}function i(e){return decodeURIComponent(e.replace(n," "))}var n=/\+/g;e.cookie=function(n,s,a){if(void 0!==s&&!/Object/.test(Object.prototype.toString.call(s))){if(a=e.extend({},e.cookie.defaults,a),null===s&&(a.expires=-1),"number"==typeof a.expires){var r=a.expires,o=a.expires=new Date;o.setDate(o.getDate()+r)}return s=String(s),document.cookie=[encodeURIComponent(n),"=",a.raw?s:encodeURIComponent(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}a=s||e.cookie.defaults||{};for(var l,d=a.raw?t:i,u=document.cookie.split("; "),h=0;l=u[h]&&u[h].split("=");h++)if(d(l.shift())===n)return d(l.join("="));return null},e.cookie.defaults={},e.removeCookie=function(t,i){return null!==e.cookie(t,i)?(e.cookie(t,null,i),!0):!1}}),define("fly/managers/cookie-1.0",["jquery","fly/libs/jquery.cookie-1.2"],function(e){var t={domains:{"default":null}};return{init:function(e){this.setConfig(e)},setConfig:function(i){e.isPlainObject(i)&&e.extend(t,i)},set:function(i,n,s){s=s||{},(e.isPlainObject(n)||e.isArray(n))&&(n=JSON.stringify(n)),s.domain?s.domain in t.domains&&(s.domain=t.domains[s.domain]):s.domain=t.domains["default"],s.domain||delete s.domain,e.cookie(i,n,s)},get:function(t){var i,n=e.cookie(t);try{i=e.parseJSON(n)}catch(s){i=n}return i},remove:function(t,i){e.removeCookie(t,i)}}}),define("fly/managers/debug-1.0",["jquery","module","version!fly/utils/string-helper","version!fly/utils/url-helper","version!fly/managers/cookie"],function(e,t,i,n,s){var a,r,o,l={},d={queryParam:"jsDebug",cookie:{name:"fly_js_debug",domain:"default"}},u=!1,h=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};return e.extend(d,t.config()),r=n.getParamAsArray(d.queryParam),r?s.set(d.cookie.name,r,{path:"/",domain:d.cookie.domain}):o=s.get(d.cookie.name)||[],(e.inArray("true",r)>-1||e.inArray("all",r)>-1)&&(s.set(d.cookie.name,!0,{path:"/",domain:d.cookie.domain}),u=!0),a=function(t){this.name=t,this.color="hsl("+h(0,360)+","+h(35,80)+"%,"+h(20,45)+"%)",(o===!0||e.inArray(this.name,r)>-1||e.inArray(this.name,o)>-1)&&this.enable()},a.prototype={constructor:a,enabled:!1,log:function(){var e,t=arguments;if(window.console&&(this.enabled||u))return t.callee=t.callee.caller,e=[].slice.call(t),e.unshift("%c "+this.name+" ","color:#fff;border-radius:3px;background-color:"+this.color+";"),"object"==typeof console.log||console.log.apply(console,e),this},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this}},{init:function(e){var t=new a(e);return l[e]=t,t},get:function(e){return l[e]||this.init(e)}}}),define("fly/managers/gpt-4.2",["jquery","version!fly/utils/string-helper","version!fly/utils/url-helper","version!fly/managers/debug"],function(e,t,i,n){var s={},a=n.get("ads"),r={},o={},l=[],d=[],u=0,h=[],c=[],p="1",g=!1,v=[],f={callbackMethods:{},adDivEventCallbacks:{},setCallback:function(e,t){this.callbackMethods[e]=t},setAdDivEventCallback:function(e,t,i){var n=this.callbackMethods[i];"function"==typeof n&&(a.log("gpt::setAdDivEventCallback:",e,{eventName:t,callbackName:i,callbackMethod:n}),this.adDivEventCallbacks[e]||(this.adDivEventCallbacks[e]={}),this.adDivEventCallbacks[e][t]||(this.adDivEventCallbacks[e][t]=[]),this.adDivEventCallbacks[e][t].push(n))},slotRenderEndedCallBack:function(t){var i=f,n="NOT FOUND";e.each(o,function(e,i){return i===t.slot?void(n=e):void 0}),a.log("gpt::slotRenderEndedCallback",{divId:n,event:t});var s=i.adDivEventCallbacks[n]&&i.adDivEventCallbacks[n].slotRenderEnded;if(s){a.log("gpt::slotRenderEndedCallback: calling event callbacks");for(var r=0;r<s.length;r++)s[r](n,t)}}},m=function(e,t,i){if(e&&(t||i)&&(i&&(a.log("gpt::setAdSlotTargeting:","clearing targeting on slot:",e),e.clearTargeting()),t)){a.log("gpt::setAdSlotTargeting:","setting targeting:",t,"on slot:",e);for(var n in t)e.setTargeting(n,t[n])}};return{companionAds:!1,delayIndvAds:!1,init:function(t){if(s={slot:{},adConfig:{},targeting:{}},e.extend(s,t),!this._isClearTargetingOnInitDisabled()){for(var i=0;i<v.length;i++){var n=v[i];googletag.pubads().clearTargeting(n),a.log("gpt::init: clearTargeting:",n)}v=[]}this._initWrappers();var r=null;s.device=s.slotVars.platform;var o="iOS App",l="Android App",d=window.navigator.userAgent;r=d&&d.indexOf&&(-1!=d.indexOf(o)||-1!=d.indexOf(l))?"app"+s.region:"mobile"==s.device?"m"+s.region:s.region,s.slot="/"+s.slotVars.network+"/"+r+"-"+s.slotVars.siteName+(s.slotVars.topics?"/"+s.slotVars.topics:""),a.log("gpt::init:","Slot:",s.slot)},setSlot:function(e){s.slot=e},createAdSlot:function(i){var n=this;a.log("gpt::createAdSlot","creating adSlot for",i);var d=i.substring(0,i.indexOf("-"+s.containerId));if(s.suppressAds&&(e.inArray(d,s.suppressAds)>-1||e.inArray(d.replace(/-/g,"_"),s.suppressAds)>-1))return void a.log("   in list of suppressed ads, skipping");var u=s.adConfig.adUnits[t.toCamelCase(d,"-")];if(a.log("   adUnit config:",u),!u)return a.log("gpt::createAdSlot:",i,"Error: no adUnit config for this divId"),void(window.console&&window.console.error&&console.error("gpt::createAdSlot:",i,"Error: no adUnit config for this divId"));var h;if(1==u.outOfPage?(h=googletag.defineOutOfPageSlot(s.slot,i),a.log("   create out of page slot")):(h=googletag.defineSlot(s.slot,u.sizes,i),a.log("   create regular slot")),!h)return a.log("gpt::createAdSlot:",i,"Error: failed to create adSlot"),void(window.console&&window.console.error&&console.error("gpt::createAdSlot:",i,"Error: failed to create adSlot"));1==u.isVideo&&(n.companionAds=!0,h.addService(googletag.companionAds()),a.log("   add companionAds service")),h.addService(googletag.pubads()),a.log("   add pubad service"),u.position&&("increment"==u.position?(h.setTargeting("pos",p),a.log("   setTargeting:","pos="+p),p++):(h.setTargeting("pos",u.position),a.log("   setTargeting:","pos="+u.position))),u.customTargeting&&e.each(u.customTargeting,function(e,t){a.log("    setTargeting:",e+"="+t),h.setTargeting(e,t)}),u.disableInitialLoad||u.delayLoad?(n.delayIndvAds=!0,a.log("   delayLoad")):l.push(h);var c=u.collapseEmptyDiv,g=u.collapseEmptyDivOnPageload;(c===!0||c===!1)&&(g===!0||g===!1?(h.setCollapseEmptyDiv(c,g),a.log("   setCollapseEmptyDiv(",c,",",g,")")):(h.setCollapseEmptyDiv(c),a.log("   setCollapseEmptyDiv(",c,")"))),u.eventCallbacks&&e.each(u.eventCallbacks,function(e,t){for(var n=t.split(","),s=0;s<n.length;s++)f.setAdDivEventCallback(i,e,n[s])}),o[i]=h,r[s.containerId]||(r[s.containerId]={}),r[s.containerId][d]||(r[s.containerId][d]=[]),r[s.containerId][d].push(h)},setTargeting:function(e,t){googletag.pubads().setTargeting(e,t),a.log("gpt::setTargeting:",e+"="+t),v.push(e)},displayAds:function(t){var i=this;e.each(t,function(e,t){a.log("gpt::displayAds:",t),i.wrappers.display(t)})},isAsyncInline:function(){var t=s.adDivIds;return"async-inline"==s.adConfig.method&&t&&e.isArray(t)&&(1!=t.length||"ad-div-id-list"!=t[0])},getAdDivIds:function(){var i=this,n=[],r={};if(i.isAsyncInline()){var o=new RegExp("^([\\w\\-]+)\\-"+s.containerId+"(\\-\\d+)?$");return e.each(s.adDivIds,function(e,t){var i;if(i=t.match(o)){var l=i[1];"mobile"!=s.targeting.device&&r[l]?a.log("gpt::getAdDivIds:","skipping divId:",t,"because repeated adUnits are not supported on ",s.targeting.device):(n.push(t),r[l]=1)}else a.log("gpt::getAdDivIds:","skipping divId:",t,"because it does not match:",o,"(async-inline adConfig.adDivIds list was probably not re-initialized with the current divIds)")}),i.adOrder(n)}return e("div[data-ad]").each(function(i,o){var l=e(o).attr("data-ad"),d=e(o).attr("id");if(!s.adConfig.adUnits[t.toCamelCase(l,"-")])return void a.log("gpt::getAdDivIds:","skipping divId:",d,'because there is no config (probably another type of div with "data-ad" attr)');var u=new RegExp(l+"-"+s.containerId+"(\\-\\d+)?$");d.match(u)?"mobile"!=s.targeting.device&&r[l]?a.log("gpt::getAdDivIds:","skipping divId:",d,"because repeated adUnits are not supported on ",s.targeting.device):(n.push(d),r[l]=1):a.log("gpt::getAdDivIds:","skipping divId:",d,"because it does not match:",u,'(was probably already loaded under a different "containerId", or possibly another type of div with "data-ad" attr)')}),i.adOrder(n)},adOrder:function(i){if("undefined"!=typeof s.adConfig.adOrder&&e.isArray(s.adConfig.adOrder)&&i.length>0){var n=s.containerId&&i&&-1!=i[0].indexOf("-"+s.containerId),r=[];e.each(s.adConfig.adOrder,function(e,i){i=t.fromCamelCase(t.toCamelCase(i,"_"),"-"),n&&(i+="-"+s.containerId),r.push(i)}),e.each(r.reverse(),function(t,n){currentIndex=e.inArray(n,i),currentIndex>-1&&(i.splice(currentIndex,1),i.unshift(n))}),a.log("gpt::adOrder:","ordered divIds",i)}return i},displayInlineAd:function(t){var i=e.inArray(t,h);if(i>-1){if(a.log("gpt::displayInlineAd:",t),this.wrappers.display(t),h.splice(i,1),0==h.length)for(a.log("gpt::displayInlineAd:","running any postDisplayCmds:",c);c.length;)c.shift()()}else a.log("gpt::displayInlineAd:",t,"ERROR: ad was already displayed or should not be displayed at all")},adDisplayTrigger:function(){var t=this;if(a.log("gpt::adDisplayTrigger:","ready to display any inline ads"),e.isArray(window.cbsiGptDivIds))for(a.log("gpt::adDisplayTrigger:","displaying ads for any existing cbsiGptDivIds:",window.cbsiGptDivIds);window.cbsiGptDivIds.length;)t.displayInlineAd(window.cbsiGptDivIds.shift());a.log("gpt::adDisplayTrigger:","setting future cbsiGptDivId ads to display immediately"),window.cbsiGptDivIds={push:t.displayInlineAd}},loadAds:function(){var t=this;return a.log("gpt::loadAds:",s),s.suppressAds&&e.inArray("all",s.suppressAds)>-1?void a.log('gpt::loadAds: not loading any ads because "suppressAds" contains "all"'):"async"==s.adConfig.method||t.isAsyncInline()?(t.isAsyncInline()&&(h=s.adDivIds.slice()),u++,d.push(s.containerId),l=[],s.adConfig.disableInitialLoadCompanions===!0&&e.each(s.adConfig.adUnits,function(e,t){t.isVideo&&(t.disableInitialLoad=!0)}),googletag=window.googletag||{},googletag.cmd=googletag.cmd||[],void googletag.cmd.push(function(){var i=t.getAdDivIds();if(a.log("gpt::loadAds","adDivIds:",i),e.each(i,function(e,i){t.createAdSlot(i)}),e.each(s.targeting,function(e,i){t.setTargeting(e,i)}),1==t.companionAds&&(null==s.adConfig.setRefreshUnfilledSlots||s.adConfig.setRefreshUnfilledSlots===!0?(googletag.companionAds().setRefreshUnfilledSlots(!0),a.log("gpt::loadAds","CompanionAds setRefreshUnfilledSlots = true")):(googletag.companionAds().setRefreshUnfilledSlots(!1),a.log("gpt::loadAds","CompanionAds setRefreshUnfilledSlots = false")),s.adConfig.setClearUnfilledSlots===!0&&(googletag.companionAds().setClearUnfilledSlots(!0),a.log("gpt::loadAds","CompanionAds setClearUnfilledSlots = true"))),(null==s.adConfig.enableAsyncRendering||s.adConfig.enableAsyncRendering===!0)&&(googletag.pubads().enableAsyncRendering(),a.log("gpt::loadAds","enableAsyncRendering")),(null==s.adConfig.enableSingleRequest||s.adConfig.enableSingleRequest===!0)&&(googletag.pubads().enableSingleRequest(),a.log("gpt::loadAds","enableSingleRequest")),1==u&&(s.adConfig.collapseEmptyDiv===!0?(googletag.pubads().collapseEmptyDivs(!0),a.log("gpt::loadAds","collapseEmptyDivs before ad fetch")):(googletag.pubads().collapseEmptyDivs(),a.log("gpt::loadAds","collapseEmptyDivs after ad fetch")),(s.adConfig.disableInitialLoad===!0||1==t.delayIndvAds||s.adConfig.disableInitialLoadRefresh===!0)&&(googletag.pubads().disableInitialLoad(),g=!0,a.log("gpt::loadAds","disableInitialLoad")),googletag.enableServices(),a.log("gpt::loadAds","enableServices"),googletag.pubads().addEventListener("slotRenderEnded",f.slotRenderEndedCallBack)),t.isAsyncInline()?t.adDisplayTrigger():t.displayAds(i),g&&s.adConfig.disableInitialLoad!==!0){var n=function(){t.wrappers.refresh(l),a.log("gpt::loadAds","refreshing initialLoad ads",l)};t.isAsyncInline()&&h.length>0?c.push(n):n()}})):void a.log("gpt::Unable to load ads as method is not async or async-inline")},registerCallback:function(e,t){f.setCallback(e,t)},refresh:function(i,n,s,l){var u=this;i&&i.length>25&&(i=""),googletag.cmd.push(function(){if(!i&&void 0===n){if(s||l)for(var h in o)m(o[h],s,l);return u.wrappers.refresh(),void a.log("gpt::refresh:","refresh all ads")}if(n){var c=[];e.each(n,function(e,i){c.push(t.fromCamelCase(t.toCamelCase(i,"_"),"-"))}),n=c}var p=[];if(i){if(r[i]){var g=[];g=n?n:Object.keys(r[i]),g=u.adOrder(g),e.each(g,function(e,t){r[i][t]&&(p=p.concat(r[i][t]),a.log("gpt::refresh:",t+"-"+i))})}}else if(n){n=u.adOrder(n);for(var v={},f=d.length-1;f>-1;f--)r[d[f]]&&e.each(n,function(e,t){!v.hasOwnProperty(t)&&r[d[f]][t]&&(v[t]=1,p=p.concat(r[d[f]][t]),a.log("gpt::refresh:",t+"-"+d[f]))})}if(s||l)for(var f=0;f<p.length;f++)m(p[f],s,l);u.wrappers.refresh(p),a.log("gpt::refresh",p)})},refreshLastLoad:function(e,t,i){var n=this;d.length>0&&n.refresh(d[d.length-1],e,t,i)},_isClearTargetingOnInitDisabled:function(){return!0===s.adConfig.disableClearTargetingOnInit;
},_initWrappers:function(){this.headerBidding.isEnabled()&&(a.log("gpt::_initWrappers","Replacing wrappers"),this.wrappers=this.headerBidding)},wrappers:{display:function(e){a.log("gpt::wrappers.display","Executing the standard ad logic"),googletag.display(e)},refresh:function(e){a.log("gpt::wrappers.refresh","Executing the standard ad logic"),googletag.pubads().refresh(e)}},headerBidding:{isEnabled:function(){return!0===s.adConfig.enableHeaderBidding&&"object"==typeof window.index_headertag_lightspeed&&"function"==typeof window.index_headertag_lightspeed.set_slot_targeting&&"function"==typeof window.index_headertag_lightspeed.add_session_end_hook&&"function"==typeof window.index_headertag_lightspeed.refresh},display:function(t){a.log("gpt::headerBidding.display","Header bidding display() started"),e(window).trigger("gptMgr.headerBiddingDisplayStart"),index_headertag_lightspeed.display(!1,[t]),e(window).trigger("gptMgr.headerBiddingDisplayEnd"),a.log("gpt::headerBidding.display","Header bidding display() completed")},refresh:function(t){a.log("gpt::headerBidding.refresh","Header bidding refresh() started"),e(window).trigger("gptMgr.headerBiddingRefreshStart"),void 0===t&&(t=window.googletag.pubads().getSlots());var i=function(t){return function(){window.index_headertag_lightspeed.set_slot_targeting(t),e(window).trigger("gptMgr.headerBiddingRefreshEnd"),googletag.pubads().refresh(t),a.log("gpt::headerBidding.refresh","Header bidding refresh() completed")}}(t);window.index_headertag_lightspeed.add_session_end_hook(i,!0),window.index_headertag_lightspeed.refresh()}}}}),define("fly/managers/geo-1.0",["jquery","version!fly/managers/cookie"],function(e,t){var i=t.get("fly_geo")||{};return{get:function(e){return i[e]?i[e]:null}}}),define("fly/managers/ad-2.0",["jquery","version!fly/managers/gpt","version!fly/managers/debug","version!fly/managers/geo","version!fly/utils/url-helper","version!fly/libs/jquery.cookie"],function(e,t,i,n,s){var a={data:{},init:function(e){this.data=e,o.log("blueKai::init::data",e)},fire:function(){var t=this;t.data.bkSiteId&&require(["//tags.bkrtx.com/js/bk-coretag.js"],function(){bk_addPageCtx("anon_id",e.cookie("XCLGFbrowser")),e.each(t.data,function(e,t){"bkSiteId"!=e&&"limit"!=e&&bk_addPageCtx(e,t)}),o.log("bluekai fire",t.data),bk_doJSTag(t.data.bkSiteId,t.data.limit),bk_ignore_meta=!0,e("#__bkframe").hide()})}},r=null,o=i.get("ads"),l={debug:i.get("paramMgr"),get:function(t){if(this.debug.log("getting params for",t),t){var i=s.getParamAsArray(t);this.debug.log("url params:",i);var n="fly_params_"+t;return i?(e.cookie(n,JSON.stringify(i),{path:"/"}),this.debug.log("set cookie:",n,i)):s.paramExists(t)?(e.removeCookie(n,{path:"/"}),this.debug.log("deleted cookie:",n)):(i=JSON.parse(e.cookie(n)),this.debug.log("cookie params:",i)),i}}},d={adData:{},adType:null,isCookieLoaded:!1,cookieValues:{},targeting:{},ftagCookieValue:null,getAdType:function(){return this.cookieValues?this.cookieValues.type:!1},getAdRegion:function(){return this.cookieValues?this.cookieValues.region:!1},getSessionTargeting:function(){return this.cookieValues&&this.cookieValues.session?this.cookieValues.session:!1},getSubSessionTargeting:function(){return this.cookieValues&&this.cookieValues.subSession?this.cookieValues.subSession:!1},getFtagTargeting:function(){return this.ftagCookieValue},isCrossDomain:function(e){e=e.toLowerCase();var t=window.location;return 0==e.search(/https?:\/\//)&&0!=e.search(t.protocol+"//"+t.host+"/")},getCookieDefaults:function(e){var t=e.ad,i={type:t.defaultAdType,region:t[t.defaultAdType].adConfig.defaultRegion};return t.session&&(i.session=this.getSession(t.session)),t.subSession&&(i.subSession=this.getSession(t.subSession,"1234567890")),i},getSession:function(e,t){if(e){var t=t||"abcdefghijklmnopqrstuvwxyz";return e>t.length&&(o.log("ad::getSession:",e,"exceeds the max number of sessions",t.length),e=t.length),t.charAt(Math.floor(Math.random()*e))}},getRegion:function(t,i){var s=t.adConfig.regions||[],a=t.targeting.device||"desktop",r=t.adConfig.deviceRegions&&t.adConfig.deviceRegions[a];if(r&&r.length>0&&(s=r),i=i||n.get("countryCode"),!i&&s.length>0)return void o.log("ad::getRegion: failed to get countryCode from fly geo cookie");for(var l,d=0;d<s.length;d++)if(e.inArray(i,s[d].countries)>-1||e.inArray("all",s[d].countries)>-1){l=s[d].region;break}return l||t.adConfig.defaultRegion},buildCookie:function(e,t){var i=e.ad;t=t||{};var n={};return n.type=t.adType||"gpt",n.region=t.adRegion||this.getRegion(i[n.type],t.adCountry),n.region?((t.adSession||i.session)&&(n.session=t.adSession||this.getSession(i.session)),(t.adSubSession||i.subSession)&&(n.subSession=t.adSubSession||this.getSession(i.subSession,"1234567890")),n):void o.log("ad::buildCookie: failed to determine ad region")},postCookieInit:function(i){var n=i.ad;if(r=this.getAdType(),!r)return o.log("unable to get adtype cookie"),!1;if(o.log("ads::init:","adType",r),n=n[r],!n)return o.log("Can't access adType data for "+r),!1;if(i.ad.useFirstPageTargeting){var s="first_page_today";if(window.firstpgvar=1==window.firstpgvar||null==e.cookie(s)?"1":"0",n.targeting.firstpg=window.firstpgvar,o.log('setting "first page" targeting to:',n.targeting.firstpg),null==e.cookie(s)){var d=new Date,u=Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),this.isEDT(d)?4:5);u+=u>d.getTime()?0:864e5;var h=document.domain.split(".").reverse(),c=h[1]+"."+h[0];e.cookie(s,!1,{path:"/",expires:new Date(u),domain:c}),o.log("set "+s+" cookie to expire at ",new Date(u).toUTCString())}}n.suppressAds=l.get("adSuppress"),o.log("ads::init suppressAds = ",n.suppressAds),n.targeting.vguid=i.viewGuid,o.log("ads::init","vguid",n.targeting.vguid);var p=this.getSessionTargeting(),g=this.getSubSessionTargeting();p&&(n.targeting.session=p),g&&(n.targeting.subses=g);var v=this.getFtagTargeting();if(v&&(n.targeting.ftag=v),e.extend(n.targeting,this.targeting),n.region=this.getAdRegion(),i.ad.blueKai){var f=i.ad.blueKai,m=n.slotVars,_="";n.targeting.device&&"mobile"==n.targeting.device&&(_="m"),f.path=_+n.region+"-"+m.siteName+"/"+m.topics,a.init(f)}"madison"===r?(madisonMgr.init(n),o.log("ads::init:","Initialize Madison",n)):"gpt"===r&&(t.init(n),o.log("ads::init:","Initialize Gpt",n))},loadAds:function(e){(1==e||d.isCookieLoaded)&&(o.log("ads::loadAds:","Loading Gpt"),t.loadAds(),o.log("ads::loadAds:","Finished Loading Gpt"),a.fire())},init:function(t){var i=this,n=t.ad.cookieName;s.getParam("ftag")&&(e.cookie(n+"_ftag",s.getParam("ftag")),i.ftagCookieValue=s.getParam("ftag")),s.getHashParam("ftag")&&(e.cookie(n+"_ftag",s.getHashParam("ftag")),i.ftagCookieValue=s.getHashParam("ftag")),e.cookie(n+"_ftag")&&(i.ftagCookieValue=e.cookie(n+"_ftag"));var a={},r=!1;if(s.getParam("adRegion")&&(a.adRegion=s.getParam("adRegion"),r=!0),s.getParam("adType")&&(a.adType=s.getParam("adType"),r=!0),s.getParam("adCountry")&&(a.adCountry=s.getParam("adCountry"),r=!0),s.getParam("adSession")&&(a.adSession=s.getParam("adSession"),r=!0),s.getParam("adSubses")&&(a.adSubSession=s.getParam("adSubses"),r=!0),s.getParam("adNetwork")&&("7336"==s.getParam("adNetwork")||"8264"==s.getParam("adNetwork"))&&t.ad.gpt&&(t.ad.gpt.slotVars.network=s.getParam("adNetwork")),e.each(s.getAllParams(),function(e,t){var n=e.match(/adTargeting_(.+)/);n&&n[1]&&(i.targeting[n[1]]=t)}),e.cookie(n)&&1!=r)i.cookieValues=JSON.parse(e.cookie(n)),i.postCookieInit(t),i.isCookieLoaded=!0;else{var l=i.buildCookie(t,a);l?(e.cookie(n,JSON.stringify(l),{path:"/"}),i.cookieValues=l,i.postCookieInit(t),i.isCookieLoaded=!0):o.log("ad::init: failed to build cookie")}if(!i.isCookieLoaded){var d={type:"get",data:a,cache:!1},u=t.ad.cookieServicePath||"/ad/ad-cookie/";i.isCrossDomain(u)&&e.extend(d,{jsonp:!1,jsonpCallback:"handleCookie",dataType:"jsonp",timeout:3e3,data:{p:""}}),d.url=u+t.viewGuid,e.ajax(d).done(function(s){o.log("trackingCookie::init","loading json response"),e.cookie(n)||e.cookie(n,JSON.stringify(s),{path:"/"}),i.cookieValues=s,i.postCookieInit(t),i.loadAds(!0)}).fail(function(e,n){o.log("trackingCookie::init","unable to load url",u+t.viewGuid,n),window.console&&window.console.error&&console.error("ads::trackingCookie::init","unable to load url",u+t.viewGuid,n),t.ad.useDefaultsOnCookieError?(o.log("trackingCookie::init","using default cookie values instead"),i.cookieValues=i.getCookieDefaults(t),i.postCookieInit(t),i.loadAds(!0)):o.log("trackingCookie::init","not loading ads")})}},isEDT:function(e){var t=new Date(e.getFullYear(),2,1);t=Date.UTC(t.getUTCFullYear(),2,14-(t.getUTCDay()+13)%7,5);var i=new Date(e.getFullYear(),10,1);return i=Date.UTC(i.getUTCFullYear(),10,7-(i.getUTCDay()+6)%7,4),e.getTime()>=t&&e.getTime()<i}};return{init:function(e){d.init(e)},loadAds:function(){d.loadAds()},getAdObj:function(){return d.isCookieLoaded?t:void 0},getGptObj:function(){return t},getBlueKaiPath:function(){return t.getBlueKaiPath}}}),function(){"use strict";window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],googletag.cmd.push(function(){if(!(googletag.hasOwnProperty("on")||googletag.hasOwnProperty("off")||googletag.hasOwnProperty("trigger")||googletag.hasOwnProperty("events"))){var e=googletag.debug_log.log,t=[],i=function(e,i,n){t.push({name:e,id:i,match:n})};i("gpt-google_js_loaded",8,/Google service JS loaded/gi),i("gpt-gpt_fetch",46,/Fetching GPT implementation/gi),i("gpt-gpt_fetched",48,/GPT implementation fetched\./gi),i("gpt-page_load_complete",1,/Page load complete/gi),i("gpt-queue_start",31,/^Invoked queued function/gi),i("gpt-service_add_slot",40,/Associated ([\w]*) service with slot ([\/\w]*)/gi),i("gpt-service_add_targeting",88,/Setting targeting attribute ([\w]*) with value ([\w\W]*) for service ([\w]*)/gi),i("gpt-service_collapse_containers_enable",78,/Enabling collapsing of containers when there is no ad content/gi),i("gpt-service_create",35,/Created service: ([\w]*)/gi),i("gpt-service_single_request_mode_enable",63,/Using single request mode to fetch ads/gi),i("gpt-slot_create",2,/Created slot: ([\/\w]*)/gi),i("gpt-slot_add_targeting",17,/Setting targeting attribute ([\w]*) with value ([\w\W]*) for slot ([\/\w]*)/gi),i("gpt-slot_fill",50,/Calling fillslot/gi),i("gpt-slot_fetch",3,/Fetching ad for slot ([\/\w]*)/gi),i("gpt-slot_receiving",4,/Receiving ad for slot ([\/\w]*)/gi),i("gpt-slot_render_delay",53,/Delaying rendering of ad slot ([\/\w]*) pending loading of the GPT implementation/gi),i("gpt-slot_rendering",5,/^Rendering ad for slot ([\/\w]*)/gi),i("gpt-slot_rendered",6,/Completed rendering ad for slot ([\/\w]*)/gi),i("gpt-refreshing_ads",70,/Refreshing ads/gi),i("gpt-clearing_slot_contents",71,/Clearing slot contents/gi),googletag.events=googletag.events||{},googletag.on=function(e,t,i){if(!t)return this;e=e.split(" ");var n=i?t:void 0,s=i||t,a=0,r="";for(s.data=n,r=e[a=0];a<e.length;r=e[++a])(this.events[r]=this.events[r]||[]).push(s);return this},googletag.off=function(e,t){e=e.split(" ");var i=0,n="",s=0,a=function(){};for(n=e[i];i<e.length;n=e[++i])if(this.events.hasOwnProperty(n))if(t){for(s=this.events[n].length-1,a=this.events[n][s];s>=0;a=this.events[n][--s])a==t&&this.events[n].splice(s,1);0===this.events[n].length&&delete this.events[n]}else delete this.events[n];return this},googletag.trigger=function(e,t){if(!this.events[e]||0===this.events[e].length)return this;var t=t||[],i=0,n=this.events[e][i];for(n;i<this.events[e].length&&n.apply(this,[{data:n.data}].concat(t))!==!1;n=this.events[e][++i]);return this},googletag.debug_log.log=function(i,n,s,a,r){if(n&&n.getMessageId&&"number"==typeof n.getMessageId()){var o=Array.prototype.slice.call(arguments),l=0;for(l;l<t.length;l++)t[l].id===n.getMessageId()&&googletag.trigger(t[l].name,o)}return e.apply(this,arguments)}}})}(),define("libs/xfp-gpt-events",function(){}),define("managers/ad",["jquery","version!fly/managers/ad","version!fly/managers/debug","libs/xfp-gpt-events","tealium"],function(e,t,i){var n=i.init("ads"),s=!1,a=t.getGptObj();e(document).ready(function(){e(".inverse-header, .content-primary-inverse, .elp-header, .hero-48-hours").length>0&&e(".ad-leader-top, .ad-leader-plus-top").addClass("dark-theme"),s||e(".ad-leader-top, .ad-leader-plus-top").addClass("no-mantle-skin"),a&&e('[data-component="imageGallery"], [data-component="mediaPost"]').on("imagegalleryshown mediapostshown",function(){a.setTargeting("vguid",CBSNEWS.tracking.pageViewGuid),a.setTargeting("firstpg","0"),a.refreshLastLoad()})}),!window.addEventListener||window.addEventListener("message",function(e){if(e.origin===window.location.protocol+"//"+window.location.host&&"string"==typeof e.data&&0===e.data.indexOf("nativeAdBlankServed_")){n.log("cbsnews::bidtelect","Message",e);for(var t=window.frames,i=0;i<t.length;i++){var s=t[i];s==e.source.parent&&(n.log("cbsnews::bidtelect","Message received, hide blank iframe",s),s.frameElement.parentNode.style.display="none")}}},!1);var r=function(t,i){n.log("leaderboardTopCallback called with adId:",t);var s=e("#"+t);i.isEmpty?(n.log("empty leader"),s.removeClass("contains-ad"),s.css("display","none")):(n.log("found leader"),s.addClass("contains-ad"),e(".ad-leader-top, .ad-leader-plus-top").css("min-height","0"))},o=function(t){n.log("skinCallback called with adId:",t),"none"!=e("#"+t).css("display")?(n.log("found skin"),s=!0,e(".ad-leader-top, .ad-leader-plus-top").removeClass("no-mantle-skin"),e(".ad-leader-top, .ad-leader-plus-top, .deep-story-header, .deep-story-body .container, .elp-header").addClass("has-mantle-skin")):n.log("empty skin")},l=function(e){if(n.log("marqueeVideoRenderCallback called with slot:",e),!e.is(":visible")){var t='<a href="http://www.cbsnews.com/live/?ftag=CNMf880813"><img src="/bundles/cbsnewscore/images/standalone/cbsn-adunit-300x80.jpg"/></a>';n.log("slot is empty, replacing with content:",t),e.html(t),e.show()}};return a.registerCallback("leaderboardTop",r),a.registerCallback("skin",o),n.log('configuring "xfp-gpt-events" event callbacks'),window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],googletag.cmd.push(function(){return googletag.on?(n.log('subscribing to "xfp-gpt-events" event callbacks'),googletag.on("gpt-refreshing_ads",function(t,i,s,a,r,o){n.log("gpt-refreshing_ads callback",t,s,r,o);var d=e("[data-ad=marquee-video-top]");d.length>0&&l(d)}),void googletag.on("gpt-clearing_slot_contents",function(t,i,s,a,r,o){n.log("gpt-clearing_slot_contents callback",t,s,r,o);var d=e("[data-ad=marquee-video-top]");d.length>0&&setTimeout(function(){l(d)},50)})):void n.log('WARNING: "xfp-gpt-events" on() subscribe function does not exist - callbacks not defined')}),t}),define("managers/beanstock-sonobi",["version!fly/managers/gpt","version!fly/managers/debug","version!fly/libs/jquery.cookie"],function(e,t){function i(){!d.adCallsFired&&(d.bidsExpired||d.ixComplete&&d.sbComplete)&&(d.adCallsFired=!0,a(),l.log("adCallsFired"))}function n(e){return function(){l.log(e),d[e]=!0,l.log("status",d),i()}}function s(e,t){var i=document.createElement("script");i.async=!0,i.src=e,i.addEventListener("load",n(t)),h.parentNode.insertBefore(i,h)}var a,r,o,l=t.init("beanstock-sonobi"),d={adCallsFired:!1,bidsExpired:!1,ixComplete:!1,sbComplete:!1},u=800,h=document.getElementsByTagName("script")[0];return{init:function(e,t){a=t,l.log("callback",a),r=e.gpt.containerId,l.log("containerId",r),o=e.gpt.targeting.device,l.log("device",o),setTimeout(n("bidsExpired"),u),s("//js-sec.indexww.com/ht/ls-cbsnews.js","ixComplete"),s("//mtrx.go.sonobi.com/morpheus.cbsnews.2652.js","sbComplete")},isEnabled:function(){var e=$.cookie("bs_rnd");e||(e=Math.floor(100*Math.random()),$.cookie("bs_rnd",e));var t=window.beanstockSonobiFreq>0&&e<=window.beanstockSonobiFreq||l.enabled;return l.log("bsEnabled",t),t}}}),define("managers/click-tracking",["jquery","tealium"],function(e){e(".module-click-tracking").on("click",function(){}),e(".subscribe-button").on("click",function(){var e="mobile"==utag_data.deviceType?"CNI2f17d43":"CNId322db2";om.trackCampaignDriver({intcid:e,campaignType:"all-access",campaignChannel:"locked content",campaignText:utag_data.topicName+";"+utag_data.articleTitle})}),e(".sixty-subscribe-overlay a").on("click",function(){om.trackCampaignDriver({intcid:"CNI0ed2038",campaignType:"all-access",campaignChannel:"locked content",campaignText:utag_data.topicName+";"+utag_data.articleTitle})}),e(".smart-banner--60-minutes #smart-banner--text-container").on("click",function(){var e="mobile"==utag_data.deviceType?"CNIe400434":"CNI17adef7";om.trackCampaignDriver({intcid:e,campaignType:"all-access",campaignChannel:"upsell footerbar",campaignText:"learn more"})}),e(".site-section-tab.sixty-tab-60-minutes-all-access a").on("click",function(){var e="mobile"==utag_data.deviceType?"CNIa25c77d":"CNIaa8c952";om.trackCampaignDriver({intcid:e,campaignType:"all-access",campaignChannel:"navigation bar",campaignText:"60 minutes all access"})}),e("#module-60-minutes-landing-page-cover-flow > li.title > a.cta-primary").on("click",function(){om.trackCampaignDriver({intcid:"CNI49ef995",campaignType:"all-access",campaignChannel:"60 front door",campaignText:"subscribe now"})}),e("#module-sixty-minutes-all-access-promo-mobile a.cta-primary").on("click",function(){om.trackCampaignDriver({intcid:"CNI0ed2038",campaignType:"all-access",campaignChannel:"locked content",campaignText:utag_data.topicName+";"+utag_data.articleTitle})}),e('.to-go a[href*="CNIf15cd3f"]').on("click",function(){om.trackCampaignDriver({intcid:"CNIf15cd3f",campaignType:"all-access",campaignChannel:"60 footer",campaignText:"Introducing CBS All Access"})})}),define("fly/utils/object-helper-1.0",["jquery"],function(e){return{deepFind:function(e,t){if(!e||!t)return null;var n=t.split("."),s=n.length;for(i=0;i<s;i++){if(!e.hasOwnProperty(n[i]))return null;e=e[n[i]]}return e}}}),define("fly/utils/data-prefix-1.0",["jquery","version!fly/utils/string-helper"],function(e,t){var i=function(i,n){var s=e(this),a=s.data(n),r={};return i?(e.each(a,function(e,n){0===e.indexOf(i)&&(e=e.substr(i.length),r[t.lowerFirst(e)]=n)}),r):void 0};return e.fn.dataPrefix=i,i}),define("fly/libs/jquery.widget-1.9.2",["jquery"],function(e){var t=0,i=Array.prototype.slice,n=e.cleanData;e.cleanData=function(t){for(var i,s=0;null!=(i=t[s]);s++)try{e(i).triggerHandler("remove")}catch(a){}n(t)},e.widget=function(t,i,n){var s,a,r,o,l=t.split(".")[0];t=t.split(".")[1],s=l+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][s.toLowerCase()]=function(t){return!!e.data(t,s)},e[l]=e[l]||{},a=e[l][t],r=e[l][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new r(e,t)},e.extend(r,a,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),o=new i,o.options=e.widget.extend({},o.options),e.each(n,function(t,s){e.isFunction(s)&&(n[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}())}),r.prototype=e.widget.extend(o,{widgetEventPrefix:a?o.widgetEventPrefix:t},n,{constructor:r,namespace:l,widgetName:t,widgetBaseClass:s,widgetFullName:s}),a?(e.each(a._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,r,i._proto)}),delete a._childConstructors):i._childConstructors.push(r),e.widget.bridge(t,r)},e.widget.extend=function(t){for(var n,s,a=i.call(arguments,1),r=0,o=a.length;o>r;r++)for(n in a[r])s=a[r][n],void 0!==s&&(e.isPlainObject(s)?t[n]=e.isPlainObject(t[n])?e.widget.extend({},t[n],s):e.widget.extend({},s):t[n]=s);return t},e.widget.bridge=function(t,n){var s=n.prototype.widgetFullName||t;e.fn[t]=function(a){var r="string"==typeof a,o=i.call(arguments,1),l=this;return a=!r&&o.length?e.widget.extend.apply(null,[a].concat(o)):a,r?this.each(function(){var i,n=e.data(this,s);return n?e.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,o),i!==n&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+a+"'")}):this.each(function(){var t=e.data(this,s);t?t.option(a||{})._init():e.data(this,s,new n(a,this))}),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(i,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),i),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetName,this),e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var n,s,a,r=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(r={},n=t.split("."),t=n.shift(),n.length){for(s=r[t]=e.widget.extend({},this.options[t]),a=0;a<n.length-1;a++)s[n[a]]=s[n[a]]||{},s=s[n[a]];if(t=n.pop(),void 0===i)return void 0===s[t]?null:s[t];s[t]=i}else{if(void 0===i)return void 0===this.options[t]?null:this.options[t];r[t]=i}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,n){var s,a=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=s=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,s=this.widget()),e.each(n,function(n,r){function o(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof r?a[r]:r).apply(a,arguments):void 0}"string"!=typeof r&&(o.guid=r.guid=r.guid||o.guid||e.guid++);var l=n.match(/^(\w+)\s*(.*)$/),d=l[1]+a.eventNamespace,u=l[2];u?s.delegate(u,d,o):i.bind(d,o)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var s,a,r=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(s in a)s in i||(i[s]=a[s]);return this.element.trigger(i,n),!(e.isFunction(r)&&r.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,s,a){"string"==typeof s&&(s={effect:s});var r,o=s?s===!0||"number"==typeof s?i:s.effect||i:t;s=s||{},"number"==typeof s&&(s={duration:s}),r=!e.isEmptyObject(s),s.complete=a,s.delay&&n.delay(s.delay),r&&e.effects&&(e.effects.effect[o]||e.uiBackCompat!==!1&&e.effects[o])?n[t](s):o!==t&&n[o]?n[o](s.duration,s.easing,a):n.queue(function(i){e(this)[t](),a&&a.call(n[0]),i()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}),define("fly/components/base-1.0",["jquery","version!fly/utils/data-prefix","version!fly/libs/jquery.widget"],function(e){var t={},i={},n={setDefaultOptions:function(i,n){"string"==typeof i?(t[i]=t[i]||{},e.extend(!0,t[i],n)):e.extend(!0,t,i)},addDefaultEvents:function(i,s){var a;"string"==typeof i?(t[i]=t[i]||{},n.addDefaultEvent(i,s)):(a=i,e.each(a,function(e,t){n.addDefaultEvent(e,t)}))},addDefaultEvent:function(e,t){i[e]=i[e]||[],i[e].push(t)}};return e.widget("fly.base",{options:{defaultsDisabled:!1,defaultOptionsDisabled:!1,defaultEventsDisabled:!1},_setup:function(){var t=this,n=i[this.widgetName]||[];this.$element=this.element,this.$document=this.document,this.$window=this.window,n.length&&e.each(n,function(i,n){var s={};e.each(n,function(e,i){s[(t.widgetEventPrefix+e).toLowerCase()]=i}),t.$element.on(s)})},_getCreateOptions:function(){var t=this.getDefaultOptions(),i=this.getDataOptions(this.element);return e.extend(!0,{},t,i)},getDefaultOptions:function(){var e=this.options,i={};return e.defaultsDisabled||e.defaultOptionsDisabled||(i=t[this.widgetName]||{}),i},getDataOptions:function(e,t){var i;return t=t||this.widgetName,i=e.data(t+"Options")||e.dataPrefix(t)},_triggerGlobal:function(e,t){this.$document.trigger(e,t)},_create:function(){this.$element=this.element},setOptionsFromData:function(){}}),n}),define("fly/components/modal-1.0",["jquery","version!fly/components/base"],function(e){var t=e.support.touch?"vclick":"click";e.widget("fly.modal",e.fly.base,{options:{content:null,position:"absolute",classModal:"modal",classBackdrop:"modal-backdrop",classShow:"show",classFixed:"fixed",enableKeyEvents:!0,openOnInit:!1,template:null},$modal:null,$backdrop:null,$body:null,isOpen:!1,eventData:{},_create:function(){var i=this.options,n="fixed"===i.position?" "+i.classFixed:"",s={},a={};this._setup(),this.$modal=this.$element.addClass(i.classModal+n),this.$backdrop=e("<div>").addClass(i.classBackdrop+n),this.$body=e(document.body),this.top=parseInt(this.$modal.css("top"),10),i.content&&this.setContent(i.content),this.eventData={$modal:this.$modal,$backdrop:this.$backdrop},s[t]="_handleClose",a[t+' [data-close="modal"]']="_handleClose",this._on(this.$backdrop,s),this._on(this.$modal,a)},_init:function(){this.options.openOnInit&&this.open()},_handleKeyboard:function(e){27==e.keyCode&&this.close()},_handleClose:function(e){e.preventDefault(),this.close()},open:function(){var e=this.options;this.isOpen||this._trigger("open",null,this.eventData)!==!1&&(this.$backdrop.addClass(e.classShow).appendTo(this.$body),this.$modal.addClass(e.classShow).appendTo(this.$body),this.position(),e.enableKeyEvents&&this._on(this.$document,{keyup:"_handleKeyboard"}),this.isOpen=!0,this._trigger("opened",null,this.eventData))},close:function(){var e=this.options;this.isOpen&&this._trigger("close",null,this.eventData)!==!1&&(this.$backdrop.removeClass(e.classShow),this.$modal.removeClass(e.classShow),this._off(this.$document,"keyup"),this.isOpen=!1,this._trigger("closed",null,this.eventData))},setContent:function(t){var i,n=this.options,s=this,a=e(t);a.hasClass(n.classModal)&&(a.removeClass(n.classModal),i=a.prop("attributes"),e.each(i,function(){"class"===this.name?s.$modal.addClass(this.value):s.$modal.attr(this.name,this.value)}),a=a.children()),this.$modal.empty().append(a),this._trigger("contentSet",null,e.extend({},this.eventData,{$modal:this.$modal,$content:a}))},position:function(){var e=this.options,t=this.$window.height(),i=isNaN(this.top)?(t-this.$modal.outerHeight())/3:this.top;20>i&&(i=20),"absolute"==e.position&&(i+=this.$window.scrollTop(),this.$backdrop.css({height:this.$document.height()})),this.$modal.css({top:i}),this._trigger("positioned",null,{$modal:this.$modal})},_destroy:function(){this.$backdrop.remove()}}),e(document).on(t+".modal-api.data-api",'[data-open="modal"]',function(t){var i=e(this),n=i.data(),s=n.$modal;t.preventDefault(),s||(s=e(n.target||i.attr("href")),i.data("$modal",s)),s.length&&s.modal().modal("open")})}),define("fly/utils/string-vars-1.0",["jquery"],function(e){return{compile:function(t,i,n){var s=this;return"string"!=typeof t?"":(n=e.makeArray(n),t=t.replace(/\{([^}]+)\}/g,function(t){var a=n,r="";return t=t.replace(/\|[^\}|]+/g,function(e){return a.push(e.substr(1)),""}),r=i[t.replace(/[{}]+/g,"")]||"",e.each(a,function(e,t){r=s.modify(t,r)}),r}))},modify:function(e,t){switch(e){case"lower":t=t.toLowerCase();break;case"upper":t=t.toUpperCase();break;case"urlencode":t=encodeURIComponent(t)}return t}}}),define("fly/components/loading-1.0",["jquery","version!fly/utils/string-vars","version!fly/components/base"],function(e,t){e.widget("fly.loading",e.fly.base,{options:{disabled:!1,delay:100,timeout:25e3,initState:"",template:'<div class="{baseClass} {stateClass}"><span class="text">{text}</span></div>',classes:{base:"loader",idle:"",loading:"loading",end:"load-end",error:"load-error"},text:{idle:"",loading:"Loading",end:"The End",error:"Error Encountered :("}},_create:function(){this._setup(),this._state=null,this._timeoutId=null},_init:function(){var e=this.options;!e.disabled&&e.initState&&(this._setContent(e.initState),this._state=e.initState)},_setContent:function(i,n){var s,a=this.options;return"remove"===i?void this.$element.empty():(s=t.compile(a.template,e.extend({state:i,baseClass:a.classes.base,stateClass:a.classes[i],text:a.text[i]},n)),void this.$element.html(s))},add:function(){var t=this.options;this._trigger("add")!==!1&&(this.update("loading"),"number"==typeof t.timeout&&t.timeout>0&&(this._timeoutId=setTimeout(e.proxy(this.remove,this),t.timeout)),this._trigger("added"))},remove:function(){this._trigger("remove")!==!1&&(this.update("remove"),this._trigger("removed"))},update:function(e,t){var i=this.options,n={state:e};this._trigger("update",null,n)!==!1&&(this._state=e,i.disabled||(clearTimeout(this._timeoutId),this._setContent(e,t),this._trigger("updated",null,n)))},isLoading:function(){return"loading"===this._state?!0:!1},getState:function(){return this._state},_setOption:function(e,t){var i=this.options;"data"===e?this.$element.data("data",t):"disabled"===e&&(t===!0?this.$element.empty():this._setContent(i.initState)),this._super(e,t)},_destroy:function(){this.$element.remove()}})}),define("fly/components/modal-iframe-1.0",["jquery","version!fly/utils/object-helper","version!fly/utils/url-helper","version!fly/components/modal","version!fly/components/loading"],function(e,t,i){e.support.touch?"vclick":"click";e.widget("fly.modalIframe",e.fly.modal,{options:{url:null,requestData:{},messages:{},loader:{disabled:!1}},messenger:null,_create:function(){this._super(),this._setupLoader()},_setupLoader:function(){var t=this;this.loader=e.fly.loading(e.extend(this.options.loader,{shown:function(){t.$element.addClass(t.loader.options.classes.loading)},hidden:function(){t.$element.removeClass(t.loader.options.classes.loading)}})),this.loader.$element.appendTo(this.$element)},open:function(){this.isOpen||(this.loader.add(),this.loadContent(),this._super())},_getUrl:function(){var t=this.options,i=t.url;return t.requestData&&(i=i+(i.indexOf("?")>0?"&":"?")+e.param(t.requestData)),i},loadContent:function(){var t=this.options,i=this;this.messenger=this.$element.iframeMessenger({remoteUrl:this._getUrl(),receivableMessages:e.extend({},t.messages,{ready:function(){
i._trigger("iframeReady"),i.loader.remove()},closeModal:function(){i.close()},scroll:function(t){var n=i.$element.offset().top+t.offset;n-=i.$window.height()/6,e("html, body").animate({scrollTop:n},"fast")}})})}})}),function(e,t,i,n,s,a){function r(e,t){var i=typeof e[t];return"function"==i||!("object"!=i||!e[t])||"unknown"==i}function o(e,t){return!("object"!=typeof e[t]||!e[t])}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function d(){var e="Shockwave Flash",t="application/x-shockwave-flash";if(!E(navigator.plugins)&&"object"==typeof navigator.plugins[e]){var i=navigator.plugins[e].description;i&&!E(navigator.mimeTypes)&&navigator.mimeTypes[t]&&navigator.mimeTypes[t].enabledPlugin&&(T=i.match(/\d+/g))}if(!T){var n;try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),T=Array.prototype.slice.call(n.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),n=null}catch(s){}}if(!T)return!1;var a=parseInt(T[0],10),r=parseInt(T[1],10);return P=a>9&&r>0,!0}function u(){if(!W){W=!0;for(var e=0;e<q.length;e++)q[e]();q.length=0}}function h(e,t){return W?void e.call(t):void q.push(function(){e.call(t)})}function c(){var e=parent;if(""!==V)for(var t=0,i=V.split(".");t<i.length;t++)e=e[i[t]];return e.easyXDM}function p(t){return e.easyXDM=G,V=t,V&&(x="easyXDM_"+V.replace(".","_")+"_"),j}function g(e){return e.match(N)[3]}function v(e){return e.match(N)[4]||""}function f(e){var t=e.toLowerCase().match(N),i=t[2],n=t[3],s=t[4]||"";return("http:"==i&&":80"==s||"https:"==i&&":443"==s)&&(s=""),i+"//"+n+s}function m(e){if(e=e.replace(B,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":i.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=i.protocol+"//"+i.host+t+e}for(;U.test(e);)e=e.replace(U,"");return e}function _(e,t){var i="",n=e.indexOf("#");-1!==n&&(i=e.substring(n),e=e.substring(0,n));var s=[];for(var r in t)t.hasOwnProperty(r)&&s.push(r+"="+a(t[r]));return e+(F?"#":-1==e.indexOf("?")?"?":"&")+s.join("&")+i}function E(e){return"undefined"==typeof e}function y(e,t,i){var n;for(var s in t)t.hasOwnProperty(s)&&(s in e?(n=t[s],"object"==typeof n?y(e[s],n,i):i||(e[s]=t[s])):e[s]=t[s]);return e}function b(){var e=t.body.appendChild(t.createElement("form")),i=e.appendChild(t.createElement("input"));i.name=x+"TEST"+O,R=i!==e.elements[i.name],t.body.removeChild(e)}function A(e){E(R)&&b();var i;R?i=t.createElement('<iframe name="'+e.props.name+'"/>'):(i=t.createElement("IFRAME"),i.name=e.props.name),i.id=i.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=t.getElementById(e.container)),e.container||(y(i.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=t.body);var n=e.props.src;if(e.props.src="javascript:false",y(i,e.props),i.border=i.frameBorder=0,i.allowTransparency=!0,e.container.appendChild(i),e.onLoad&&M(i,"load",e.onLoad),e.usePost){var s,a=e.container.appendChild(t.createElement("form"));if(a.target=i.name,a.action=n,a.method="POST","object"==typeof e.usePost)for(var r in e.usePost)e.usePost.hasOwnProperty(r)&&(R?s=t.createElement('<input name="'+r+'"/>'):(s=t.createElement("INPUT"),s.name=r),s.value=e.usePost[r],a.appendChild(s));a.submit(),a.parentNode.removeChild(a)}else i.src=n;return e.props.src=n,i}function S(e,t){"string"==typeof e&&(e=[e]);for(var i,n=e.length;n--;)if(i=e[n],i=new RegExp("^"==i.substr(0,1)?i:"^"+i.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),i.test(t))return!0;return!1}function I(n){var s,a=n.protocol;if(n.isHost=n.isHost||E(Y.xdm_p),F=n.hash||!1,n.props||(n.props={}),n.isHost)n.remote=m(n.remote),n.channel=n.channel||"default"+O++,n.secret=Math.random().toString(16).substring(2),E(a)&&(a=f(i.href)==f(n.remote)?"4":r(e,"postMessage")||r(t,"postMessage")?"1":n.swf&&r(e,"ActiveXObject")&&d()?"6":"Gecko"===navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?"5":n.remoteHelper?"2":"0");else if(n.channel=Y.xdm_c.replace(/["'<>\\]/g,""),n.secret=Y.xdm_s,n.remote=Y.xdm_e.replace(/["'<>\\]/g,""),a=Y.xdm_p,n.acl&&!S(n.acl,n.remote))throw new Error("Access denied for "+n.remote);switch(n.protocol=a,a){case"0":if(y(n,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),n.isHost){if(!n.local){for(var o,l=i.protocol+"//"+i.host,u=t.body.getElementsByTagName("img"),h=u.length;h--;)if(o=u[h],o.src.substring(0,l.length)===l){n.local=o.src;break}n.local||(n.local=e)}var c={xdm_c:n.channel,xdm_p:0};n.local===e?(n.usePolling=!0,n.useParent=!0,n.local=i.protocol+"//"+i.host+i.pathname+i.search,c.xdm_e=n.local,c.xdm_pa=1):c.xdm_e=m(n.local),n.container&&(n.useResize=!1,c.xdm_po=1),n.remote=_(n.remote,c)}else y(n,{channel:Y.xdm_c,remote:Y.xdm_e,useParent:!E(Y.xdm_pa),usePolling:!E(Y.xdm_po),useResize:n.useParent?!1:n.useResize});s=[new j.stack.HashTransport(n),new j.stack.ReliableBehavior({}),new j.stack.QueueBehavior({encode:!0,maxLength:4e3-n.remote.length}),new j.stack.VerifyBehavior({initiate:n.isHost})];break;case"1":s=[new j.stack.PostMessageTransport(n)];break;case"2":n.isHost&&(n.remoteHelper=m(n.remoteHelper)),s=[new j.stack.NameTransport(n),new j.stack.QueueBehavior,new j.stack.VerifyBehavior({initiate:n.isHost})];break;case"3":s=[new j.stack.NixTransport(n)];break;case"4":s=[new j.stack.SameOriginTransport(n)];break;case"5":s=[new j.stack.FrameElementTransport(n)];break;case"6":T||d(),s=[new j.stack.FlashTransport(n)]}return s.push(new j.stack.QueueBehavior({lazy:n.lazy,remove:!0})),s}function D(e){for(var t,i={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},n=0,s=e.length;s>n;n++)t=e[n],y(t,i,!0),0!==n&&(t.down=e[n-1]),n!==s-1&&(t.up=e[n+1]);return t}function C(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var R,T,P,M,L,w=this,O=Math.floor(1e4*Math.random()),k=Function.prototype,N=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,U=/[\-\w]+\/\.\.\//,B=/([^:])\/\//g,V="",j={},G=e.easyXDM,x="easyXDM_",F=!1;if(r(e,"addEventListener"))M=function(e,t,i){e.addEventListener(t,i,!1)},L=function(e,t,i){e.removeEventListener(t,i,!1)};else{if(!r(e,"attachEvent"))throw new Error("Browser not supported");M=function(e,t,i){e.attachEvent("on"+t,i)},L=function(e,t,i){e.detachEvent("on"+t,i)}}var H,W=!1,q=[];if("readyState"in t?(H=t.readyState,W="complete"==H||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==H||"interactive"==H)):W=!!t.body,!W){if(r(e,"addEventListener"))M(t,"DOMContentLoaded",u);else if(M(t,"readystatechange",function(){"complete"==t.readyState&&u()}),t.documentElement.doScroll&&e===top){var z=function(){if(!W){try{t.documentElement.doScroll("left")}catch(e){return void n(z,1)}u()}};z()}M(e,"load",u)}var Y=function(e){e=e.substring(1).split("&");for(var t,i={},n=e.length;n--;)t=e[n].split("="),i[t[0]]=s(t[1]);return i}(/xdm_e=/.test(i.search)?i.search:i.hash),$=function(){var e={},t={a:[1,2,3]},i='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(t).replace(/\s/g,"")===i?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===i&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t=i.evalJSON(),t.a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?($=function(){return e},e):null)};y(j,{version:"2.4.19.3",query:Y,stack:{},apply:y,getJSONObject:$,whenReady:h,noConflict:p}),j.DomHelper={on:M,un:L,requiresJSON:function(i){o(e,"JSON")||t.write('<script type="text/javascript" src="'+i+'"></script>')}},function(){var e={};j.Fn={set:function(t,i){e[t]=i},get:function(t,i){if(e.hasOwnProperty(t)){var n=e[t];return i&&delete e[t],n}}}}(),j.Socket=function(e){var t=D(I(e).concat([{incoming:function(t,i){e.onMessage(t,i)},callback:function(t){e.onReady&&e.onReady(t)}}])),i=f(e.remote);this.origin=f(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,i)},t.init()},j.Rpc=function(e,t){if(t.local)for(var i in t.local)if(t.local.hasOwnProperty(i)){var n=t.local[i];"function"==typeof n&&(t.local[i]={method:n})}var s=D(I(e).concat([new j.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=f(e.remote),this.destroy=function(){s.destroy()},s.init()},j.stack.SameOriginTransport=function(e){var t,s,a,r;return t={outgoing:function(e,t,i){a(e),i&&i()},destroy:function(){s&&(s.parentNode.removeChild(s),s=null)},onDOMReady:function(){r=f(e.remote),e.isHost?(y(e.props,{src:_(e.remote,{xdm_e:i.protocol+"//"+i.host+i.pathname,xdm_c:e.channel,xdm_p:4}),name:x+e.channel+"_provider"}),s=A(e),j.Fn.set(e.channel,function(e){return a=e,n(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,r)}})):(a=c().Fn.get(e.channel,!1)(function(e){t.up.incoming(e,r)}),n(function(){t.up.callback(!0)},0))},init:function(){h(t.onDOMReady,t)}}},j.stack.FlashTransport=function(e){function s(e,t){n(function(){o.up.incoming(e,d)},0)}function r(i){var n=e.swf+"?host="+e.isHost,s="easyXDM_swf_"+Math.floor(1e4*Math.random());j.Fn.set("flash_loaded"+i.replace(/[\-.]/g,"_"),function(){j.stack.FlashTransport[i].swf=u=c.firstChild;for(var e=j.stack.FlashTransport[i].queue,t=0;t<e.length;t++)e[t]();e.length=0}),e.swfContainer?c="string"==typeof e.swfContainer?t.getElementById(e.swfContainer):e.swfContainer:(c=t.createElement("div"),y(c.style,P&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(c));var r="callback=flash_loaded"+a(i.replace(/[\-.]/g,"_"))+"&proto="+w.location.protocol+"&domain="+a(g(w.location.href))+"&port="+a(v(w.location.href))+"&ns="+a(V);c.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+s+"' data='"+n+"'><param name='allowScriptAccess' value='sameDomain'></param><param name='wmode' value='transparent'><param name='movie' value='"+n+"'></param><param name='flashvars' value='"+r+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+r+"' allowScriptAccess='sameDomain' wmode='transparent' src='"+n+"' height='1' width='1'></embed></object>"}var o,l,d,u,c;return o={outgoing:function(t,i,n){u.postMessage(e.channel,t.toString()),n&&n()},destroy:function(){try{u.destroyChannel(e.channel)}catch(t){}u=null,l&&(l.parentNode.removeChild(l),l=null)},onDOMReady:function(){d=e.remote,j.Fn.set("flash_"+e.channel+"_init",function(){n(function(){o.up.callback(!0)})}),j.Fn.set("flash_"+e.channel+"_onMessage",s),e.swf=m(e.swf);var t=g(e.swf),a=function(){j.stack.FlashTransport[t].init=!0,u=j.stack.FlashTransport[t].swf,u.createChannel(e.channel,e.secret,f(e.remote),e.isHost),e.isHost&&(P&&e.swfNoThrottle&&y(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),y(e.props,{src:_(e.remote,{xdm_e:f(i.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:x+e.channel+"_provider"}),l=A(e))};j.stack.FlashTransport[t]&&j.stack.FlashTransport[t].init?a():j.stack.FlashTransport[t]?j.stack.FlashTransport[t].queue.push(a):(j.stack.FlashTransport[t]={queue:[a]},r(t))},init:function(){h(o.onDOMReady,o)}}},j.stack.PostMessageTransport=function(t){function s(e){if(e.origin)return f(e.origin);if(e.uri)return f(e.uri);if(e.domain)return i.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function a(e){var i=s(e);i==d&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&r.up.incoming(e.data.substring(t.channel.length+1),i)}var r,o,l,d;return r={outgoing:function(e,i,n){l.postMessage(t.channel+" "+e,i||d),n&&n()},destroy:function(){L(e,"message",a),o&&(l=null,o.parentNode.removeChild(o),o=null)},onDOMReady:function(){if(d=f(t.remote),t.isHost){var s=function(i){i.data==t.channel+"-ready"&&(l="postMessage"in o.contentWindow?o.contentWindow:o.contentWindow.document,L(e,"message",s),M(e,"message",a),n(function(){r.up.callback(!0)},0))};M(e,"message",s),y(t.props,{src:_(t.remote,{xdm_e:f(i.href),xdm_c:t.channel,xdm_p:1}),name:x+t.channel+"_provider"}),o=A(t)}else M(e,"message",a),l="postMessage"in e.parent?e.parent:e.parent.document,l.postMessage(t.channel+"-ready",d),n(function(){r.up.callback(!0)},0)},init:function(){h(r.onDOMReady,r)}}},j.stack.FrameElementTransport=function(s){var a,r,o,l;return a={outgoing:function(e,t,i){o.call(this,e),i&&i()},destroy:function(){r&&(r.parentNode.removeChild(r),r=null)},onDOMReady:function(){l=f(s.remote),s.isHost?(y(s.props,{src:_(s.remote,{xdm_e:f(i.href),xdm_c:s.channel,xdm_p:5}),name:x+s.channel+"_provider"}),r=A(s),r.fn=function(e){return delete r.fn,o=e,n(function(){a.up.callback(!0)},0),function(e){a.up.incoming(e,l)}}):(t.referrer&&f(t.referrer)!=Y.xdm_e&&(e.top.location=Y.xdm_e),o=e.frameElement.fn(function(e){a.up.incoming(e,l)}),a.up.callback(!0))},init:function(){h(a.onDOMReady,a)}}},j.stack.NameTransport=function(e){function t(t){var i=e.remoteHelper+(o?"#_3":"#_2")+e.channel;l.contentWindow.sendMessage(t,i)}function i(){o?2!==++u&&o||r.up.callback(!0):(t("ready"),r.up.callback(!0))}function s(e){r.up.incoming(e,p)}function a(){c&&n(function(){c(!0)},0)}var r,o,l,d,u,c,p,g;return r={outgoing:function(e,i,n){c=n,t(e)},destroy:function(){l.parentNode.removeChild(l),l=null,o&&(d.parentNode.removeChild(d),d=null)},onDOMReady:function(){o=e.isHost,u=0,p=f(e.remote),e.local=m(e.local),o?(j.Fn.set(e.channel,function(t){o&&"ready"===t&&(j.Fn.set(e.channel,s),i())}),g=_(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),y(e.props,{src:g+"#"+e.channel,name:x+e.channel+"_provider"}),d=A(e)):(e.remoteHelper=e.remote,j.Fn.set(e.channel,s));var t=function(){var s=l||this;L(s,"load",t),j.Fn.set(e.channel+"_load",a),function r(){"function"==typeof s.contentWindow.sendMessage?i():n(r,50)}()};l=A({props:{src:e.local+"#_4"+e.channel},onLoad:t})},init:function(){h(r.onDOMReady,r)}}},j.stack.HashTransport=function(t){function i(e){if(v){var i=t.remote+"#"+p++ +"_"+e;(l||!m?v.contentWindow:v).location=i}}function s(e){c=e,o.up.incoming(c.substring(c.indexOf("_")+1),_)}function a(){if(g){var e=g.location.href,t="",i=e.indexOf("#");-1!=i&&(t=e.substring(i)),t&&t!=c&&s(t)}}function r(){d=setInterval(a,u)}var o,l,d,u,c,p,g,v,m,_;return o={outgoing:function(e,t){i(e)},destroy:function(){e.clearInterval(d),(l||!m)&&v.parentNode.removeChild(v),v=null},onDOMReady:function(){if(l=t.isHost,u=t.interval,c="#"+t.channel,p=0,m=t.useParent,_=f(t.remote),l){if(y(t.props,{src:t.remote,name:x+t.channel+"_provider"}),m)t.onLoad=function(){g=e,r(),o.up.callback(!0)};else{var i=0,s=t.delay/50;!function a(){if(++i>s)throw new Error("Unable to reference listenerwindow");try{g=v.contentWindow.frames[x+t.channel+"_consumer"]}catch(e){}g?(r(),o.up.callback(!0)):n(a,50)}()}v=A(t)}else g=e,r(),m?(v=parent,o.up.callback(!0)):(y(t,{props:{src:t.remote+"#"+t.channel+new Date,name:x+t.channel+"_consumer"},onLoad:function(){o.up.callback(!0)}}),v=A(t))},init:function(){h(o.onDOMReady,o)}}},j.stack.ReliableBehavior=function(e){var t,i,n=0,s=0,a="";return t={incoming:function(e,r){var o=e.indexOf("_"),l=e.substring(0,o).split(",");e=e.substring(o+1),l[0]==n&&(a="",i&&i(!0)),e.length>0&&(t.down.outgoing(l[1]+","+n+"_"+a,r),s!=l[1]&&(s=l[1],t.up.incoming(e,r)))},outgoing:function(e,r,o){a=e,i=o,t.down.outgoing(s+","+ ++n+"_"+e,r)}}},j.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===o.length)return void C(i);if(!l&&0!==o.length&&!r){l=!0;var s=o.shift();i.down.outgoing(s.data,s.origin,function(e){l=!1,s.callback&&n(function(){s.callback(e)},0),t()})}}var i,r,o=[],l=!0,d="",u=0,h=!1,c=!1;return i={init:function(){E(e)&&(e={}),e.maxLength&&(u=e.maxLength,c=!0),e.lazy?h=!0:i.down.init()},callback:function(e){l=!1;var n=i.up;t(),n.callback(e)},incoming:function(t,n){if(c){var a=t.indexOf("_"),r=parseInt(t.substring(0,a),10);d+=t.substring(a+1),0===r&&(e.encode&&(d=s(d)),i.up.incoming(d,n),d="")}else i.up.incoming(t,n)},outgoing:function(n,s,r){e.encode&&(n=a(n));var l,d=[];if(c){for(;0!==n.length;)l=n.substring(0,u),n=n.substring(l.length),d.push(l);for(;l=d.shift();)o.push({data:d.length+"_"+l,origin:s,callback:0===d.length?r:null})}else o.push({data:n,origin:s,callback:r});h?i.down.init():t()},destroy:function(){r=!0,i.down.destroy()}}},j.stack.VerifyBehavior=function(e){function t(){n=Math.random().toString(16).substring(2),i.down.outgoing(n)}var i,n,s;return i={incoming:function(a,r){var o=a.indexOf("_");-1===o?a===n?i.up.callback(!0):s||(s=a,e.initiate||t(),i.down.outgoing(a)):a.substring(0,o)===s&&i.up.incoming(a.substring(o+1),r)},outgoing:function(e,t,s){i.down.outgoing(n+"_"+e,t,s)},callback:function(i){e.initiate&&t()}}},j.stack.RpcBehavior=function(e,t){function i(e){e.jsonrpc="2.0",a.down.outgoing(r.stringify(e))}function n(e,t){var n=Array.prototype.slice;return function(){var s,a=arguments.length,r={method:t};a>0&&"function"==typeof arguments[a-1]?(a>1&&"function"==typeof arguments[a-2]?(s={success:arguments[a-2],error:arguments[a-1]},r.params=n.call(arguments,0,a-2)):(s={success:arguments[a-1]},r.params=n.call(arguments,0,a-1)),d[""+ ++o]=s,r.id=o):r.params=n.call(arguments,0),e.namedParams&&1===r.params.length&&(r.params=r.params[0]),i(r)}}function s(e,t,n,s){if(!n)return void(t&&i({id:t,error:{code:-32601,message:"Procedure not found."}}));var a,r;t?(a=function(e){a=k,i({id:t,result:e})},r=function(e,n){r=k;var s={id:t,error:{code:-32099,message:e}};n&&(s.error.data=n),i(s)}):a=r=k,l(s)||(s=[s]);try{var o=n.method.apply(n.scope,s.concat([a,r]));E(o)||a(o)}catch(d){r(d.message)}}var a,r=t.serializer||$(),o=0,d={};return a={incoming:function(e,n){var a=r.parse(e);if(a.method)t.handle?t.handle(a,i):s(a.method,a.id,t.local[a.method],a.params);else{var o=d[a.id];a.error?o.error&&o.error(a.error):o.success&&o.success(a.result),delete d[a.id]}},init:function(){if(t.remote)for(var i in t.remote)t.remote.hasOwnProperty(i)&&(e[i]=n(t.remote[i],i));a.down.init()},destroy:function(){for(var i in t.remote)t.remote.hasOwnProperty(i)&&e.hasOwnProperty(i)&&delete e[i];a.down.destroy()}}},w.easyXDM=j}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),define("fly/libs/easy-xdm-cbsi-2.4.19.3",function(){}),define("fly/libs/jquery.throttle-debounce-1.1",["jquery"],function(e){"$:nomunge";var t;e.throttle=t=function(t,i,n,s){function a(){function e(){o=+new Date,n.apply(l,u)}function a(){r=void 0}var l=this,d=+new Date-o,u=arguments;s&&!r&&e(),r&&clearTimeout(r),void 0===s&&d>t?e():i!==!0&&(r=setTimeout(s?a:e,void 0===s?t-d:t))}var r,o=0;return"boolean"!=typeof i&&(s=n,n=i,i=void 0),e.guid&&(a.guid=n.guid=n.guid||e.guid++),a},e.debounce=function(e,i,n){return void 0===n?t(e,i,!1):t(e,n,i!==!1)}}),define("fly/components/iframe-messenger-1.1",["jquery","version!fly/utils/url-helper","version!fly/managers/debug","version!fly/components/base","version!fly/libs/easy-xdm-cbsi","version!fly/libs/jquery.throttle-debounce"],function(e,t,i){window.fly=window.fly||{},window.fly.easyXDM=easyXDM.noConflict("fly");var n=i.get("iframeMessenger");e.widget("fly.iframeMessenger",e.fly.base,{options:{remoteUrl:null,resizeOnReady:!0,receivableMessages:{}},isProvider:null,_create:function(){var i=this,n=this.options;this._setup(),this.isProvider=t.getParam("xdm_e")?!0:!1,n.remoteUrl?this.socket=new window.fly.easyXDM.Socket({remote:n.remoteUrl,container:this.$element[0],onMessage:e.proxy(this._onMessage,this)}):this.isProvider&&(this.socket=new window.fly.easyXDM.Socket({isHost:!1,onReady:e.proxy(this._onReady,this),onMessage:e.proxy(this._onMessage,this)}),this.$document.on("displayChange",function(){i.postMessage("resize")}))},_initWindowResize:function(){var t=this,i=e(window);this.width=i.width(),i.resize(e.throttle(150,function(){var i=e(window).width();t.width!==i&&(t.postMessage("resize"),t.width=i)}))},_onReady:function(){this.postMessage("ready",null,!0),this._initWindowResize()},_onMessage:function(e,t){var i,s=this.options;e=JSON.parse(e)||{},!this.isProvider&&e.size&&e.size.height&&(i=this.$element.find("iframe"),"ready"===e.name?(i.animate({height:e.size.height},"fast"),this.$element.height(e.size.height)):(this.$element.height(e.size.height),i.height(e.size.height))),n.log("messageRecieved: ",e,"handler: ",s.receivableMessages[e.name]),s.receivableMessages[e.name]&&s.receivableMessages[e.name](e.data,t)},postMessage:function(t,i,s){s=s||!1;var a,r=this,o=(s||"resize"===t)&&this.isProvider?!0:!1,l={name:t,data:i};r.socket&&(o&&e.extend(!0,l,{size:{height:e(document.body).height()}}),a=JSON.stringify(l),n.log("postMessage: ",a),r.socket.postMessage(a))}})}),define("fly/components/form-validate-1.0",["jquery","version!fly/utils/string-helper","version!fly/utils/string-vars","version!fly/managers/debug","version!fly/components/base"],function(e,t,i,n){var s=e.support.touch?"vclick":"click",a=n.init("formValidate");e.widget("fly.formValidate",e.fly.base,{options:{inlineErrorTemplate:'<label for="{id}" class="validate-{type}">{message}</label>',globalErrorTemplate:'<div class="alert alert-{type}">{message}</div>',classFieldStatus:"validate-{type}",animation:"slide",fieldSelector:'[data-item="field"]',ignoreHidden:!0,ignoreSelector:null,validateOnChange:!0,scrollToErrors:!1,attributes:["required","maxlength","minlength"],rules:{},success:function(e,t){t.$form.submit()},failure:function(e,t){},placeError:function(e,t){t.is(":checkbox, :radio")&&t.parent("label").length?e.insertAfter(t.parent("label")):e.insertAfter(t)}},rules:{required:{message:function(e){return e.is(":radio")?"One of these fields is required":"This field is required"},test:function(e){var t,i;return e.is(":radio")?(t=e.closest("form").find(':radio[name="'+e.attr("name")+'"]'),t.is(":checked")):(i=e.is(":checkbox")?e.is(":checked"):e.val(),i?!0:!1)}},mailcheck:{type:"warning",message:null,test:function(e,t){var i=this,n=e.closest("form");return require(["fly/libs/mailcheck-1.1"],function(){e.mailcheck({suggested:function(a,r){i.message='Did you mean <a class="mailcheck" data-_insert="mailcheck">'+r.domain+"</a>?",n.on(s+".mailcheck",'[data-_insert="mailcheck"]',function(){e.val(r.full).trigger("change")}),t.reject("mailcheck")},empty:function(e){n.off(".mailcheck"),t.resolve()}})}),t.promise()}},availableEmail:{remote:!0,message:"Email is already in use"},availableUsername:{remote:!0,message:"User Name is already in use"},minlength:{message:function(e){return"This field must be at least "+e.attr("minlength")+" characters"},test:function(e){return e.val().length>=e.attr("minlength")}},maxlength:{message:function(e){return"This field must be no more than "+e.attr("maxlength")+" characters"},test:function(e){return e.val().length<=e.attr("maxlength")}},email:{message:"Please enter a valid email",test:function(e){return/^[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,4}$/i.test(e.val())}},noUrl:{message:"A url is not allowed in this field",test:function(e){return!/http:\/\//i.test(e.val())}},noSpecialCharacters:{message:"The special characters @, &, and % are not allowed in this field",test:function(e){return/^[^@&%]+$/i.test(e.val())}},equalTo:{message:"Fields do not match",test:function(t){var i=e('input[name="'+t.data("validate-equal-to")+'"]');return i.length&&t.val()===i.val()}}},wasSubmitted:!1,isWorking:!1,isFormValid:!1,_create:function(){var e=this.options,t={};this._setup(),this.$form=this.$element,this.$form.attr("novalidate","novalidate"),this.globalErrors=[],this.ignoreSelector=":submit, :reset, :image, [disabled]",e.ignoreHidden&&(this.ignoreSelector+=", :hidden"),e.ignoreSelector&&(this.ignoreSelector+=", "+e.ignoreSelector),this.addRules(e.rules),this._on(this.$form,{submit:"_handleSubmit"}),e.validateOnChange&&(t["focusout :input:not("+this.ignoreSelector+", [data-_enabled])"]="_handleFocusOut",t["keyup :input:not("+this.ignoreSelector+", [readonly])"]="_handleChange",t["change :input:not("+this.ignoreSelector+")"]="_handleChange",this._on(this.$form,t))},_handleSubmit:function(e){this._off(this.$form,"focusout"),this.wasSubmitted=!0,this.isFormValid||(e.preventDefault(),e.stopImmediatePropagation(),this.validate())},_handleFocusOut:function(t){var i=e(t.target);i.attr("data-_enabled","true"),this._handleChange(t)},_handleChange:function(t){var i=e(t.target);this.isFormValid=!1,(this.wasSubmitted||i.data("_enabled"))&&(i.data("_passed",!1),this.testField(i))},getRule:function(e){return"undefined"!=typeof this.rules[e]?this.rules[e]:!1},getRulesToValidate:function(t){var i=this,n=t.data("validate")||[],s=e.isArray(n)?n:n.split(" ");return e.each(this.options.attributes,function(e,i){t.attr(i)&&s.unshift(i)}),e.grep(s,function(e,t){return i.getRule(e)})},addRules:function(t){e.isPlainObject(t)&&e.extend(this.rules,t)},removeRule:function(e){this.getRule(e)!==!1&&delete this.rules[e]},setFieldDelegate:function(e){var t=null;return e.is(":radio")&&(t=this.$form.find(':radio[name="'+e.attr("name")+'"]').first()),e.data("_field_delegate",t),e},testField:function(t){var i,n=this,s=[],r=t.data()||{},o=r.error||{},l=e.Deferred();return r._passed?(l.resolve(),l.promise()):(this.setFieldDelegate(t),r.remoteRequest&&r.remoteRequest.abort(),i=this.getRulesToValidate(t),a.log("test field: ",t," w/ rules:",i),e.each(i,function(i,r){var l,d=n.getRule(r),u=!0,h=d.remote?!0:!1,c=null;return h&&(c=d.remoteUrl||t.data("remoteUrl"),n.removeError(t)),l=function(){var i=e.Deferred(),s=null;return s=h?n.requestRemote(c,t,r,i):d.test(t,i),s===!1?(u=!1,i.reject(r)):s===!0&&i.resolve(r),i.promise()},l=l(),s.push(l),e.when(l).fail(function(){a.log("rule failed: ",r,t)}).then(function(){o.name===r&&n.removeError(t),a.log("rule passed: ",r,t)}),u?void 0:!1}),e.when.apply(null,s).fail(function(e){var i=n.getRule(e),s=i.type?i.type:"error",r=t.data(),o=r.error||{};r.remoteTimeout&&clearTimeout(r.remoteTimeout),r.remoteRequest&&r.remoteRequest.abort(),o.message!=n.getMessage(e,t)&&(n.removeError(t),n.addInlineError(t,e)),"error"!==s?(l.resolve(),a.log("field passed: ",t," type: ",s)):(l.reject(),a.log("field failed: ",t))}).then(function(){t.data("_passed",!0),n.removeError(t),l.resolve(),a.log("field passed: ",t)}),l.promise())},requestRemote:function(t,i,n,s){var a={},r=null,o=null,l=i.data()||{};l.remoteTimeout&&(clearTimeout(l.remoteTimeout),l.remoteQueue.resolve(n)),a[i.attr("name")]=i.val(),o=setTimeout(function(){r=e.ajax({type:"POST",dataType:"json",url:t,data:a,timeout:5e3,success:function(t){switch(t){case!0:s.resolve(n);break;case!1:s.reject(n);break;default:e.isPlainObject(t)&&t.status?"success"===t.status?s.resolve(n):s.reject(n):s.resolve(n)}},complete:function(){i.data("remoteRequest",null)},error:function(e,t){s.resolve(n),i.data("_passed",!1)}}),i.data({remoteRequest:r,remoteQueue:null,remoteTimeout:null})},300),i.data({remoteQueue:s,remoteTimeout:o})},validate:function(){var t=this.options,i=this,n=[];this.isWorking||this._trigger("validate")!==!1&&(this.isWorking=!0,this.removeGlobalErrors(),this.$form.find(":input").not(this.ignoreSelector).each(function(){var t=e(this);n.push(i.testField(t))}),e.when.apply(null,n).fail(function(){a.log("validate failed"),i._trigger("failure",null,{$form:i.$form}),t.scrollToErrors&&i.scrollToErrors()}).then(function(){a.log("validate success"),i.isFormValid=!0,i._trigger("success",null,{$form:i.$form}),i.isFormValid=!1}).always(function(){i._trigger("validated"),i.isWorking=!1}))},scrollToErrors:function(){var t=this.options,i=this.$form.find("[data-validate-error]").first(),n=i.closest(t.fieldSelector),s=(n.length?n:i).offset().top;this._trigger("scroll",null,{offset:s})!==!1&&(s-=this.$window.height()/6,e("html, body").animate({scrollTop:s},"fast"))},removeError:function(t){t=t.data("_field_delegate")||t;var i=this,n=this.options,s=t.data("error");s&&("slide"===n.animation?s.$error.slideUp("fast",function(){e(this).remove(),i._completeRemoveError(s,t)}):(t.remove(),this._completeRemoveError(s,t)),t.removeClass(s.fieldClass).removeData("error"))},getMessage:function(t,i){var n=this.getRule(t),s=i.data("validate-message-"+t)||i.data("validate-message-"+t.toLowerCase());return s||s===!1||(s=e.isFunction(n.message)?n.message(i):n.message),s},addInlineError:function(t,n){t=t.data("_field_delegate")||t;var s,a,r,o,l=this,d=this.options,u=t.data("error")||{},h={name:n,position:"inline"};"error"!==u.type&&(r=this.getMessage(n,t),s=this.getRule(n),a=s.type||"error",o=i.compile(d.inlineErrorTemplate,{type:a,id:t.attr("id"),message:r}),e.extend(h,{type:a,message:r,$error:e(o).attr("data-validate-error",!0),fieldClass:i.compile(this.options.classFieldStatus,{type:a})}),t.addClass(h.fieldClass).data("error",h),r!==!1&&("slide"===d.animation?(h.$error=e("<div />").wrapInner(h.$error),h.$error.hide(),d.placeError.call(this,h.$error,t),h.$error.slideDown("fast",function(){l._completeAddError(h,t)})):(d.placeError.call(this,h.$error,t),this._completeAddError(h,t))))},addGlobalError:function(t,n){n=n||"error";var s,a=this,r=this.options,o={position:"global",type:n,message:t};s=i.compile(r.globalErrorTemplate,{type:n,message:t}),e.extend(o,{$error:e(s).attr("data-validate-error",!0)}),"slide"===r.animation?(o.$error=e("<div />").wrapInner(o.$error),o.$error.hide().prependTo(this.$form).slideDown("fast",function(){a._completeAddError(o)})):(this.$form.prepend(o.$error),this._completeAddError(o)),this.globalErrors.push(o)},removeGlobalErrors:function(){var t=this;e.each(this.globalErrors,function(e,i){i.$error.remove(),t._completeRemoveError(i)})},removeInlineErrors:function(){var t=this;this.$form.find("[data-validate-error]").each(function(){var i=e(this),n=i.data();n.error&&t.removeError(i),n.remoteRequest&&n.remoteRequest.abort()})},_completeAddError:function(t,i){this._trigger("errorAdded",null,e.extend(t,{$field:i})),this.$document.trigger("displayChange",{type:"errorAdded"})},_completeRemoveError:function(t,i){this._trigger("errorRemoved",null,e.extend(t,{$field:i})),this.$document.trigger("displayChange",{type:"errorRemoved"})},_disable:function(){this.removeGlobalErrors(),this.removeInlineErrors()},_destroy:function(){this._disable()}})}),define("fly/managers/user-1.0",["jquery","version!fly/utils/object-helper","version!fly/utils/string-helper","version!fly/utils/url-helper","version!fly/managers/debug","version!fly/managers/cookie","version!fly/components/modal-iframe","version!fly/components/iframe-messenger","version!fly/components/form-validate"],function(e,t,i,n,s,a){var r,o,l,d=!1,u=e.support.touch?"vclick":"click",h=e(document),c=e("<div>"),p=s.get("user"),g=e.fly.iframeMessenger(),v={},f=!1,m={permittedAppIds:[]},_=function(e){d?e():c.on("addEventQueue",e)},E={baseUrl:window.location.protocol+"//"+window.location.host,loadUserOnInit:!0,autoReplaceContent:!0,cookieName:"fly_user",urls:{login:"/user/login/",register:"/user/registration/",update:"/user/update/",forgotPassword:"/user/forgotten-password/",userData:{urlType:"relative",url:"/user/get-data/"}},events:{submit:function(){r.loader.add()},submitted:function(){r.loader.remove()},loginComplete:function(e,t){o.setLoggedIn(t),o.updateDisplay()},loginSuccess:function(e,t){r._on({modaliframeclosed:function(){c.trigger("loginComplete",t.user)}}),t.content||r.close()},registerSuccess:function(e,t){r._on({modaliframeclosed:function(){c.trigger("loginComplete",t.user)}}),r.$element.addClass("modal-register-success"),t.content||r.close()},userDataLoaded:function(e,t){o.updateDisplay()},logoutSuccess:function(){o.setLoggedOut()}},iframeEvents:{},formValidate:{},modalIframe:{}};return l={initGating:function(t){t=t||h,t.find("[data-user-gate]").each(function(t,i){var n=e(i),s=n.data("_user-gate-init"),a=n.is("form")?"submit":u;s||(n.on(a+".userGate",l.handleGatedEvent),n.data("_user-gate-init",!0))})},handleGatedEvent:function(t){var i=e(this),n=i.data(),s=n.userGate,a=function(){i.data("userGateDisable",!0),setTimeout(function(){i.is("form")?i.submit():i[0].click(),i.data("userGateDisable",!1)},150)};n.userGateDisable||(t.preventDefault(),t.stopImmediatePropagation(),o.gate(a,s))},initModals:function(t){t=t||h,t.on(u,"[data-user-show]",function(t){var i,n=e(this).data(),s=n.userShow;
e.isPlainObject(s)?(i=s.params,s=s.action):i=n.userShowParams,t.preventDefault(),o.inIframe?g.postMessage("showModal",{modal:s,params:i}):o.showModal(s,i)}),o.inIframe&&h.on(u,'[data-close="modal"]',function(e){g.postMessage("closeModal")}),o.registerEvents({showModal:function(e,t){r.close(),o.showModal(t.modal,t.params)}})},initForms:function(t){t=t||h,t.find("form[data-user-submit]").each(function(t,i){var n=e(i),s=n.data("_user-submit-init");s||(o.initForm(n,n.data("user-submit")),n.data("_user-submit-init",!0))})}},o={inIframe:g.isProvider,init:function(t){var i;if(!d){this.setConfig(t),this.registerEvents(E.events),this.registerIframeEvents(E.iframeEvents),e.each(E.urls,function(e,t){t.urlType&&t.url?"relative"==t.urlType?E.urls[e]=t.url:E.urls[e]=E.baseUrl+t.url:0!==t.indexOf("http")&&(E.urls[e]=E.baseUrl+t)}),this.inIframe&&this.getTriggerData();var n=this;!this.inIframe&&E.loadUserOnInit&&(i=a.get(E.cookieName),i?(this.setUserData(i),this.loadUserData(),c.one("userDataLoadFailure",function(){n.updateDisplay()})):n.updateDisplay()),l.initModals(),this.process(),p.log("init: ",E),d=!0,c.trigger("addEventQueue"),c.trigger("init")}},process:function(){l.initGating(),l.initForms()},setLoggedIn:function(e){e=e||{},f=!0,this.setUserData(e)},setLoggedOut:function(){f=!1,this.updateDisplay()},getTriggerData:function(t){var i=this;t=t||h,t.find("[data-user-trigger]").each(function(t,n){var s=e(n).data("userTrigger");p.log("triggerData",s),s&&i.postMessage(s.name,s.data,!0)})},setUserData:function(t){e.extend(!0,m,t)},setConfig:function(t){e.extend(!0,E,t)},gate:function(e,t){var i=function(){try{e()}catch(t){p.log("gate: nextAction failed",t)}};p.log("gate: ",m),c.off("loginComplete.userGate"),f&&this.isPermittedAppId(t)?i():(c.on("loginComplete.userGate",i),this.showModal("login",{appId:t}))},isPermittedAppId:function(e){return!0},showModal:function(t,n){E.urls[t]&&(r=e.fly.modalIframe(e.extend(!0,{},E.modalIframe,{url:E.urls[t],requestData:e.extend(n||{},{ifmsgr:!0}),messages:v,iframeReady:function(){c.trigger(t+"Shown",n),p.log(t+"Shown")}})),r.$element.addClass("modal-"+i.fromCamelCase(t)),n&&n.appId&&r.$element.addClass("modal-"+i.fromCamelCase(t)+"-"+n.appId),r.open())},initForm:function(t,i){var n=this;t.formValidate(e.extend(!0,{},E.formValidate,{success:function(e){n.submitForm(t,i)},scroll:function(e,t){return n.inIframe?(g.postMessage("scroll",{offset:t.offset}),!1):void 0}}))},submitForm:function(i,s){var a=this,r=i.data("formValidate"),o=i.attr("action"),l=i.serializeArray()||[];this.triggerEvent("submit",{action:s}),this.triggerEvent(s+"Submit"),l.push({name:"viewType",value:"json"}),e.ajax({type:"POST",url:o,data:e.param(l)}).done(function(i,o,l){var d,u;i=i||{},E.autoReplaceContent&&i.content&&(u=e(i.content),a.process(u),e("body").empty().append(u),c.trigger("contentSet",{$content:u}),g.postMessage("resize")),i.trigger&&a.postMessage(i.trigger.name,i.trigger.data,!0),"success"===i.status?(i.appId=n.getParam("appId"),a.triggerEvent(s+"Success",i)):"failure"===i.status&&(d=t.deepFind(i,"messages.error")||[],e.each(d.reverse(),function(e,t){r.addGlobalError(t,"error")}),a.triggerEvent(s+"Failure",i))}).fail(function(t,n){r.addGlobalError("We are having technical difficulties. Please try again.","error"),a.triggerEvent(s+"LoadFailure",t),"login"==s&&1==i.data("user-emailalert")&&e.ajax({type:"POST",url:window.location.protocol+"//"+window.location.host+"/js/error",data:{urlCalled:o,response:t.responseText,error:n+" ("+t.status+")",email:i.find("#login_email").val()}})}).always(function(){a.triggerEvent("submitted",{action:s}),a.triggerEvent(s+"Submitted")})},postMessage:function(e,t){t?g.postMessage(e,t):g.postMessage(e)},registerEvents:function(t){this.inIframe||_(function(){e.each(t,function(t,i){c.on(t,e.proxy(i,o)),t=t.split(".")[0],v[t]||(v[t]=function(e){c.trigger(t,e),p.log(t+": ",e)})})})},registerIframeEvents:function(t){this.inIframe&&_(function(){e.each(t,function(t,i){c.on(t,e.proxy(i,o))})})},triggerEvent:function(e,t){this.inIframe&&(c.trigger(e,t),g.postMessage(e,t))},removeEvents:function(e){_(function(){c.off(e)})},redirect:function(e){e=E.urls.location||e,window.location=e},loadUserData:function(){var i,n=this;e.ajax({dataType:"json",type:"POST",url:E.urls.userData}).done(function(e){i=t.deepFind(e,"user")||{},n.setUserData(i),f=e.isLoggedIn||!1,c.trigger("userDataLoaded",i),p.log("user data loaded: ",e)}).fail(function(e,t){c.trigger("userDataLoadFailure"),p.log("user data load failure: ",e)})},updateDisplay:function(t,i){i=i||e("body");var n=i.find('[data-user-view="loggedIn"]'),s=i.find('[data-user-view="loggedOut"]'),a=i.find("[data-user-var]");t=t||m,f&&a.each(function(){var i=e(this),n=i.data("userVar"),s=i.data("userVarAttr");t[n]&&(s?i.attr(s,t[n]):i.text(t[n]))}),n[f?"show":"hide"](),s[f?"hide":"show"](),c.trigger("displayUpdate"),h.trigger("displayChange",{type:"userDisplayUpdate"})},getModal:function(){return r},getConfig:function(){return E},getUserData:function(){return m}}}),define("managers/social-authentication-1.0",["jquery","version!fly/managers/debug","version!fly/managers/user","version!fly/utils/url-helper","version!fly/libs/jquery.cookie"],function(e,t,i,n){function s(){v=URS.newInstance({appId:g.appId,environment:URS.ursEnvironments[g.environment]||URS.ursEnvironments.QA,version:g.ursVersion,clientToken:g.ursClientToken}),y.fire()}function a(t,n){if(i.inIframe)i.postMessage("openForm",{name:t,params:n});else{if(g.modalFlow)return path=E[t]+"?"+e.param(n),w=960,h=551,left=screen.width/2-w/2,top=screen.height/2-h/2,additionalInfo=window.open(path,"","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=no, width="+w+", height="+h+", top="+top+", left="+left),additionalInfo;p.log("Open "+t+" Page"),window.location.href=E[t]+"?"+e.param(n)}}function r(){i.inIframe?i.postMessage("reloadPage"):(p.log("Reload Page"),window.location.reload())}function o(e){var t;"billing"===e&&(t=E.billing),"ioslogin"===e&&(t=i.getConfig().urls.login+"?appId="+g.appId+"&platform="+g.platform),"androidlogin"===e&&(t=i.getConfig().urls.login+"?appId="+g.appId+"&platform="+g.platform+"&login=true"),i.inIframe?i.redirect(t):(p.log("Redirecting not in modal"),window.location.replace(t))}function l(){v.common.addEventListener(v.events.AUTH_COMPLETE,function(t,i){if(p.log("AUTH_COMPLETE: ",t,i),i.hasErrors()){var s=e.map(i.response.status.errors,function(e,t){return e.applicationCode});p.log("errors: ",s);var r=s.join(",");if(r.indexOf("invalid.noLink")>=0)v.social.authenticate(f,!0);else if(r.match(/required\.|\.required/)){for(var l=[],d=0;d<s.length;d++)s[d].match(/required\.|\.required/)&&l.push(s[d].replace(/required\.|\.required/,"").toLowerCase());var u="socialAdditionalInformation",h={socialSite:f,fields:l.join(","),appId:g.appId,ifmsgr:"true"};a(u,h)}else r.match(/_in_use|inuse/)?p.log("error handled elsewhere:",s):r.indexOf("invalid.user")>=0?b++<10&&(p.log("trying to authenticate again"),v.social.authenticate(f,!0)):r.indexOf(!1)?b++<10&&(p.log("trying to authenticate again"),v.social.authenticate(f,!0)):p.log("unhandled authentication error:",s)}else{p.log("Logged in via "+f),b=0;var c=i.response.receipt.account;if(e.cookie(g.cookieUserRecognized,JSON.stringify({username:c.userName,socialSite:f}),{expires:365,path:"/"}),0==c.emailValid&&"1503"!=g.appId){p.log("user email not verified, logging out and showing CLC message"),v.social.logout(f),v.registration.logout();var h={email:c.emailAddress},u="confirmRegistration";a(u,h)}else p.log("telling symfony user is logged in"),e.post("/user/social-login/",{email:c.emailAddress,platform:g.platform,appId:g.appId},function(e){var t=e;if(p.log("Login Status: ",t.status),"notsubscribed"===t.status)o("billing");else if("iossuccess"===t.status)o("ioslogin");else if("androidsuccess"===t.status)o("androidlogin");else if("success"===t.status){var i=-1!=navigator.userAgent.indexOf("Edge")||-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Trident");if("mobile"==CBSNEWS.device)if(n.getParam("page")){var s=CBSNEWS.user.publicHost,a=unescape(n.getParam("page"));window.location.href="http://"+s+a,window.opener&&window.opener.postMessage("loginWindow",document.referrer.replace(/^(https?:\/\/[^/]+).+$/,"$1"))}else window.opener?window.opener.postMessage("loginWindow",document.referrer.replace(/^(https?:\/\/[^/]+).+$/,"$1")):window.location.reload();else i?window.opener?window.close():window.location.reload():window.opener?(window.opener.postMessage("loginWindow",document.referrer.replace(/^(https?:\/\/[^/]+).+$/,"$1")),window.close()):window.location.reload();var r=n.getParam("redirectUrl")||"";if(r=r.replace(/^.*\/\/[^\/]+/,"")){var l=CBSNEWS.user.publicHost;window.location.assign("http://"+l+r)}else window.opener.postMessage("loginWindow",document.referrer.replace(/^(https?:\/\/[^/]+).+$/,"$1"))}},"json").fail(function(e){p.log("symfony request failed: ",e)});f=null}}),v.common.addEventListener(v.events.GET_LINKS_COMPLETE,function(t,i){p.log("GET_LINKS_COMPLETE: ",t,i);var n={};e.each(i.response.socialLinks,function(e,t){n[t.socialSite]=!0}),e.each(v.social.sites,function(t,i){var s=e("[data-user-link="+i+"]");n.hasOwnProperty(i)?s.removeClass(g.classUnlinked).addClass(g.classLinked).text(g.textLinked+i):s.removeClass(g.classLinked).addClass(g.classUnlinked).text(g.textUnlinked+i),s.on("click",function(t){var n=e(this).hasClass(g.classLinked);n?v.social.unlink(i):v.social.link(i)})})}),v.common.addEventListener(v.events.LINK_COMPLETE,function(t,i){p.log("LINK_COMPLETE: ",t,i),!i.hasErrors()&&i.response.linked&&e("[data-user-link="+i.response.socialSite+"]").removeClass(g.classUnlinked).addClass(g.classLinked).text(g.textLinked+i.response.socialSite)}),v.common.addEventListener(v.events.UNLINK_COMPLETE,function(t,i){p.log("UNLINK_COMPLETE: ",t,i),!i.hasErrors()&&i.response.accountUnlinked&&e("[data-user-link="+i.response.socialSite+"]").removeClass(g.classLinked).addClass(g.classUnlinked).text(g.textUnlinked+i.response.socialSite)})}function d(){c(),e("#social-additional-information").on("submit",function(t){t.preventDefault();for(var i=e(t.target).serializeArray(),n={},s=0;s<i.length;s++)"socialSite"===i[s].name?f=i[s].value:n[i[s].name]=i[s].value;v.social.authenticate(f,!0,n)});var t=JSON.parse(e.cookie(g.cookieUserRecognized));t?(m.hide(),_.show(),e("[data-user-template]",_).each(function(i,n){var s=e(n);"name"===s.data("userTemplate")&&s.text(t.username)}),e("[data-user-social]",_).each(function(i,n){var s=e(n);s.data("userSocial",t.socialSite),s.addClass(t.socialSite),e(".logo",s).text(t.socialSite)}),e("[data-user-action]",_).on("click",function(t){"differentNetwork"===e(this).data("userAction")&&(e.removeCookie(g.cookieUserRecognized,{path:"/"}),_.hide(),m.show())})):(m.show(),_.hide()),e("[data-user-social]").on("click",function(t){f=e(this).data("userSocial"),"modal"===e(this).data("userFlow")&&(g.modalFlow=!0),v.social.authenticate(f)})}function u(){var t=e("#social-username");t.size()>0&&(v.common.addEventListener(v.events.USERNAME_CHECK_TAKEN,function(i,n){var s=t;p.log("username taken:",s[0].value),s.parent().children().remove(".icon-spinner"),s.parent().children().remove(".icon-ok"),s.before(e("<i class='icon-remove' style='color:red'></i> ")),s.data("taken","true")}),v.common.addEventListener(v.events.USERNAME_CHECK_AVAILABLE,function(i,n){var s=t;p.log("username available:",s[0].value),s.parent().children().remove(".icon-spinner"),s.parent().children().remove(".icon-remove"),s.before(e("<i class='icon-ok' style='color:green'></i> ")),s.data("taken","false")}));var i=e("#social-email");i.size()>0&&(v.common.addEventListener(v.events.EMAIL_CHECK_TAKEN,function(t,n){var s=i;p.log("email taken:",s[0].value),s.parent().children().remove(".icon-spinner"),s.parent().children().remove(".icon-ok"),s.before(e("<i class='icon-remove' style='color:red'></i> ")),s.data("taken","true")}),v.common.addEventListener(v.events.EMAIL_CHECK_AVAILABLE,function(t,n){var s=i;p.log("email available:",s[0].value),s.parent().children().remove(".icon-spinner"),s.parent().children().remove(".icon-remove"),s.before(e("<i class='icon-ok' style='color:green'></i> ")),s.data("taken","false")})),(t.size()>0||i.size()>0)&&v.common.addEventListener(v.events.AUTH_COMPLETE,function(n,s){if(p.log("AUTH_COMPLETE (for user form): ",n,s),s.hasErrors()){var a=e.map(s.response.status.errors,function(e,t){return e.applicationCode});p.log("errors: ",a);var r=a.join(",");if(r.match(/username\.uname_in_use|inuse\.userName/i)){var o=t;p.log("username taken:",o[0].value),o.parent().children().remove(".icon-spinner"),o.parent().children().remove(".icon-ok"),o.parent().children().remove(".icon-remove"),o.before(e("<i class='icon-remove' style='color:red'></i> ")),o.data("taken","true")}if(r.match(/emailaddress\.email_in_use|inuse\.email/)){var l=i;p.log("email taken:",l[0].value),l.parent().children().remove(".icon-spinner"),l.parent().children().remove(".icon-ok"),l.parent().children().remove(".icon-remove"),l.before(e("<i class='icon-remove' style='color:red'></i> ")),l.data("taken","true")}r.match(/_in_use|inuse/)||p.log("not handling error here:",a)}})}function c(){var t={};e("body").on("keyup change focusout","#social-username , #social-email",function(i){var n=this;clearInterval(t[n.id]),e(n).parent().children().remove(".icon-spinner"),e(n).parent().children().remove(".icon-remove"),e(n).parent().children().remove(".icon-ok"),e.trim(n.value).length>0&&(e(n).before(e("<i class='icon-spinner icon-spin icon-2x'></i>")),t[n.id]=setTimeout(function(){"social-username"==e(n).attr("id")?v.registration.isUserNameTaken(e(n).val()):v.registration.isEmailTaken(e(n).val())},1e3))})}var p=t.get("socialAuth"),g={classLinked:"linked",classUnlinked:"unlinked",textLinked:"Linked to ",textUnlinked:"Unlinked to ",cookieUserRecognized:"urs_social_recognized",modalFlow:!1},v=null,f=null,m=e(".unrecognized"),_=e(".recognized"),E={socialAdditionalInformation:"/user/social-additional-information/",confirmRegistration:"/user/instructions-confirm-registration/",billing:"/user/billing/60minutes/"},y=e.Callbacks(),b=0;return{init:function(t){e.extend(!0,g,t),require(["urs"],s),y.add(function(){l(),u(),v.social.getLinks()}),i.setConfig({urls:E}),d(),i.inIframe||i.registerEvents({openForm:function(e,t){p.log("openForm callback:",e,t),g.modalFlow=!0,a(t.name,t.params)},reloadPage:function(e){p.log("reloadPage callback:",e),r()}})},registerUrsEvents:function(e,t){var i=function(){v.events[e]&&(v.common.addEventListener(v.events[e],t),p.log("registered to",e,"event with function:",t))};v?i():y.add(i)}}}),define("managers/tealium",["jquery","version!fly/managers/debug","fly/libs/uuid.v4","tealium"],function(e,t){var i=(e.support.touch?"vclick":"click",t.get("tealium"));return{trackingData:{},viewGuid:null,resetGuidEnabled:!0,init:function(e){this.trackingData=e,i.log("tealium::init:","loading tracking data",this.trackingData)},explicitTrackView:function(e){var e="undefined"==typeof e?{}:e;utag.view(e)},explicitTrackLink:function(e){var e="undefined"==typeof e?{}:e;utag.link(e)},setViewGuid:function(e){this.viewGuid=e,i.log("tealium::setViewGuid",this.viewGuid)},resetViewGuid:function(){return this.resetGuidEnabled&&(this.viewGuid=uuid.v4()),i.log("tealium::resetViewGuid",this.viewGuid),this.viewGuid},getViewGuid:function(){return this.viewGuid},syncResetViewGuid:function(){var e="";return e=this.resetViewGuid(),this.resetGuidEnabled=this.resetGuidEnabled?!1:!0,e},getTrackingData:function(){return this.trackingData}}}),define("managers/social-authentication",["jquery","version!fly/managers/debug","managers/social-authentication-1.0","managers/tealium"],function(e,t,i,n){var s=e(document);return s.ready(function(){function n(e){var t=e.split(" "),i=t[0].split("-"),n=t[1].split(":"),s=new Date(i[0],i[1]-1,i[2],n[0],n[1],n[2]);return s}function s(){e("#social-dateofbirth").val(""),e("select[id^=social_dateOfBirth]").each(function(t,i){var n=e("#social-dateofbirth").val()+e(i).val();2>t&&(n+="/"),e("#social-dateofbirth").val(n)})}var a=t.get("socialAuth");e("select[id^=social_dateOfBirth]").change(s),a.log("registering Default Newsletter Subscription to urs AUTH_SUCCESS event"),i.registerUrsEvents("AUTH_SUCCESS",function(t,i){a.log("AUTH_SUCCESS: ",t,i);var s=i.response.receipt.account;if(s.tosAccepted){var r=n(s.registrationDate),o=n(i.response.status.timestamp);o.getTime()-r.getTime()<1e4&&(a.log("new registration, subscribe to Default Newsletter e889"),e.ajax({dataType:"json",url:"/user/edit-profile-xhr/",data:{option:"e889:INTERNAL_NEWSLETTER"},type:"POST",async:!1,cache:!1}).done(function(e){e.status&&"success"==e.status?a.log("successfully subscribed to Default Newsletter e889",e):a.log("failed to subscribe to Default Newsletter e889:",e)}).fail(function(e){a.log("Default Newsletter subscribe request failed:",e)}).always(function(){0==s.emailValid&&(a.log("user email not verified, so logging user out"),e.ajax({dataType:"json",url:"/user/logout/",async:!1,cache:!1}).done(function(e){a.log("logout successful")}).fail(function(e){a.log("failed to logout")}))}))}});var r=CBSNEWS.user.appId;a.log("registering omniture tracking to urs AUTH_SUCCESS event"),i.registerUrsEvents("AUTH_SUCCESS",function(e,t){a.log("AUTH_SUCCESS: ",e,t);var i=t.response.socialSite,s=r+"-social|"+i,o=t.response.receipt.account,l=n(o.registrationDate),d=n(t.response.status.timestamp);d.getTime()-l.getTime()<1e4?(a.log("new registration, tracking in omniture"),om.trackRegistrationNew({userRegFormType:s,userRegService:i})):(a.log("regular login, tracking in omniture"),om.trackLogin({userId:o.registrationId,userState:"authenticated",userType:"registered"}))})}),i}),define("managers/bluehornet",["jquery"],function(e){e("#newsletter-signup-form").submit(function(t){var i=e("#newsletter-signup-form").find("[required]"),n="/newsletters/xhr/non-user-subscribe/",s=e("#newsletter-widget-wrapper .message h4"),a=e("#newsletter-widget-wrapper .message p"),r=(document.forms.newsletterSignupWidget.email.value,new FormData(this));e("#newsletter-widget-wrapper h3").hide(),e(i).each(function(){e(this).val()&&e("#newsletter-signup__privacy").is(":checked")?(e.ajax({url:n,type:"POST",data:r,dataType:"json",mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1}).done(function(t,i,n){"success"===t.status?(s.empty().html("Thanks for subscribing"),a.html("View other <br /> newsletters <a href='http://www.cbsnews.com/newsletters/?ftag=CNM-00-10aab8g'>here</a>"),e("#newsletter-widget-wrapper .message").fadeIn(1e3),e(".newsletter-form").hide()):"failure"===t.status&&(s.empty().html("Error!"),e("#newsletter-widget-wrapper .message").fadeIn(1e3),"duplicate"===t.message?a.html("You have subscribed already. View other newsletters <a href='http://www.cbsnews.com/newsletters/?ftag=CNM-00-10aab8g'>here</a>"):a.html("Please enter a valid email address"))}).fail(function(t,i){e("#newsletter-widget-wrapper .message").fadeIn(1e3),s.html("Error!"),a.html("We are experiencing technical difficulties please check back later")}),t.preventDefault()):(t.preventDefault(),e("#newsletter-widget-wrapper .message").fadeIn(1e3),s.empty().html("Error!"),""!=e('#newsletter-widget-wrapper input[type="email"]').val()||e("#newsletter-signup__privacy").is(":checked")?""==e('#newsletter-widget-wrapper input[type="email"]').val()||e("#newsletter-signup__privacy").is(":checked")?a.empty().html("Please enter a valid email address"):a.empty().html("Please check this box if you want to proceed."):a.empty().html("Please enter a valid email address"))})})}),define("managers/user",["jquery","version!fly/managers/user","managers/tealium","version!fly/utils/object-helper","version!fly/utils/string-helper","version!fly/utils/url-helper","version!fly/managers/debug","version!fly/managers/cookie","version!fly/components/modal-iframe","version!fly/components/iframe-messenger"],function(e,t,i,n,s,a,r,o){var l=e(document);return l.ready(function(){var i=CBSNEWS.user,s=i.secureHost,r=i.appId,o=(i.platform,r+"|short"),l={registerShown:function(){om.trackRegistrationOpen({userRegFormType:o})},loginSuccess:function(e,t){om.trackLogin({userId:t.user.registrationId,userState:"authenticated",userType:"registered"})},registerSuccess:function(){om.trackRegistrationNew({userRegFormType:o,userRegService:"urs"})},logoutSuccess:function(){om.trackLogout({userId:data.user.registrationId})},forgotPasswordSuccess:function(){om.trackForgotPassword()}};t.registerEvents(l);var d={urls:{billingPage:"/user/billing/60minutes/",confirm:"/user/send-confirmation/"},events:{loginSuccess:function(e,i){if(i.appId&&i.platform&&"1503"==i.appId&&"ios"==i.platform)window.location.href="loginsuccess://login?regId="+i.user.registrationId;else if(i.appId&&i.platform&&"1503"==i.appId&&"android"==i.platform)window.location.href=t.urls.login+"?appId="+i.appId+"&platform="+i.platform+"&login=true";else if(i.goToFormName)if(t.inIframe)t.postMessage("openForm",{name:i.goToFormName,params:{show:"60minutes"}});else{var n=t.getModal();n&&n.close(),t.showModal(i.goToFormName,{show:"60minutes"})}else t.getModal().close(),window.location.reload()}}};s&&(d.baseUrl="https://"+s),t.options={},t.options.errorDiv=".message-panel",t.submitForm=function(s,o){var l=t.getConfig(),d=this,u=s.data("formValidate"),h=s.attr("action"),c=s.serializeArray()||[];"1503"==r&&d._errorPanel(!1),this.triggerEvent("submit",{action:o}),this.triggerEvent(o+"Submit"),c.push({name:"viewType",value:"json"}),e.ajax({type:"POST",url:h,data:e.param(c)}).done(function(t,s,h){var c,p;if(t=t||{},l.autoReplaceContent&&t.content&&(p=e(t.content),d.process(p),e("body").empty().append(p),d.triggerEvent("contentSet",{$content:p}),d.postMessage("resize")),t.trigger&&d.postMessage(t.trigger.name,t.trigger.data,!0),"success"===t.status){t.appId=a.getParam("appId");var g=-1!=navigator.userAgent.indexOf("Edge")||-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Trident");if("mobile"==CBSNEWS.device)if(a.getParam("page")){var v=CBSNEWS.user.publicHost,f=unescape(a.getParam("page"));window.location.href="http://"+v+f}else window.history.back(),window.opener.postMessage("loginWindow",document.referrer.replace(/^(https?:\/\/[^/]+).+$/,"$1"));else if(a.getParam("page")){var v=CBSNEWS.user.publicHost,f=unescape(a.getParam("page"));-1!=navigator.userAgent.indexOf("iPad")?window.location.href="http://"+v+f:window.opener&&(window.opener.postMessage("loginWindow",document.referrer.replace(/^(https?:\/\/[^/]+).+$/,"$1")),window.close())}else g?window.opener?window.close():window.location.reload():window.opener?(window.opener.postMessage("loginWindow",document.referrer.replace(/^(https?:\/\/[^/]+).+$/,"$1")),window.close()):window.opener.postMessage("loginWindow",document.referrer.replace(/^(https?:\/\/[^/]+).+$/,"$1"));d.triggerEvent(o+"Success",t)}else"failure"===t.status&&(c=n.deepFind(t,"messages.error")||[],e.each(c.reverse(),function(e,t){"1503"==r?(d._errorPanelUpdate(t),d._errorPanel(!0)):t.indexOf("maximum")>-1?window.location.href="/user/forgotten-password/?appId="+i.appId+"&platform="+i.platform+"&ifmsgr=true&ifReset=true":u.addGlobalError(t,"error")}),d.triggerEvent(o+"Failure",t))}).fail(function(t,i){u.addGlobalError("We are having technical difficulties. Please try again.","error"),d.triggerEvent(o+"LoadFailure",t),"login"==o&&1==s.data("user-emailalert")&&e.ajax({type:"POST",url:window.location.protocol+"//"+window.location.host+"/js/error",data:{urlCalled:h,response:t.responseText,error:i+" ("+t.status+")",email:s.find("#login_email").val()}})}).always(function(){d.triggerEvent("submitted",{action:o}),d.triggerEvent(o+"Submitted")})},t._errorPanelUpdate=function(t){e(this.options.errorDiv).append('<div class="alert alert-error">'+t+"</div>")},t._errorPanel=function(t){return t?void e(this.options.errorDiv).slideDown():(e(this.options.errorDiv).slideUp(),void e("div.alert",this.options.errorDiv).remove())},t.init(d),jQuery.isFunction(t.loadUserData)&&t.loadUserData()}),t}),define("managers/taboola-rem",["jquery","version!fly/managers/debug"],function(e,t){"use strict";var i,n=t.init("taboolaRem"),s={category_door:"category",deep_story:"-1",error_page:"-2",front_door:"home",image_gallery:"photo",image_gallery_list:"other",live_video:"-1",media_post:"other",news_item:"article",search:"-2",topic_list:"other",video:"video",video_door:"category"},a=s[utag_data.pageType]||"other",r=window._taboola=window._taboola||[],o=!1,l={init:function(t){var i={};i[a]="auto",i.referrer=document.referrer,i.url=window.location.href,t=e.extend(i,t),n.log("init",t),r.push(t),l.load()},load:function(){return o?void n.log("Taboola already loaded"):(n.log("Loading Taboola"),void require(["taboola"],function(){n.log("Taboola loaded"),o=!0}))},display:function(){return i=e("[data-taboola]"),i.length?(l.init(),i.each(function(){var t=e(this).data("taboola");t=e.extend({container:this,target_type:"mix"},t),n.log("display",t),r.push(t)}),void r.push({flush:!0})):void n.log("No Taboola REM containers found")},refresh:function(){n.log("refresh"),r.push({notify:"newPageLoad"}),l.display()},taboola:null};return e(function(){n.log("DOM is ready"),l.display()}),l}),define("fly/components/modal-async-1.0",["jquery","version!fly/utils/object-helper","version!fly/components/modal","version!fly/components/loading","version!fly/utils/data-prefix"],function(e,t){var i=e.support.touch?"vclick":"click";e.widget("fly.modalAsync",e.fly.modal,{options:{url:null,requestData:{},responseKey:"modal",loader:{disabled:!1}},isContentLoaded:!1,_create:function(){this._super(),this._setupLoader()},open:function(){this.isOpen||(this.isContentLoaded||this.loadContent(),this._super())},_setupLoader:function(){this.loader=e.fly.loading(this.options.loader),this.loader.$element.appendTo(this.$element)},loadContent:function(){var i=this.options,n=this;this.loader.add(),e.ajax({dataType:"json",url:i.url,data:i.requestData}).done(function(s){var a=t.deepFind(s,i.responseKey)||{},r=a.html;return r?(n._trigger("contentLoaded",null,e.extend({},this.eventData,{content:r})),n.isContentLoaded=!0,n.setContent(r),void n.$backdrop.css({height:n.$document.height()})):void n.destroy()}).fail(function(e,t){n.destroy()}).always(function(){n.loader.remove()})},_destroy:function(){this._trigger("destroy"),this._super(),this.$modal.remove()}}),e(document).on(i+".modalAsync-api.data-api",'[data-open="modalAsync"]',function(t){var i,n=e(this),s=n.data(),a=s.$modal;n.data("modalOptions").checkIE?$checkIE=n.data("modalOptions").checkIE:$checkIE=!1,!$checkIE||-1==navigator.appVersion.indexOf("MSIE 8.")&&-1==navigator.appVersion.indexOf("MSIE 7.")?(t.preventDefault(),t.stopImmediatePropagation(),a?a.open():(i=n.data("modalAsyncOptions")||n.dataPrefix("modalAsync"),a=e.fly.modalAsync(e.extend(!0,{},{openOnInit:!0,destroy:function(){n.removeData("$modal")}},i)),n.data("$modal",a))):($url="//"+location.host+n.attr("href"),window.open($url))})}),define("components/modal-homepage",["jquery","version!fly/utils/object-helper","version!fly/components/modal","version!fly/components/loading","version!fly/utils/data-prefix"],function(e){var t=e.support.touch?"vclick":"click";e.widget("fly.modalHomepage",e.fly.modal,{}),e(document).on(t+".modal-api.data-api",'[data-open="modal-homepage"]',function(t){var i=e(this),n=i.data(),s=n.$modal;$html='<div class="modal-wrapper"><div class="modal-header"><button class="close" data-close="modal"><div>&times;</div></button></div><div class="modal-body">',$browser="",navigator.userAgent.toLowerCase().indexOf("firefox")>-1?($browser="Firefox",$instructions='<p>1. Click the menu button and choose "Options" or "Preferences".<br/>2. Select the "General" panel.<br/>3. In the "Home Page" box enter www.cbsnews.com then click OK or just close the window. </p>'):navigator.userAgent.toLowerCase().indexOf("chrome")>-1?($browser="Chrome",$instructions='<p>1. Click on the Chrome menu icon, located in the upper right hand corner of your browser window then select "Settings".<br/>2. Under the "On Startup" click on the "Open a specific page or set of pages" then click on the "Set Pages". <br/>3. Click on the "Use Current" button then click "OK".</p>'):navigator.userAgent.toLowerCase().indexOf("safari")>-1?($browser="Safari",$instructions='<p>1. From the top menu bar, click "Safari." Select "Preferences."<br/>2. On the "General" tab, type www.cbsnews.com in the Homepage entry box and you\'re done.</p>'):(navigator.userAgent.toLowerCase().indexOf("msie")>-1||navigator.userAgent.toLowerCase().indexOf("trident")>-1)&&($browser="Internet Explorer",$instructions='<p>1. Click on the gear icon, located in the upper right hand corner of your browser window then select "Internet Options".<br/>2. Under the "Home Page" box click on the "Use Current" button then click "OK".'),""!=$browser&&($html+="<h3>To make CBS News your homepage in "+$browser+":</h3>"+$instructions+"</div></div>"),t.preventDefault(),s||(s=e(n.target||i.attr("href")),s[0].innerHTML=$html,i.data("$modal",s)),s.length&&s.modal().modal("open")})}),define("components/smart-banner",["jquery","version!fly/managers/debug","version!fly/components/base","version!fly/libs/jquery.cookie"],function(e,t){var i=e(document.documentElement),n=t.init("smartBanner");n.log("starting widget"),e.widget("cbsnews.smartBanner",e.fly.base,{options:{url:null,bannerAnchorSelector:"#smart-banner--text-container",bannerVisibleClass:"smart-banner--visible",cookieName:"smartBannerState",retryDays:7,hideDays:30},deviceName:null,isHidden:!1,zoomInterval:null,_create:function(){if(n.log("creating component",this.options),this._isTargetDevice()){this._setup(),this._isHidden()||(this.zoomInterval=setInterval(e.proxy(this._onZoom,this),300));var t=this._url(this.deviceName);n.log("set click url to ",t),this.$element.on("click","a",e.proxy(this._toggleHide,this)).find(this.options.bannerAnchorSelector).attr("href",t),this._show()}},_show:function(){n.log("show component"),null===this.isHidden&&setTimeout(e.proxy(this._setCookie,this,this.options.retryDays),3e4),this._toggleVisibleClass()},_toggleHide:function(){n.log((this.isHidden?"show":"hide")+" component"),this.isHidden=!this.isHidden,this._setCookie(this.options.hideDays),this._toggleVisibleClass(),clearInterval(this.zoomInterval)},_onZoom:function(){var t=this.$element.width()!=e(document).width();t!=this.isHidden&&(n.log("onZoom ",this.isHidden?"show":"hide"," banner"),this._toggleVisibleClass(t))},_setCookie:function(t){n.log("set cookie for "+t+" days"),e.cookie(this.options.cookieName,+this.isHidden,{path:"/",expires:t})},_isTargetDevice:function(){var e=navigator.userAgent.toLowerCase(),t=this.options.url,s=t&&"object"==typeof t&&Object.keys(t).join("|"),a=new RegExp("("+s+")"),r=e.match(a);return s?r?(n.log("detected device as ",r[0]),this.deviceName=r[0],i.addClass(this.deviceName)):n.log("device does not match the rule ",r):(n.log("no devices provided, default to true",r),r=!0),!!r},_isHidden:function(){return this.isHidden=e.cookie(this.options.cookieName),n.log("banner is ",this.isHidden?"hidden":"visible"),this.isHidden},_toggleVisibleClass:function(e){e=e||this.isHidden,n.log("toggle state to "+(e?"hidden":"visible")),i.toggleClass(this.options.bannerVisibleClass,!e)},_url:function(e){var t=this.options.url;return n.log("Guess URL ",t,"by ",e),"string"==typeof t?t:"object"==typeof t&&e in t?t[e]:""}})}),define("components/ticker",["jquery","version!fly/managers/cookie","version!fly/managers/debug","version!fly/components/base"],function(e,t,i){var n=i.init("ticker"),s=e.support.touch?"vclick":"click";e.widget("fly.ticker",e.fly.base,{options:{feedUrl:"/feedfiles/breakingnews.desktop.xml",idleTimerInterval:5,updateInterval:60,animationInterval:9,fadeOutSpeed:400,fadeInSpeed:900,selectors:{tickerLI:"ul.fadingTicker > li"}},response:{},updateTimer:null,idleTimer:null,needsUpdate:!1,tickerActive:!1,animationTimer:null,currentFrame:0,$content:null,
$tickerItems:null,_create:function(){var i=t.get("cbsnews_mticker_x");if(i)return void e(".ticker").hide();e(".ticker").show(),this._setup(),this.$content=this.$element;var n={};n[s+" .close"]="_handleClose",this._on(this.$element,n),this.startTicker()},startTicker:function(){this.startTimer(),e(this.options.selectors.tickerLI,this.$content).length>0?(this.tickerActive=!0,this.startAnimation()):this.refreshSequence()},refreshData:function(){this.stopTimer(),this._trigger("refresh",null,this.eventData)!==!1&&e.ajax({type:"POST",url:this.options.feedUrl}).done(e.proxy(this.handleResponse,this)).fail(e.proxy(this.handleFail,this))},handleResponse:function(e){this.response=e,this.needsUpdate=!1,this.processResponse(),this.startTimer()},handleFail:function(){this._trigger("failResponse",null,this.eventData)!==!1&&n.log("xhr request failed")},processResponse:function(){if(this._trigger("processResponse",null,this.eventData)!==!1){this.tickerActiveXml=e("cbsNewsTicker",this.response).attr("active");var t=this.skin;this.skin=e("skin",this.response).text();var t=this.skinName;this.skinName=e("skin",this.response).attr("id");this.rank;this.rank=e("rank",this.response).text();this.refreshableContentSelector;this.refreshableContentSelector=e("refreshableContent",this.response).text();var i=this.content;if(this.content=e("content",this.response).text(),"global"!=this.rank&&!this.rankCheck(this.rank))return this.killTicker(),!1;if(0==this.tickerActive&&1==this.tickerActiveXml){if(this.updateTickerSkin(),this.updateTickerContent(),e(".leaderboard-ads").length&&e(".ui-page-panel").length){var n=e(".content-primary.ads").offset().top;e(".leaderboard-ads").css("top",n)}}else 1==this.tickerActive&&0==this.tickerActiveXml&&this.killTicker();if(0!=this.tickerActiveXml){if(this.tickerActive=!0,this.skinName!=t&&(this.updateTickerSkin(),this.updateTickerContent()),this.content!=i)this.updateTickerContent();else{var s=e(this.options.selectors.tickerLI,this.$content);s.hide().removeClass("active")}this.startAnimation()}}},rankCheck:function(e){var t=window.location.href.split("?")[0];return"global"==e?!0:"test"==e&&-1!=t.indexOf("testProduction")?!0:"notHome"==e&&"http://www.cbsnews.com/"!=t&&"http://oaktree.cbsnews.com/"!=t&&"http://cbsnews.com/"!=t?!0:!1},updateTickerSkin:function(){this._trigger("updateSkin",null,this.eventData)!==!1&&this.$content.html(this.skin)},updateTickerContent:function(){this._trigger("updateContent",null,this.eventData)!==!1&&e(this.refreshableContentSelector,this.$content).html(this.content)},killTicker:function(){this._trigger("killTicker",null,this.eventData)!==!1&&(this.tickerActive=!1,this.$content.empty(),this.startIdleTimer())},startTimer:function(){this.updateTimer=setTimeout(e.proxy(this.setUpdateFlag,this,!0),1e3*this.options.updateInterval)},stopTimer:function(){clearTimeout(this.updateTimer)},startIdleTimer:function(){n.log("idle timer started"),this.idleTimer=setInterval(e.proxy(this.checkUpdateFlag,this,!0),1e3*this.options.idleTimerInterval)},killIdleTimer:function(){clearInterval(this.idleTimer),n.log("timer"),n.log(this.idleTimer)},checkUpdateFlag:function(){n.log("check update flag"),this.needsUpdate&&(n.log("do update"),this.killIdleTimer(),this.refreshSequence())},setUpdateFlag:function(e){this.needsUpdate=e},startAnimation:function(){this.$tickerItems=e(this.options.selectors.tickerLI,this.$content),this.animationTimer=setInterval(e.proxy(this.animationNextFrame,this),1e3*this.options.animationInterval),-1==this.currentFrame&&this.animationNextFrame()},animationNextFrame:function(){if(1==this.$tickerItems.length){this.currentFrame=0;var t=e(this.$tickerItems[this.currentFrame]);return t.show().addClass("active"),void(1==this.needsUpdate&&(this.stopAnimation(),setTimeout(e.proxy(this.refreshSequence,this),1e3*this.options.animationInterval)))}if(-1==this.currentFrame)this.animationNextFrameShow();else{var t=e(this.$tickerItems[this.currentFrame]);t.fadeOut(this.options.fadeOutSpeed,e.proxy(this.animationNextFrameShow,this)).removeClass("active")}},animationNextFrameShow:function(){return this._trigger("showFrame",null,this.eventData)!==!1?(this.currentFrame>=this.$tickerItems.length-1||-1==this.currentFrame?this.currentFrame=0:this.currentFrame++,activeFrame=e(this.$tickerItems[this.currentFrame]),activeFrame.fadeIn(this.options.fadeInSpeed).addClass("active"),this.currentFrame==this.$tickerItems.length-1&&1==this.needsUpdate?(this.stopAnimation(),void setTimeout(e.proxy(this.refreshSequence,this),1e3*this.options.animationInterval)):void 0):void 0},refreshSequence:function(){this._trigger("refreshTrigger",null,this.eventData)!==!1&&(this.currentFrame=-1,this.refreshData())},stopAnimation:function(){clearInterval(this.animationTimer)},_handleClose:function(e){e.preventDefault(),this.$element.hide(),this.stopAnimation(),t.set("cbsnews_mticker_x","1",{path:"/",domain:"default",expires:1})}})}),window.beanstockSonobiFreq=window.beanstockSonobiFreq||100,require(["gpt"]),require(["jquery","libs/iframe-resizer.min"],function(e){e(function(){var t=e("iframe.resizer");t.length&&typeof t.iFrameResize==typeof Function&&t.iFrameResize({log:!1,enablePublicMethods:!0,autoResize:!0,heightCalculationMethod:"lowestElement",checkOrigin:!0})})}),("front_door"===utag_data.pageType||"category_door"===utag_data.pageType)&&require(["libs/pointroll.resp.lib"]),require(["fly/libs/uuid.v4"],function(){CBSNEWS.tracking.pageViewGuid=uuid.v4()}),require(["jquery","managers/ad","managers/beanstock-sonobi"],function(e,t,i,n){e(function(){var e=CBSNEWS.ad,n=CBSNEWS.tracking.pageViewGuid;require(["sharethrough"]);var s=function(){t.init({ad:e,viewGuid:n}),t.loadAds()};i.isEnabled?i.init(e,s):s()})}),require(["managers/click-tracking"]),require(["jquery","managers/components."+CBSNEWS.device],function(e,t){e(function(){t.process()})}),require(["jquery","managers/social-authentication"],function(e,t){e(function(){t.init(CBSNEWS.user)})}),require(["managers/tealium"],function(e){window.$tealium=e,1==CBSNEWS.tracking.isEnabled&&(e.setViewGuid(CBSNEWS.tracking.pageViewGuid),e.init(CBSNEWS.tracking))}),require(["managers/bluehornet"]),require(["managers/user"]),require(["managers/taboola-rem"]),require(["version!fly/components/modal"]),require(["version!fly/components/modal-async"]),require(["components/modal-homepage"]),require(["components/smart-banner"]),require(["components/ticker"]),define("common",function(){}),define("fly/libs/jquery.nano-scroller-0.7.2",["jquery"],function(e){"use strict";var t,i,n,s,a,r,o,l,d,u,h,c,p,g,v,f,m,_,E,y,b;y={paneClass:"pane",sliderClass:"slider",contentClass:"content",iOSNativeScrolling:!1,preventPageScrolling:!1,disableResize:!1,alwaysVisible:!1,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null},f="scrollbar",v="scroll",l="mousedown",d="mousemove",h="mousewheel",u="mouseup",g="resize",a="drag",_="up",p="panedown",n="DOMMouseScroll",s="down",E="wheel",r="keydown",o="keyup",m="touchmove",t="Microsoft Internet Explorer"===window.navigator.appName&&/msie 7./i.test(window.navigator.appVersion)&&window.ActiveXObject,i=null,b=function(){var e,t,i;return e=document.createElement("div"),t=e.style,t.position="absolute",t.width="100px",t.height="100px",t.overflow=v,t.top="-9999px",document.body.appendChild(e),i=e.offsetWidth-e.clientWidth,document.body.removeChild(e),i},c=function(){function r(t,n){this.el=t,this.options=n,i||(i=b()),this.$el=e(this.el),this.doc=e(this.options.documentContext||document),this.win=e(this.options.windowContext||window),this.$content=this.$el.children("."+n.contentClass),this.$content.attr("tabindex",0),this.content=this.$content[0],this.options.iOSNativeScrolling&&null!=this.el.style.WebkitOverflowScrolling?this.nativeScrolling():this.generate(),this.createEvents(),this.addEvents(),this.reset()}return r.prototype.preventScrolling=function(e,t){if(this.isActive)if(e.type===n)(t===s&&e.originalEvent.detail>0||t===_&&e.originalEvent.detail<0)&&e.preventDefault();else if(e.type===h){if(!e.originalEvent||!e.originalEvent.wheelDelta)return;(t===s&&e.originalEvent.wheelDelta<0||t===_&&e.originalEvent.wheelDelta>0)&&e.preventDefault()}},r.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"}),this.iOSNativeScrolling=!0,this.isActive=!0},r.prototype.updateScrollValues=function(){var e;e=this.content,this.maxScrollTop=e.scrollHeight-e.clientHeight,this.contentScrollTop=e.scrollTop,this.iOSNativeScrolling||(this.maxSliderTop=this.paneHeight-this.sliderHeight,this.sliderTop=this.contentScrollTop*this.maxSliderTop/this.maxScrollTop)},r.prototype.createEvents=function(){var e=this;this.events={down:function(t){return e.isBeingDragged=!0,e.offsetY=t.pageY-e.slider.offset().top,e.pane.addClass("active"),e.doc.bind(d,e.events[a]).bind(u,e.events[_]),!1},drag:function(t){return e.sliderY=t.pageY-e.$el.offset().top-e.offsetY,e.scroll(),e.updateScrollValues(),e.contentScrollTop>=e.maxScrollTop?e.$el.trigger("scrollend"):0===e.contentScrollTop&&e.$el.trigger("scrolltop"),!1},up:function(t){return e.isBeingDragged=!1,e.pane.removeClass("active"),e.doc.unbind(d,e.events[a]).unbind(u,e.events[_]),!1},resize:function(t){e.reset()},panedown:function(t){return e.sliderY=(t.offsetY||t.originalEvent.layerY)-.5*e.sliderHeight,e.scroll(),e.events.down(t),!1},scroll:function(t){e.isBeingDragged||(e.updateScrollValues(),e.iOSNativeScrolling||(e.sliderY=e.sliderTop,e.slider.css({top:e.sliderTop})),null!=t&&(e.contentScrollTop>=e.maxScrollTop?(e.options.preventPageScrolling&&e.preventScrolling(t,s),e.$el.trigger("scrollend")):0===e.contentScrollTop&&(e.options.preventPageScrolling&&e.preventScrolling(t,_),e.$el.trigger("scrolltop"))))},wheel:function(t){return null!=t?(e.sliderY+=-t.wheelDeltaY||-t.delta,e.scroll(),!1):void 0}}},r.prototype.addEvents=function(){var e;this.removeEvents(),e=this.events,this.options.disableResize||this.win.bind(g,e[g]),this.iOSNativeScrolling||(this.slider.bind(l,e[s]),this.pane.bind(l,e[p]).bind(""+h+" "+n,e[E])),this.$content.bind(""+v+" "+h+" "+n+" "+m,e[v])},r.prototype.removeEvents=function(){var e;e=this.events,this.win.unbind(g,e[g]),this.iOSNativeScrolling||(this.slider.unbind(),this.pane.unbind()),this.$content.unbind(""+v+" "+h+" "+n+" "+m,e[v])},r.prototype.generate=function(){var e,t,n,s,a;return n=this.options,s=n.paneClass,a=n.sliderClass,e=n.contentClass,this.$el.find(""+s).length||this.$el.find(""+a).length||this.$el.append('<div class="'+s+'"><div class="'+a+'" /></div>'),this.pane=this.$el.children("."+s),this.slider=this.pane.find("."+a),i&&(t="rtl"===this.$el.css("direction")?{left:-i}:{right:-i},this.$el.addClass("has-scrollbar")),null!=t&&this.$content.css(t),this},r.prototype.restore=function(){this.stopped=!1,this.pane.show(),this.addEvents()},r.prototype.reset=function(){var e,n,s,a,r,o,l,d,u;return this.iOSNativeScrolling?void(this.contentHeight=this.content.scrollHeight):(this.$el.find("."+this.options.paneClass).length||this.generate().stop(),this.stopped&&this.restore(),e=this.content,s=e.style,a=s.overflowY,t&&this.$content.css({height:this.$content.height()}),n=e.scrollHeight+i,o=this.pane.outerHeight(),d=parseInt(this.pane.css("top"),10),r=parseInt(this.pane.css("bottom"),10),l=o+d+r,u=Math.round(l/n*l),u<this.options.sliderMinHeight?u=this.options.sliderMinHeight:null!=this.options.sliderMaxHeight&&u>this.options.sliderMaxHeight&&(u=this.options.sliderMaxHeight),a===v&&s.overflowX!==v&&(u+=i),this.maxSliderTop=l-u,this.contentHeight=n,this.paneHeight=o,this.paneOuterHeight=l,this.sliderHeight=u,this.slider.height(u),this.events.scroll(),this.pane.show(),this.isActive=!0,e.scrollHeight===e.clientHeight||this.pane.outerHeight(!0)>=e.scrollHeight&&a!==v?(this.pane.hide(),this.isActive=!1):this.el.clientHeight===e.scrollHeight&&a===v?this.slider.hide():this.slider.show(),this.pane.css({opacity:this.options.alwaysVisible?1:"",visibility:this.options.alwaysVisible?"visible":""}),this)},r.prototype.scroll=function(){return this.isActive?(this.sliderY=Math.max(0,this.sliderY),this.sliderY=Math.min(this.maxSliderTop,this.sliderY),this.$content.scrollTop((this.paneHeight-this.contentHeight+i)*this.sliderY/this.maxSliderTop*-1),this.iOSNativeScrolling||this.slider.css({top:this.sliderY}),this):void 0},r.prototype.scrollBottom=function(e){return this.isActive?(this.reset(),this.$content.scrollTop(this.contentHeight-this.$content.height()-e).trigger(h),this):void 0},r.prototype.scrollTop=function(e){return this.isActive?(this.reset(),this.$content.scrollTop(+e).trigger(h),this):void 0},r.prototype.scrollTo=function(t){return this.isActive?(this.reset(),this.scrollTop(e(t).get(0).offsetTop),this):void 0},r.prototype.stop=function(){return this.stopped=!0,this.removeEvents(),this.pane.hide(),this},r.prototype.flash=function(){var e=this;if(this.isActive)return this.reset(),this.pane.addClass("flashed"),setTimeout(function(){e.pane.removeClass("flashed")},this.options.flashDelay),this},r}(),e.fn.nanoScroller=function(t){return this.each(function(){var i,n;if((n=this.nanoscroller)||(i=e.extend({},y,t),this.nanoscroller=n=new c(this,i)),t&&"object"==typeof t){if(e.extend(n.options,t),t.scrollBottom)return n.scrollBottom(t.scrollBottom);if(t.scrollTop)return n.scrollTop(t.scrollTop);if(t.scrollTo)return n.scrollTo(t.scrollTo);if("bottom"===t.scroll)return n.scrollBottom(0);if("top"===t.scroll)return n.scrollTop(0);if(t.scroll&&t.scroll instanceof e)return n.scrollTo(t.scroll);if(t.stop)return n.stop();if(t.flash)return n.flash()}return n.reset()})}}),define("fly/components/scrollbar-1.0",["jquery","fly/libs/jquery.nano-scroller-0.7.2","version!fly/components/base"],function(e){e.widget("fly.scrollbar",e.fly.base,{options:{containerClass:"content-scroll",height:null},isCreated:!1,_create:function(){var e=this.options;this._setup(),this.$element.addClass(e.containerClass),e.height&&this.$element.css("height",e.height),this.$element.nanoScroller(this.options)},_init:function(){return this.isCreated?void this.$element.nanoScroller():void(this.isCreated=!0)},fire:function(e){this.$element.nanoScroller(e)}})}),define("utils/request-animation-frame",[],function(){"use strict";for(var e=0,t={raf:"requestAnimationFrame",caf:"cancelAnimationFrame",af:"AnimationFrame"},i=["ms","moz","webkit","o"],n=0;n<i.length&&!window[t.raf];++n)window[t.raf]=window[i[n]+"Request"+t.af],window[t.caf]=window[i[n]+"Cancel"+t.af]||window[i[n]+"CancelRequest"+t.af];window[t.raf]||(window[t.raf]=function(t){var i=(new Date).getTime(),n=Math.max(0,16-(i-e)),s=window.setTimeout(function(){t(i+n)},n);return e=i+n,s}),window[t.caf]||(window[t.caf]=function(e){window.clearTimeout(e)});var s=window[t.caf],a=window[t.raf];return{cancelAnimationFrame:function(e){return s(e)},requestAnimationFrame:function(e){return a(e)}}}),define("managers/sticky-ads",["jquery","managers/ad","managers/tealium","utils/request-animation-frame","version!fly/managers/debug"],function(e,t,i,n,s){function a(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}function r(){var t,i,s=(window.pageYOffset||document.scrollTop)-(document.clientTop||0);if(u!=s){u=s,v=a();for(t in p)i=p[t],e(i.adUnits).each(o).filter(l(i.options)).each(d(i))}n.requestAnimationFrame(r)}function o(){this.__rect=this.getBoundingClientRect()}function l(e){var n=e.loadAdDistance*v,s=e.adData;return function(){var e=this,a=e.getAttribute("data-ad-loaded"),r=e.__height||e.__rect.height;return e.__rect.top<=n&&"0"===a&&(s.gpt.adConfig.method="async",s.gpt.containerId=e.getAttribute("data-ad-container-id"),h.log("Load ",s.gpt.containerId),t.init({ad:s,viewGuid:i.getViewGuid()}),t.loadAds(),e.setAttribute("data-ad-loaded",1)),r>10}}function d(t){var i=t.adUnits,n=i.length>1?i[i.length-1]:0,s=t.options.fixedClassName;return s?function(){var t=this,i=t.__rect.top,a=n?n.__rect.height:0,r=Math.max(a-i,0),o=0>=i;t.__height||(t.__height=t.clientHeight),e(t).toggleClass(s,o),o?e(n).removeClass(s):e(n).children().css("top","-"+r+"px"),n=t}:e.noop}var u,h=s.init("stickyAds"),c={loadAdDistance:1.5,fixedClassName:null,instanceClassName:null,adData:{}},p={},g=!1,v=a();return{registerAdUnits:function(t){var i,t=e.extend(c,t),s=t.instanceClassName;return s?(i=document.getElementsByClassName(s),p[s]={adUnits:i,options:t},g||(n.requestAnimationFrame(r),g=!0),h.log("options",t),h.log("screenHeight",v),h.log("registry",p),h.log("adUnits",i),void h.log("scrollListenerRegistered",g)):void console.error("No instanceClassName defined",t)}}}),define("components/comments",["jquery","managers/sticky-ads","version!fly/managers/ad","managers/tealium","utils/request-animation-frame","version!fly/managers/debug","version!fly/components/base","tealium"],function(e,t,i,n,s,a){var r=a.init("comments");r.log("starting widget");var o=window.om;e.widget("cbsnews.comments",e.fly.base,{options:{deviceType:null,contentType:null},adData:null,$body:null,bodyClass:"livefyre-hide-article livefyre-show-comments",deviceName:null,state:"article",adUnits:null,domUpdated:!1,requestId:null,toggleClass:".toggle-comments",$toggleElem:null,toggleElemYOffset:null,fixedToggle:!1,contentEl:null,rPermalink:/lf-content=/,_create:function(){r.log("_create"),this._setup(),this._super("_create"),this.$body=e(document.body),this.adData=CBSNEWS.ad;var i=this.options.contentType.replace("content_","").replace("_","-");switch(this.contentEl=document.getElementById(i),r.log("contentId: ",i),this.options.deviceType){case"mobile":this.adUnits=["mobile_mpu_bottom","mobile-banner-top"];break;case"desktop":t.registerAdUnits({fixedClassName:"ad-rr-sticky",instanceClassName:"ad-mpu-bottom",adData:this.adData}),this.adUnits=["mpu-bottom","leader-bottom"];break;default:r.log("wrong deviceType",this.options.deviceType)}this.$body.on("click",this.toggleClass,e.proxy(this._toggleComments,this)),this.$element.html(this._injectHTML).on("click",".fyre-stream-more",e.proxy(this._onLoadMoreComments,this)),this.$toggleElem=e("#comments").find(this.toggleClass),this.rPermalink.test(window.location)&&this._toggleComments()},_injectHTML:function(e,t){return r.log("_injectHTML",t),t.replace(/^\s*?<!--|-->\s*$/g,"")},_onLoadMoreComments:function(){r.log("_onLoadMoreComments"),this._refreshAds(),o.trackCommentShowmoreView()},_refreshAds:function(){r.log("_refreshAds");var e=i.getAdObj();r.log("adObj:",e),e&&(e.setTargeting("vguid",n.getViewGuid()),e.refresh(this.adData.gpt.containerId,this.adUnits))},_toggleBodyClass:function(){r.log("toggle state to "+(this.$body.hasClass(this.bodyClass)?"article":"comments")),this.$body.toggleClass(this.bodyClass)},_toggleComments:function(e){r.log("_toggleComments"),e&&e.preventDefault(),this._triggerDomUpdated(),this._toggleBodyClass(),this.contentEl.scrollIntoView(!0),"desktop"==this.options.deviceType&&this._stickyShowStory({block:"start",behavior:"smooth"}),this.$body.hasClass(this.bodyClass)?o.trackShowStoryView():o.trackCommentView()},_triggerDomUpdated:function(){r.log("_triggerDomUpdated"),this.domUpdated||(this._triggerGlobal("domUpdated",{$context:this.$element}),this.domUpdated=!0)},_stickyShowStory:function(){this.$body.hasClass(this.bodyClass)?(this.toggleElemYOffset=this.$toggleElem.offset().top,this.requestId=s.requestAnimationFrame(this._toggleStickyButton.bind(this))):(s.cancelAnimationFrame(this.requestId),this.$toggleElem.removeClass("sticky"))},_toggleStickyButton:function(){var e=(window.pageYOffset||document.scrollTop)-(document.clientTop||0);this.pageYOffset!=e&&(this.pageYOffset=e,this.$toggleElem.toggleClass("sticky",e>this.toggleElemYOffset)),this.requestId=s.requestAnimationFrame(this._toggleStickyButton.bind(this))}})});var swfobject=function(){function e(){if(!H){try{var e=U.getElementsByTagName("body")[0].appendChild(f("span"));e.parentNode.removeChild(e)}catch(t){return}H=!0;for(var i=j.length,n=0;i>n;n++)j[n]()}}function t(e){H?e():j[j.length]=e}function i(e){if(typeof N.addEventListener!=T)N.addEventListener("load",e,!1);else if(typeof U.addEventListener!=T)U.addEventListener("load",e,!1);else if(typeof N.attachEvent!=T)m(N,"onload",e);else if("function"==typeof N.onload){var t=N.onload;N.onload=function(){t(),e()}}else N.onload=e}function n(){V?s():a()}function s(){var e=U.getElementsByTagName("body")[0],t=f(P);t.setAttribute("type",w);var i=e.appendChild(t);if(i){var n=0;!function(){if(typeof i.GetVariable!=T){var s=i.GetVariable("$version");s&&(s=s.split(" ")[1].split(","),z.pv=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)])}else if(10>n)return n++,void setTimeout(arguments.callee,10);e.removeChild(t),i=null,a()}()}else a()}function a(){var e=G.length;if(e>0)for(var t=0;e>t;t++){var i=G[t].id,n=G[t].callbackFn,s={success:!1,id:i};if(z.pv[0]>0){var a=v(i);if(a)if(!_(G[t].swfVersion)||z.wk&&z.wk<312)if(G[t].expressInstall&&o()){var u={};u.data=G[t].expressInstall,u.width=a.getAttribute("width")||"0",u.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(u.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(u.align=a.getAttribute("align"));for(var h={},c=a.getElementsByTagName("param"),p=c.length,g=0;p>g;g++)"movie"!=c[g].getAttribute("name").toLowerCase()&&(h[c[g].getAttribute("name")]=c[g].getAttribute("value"));l(u,h,i,n)}else d(a),n&&n(s);else y(i,!0),n&&(s.success=!0,s.ref=r(i),n(s))}else if(y(i,!0),n){var f=r(i);f&&typeof f.SetVariable!=T&&(s.success=!0,s.ref=f),n(s)}}}function r(e){var t=null,i=v(e);if(i&&"OBJECT"==i.nodeName)if(typeof i.SetVariable!=T)t=i;else{var n=i.getElementsByTagName(P)[0];n&&(t=n)}return t}function o(){return!W&&_("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function l(e,t,i,n){W=!0,I=n||null,D={success:!1,id:i};var s=v(i);if(s){"OBJECT"==s.nodeName?(A=u(s),S=null):(A=s,S=i),e.id=O,(typeof e.width==T||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==T||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),U.title=U.title.slice(0,47)+" - Flash Player Installation";var a=z.ie&&z.win?"ActiveX":"PlugIn",r="MMredirectURL="+N.location.toString().replace(/&/g,"%26")+"&MMplayerType="+a+"&MMdoctitle="+U.title;if(typeof t.flashvars!=T?t.flashvars+="&"+r:t.flashvars=r,z.ie&&z.win&&4!=s.readyState){var o=f("div");i+="SWFObjectNew",o.setAttribute("id",i),s.parentNode.insertBefore(o,s),s.style.display="none",function(){4==s.readyState?s.parentNode.removeChild(s):setTimeout(arguments.callee,10)}()}h(e,t,i)}}function d(e){if(z.ie&&z.win&&4!=e.readyState){var t=f("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var t=f("div");if(z.win&&z.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(P)[0];if(i){var n=i.childNodes;if(n)for(var s=n.length,a=0;s>a;a++)1==n[a].nodeType&&"PARAM"==n[a].nodeName||8==n[a].nodeType||t.appendChild(n[a].cloneNode(!0))}}return t}function h(e,t,i){var n,s=v(i);if(z.wk&&z.wk<312)return n;if(s)if(typeof e.id==T&&(e.id=i),z.ie&&z.win){var a="";for(var r in e)e[r]!=Object.prototype[r]&&("data"==r.toLowerCase()?t.movie=e[r]:"styleclass"==r.toLowerCase()?a+=' class="'+e[r]+'"':"classid"!=r.toLowerCase()&&(a+=" "+r+'="'+e[r]+'"'));var o="";for(var l in t)t[l]!=Object.prototype[l]&&(o+='<param name="'+l+'" value="'+t[l]+'" />');s.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+o+"</object>",x[x.length]=e.id,n=v(e.id)}else{var d=f(P);d.setAttribute("type",w);for(var u in e)e[u]!=Object.prototype[u]&&("styleclass"==u.toLowerCase()?d.setAttribute("class",e[u]):"classid"!=u.toLowerCase()&&d.setAttribute(u,e[u]));for(var h in t)t[h]!=Object.prototype[h]&&"movie"!=h.toLowerCase()&&c(d,h,t[h]);s.parentNode.replaceChild(d,s),n=d}return n}function c(e,t,i){var n=f("param");n.setAttribute("name",t),n.setAttribute("value",i),e.appendChild(n)}function p(e){var t=v(e);t&&"OBJECT"==t.nodeName&&(z.ie&&z.win?(t.style.display="none",function(){4==t.readyState?g(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function g(e){var t=v(e);if(t){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}}function v(e){var t=null;try{t=U.getElementById(e)}catch(i){}return t}function f(e){return U.createElement(e)}function m(e,t,i){e.attachEvent(t,i),F[F.length]=[e,t,i]}function _(e){var t=z.pv,i=e.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]?!0:!1}function E(e,t,i,n){if(!z.ie||!z.mac){var s=U.getElementsByTagName("head")[0];if(s){var a=i&&"string"==typeof i?i:"screen";if(n&&(C=null,R=null),!C||R!=a){var r=f("style");r.setAttribute("type","text/css"),r.setAttribute("media",a),C=s.appendChild(r),z.ie&&z.win&&typeof U.styleSheets!=T&&U.styleSheets.length>0&&(C=U.styleSheets[U.styleSheets.length-1]),R=a}z.ie&&z.win?C&&typeof C.addRule==P&&C.addRule(e,t):C&&typeof U.createTextNode!=T&&C.appendChild(U.createTextNode(e+" {"+t+"}"))}}}function y(e,t){if(q){var i=t?"visible":"hidden";H&&v(e)?v(e).style.visibility=i:E("#"+e,"visibility:"+i)}}function b(e){var t=/[\\\"<>\.;]/,i=null!=t.exec(e);return i&&typeof encodeURIComponent!=T?encodeURIComponent(e):e}var A,S,I,D,C,R,T="undefined",P="object",M="Shockwave Flash",L="ShockwaveFlash.ShockwaveFlash",w="application/x-shockwave-flash",O="SWFObjectExprInst",k="onreadystatechange",N=window,U=document,B=navigator,V=!1,j=[n],G=[],x=[],F=[],H=!1,W=!1,q=!0,z=function(){var e=typeof U.getElementById!=T&&typeof U.getElementsByTagName!=T&&typeof U.createElement!=T,t=B.userAgent.toLowerCase(),i=B.platform.toLowerCase(),n=i?/win/.test(i):/win/.test(t),s=i?/mac/.test(i):/mac/.test(t),a=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,r=!1,o=[0,0,0],l=null;if(typeof B.plugins!=T&&typeof B.plugins[M]==P)l=B.plugins[M].description,!l||typeof B.mimeTypes!=T&&B.mimeTypes[w]&&!B.mimeTypes[w].enabledPlugin||(V=!0,r=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),o[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),o[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof N.ActiveXObject!=T)try{var d=new ActiveXObject(L);d&&(l=d.GetVariable("$version"),l&&(r=!0,l=l.split(" ")[1].split(","),o=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]))}catch(u){}return{w3:e,pv:o,wk:a,ie:r,win:n,mac:s}}();(function(){z.w3&&((typeof U.readyState!=T&&"complete"==U.readyState||typeof U.readyState==T&&(U.getElementsByTagName("body")[0]||U.body))&&e(),H||(typeof U.addEventListener!=T&&U.addEventListener("DOMContentLoaded",e,!1),z.ie&&z.win&&(U.attachEvent(k,function(){"complete"==U.readyState&&(U.detachEvent(k,arguments.callee),e())}),N==top&&!function(){if(!H){try{U.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),z.wk&&!function(){return H?void 0:/loaded|complete/.test(U.readyState)?void e():void setTimeout(arguments.callee,0)}(),i(e)))})(),function(){z.ie&&z.win&&window.attachEvent("onunload",function(){for(var e=F.length,t=0;e>t;t++)F[t][0].detachEvent(F[t][1],F[t][2]);for(var i=x.length,n=0;i>n;n++)p(x[n]);for(var s in z)z[s]=null;z=null;for(var a in swfobject)swfobject[a]=null;swfobject=null})}();return{registerObject:function(e,t,i,n){if(z.w3&&e&&t){var s={};s.id=e,s.swfVersion=t,s.expressInstall=i,s.callbackFn=n,G[G.length]=s,y(e,!1)}else n&&n({success:!1,id:e})},getObjectById:function(e){return z.w3?r(e):void 0},embedSWF:function(e,i,n,s,a,r,d,u,c,p){var g={success:!1,id:i};z.w3&&!(z.wk&&z.wk<312)&&e&&i&&n&&s&&a?(y(i,!1),t(function(){n+="",s+="";var t={};if(c&&typeof c===P)for(var v in c)t[v]=c[v];t.data=e,t.width=n,t.height=s;var f={};if(u&&typeof u===P)for(var m in u)f[m]=u[m];if(d&&typeof d===P)for(var E in d)typeof f.flashvars!=T?f.flashvars+="&"+E+"="+d[E]:f.flashvars=E+"="+d[E];if(_(a)){var b=h(t,f,i);t.id==i&&y(i,!0),g.success=!0,g.ref=b}else{if(r&&o())return t.data=r,void l(t,f,i,p);y(i,!0)}p&&p(g)})):p&&p(g)},switchOffAutoHideShow:function(){q=!1},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:_,createSWF:function(e,t,i){return z.w3?h(e,t,i):void 0},showExpressInstall:function(e,t,i,n){z.w3&&o()&&l(e,t,i,n)},removeSWF:function(e){z.w3&&p(e)},createCSS:function(e,t,i,n){z.w3&&E(e,t,i,n)},addDomLoadEvent:t,addLoadEvent:i,getQueryParamValue:function(e){var t=U.location.search||U.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return b(t);for(var i=t.split("&"),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf("="))==e)return b(i[n].substring(i[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(W){var e=v(O);e&&A&&(e.parentNode.replaceChild(A,e),S&&(y(S,!0),z.ie&&z.win&&(A.style.display="block")),I&&I(D)),W=!1}}}}();define("libs/swfobject",function(){}),define("components/video/video-desktop",["jquery","version!fly/managers/debug","version!fly/utils/url-helper","libs/swfobject","managers/tealium","version!fly/libs/jquery.cookie","version!fly/components/base"],function(e,t,i){var n=t.get("video"),s=CBSNEWS.ad||{};n.log("video-desktop:","adData = ",s);e(window);e.widget("fly.videoDesktop",e.fly.base,{options:{pid:"H387n3FRoTqD",url:"http://www.cbsnews.com/videos/",playerWidth:"100%",playerHeight:"100%",si:"162",suppress:!1,autoplay:!0,articleAuto:!1,articleAutoState:!0,pageType:null,pagePlaylist:!1,elementRef:null,live:!1,lengthSecs:60,cid:999999,hed:null,subscriptionPreView:null,viewable:!0,subscriber:!1,is60minfranchise:null,is60Extra:null,is6048Preview:null,UrlmpxRefId:null,loadingMethod:"PID",topicname:null,psite:"http://www.cbsnews.com",uuid:null,noDVR:!1,flv:null,smode:"fit",releaseURL:"http://www.cbsnews.com/common/video/cbsnews_video.swf"},playerElement:null,$player:null,cbsiPlayer:null,jsReady:!1,devURL:"http://www.cbsnews.com/common/video/cbsnews_video.swf",playerRefId:"cbsNewsVideoPlayerSwf",elementRefId:"cbsNewsVideoPlayer",flashVars:{},_create:function(t){window.cbsiPlayer=e.proxy(this.cbsiPlayer,this),window.onCBSIPlayerReady=e.proxy(this.onCBSIPlayerReady,this),window.isJSReady=e.proxy(this.isJSReady,this),window.onCBSI_PlayerLoaded=e.proxy(this.onCBSI_PlayerLoaded,this),window.getVideoAdSessionValues=e.proxy(this.getVideoAdSessionValues,this),window.onAdResourcesInfo=e.proxy(this.onAdResourcesInfo,this),window.sixtyAALearnDesktop=e.proxy(this.sixtyAALearnDesktop,this),window.setAutoPlayValue=e.proxy(this.setAutoPlayValue,this),window.onCBSI_ContentStart=e.proxy(this.onCBSI_ContentStart,this),window.onCBSI_AdStart=e.proxy(this.onCBSI_AdStart,this),window.userPlay=e.proxy(this.userPlay,this),this.elementRefId=null==this.options.elementRef?this.elementRefId:this.options.elementRef,this._setupPlayer()},_setupPlayer:function(){this.setJSReady(),this.options.lengthSecs=this.options.duration,this.options.loggedInUser="authenticated"===utag_data.userState,this.options.pid.match(/999999/gi)&&(this.options.loadingMethod="URL",this.options.cid=this.options.pid),this.isLiveVideoCheck(this.options.pid)&&(this.options.live="true"),this.isLiveNoDVRCheck(this.options.pid)&&(this.options.noDVR="true"),"Article"==this.options.pageType&&(this.options.articleAuto=!0,null==e.cookie("cbsArticleAuto")&&e.cookie("cbsArticleAuto",!0,{expires:30,path:"/"}),"true"==e.cookie("cbsArticleAuto")||null==e.cookie("cbsArticleAuto")?(this.options.articleAuto=!0,this.options.articleAutoState=!0):(this.options.articleAuto=!0,this.options.articleAutoState=!1,this.options.autoplay=!1)),"true"==this.options.subscriptionPreView.active||1==this.options.subscriptionPreView.active?this.showHTMLPreview():this.playVideo()},setJSReady:function(){this.jsReady=!0},isJSReady:function(){return this.jsReady},sixtyAALearnDesktop:function(){om.trackCampaignDriver({intcid:"CNI11b6b0f",campaignType:"all-access",campaignChannel:"video player",campaignText:"learn more"})},getVideoAdSessionValues:function(t){var a="",r=JSON.parse(e.cookie(s.cookieName)),o=r&&r.session;
if(o&&(a="session="+o),(1==this.options.suppress||1==this.options.subscriber&&1==this.options.is60minfranchise||"true"==this.options.subscriber&&"true"==this.options.is60minfranchise)&&(a+="&feat=killad"),s.useFirstPageTargeting){var l=null==e.cookie("first_page_today")||void 0!==window.firstpgvar&&1==window.firstpgvar?"1":"0";a+="&firstpg="+l}return null!=this.options.pageType&&(a+="&ptype="+this.options.pageType),e.each(i.getAllParams(),function(e,t){var i=e.match(/adTargeting_(.+)/);i&&i[1]&&(a+="&"+i[1]+"="+t)}),n.log("video-desktop:","setting video ad session values:",a),a},isLiveVideoCheck:function(t){var i=["EZCOmvznjVN_","puG_yGuOdrCu","TiGLGtxzSPKe","D6fmVetXK8_K","4jQtQV2BUWPw","3eplG8pAXhsH","F8VkKnk_tgC8","9nnsnOy8iPUa"];return-1==e.inArray(t,i)?!1:!0},isLiveNoDVRCheck:function(t){var i=["3eplG8pAXhsH","9nnsnOy8iPUa"];return-1==e.inArray(t,i)?!1:!0},playVideo:function(e){playerStarted=!0,this.displaySWFObject()},getSWFurl:function(){return this.options.releaseURL},displaySWFObject:function(){this.getFlashVars();var t={scale:"noscale",salign:"lt",wmode:"direct",allowFullScreen:"true",allowScriptAccess:"always",quality:"high",bgcolor:"#000000",swliveconnect:"true"},i={salign:"lt",scale:"noscale",wmode:"direct",allowFullScreen:"true",allowScriptAccess:"always",quality:"high",bgcolor:"#000000",swliveconnect:"true"};({id:this.playerRefId});navigator.userAgent.match(/Firefox/i)?swfobject.embedSWF(this.getSWFurl(),this.elementRefId,this.options.playerWidth,this.options.playerHeight,"9.0.0","",this.flashVars,i):swfobject.embedSWF(this.getSWFurl(),this.elementRefId,this.options.playerWidth,this.options.playerHeight,"9.0.0","",this.flashVars,t),this.cbsiPlayer=this.playerElement=document.getElementById(this.elementRefId),this.$player=e(this.playerElement)},getFlashVars:function(e){this.flashVars=this.options,"true"==this.options.is60minfranchise||1==this.options.is60minfranchise?"true"==this.options.viewable||1==this.options.viewable?this.flashVars.nonmember=!1:"true"==this.options.is6048Preview||1==this.options.is6048Preview?this.flashVars.nonmember=!1:"false"==this.options.subscriber||0==this.options.subscriber?this.flashVars.nonmember=!0:this.flashVars.nonmember=!1:this.flashVars.nonmember=!1},thisMovie:function(e){return e=e||this.playerRefId,(Browser.Engine.trident?window:document)[e]},showHTMLPreview:function(){e("<div/>",{"class":"subscribe-preview",id:"subscribe-previewId"}).append(e("<img/>",{id:"subscribe-preview-imgId","class":"subscribe-preview-img",src:this.options.thumbnail})).append(e("<div/>",{id:"subscribe-preview-iconId","class":"subscribe-preview-icon"})).appendTo(e("#"+this.elementRefId));var t=this;e("#subscribe-previewId").on("click",function(e){t.playVideo()}),"60AALarge"==this.options.subscriptionPreView.view&&e("#subscribe-previewId").append(e("<div/>",{"class":"subscribe-preview-text",id:"subscribe-preview-textId",text:"Take The Tour"}))},userPlay:function(){cbsnewsPlayerPlay()},playItem:function(e){},onCBSIPlayerReady:function(e){this.cbsiPlayer.addEventJSCallback("onPlayerLoaded_cbsi","onCBSI_PlayerLoaded"),this.cbsiPlayer.addEventJSCallback("onAdResourcesInfo","onAdResourcesInfo"),this.cbsiPlayer.addEventJSCallback("onAdStart_cbsi","onCBSI_AdStart"),this.cbsiPlayer.addEventJSCallback("onContentEnd_cbsi","onContentEnd_cbsi"),this.cbsiPlayer.addEventJSCallback("onStateChange_cbsi","onStateChange_cbsi"),this.cbsiPlayer.addEventJSCallback("onContentStart_cbsi","onCBSI_ContentStart"),this.cbsiPlayer.addEventJSCallback("onPlayListEnd_cbsi","onPlayListEnd_cbsi"),this.cbsiPlayer.addEventJSCallback("userPlay","userPlay")},onContentEnd_cbsi:function(){},setAutoPlayValue:function(t){e.cookie("cbsArticleAuto",t,{expires:30,path:"/"})},onAdResourcesInfo:function(){},getContainerId:function(e,t){return adObject.camelcaseToHyphen(e)+(t?"-"+t:"")},camelcaseToHyphen:function(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})},onCBSI_PlayerLoaded:function(e){console.info("onCBSI_PlayerLoaded"),this._trigger("onPlayerLoaded_cbsi")},onCBSI_ContentStart:function(){n.log("onContentStart_cbsi"),this._trigger("onContentStart_cbsi")},onCBSI_AdStart:function(e){n.log("onAdStart_cbsi"),this._trigger("onAdStart_cbsi")}})}),define("components/video/video-Hi5",["jquery","managers/tealium","version!fly/components/base","version!fly/managers/debug"],function(e,t){var i=e(window);e.widget("fly.videoHi5",e.fly.base,{options:{pid:null,hed:null,device:null,pageType:null,thumbnail:null,width:null,subscriber:null,is60minfranchise:null,is60Extra:null,is6048Preview:null,uuid:null,viewable:!0,height:null,element:null,uri:null},playerElement:null,$player:null,cbsiPlayer:null,preview_cntrls:null,controls:null,partner:"cbsnews_mobile",adPlaying:!1,contentPlaying:!1,adControls:null,isFullScreen:!1,jsReady:!1,captionShowing:!1,imaAdDivID:"uvp_ad_container",novemberAlpha:!1,videoRegistration:{foxtrot:null,product:null,status:null,parentTopicName:null,topicName:null,is60Extra:null,is6048Preview:null},uvp_sOpts_tmp:{partner:"cbsnews",nativeControls:!1,autoHide:!1,previewImg:null,videoTitle:"",showPreviewOnVideoEnd:!0,logo:"",logoClickUrl:"http://www.cbsnews.com",uvpc:"",logWindow:!1,includeFullScreenButton:!0,useNativeFullScreen:!1,dwTags:"player:cbsNewsMobile",netwk:"can",mapp:"UVP_Hi5;2.4.1",cms:"platform",uvpHandlesAdClicks:!0,landscape16x9_normal:["620px","413px","0px","0px"],landscape4x3_normal:["320px","240px","0px","56px"],portrait16x9_normal:["620px","350px","0px","0px"],portrait4x3_normal:["240px","160px","0px","0px"],landscape16x9_customFS:["960px","540px","0px","0px"],landscape4x3_customFS:["848px","636px","0px","56px"],portrait16x9_customFS:["960px","540px","0px","0px"],portrait4x3_customFS:["640px","480px","0px","0px"],initialAspect:"16x9",watermark:!1},_create:function(t){this._setup(),this.uvp_sOpts_tmp.dwTags="player:"+this.options.device,"VideoEmbed"==this.options.pageType?(this.uvp_sOpts_tmp.landscape16x9_normal=[this.options.width+"%",this.options.height+"%","0px","0px"],this.uvp_sOpts_tmp.portrait16x9_normal=[this.options.width+"%",this.options.height+"%","0px","0px"],"fbia app"==utag_data.siteType&&(DW.pageParams.omnicookie=utag_data.siteType+"||| "+utag_data.deviceType)):(this.uvp_sOpts_tmp.landscape16x9_normal=[this.options.width+"px",this.options.height+"px","0px","0px"],this.uvp_sOpts_tmp.portrait16x9_normal=[this.options.width+"px",this.options.height+"px","0px","0px"]),"tablet"==this.options.device?this.uvp_sOpts_tmp.uvpc="/common/video/uvp_cbsnews_hl_tablet.xml":"mobile"==this.options.device?(this.uvp_sOpts_tmp.uvpc="/common/video/uvp_cbsnews_hl_mobile.xml","VideoEmbed"==this.options.pageType?(this.uvp_sOpts_tmp.landscape16x9_normal=[this.options.width+"%",this.options.height+"%","0px","0px"],this.uvp_sOpts_tmp.portrait16x9_normal=[this.options.width+"%",this.options.height+"%","0px","0px"],"fbia app"==utag_data.siteType&&(DW.pageParams.omnicookie=utag_data.siteType+"||| "+utag_data.deviceType)):(this.uvp_sOpts_tmp.landscape16x9_normal=[this.options.width+"px",this.options.height+"px","0px","0px"],this.uvp_sOpts_tmp.portrait16x9_normal=[this.options.width-140+"px",this.options.height-79+"px","0px","0px"])):this.uvp_sOpts_tmp.uvpc="http://www.cbsnews.com/common/video/uvp_cbsnews_hl_mobile.xml",this.initialStart(),window.cbsiPlayer=e.proxy(this.cbsiPlayer,this),window.preview_cntrls=e.proxy(this.preview_cntrls,this),window.controls=e.proxy(this.controls,this),window.adControls=e.proxy(this.adControls,this),window.isFullScreen=e.proxy(this.isFullScreen,this),window.jsReady=e.proxy(this.jsReady,this),window.videoPlayback=e.proxy(this.videoPlayback,this),window.setVideoUUID=e.proxy(this.updateVideoUUID,this),window.onCBSIPlayerReady=e.proxy(this.onCBSIPlayerReady,this),window.isJSReady=e.proxy(this.isJSReady,this),window.onCBSI_PlayerLoaded=e.proxy(this.onCBSI_PlayerLoaded,this),window.onCBSI_ContentStart=e.proxy(this.onCBSI_ContentStart,this),window.onCBSI_ContentEnd=e.proxy(this.onCBSI_ContentEnd,this),window.onCBSI_AdStart=e.proxy(this.onCBSI_AdStart,this),window.onCBSI_AdEnd=e.proxy(this.onCBSI_AdEnd,this),window.onCBSI_AdResourcesInfo=e.proxy(this.onCBSI_AdResourcesInfo,this),window.onCBSI_AdSlotStart=e.proxy(this.onCBSI_AdSlotStart,this),window.onCBSI_PlayerDataLoaded=e.proxy(this.onCBSI_PlayerDataLoaded,this),window.onCBSI_PlayListEnd=e.proxy(this.onCBSI_PlayListEnd,this),window.loadFirstVideo=e.proxy(this.loadFirstVideo,this),window.setFullscreenState=e.proxy(this.setFullscreenState,this),window.onCBSI_CaptionsError=e.proxy(this.onCBSI_CaptionsError,this)},setJSReady:function(){this.jsReady=!0},isJSReady:function(){return this.jsReady},loadCbsiJSPlayer:function(){e("head").append('<script type="text/javascript" async="true" src="http://vidtech.cbsinteractive.com/h5/2_4_1/CBSI_PLAYER.js"></script>'),e("head").append('<script type="text/javascript" async="true" src="http://s0.2mdn.net/instream/html5/ima3.js"></script>'),e("head").append('<script type="text/javascript" async="true" src="http://vidtech.cbsinteractive.com/skins/js_simple/2_1_2/preview.js"></script>'),e("head").append('<script type="text/javascript" async="true" src="http://vidtech.cbsinteractive.com/skins/js_simple/2_1_2/adcontrols.js"></script>'),e("head").append('<script type="text/javascript" async="true" src="http://vidtech.cbsinteractive.com/skins/js_simple/2_1_2/controls.js"></script>'),this.playerElement=document.getElementById(this.options.element),this.$player=e(this.playerElement);var t="tablet"==this.options.device?"video-player-hi5":"video-player-hi5-mobile";if(this.$player.empty().addClass(t).css({"z-index":"10",width:this.options.width+"px",height:this.options.height+"px"}),e("<div/>",{id:"mycbsiplayer"}).appendTo(this.$player),e("<div/>",{id:"uvp_ad_container"}).appendTo(this.$player),"mobile"==this.options.device){var n=460,s=259,a=i.width(),r=s/n*a;a>640?this.$player.css({width:640,height:360}):this.$player.css({"min-height":r,width:"100%",height:"auto"})}},setFullScreenStateFromControls:function(e){null!=e&&(this.isFullScreen=e)},getFullscreenState:function(){return null!=this.isFullScreen?this.isFullScreen:!1},onCBSIPlayerReady:function(e){if(null!=e){this.cbsiPlayer=e;var t="mycbsiplayer",i=this.imaAdDivID;document.getElementById("videoplayer");this.addUvpEventCallbacks(),this.preview_cntrls=new UVP_Preview(this.options.element,t,i),this.adControls=new UVP_AdControls(e,this.options.element,t,i),this.controls=new UVP_Controls(e,this.options.element,t,i),this.cbsiPlayer.initialize(t,this.options.element,this.imaAdDivID,"learnMoreAdClickThruID"),this.attachSecondaryControls(),this.listenPreviewClicks(),this.listenClosedCaptionClicks(),this.listenPause()}},attachSecondaryControls:function(){e("<div/>",{id:"closedcap","class":"cc"}).appendTo("#videoplayer .controls"),e("<div/>",{id:"caption_hotspot"}).appendTo("#videoplayer .controls")},listenClosedCaptionClicks:function(){e("#caption_hotspot").on("click touchstart",function(e){this.cbsiPlayer.setYOffset(30),this.captionShowing=!this.captionShowing,1==this.captionShowing?this.cbsiPlayer.showCaptions():this.cbsiPlayer.hideCaptions()})},onCBSI_PlayerDataLoaded:function(e){null!=this.controls&&this.controls.onPlayerDataLoaded(),null!=this.adControls&&this.adControls.onPlayerDataLoaded()},onCBSI_ContentStart:function(e){if(this.adPlaying=!1,this.contentPlaying=!0,null!=this.controls){this.controls.contentStart();this.cbsiPlayer.getContentData();this.cbsiPlayer.hideCaptions()}null!=this.adControls&&this.adControls.contentStart(),null!=this.preview_cntrls&&this.preview_cntrls.removePreviewUI(),this._trigger("onContentStart_cbsi")},onCBSI_ContentEnd:function(e){this.novemberAlpha=!1,this.contentPlaying=!1,null!=uvp_sOpts&&uvp_sOpts.showPreviewOnVideoEnd&&null!=this.preview_cntrls&&this.preview_cntrls.onPlaylistEndEvent(),null!=this.controls&&this.controls.onPlaylistEnd(),null!=this.adControls&&this.adControls.onPlaylistEnd()},onCBSI_AdStart:function(e){var t=new Object;t.id=this.cbsiPlayer.getVideoAdClipId(),t.clickThru=this.cbsiPlayer.getVideoAdClickThru(),this.adPlaying=!0,null!=this.controls&&this.controls.adStart(t.id),null!=this.adControls&&this.adControls.adStart(t),null!=this.preview_cntrls&&this.preview_cntrls.removePreviewUI(),this._trigger("onAdStart_cbsi")},onCBSI_AdEnd:function(e){this.adPlaying=!1,null!=this.controls&&this.controls.adEnd(),null!=this.adControls&&this.adControls.adEnd()},onCBSI_PlayListEnd:function(e){this.novemberAlpha=!1,null!=uvp_sOpts&&uvp_sOpts.showPreviewOnVideoEnd&&null!=this.preview_cntrls&&this.preview_cntrls.onPlaylistEndEvent(),null!=this.controls&&this.controls.onPlaylistEnd(),null!=this.adControls&&this.adControls.onPlaylistEnd()},onCBSI_NoAdContent:function(e){},restorePreview:function(){document.getElementsByTagName("video")[0];null!=this.preview_cntrls&&this.preview_cntrls.onPlaylistEndEvent()},onCBSI_AdResourcesInfo:function(e){},onCBSI_AdSlotStart:function(e){if(1!=arguments.length&&2==arguments.length){var t=arguments[0];null!=this.adControls&&this.adControls.onAdSlotStart(t)}},listenPause:function(){e("#play_pause_hotspot").on("click touchstart",function(e){this._trigger("playerPause_cbsi")})},remove60MinBlock:function(){e("#errorVideoId").length&&e("#errorVideoId").css("display","none")},show60MinBlock:function(t){if(e("#errorVideoId").length)e("#errorVideoId").css("display","block"),e("#previewcontrols").css("display","none");else{if("app"==t)var i="To view this video download the free 60 Minutes App",n="Download the App",s="";else var i="To view this video you must be subscribed to 60 Minutes All Access",n="Learn More",s=" subscribeMsg";e("<div/>",{"class":"video-error",id:"errorVideoId"}).append(e("<div/>",{id:"video-error-IconId","class":"video-error-icon"})).append(e("<div/>",{id:"video-error-textId","class":"video-error-text"+s,text:i})).append(e("<div/>",{id:"video-error-buttonId","class":"video-error-button"+s,text:n})).appendTo(this.$player),this.preview_cntrls.addPreviewUI(),e("#previewcontrols").css("display","none")}this.appBtnClick(t),(this.adPlaying||this.contentPlaying)&&this.cbsiPlayer.pauseVideo()},updateVideoUUID:function(e){this.options.uuid=e},pullSubscribeReg:function(t,i){self=this,e.ajax({type:"GET",url:"/video-registration/"+this.options.uuid,dataType:"json",cache:!1,timeout:6e4,error:this.pullError,success:function(e){if(self.videoRegistration.foxtrot=e.registration.video.foxtrot,self.videoRegistration.product=e.registration.product,self.videoRegistration.status=e.registration.user.status,self.videoRegistration.parentTopicName=e.registration.video.parentTopic.name,self.videoRegistration.topicName=e.registration.video.topic.name,self.videoRegistration.is60Extra=e.registration.video.is60Extra,self.videoRegistration.is6048Preview=e.registration.video.is6048Preview,t)if(-1!=self.videoRegistration.parentTopicName.indexOf("60 Minutes"))if("true"==self.videoRegistration.foxtrot){if("true"!=self.videoRegistration.is6048Preview&&"true"!=self.videoRegistration.is60Extra&&1!=self.videoRegistration.is6048Preview&&1!=self.videoRegistration.is60Extra)return void self.show60MinBlock("subscribe");("true"==self.videoRegistration.status||1==self.videoRegistration.status)&&(this.novemberAlpha=!0),self.initPlayback(t,i)}else if("true"==self.videoRegistration.is6048Preview||1==self.videoRegistration.is6048Preview)self.initPlayback(t,i);else{if("false"==self.videoRegistration.status||0==self.videoRegistration.status)return void self.show60MinBlock("subscribe");this.novemberAlpha=!0,self.initPlayback(t,i)}else self.initPlayback(t,i);else self.options.is60minfranchise=-1!=self.videoRegistration.parentTopicName.indexOf("60 Minutes")?!0:!1,self.options.viewable=self.videoRegistration.foxtrot,self.options.is6048Preview=self.videoRegistration.is6048Preview,self.options.is60Extra=self.videoRegistration.is60Extra,self.options.subscriber=self.videoRegistration.status}})},pullError:function(){},appBtnClick:function(t){e("#errorVideoId #video-error-buttonId").on("click",function(e){e.preventDefault(),"app"==t?navigator.userAgent.match(/iPhone|iPad|iPod/i)?document.location.href="https://itunes.apple.com/us/app/60-minutes-all-access/id997500692?mt=8":navigator.userAgent.match(/android/i)?document.location.href="https://play.google.com/store/apps/details?id=com.cbsnews.sixtyminutes&hl=en":document.location.href="/60-minutes/60-minutes-all-access/":document.location.href="/60-minutes/60-minutes-all-access/",om.trackCampaignDriver({intcid:"CNI39cd285",campaignType:"all-access",campaignChannel:"video player",campaignText:"learn more"})})},loadFirstVideo:function(){this.loadContentUrl()},loadContentUrl:function(){var e=new Object;e.isAd=!1,e.profile="prog",e.startTime=0,e.endTime=-1,e.videoTitle=this.options.hed,e.mediaId=this.options.pid,e.isLive=!1},listenPreviewClicks:function(){var t=this;e.support.touch?"touchstart":"click";e("#previewcontrols").on("touchstart",function(e){t.videoPlayback()})},videoPlayback:function(e,t){var i=new Object;i.isAd=!1,i.profile="prog",i.startTime=0,i.endTime=-1,i.videoTitle=this.options.hed,i.mediaId=this.options.pid,i.isLive=!1;if(e)this.remove60MinBlock(),this.pullSubscribeReg(e,t);else if(1==this.options.is60minfranchise||"true"==this.options.is60minfranchise)if(1==this.options.viewable||"true"==this.options.viewable)(1==this.options.is6048Preview||1==this.options.is60Extra||"true"==this.options.is6048Preview||"true"==this.options.is60Extra)&&(1==this.options.subscriber||"true"==this.options.subscriber)&&(this.novemberAlpha=!0);else if(1==this.options.is6048Preview||"true"==this.options.is6048Preview);else{if(0==this.options.subscriber||"false"==this.options.subscriber)return void this.show60MinBlock("subscribe");this.novemberAlpha=!0}if(e);else if(this.cbsiPlayer){var n="cbsnews_mobile";1==this.novemberAlpha?this.cbsiPlayer.loadVideoByUrl(this.options.uri,i):this.options.pid.match(/999999/gi)?this.cbsiPlayer.loadVideoByUrl(this.options.uri,i):this.cbsiPlayer.loadVideoById(this.options.pid,n)}},initPlayback:function(e,t){if(this.options.pid=e,this.cbsiPlayer){var i="cbsnews_mobile";1==this.novemberAlpha?this.cbsiPlayer.loadVideoByUrl(this.options.uri,videoOptions):e.match(/999999/gi)?this.cbsiPlayer.loadVideoByUrl(t,videoOptions):this.cbsiPlayer.loadVideoById(e,i)}},onCBSI_PlayerLoaded:function(e){this.loadContentUrl(),this._trigger("onPlayerLoaded_cbsi")},onCBSI_CaptionsError:function(t){e("#caption").text("Sorry, closed captions are not available for this video.")},addUvpEventCallbacks:function(){this.cbsiPlayer.addEventJSCallback("onPlayerLoaded_cbsi","onCBSI_PlayerLoaded"),this.cbsiPlayer.addEventJSCallback("onContentStart_cbsi","onCBSI_ContentStart"),this.cbsiPlayer.addEventJSCallback("onContentEnd_cbsi","onCBSI_ContentEnd"),this.cbsiPlayer.addEventJSCallback("onAdStart_cbsi","onCBSI_AdStart"),this.cbsiPlayer.addEventJSCallback("onAdEnd_cbsi","onCBSI_AdEnd"),this.cbsiPlayer.addEventJSCallback("onAdResourcesInfo","onCBSI_AdResourcesInfo"),this.cbsiPlayer.addEventJSCallback("onAdSlotStart_cbsi","onCBSI_AdSlotStart"),this.cbsiPlayer.addEventJSCallback("onPlayerDataLoaded_cbsi","onCBSI_PlayerDataLoaded"),this.cbsiPlayer.addEventJSCallback("onPlayListEnd_cbsi","onCBSI_PlayListEnd"),this.cbsiPlayer.addEventJSCallback("onCaptionsError","onCBSI_CaptionsError")},isLiveMobile:function(t){var i=["EZCOmvznjVN_","puG_yGuOdrCu","TiGLGtxzSPKe","D6fmVetXK8_K","4jQtQV2BUWPw","3eplG8pAXhsH","F8VkKnk_tgC8","9nnsnOy8iPUa"];return-1==e.inArray(t,i)?!1:!0},initialStart:function(){(null==this.options.is60minfranchise||"null"==this.options.is60minfranchise)&&this.pullSubscribeReg();var t=this.isLiveMobile(this.options.pid);t?e("<div/>",{"class":"ipadLiveVidClass",id:"ipadLiveVid",text:"Sorry this video is unavailable on this device",css:{color:"#FFFFFF","font-size":"16px","font-weight":"bold",width:"620px",height:"350px"}}).append(this.$element):(this.uvp_sOpts_tmp.previewImg=this.options.thumbnail,this.uvp_sOpts_tmp.videoTitle=this.options.hed,uvp_sOpts=this.uvp_sOpts_tmp,this.loadCbsiJSPlayer())}})});var uvp_sOpts;define("components/video/video-player",["jquery","version!fly/managers/debug","components/video/video-desktop","components/video/video-Hi5","version!fly/libs/jquery.cookie","version!fly/components/base"],function(e,t){"use strict";var i=t.get("video"),n=e(window);e.widget("fly.videoPlayer",e.fly.base,{options:{autoplay:!0,mediaRtmpDesktop:null,mediaRtmpMobileHigh:null,mediaRtmpMobileLow:null,mediaHls:null,mediaHlsTablet:null,mediaHlsPhone:null,url:null,suppress:!1,playerWidth:"100%",playerHeight:"100%",pagePlaylist:!1,si:"162",hed:null,thumbnail:"http://i.i.cbsi.com/cnwk.1d/i/cbs/video/defaultVideoSlate2011.jpg",pageType:null,element:null,duration:null,ipadBlock:null,mediaHlsURI:null,mediaHlsURITablet:null,mediaHlsURIPhone:null,mediaRtmpDesktopURI:null,mediaRtmpMobileHighURI:null,mediaRtmpMobileLowURI:null,subscriptionPreView:!1,subscriber:!1,is60minfranchise:null,is60Extra:!1,is6048Preview:!1,viewable:!0,mpxRefId:null,uuid:null,topicname:null,device:null,psite:"http://www.cbsnews.com",releaseURL:"http://www.cbsnews.com/common/video/cbsnews_video.swf"},widget:void 0,scrollListenerRegistered:null,fullPlayerBottom:0,pageYOffset:-1,playerSize:"full",_create:function(t){if("desktop"==this.options.device&&navigator.userAgent.match(/Android|iPad|BlackBerry|RIM/i)&&(this.options.device="tablet"),"desktop"!=this.options.device&&e("body").append('<script type="text/javascript" src="http://s0.2mdn.net/instream/html5/ima3.js"></script>'),e("#playerWrap")){var i=e("#playerWrap").width();e("#playerWrap").height(Math.round(9*i/16))}this.determineRoute()},determineRoute:function(){if("desktop"==this.options.device)this.options.mediaRtmpDesktop.match(/999999/gi)?this.widget=e.fly.videoDesktop({autoplay:this.options.autoplay,pid:this.options.mediaRtmpDesktop,url:this.options.url,si:this.options.si,pageType:this.options.pageType,pagePlaylist:this.options.pagePlaylist,playerWidth:this.options.playerWidth,playerHeight:this.options.playerHeight,elementRef:this.options.element,hed:this.options.hed,uuid:this.options.uuid,flv:this.options.mediaRtmpDesktopURI,topicname:this.options.topicname,subscriptionPreView:this.options.subscriptionPreView,thumbnail:this.options.thumbnail,subscriber:this.options.subscriber,viewable:this.options.viewable,is60minfranchise:this.options.is60minfranchise,is60Extra:this.options.is60Extra,is6048Preview:this.options.is6048Preview,UrlmpxRefId:this.options.mpxRefId,lengthSecs:this.options.duration,psite:this.options.psite,releaseURL:this.options.releaseURL,suppress:this.options.suppress}):this.widget=e.fly.videoDesktop({autoplay:this.options.autoplay,pid:this.options.mediaRtmpDesktop,suppress:this.options.suppress,pagePlaylist:this.options.pagePlaylist,url:this.options.url,hed:this.options.hed,uuid:this.options.uuid,si:this.options.si,pageType:this.options.pageType,playerWidth:this.options.playerWidth,playerHeight:this.options.playerHeight,flv:this.options.mediaRtmpDesktopURI,subscriptionPreView:this.options.subscriptionPreView,thumbnail:this.options.thumbnail,subscriber:this.options.subscriber,UrlmpxRefId:this.options.mpxRefId,viewable:this.options.viewable,is60minfranchise:this.options.is60minfranchise,is60Extra:this.options.is60Extra,is6048Preview:this.options.is6048Preview,psite:this.options.psite,elementRef:this.options.element,releaseURL:this.options.releaseURL});else if("tablet"==this.options.device){var t=null!=this.options.mediaHlsTablet?this.options.mediaHlsTablet:this.options.mediaHls,i=null!=this.options.mediaHlsURITablet?this.options.mediaHlsURITablet:this.options.mediaHlsURI,n=navigator.userAgent.match(/iPhone|iPad|iPod/i)?t:this.options.mediaRtmpMobileHigh,s=navigator.userAgent.match(/iPhone|iPad|iPod/i)?i:this.options.mediaRtmpMobileHighURI;this.widget=e.fly.videoHi5({hed:this.options.hed,pid:n,thumbnail:this.options.thumbnail,device:this.options.device,pageType:this.options.pageType,width:this.options.playerWidth,height:this.options.playerHeight,element:this.options.element,subscriber:this.options.subscriber,viewable:this.options.viewable,is60minfranchise:this.options.is60minfranchise,is60Extra:this.options.is60Extra,is6048Preview:this.options.is6048Preview,uuid:this.options.uuid,uri:s})}else if("mobile"==this.options.device){var t=null!=this.options.mediaHlsPhone?this.options.mediaHlsPhone:this.options.mediaHls,i=null!=this.options.mediaHlsURIPhone?this.options.mediaHlsURIPhone:this.options.mediaHlsURI,n=navigator.userAgent.match(/iPhone|iPad|iPod/i)?t:this.options.mediaRtmpMobileLow,s=navigator.userAgent.match(/iPhone|iPad|iPod/i)?i:this.options.mediaRtmpMobileLowURI;this.widget=e.fly.videoHi5({hed:this.options.hed,pid:n,thumbnail:this.options.thumbnail,subscriber:this.options.subscriber,viewable:this.options.viewable,pageType:this.options.pageType,is60minfranchise:this.options.is60minfranchise,is60Extra:this.options.is60Extra,is6048Preview:this.options.is6048Preview,device:this.options.device,width:this.options.playerWidth,height:this.options.playerHeight,element:this.options.element,uuid:this.options.uuid,uri:s})}this.widget.options.onPlayerLoaded_cbsi=e.proxy(this.onVideoPlayerLoaded,this),this.widget.options.onAdStart_cbsi=e.proxy(this.onAdStart,this),this.widget.options.onContentStart_cbsi=e.proxy(this.onContentStart,this)},loadCompanionAd:function(){window.googletag&&googletag.cmd.push(function(){googletag.defineSlot("/8264/vaw-can/cbsnews",[300,60],"marquee_video_top").addService(googletag.companionAds()).addService(googletag.pubads()),googletag.defineSlot("/8264/vaw-can/cbsnews",[728,90],"leader_video_top").addService(googletag.companionAds()).addService(googletag.pubads()),googletag.companionAds().setRefreshUnfilledSlots(!0),googletag.enableServices()})},onVideoPlayerLoaded:function(){i.log("VideoPlayerLoaded")},onAdStart:function(){i.log("adstart: registerScrollListener"),this.registerScrollListener()},onContentStart:function(){i.log("contentstart: registerScrollListener"),"desktop"==this.options.device&&videoContentStart(),this.registerScrollListener()},registerScrollListener:function(){this.scrollListenerRegistered||(i.log("registering scroll listener"),this.scrollListenerRegistered=!0,this.fullPlayerBottom=this.widget.$player.offset().top+this.widget.$player.height(),this.scrollListener())},scrollListener:function(){var e,t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},i=n.scrollTop();this.pageYOffset!=i&&(this.pageYOffset=i,e=this.fullPlayerBottom-i<100?"small":"full",this.playerSize!=e&&(this.playerSize=e,this.resizePlayer(e))),t(this.scrollListener.bind(this))},resizePlayer:function(e){var t;if(t="desktop"===this.options.device?this.widget.$player.parent():this.widget.$player.parents(".media-block"),"small"==e?t.addClass("floating"):t.removeClass("floating"),"desktop"===this.options.device){var i=this.widget.playerElement;i.setResize&&i.setResize(this.widget.$player.width(),this.widget.$player.height())}}})}),define("components/video/generic-playlist",["jquery","components/video/video-player","version!fly/libs/jquery.cookie","version!fly/components/base"],function(e){e.widget("fly.genericPlaylist",e.fly.base,{options:{selector:null,url:null,pageType:null,device:null,playerWidth:"100%",playerHeight:"100%",firstmediaRtmpDesktop:null,firstmediaRtmpMobileHigh:null,firstmediaRtmpMobileLow:null,firstmediaHls:null,firstmediaHlsTablet:null,firstmediaHlsPhone:null,firstmediaRtmpDesktopURI:null,firstmediaRtmpMobileHighURI:null,firstmediaRtmpMobileLowURI:null,firstmediaHlsURI:null,firstmediaHlsURITablet:null,firstmediaHlsURIPhone:null,firstmpxRefId:null,firsttopicname:null,firstDuration:null,firstTitle:null,firstImage:null,firstuuid:null,subscriber:!1,iristvFetchNumber:5,is60minfranchise:null,is60Extra:!1,is6048Preview:!1,viewable:!0,psite:"http://www.cbsnews.com",targetElement:null,releaseUrl:null},playlist:null,isTablet:!1,videoPaused:!1,assetClicked:!1,prevEvent:null,playbackStarted:!1,fireWatch:!1,_create:function(t){window.onPlayListEnd_cbsi=e.proxy(this.onPlayListEnd_cbsi,this),window.onContentEnd_cbsi=e.proxy(this.playlistUrlVideoEnd,this),window.cbsnewsPlayerPause=e.proxy(this.playerPause,this),window.cbsnewsPlayerPlay=e.proxy(this.cbsnewsPlayerPlay,this),window.videoContentStart=e.proxy(this.videoContentStart,this);var i=this;navigator.userAgent.match(/Android|iPad|BlackBerry|RIM/i)&&(this.isTablet=!0),this.setupPlaylist(i)},setupPlaylist:function(t){if(this.playlist=new Array,this.options.iristvEnabled)this.iristvLoadFetch(this,"watch");else{if(e(this.options.selector).each(function(i,n){t.pushPlaylist(e(n).data("video-info")),e(n).click(function(i){i.preventDefault(),t.assetClicked=!0,t.onAssetClick(e(this).data("video-info"),e(this).data("pid"),e(this))})}),e(this.options.selector).length>1&&e(this.options.selector).each(function(i,n){e(n).data("pid")==t.playlist[0].item.mediaRtmpDesktop&&(e(n).addClass("selected"),t.updateSelected(e(n)))}),null!=this.options.firstmediaRtmpDesktop){var i={item:{mediaRtmpDesktop:this.options.firstmediaRtmpDesktop,mediaRtmpMobileHigh:this.options.firstmediaRtmpMobileHigh,mediaRtmpMobileLow:this.options.firstmediaRtmpMobileLow,mediaHls:this.options.firstmediaHls,mediaHlsTablet:this.options.firstmediaHlsTablet,mediaHlsPhone:this.options.firstmediaHlsPhone,articleTitle:this.options.firstTitle,thumbnail:this.options.firstImage,duration:this.options.firstDuration,uuid:this.options.firstuuid,mpxRefId:this.options.firstmpxRefId,mediaRtmpDesktopURI:this.options.firstmediaRtmpDesktopURI,mediaRtmpMobileHighURI:this.options.firstmediaRtmpMobileHighURI,mediaRtmpMobileLowURI:this.options.firstmediaRtmpMobileLowURI,topicname:this.options.firsttopicname,mediaHlsURI:this.options.firstmediaHlsURI,mediaHlsURITablet:this.options.firstmediaHlsTabletURI,mediaHlsURIPhone:this.options.firstmediaHlsURIPhone}};this.unshiftPlaylist(i)}this.injectPlayer(t.playlist[0])}},videoContentStart:function(){this.options.iristvEnabled&&this.eventListenerRem("contentPlay")},popPlaylist:function(){return this.playlist.pop()},pushPlaylist:function(e){return this.playlist.push(e)},shiftPlaylist:function(){return this.playlist.shift()},unshiftPlaylist:function(e){return this.playlist.unshift(e)},clearPlaylist:function(){return this.playlist=[]},getNextPlaylistItem:function(){return this.playlist[1]},getFirstPlaylistItem:function(){return this.playlist[0]},getPlaylistIndexItem:function(e){return this.playlist[e]},getPlaylist:function(){return this.playlist},getPlaylistDebug:function(){e.each(this.playlist,function(e){})},playerPause:function(){this.videoPaused=!0,this.eventListenerRem("pause")},cbsnewsPlayerPlay:function(){1==this.videoPaused&&(this.eventListenerRem("resume"),this.videoPaused=!1)},eventListenerRem:function(e){switch(e){case"done":irisEvent="next_auto,video_complete,percentage_watched";break;case"contentPlay":irisEvent="play",this.fireWatch&&(this.makeWatchNextRequest("watch",this.watchQueryParams),this.fireWatch=!1);break;case"play":irisEvent="playStart";break;default:irisEvent=e}return"playStart"==window.cbsPlaylistPrevEvent&&"play"==irisEvent||"load"==irisEvent||"resume"==irisEvent||"playStart"==irisEvent||"nextVideo"==irisEvent?void(window.cbsPlaylistPrevEvent=irisEvent):(window.cbsPlaylistPrevEvent=irisEvent,void this.irisTvUpdate(irisEvent))},getPlaylistlength:function(){return this.playlist.length},onPlayListEnd_cbsi:function(){this.eventListenerRem("done"),0==this.assetClicked&&(2==this.getPlaylistlength()&&this.iristvLoadFetch(this,"next"),this.shiftPlaylist(),this.getPlaylistlength()>=1&&(this.loadVideo(this.getFirstPlaylistItem()),this.loopSelector(this.playlist[0].item.mediaRtmpDesktop))),this.assetClicked=!1,this.eventListenerRem("nextVideo")},loopSelector:function(t){var i=this;e(this.options.selector).each(function(n,s){e(s).data("pid")==t&&i.updateSelected(e(s))})},updateSelected:function(t){e(this.options.selector).each(function(t,i){e(i).removeClass("selected");
}),t.addClass("selected")},removeIndex:function(e){return this.playlist.slice(0,e).concat(this.playlist.slice(e+1))},shiftIndex:function(e){return this.playlist.slice(e,this.playlist.length).concat(this.playlist.slice(0,e))},onAssetClick:function(t,i,n){this.eventListenerRem("click"),0==this.getPlaylistlength()?(this.unshiftPlaylist(t),this.updateSelected(n),this.loadVideo(this.getFirstPlaylistItem())):1==this.getPlaylistlength()?(this.unshiftPlaylist(t),this.popPlaylist(),this.loadVideo(this.getFirstPlaylistItem())):(elementIndex=e.inArray(t,this.playlist),elementObj=this.getPlaylistIndexItem(elementIndex),this.playlist=this.shiftIndex(elementIndex),this.updateSelected(n),this.loadVideo(this.getFirstPlaylistItem()))},injectPlayer:function(t){this.eventListenerRem("load"),e.fly.videoPlayer({mediaRtmpDesktop:t.item.mediaRtmpDesktop,mediaRtmpMobileHigh:t.item.mediaRtmpMobileHigh,mediaRtmpMobileLow:t.item.mediaRtmpMobileLow,mediaHls:t.item.mediaHls,mediaHlsTablet:t.item.mediaHlsTablet,mediaHlsPhone:t.item.mediaHlsPhone,url:this.options.url,playerWidth:this.options.playerWidth,playerHeight:this.options.playerHeight,si:"162",hed:t.item.articleTitle,duration:t.item.duration,thumbnail:t.item.mediaImage,pageType:this.options.pageType,pagePlaylist:!0,uuid:t.item.uuid,mpxRefId:t.item.mpxRefId,element:this.options.targetElement,topicname:t.item.topicname,mediaHlsURI:t.item.mediaHlsURI,mediaHlsURITablet:t.item.mediaHlsURITablet,mediaHlsURIPhone:t.item.mediaHlsURIPhone,mediaRtmpDesktopURI:t.item.mediaRtmpDesktopURI,mediaRtmpMobileHighURI:t.item.mediaRtmpMobileHighURI,mediaRtmpMobileLowURI:t.item.mediaRtmpMobileLowURI,subscriber:this.options.subscriber,viewable:this.options.viewable,is60minfranchise:this.options.is60minfranchise,is6048Preview:this.options.is6048Preview,is60Extra:this.options.is60Extra,device:this.options.device,psite:this.options.psite,releaseURL:this.options.releaseUrl}),this.playbackStarted=!0,this.eventListenerRem("play")},getPlayer:function(e){return-1!=navigator.appName.indexOf("Microsoft")?window[e]:document[e]},playlistUrlVideoEnd:function(){this.playlist[0].item.mediaRtmpDesktop.match(/999999/gi)&&this.onPlayListEnd_cbsi(),"authenticated"===utag_data.userState&&"1"==utag_data.contentLocked&&this.onPlayListEnd_cbsi()},loadVideo:function(e){if("desktop"==this.options.device){var t;e.item.mediaRtmpDesktop.match(/999999/gi)?(t={hed:e.item.articleTitle,lengthSecs:e.item.duration,flv:e.item.mediaRtmpDesktopURI,url:this.options.url,uuid:e.item.uuid,cid:e.item.mediaRtmpDesktop,topicname:e.item.topicname,UrlmpxRefId:e.item.mpxRefId},0==this.isTablet?this.getPlayer(this.options.targetElement).externalPlayClipUrl(t):(setVideoUUID(e.item.uuid),navigator.userAgent.match(/iPhone|iPad|iPod/i)?null!=e.item.mediaHlsURITablet?videoPlayback(e.item.mediaHlsTablet,e.item.mediaHlsURITablet):videoPlayback(e.item.mediaHls,e.item.mediaHlsURI):videoPlayback(e.item.mediaRtmpMobileHigh,e.item.mediaRtmpMobileHighURI))):(t={pid:e.item.mediaRtmpDesktop,uuid:e.item.uuid,url:this.options.url},0==this.isTablet?this.getPlayer(this.options.targetElement).externalPlayClipPid(t):(setVideoUUID(e.item.uuid),navigator.userAgent.match(/iPhone|iPad|iPod/i)?null!=e.item.mediaHlsURITablet?videoPlayback(e.item.mediaHlsTablet,e.item.mediaHlsURITablet):videoPlayback(e.item.mediaHls,e.item.mediaHlsURI):videoPlayback(e.item.mediaRtmpMobileHigh,e.item.mediaRtmpMobileHighURI)))}else this.injectPlayer(e)},iristvLoadFetch:function(t,i){console.log("fetch");var n=this.options.mpxRefId;"next"==i&&this.playlist[0]&&(n=this.playlist[0].item.mpxRefId);var s={platform_id:n,number:this.options.iristvFetchNumber,user_id:CBSNEWS.user.ursClientToken};if("next"==i&&(console.log("doing next"),s.experience=this.irisWatch.experience,this.makeWatchNextRequest(i,s)),"watch"==i&&(this.watchQueryParams=s,this.fireWatch=!0),null==this.options.firstmediaRtmpDesktop||this.playbackStarted){if(!this.playbackStarted){var a=e(this.options.selector)[0];this.unshiftPlaylist(e(a).data("video-info"));var t=this;e(a).click(function(i){i.preventDefault(),t.assetClicked=!0,t.onAssetClick(e(this).data("video-info"),e(this).data("pid"),e(this))})}}else{var r={item:{mediaRtmpDesktop:this.options.firstmediaRtmpDesktop,mediaRtmpMobileHigh:this.options.firstmediaRtmpMobileHigh,mediaRtmpMobileLow:this.options.firstmediaRtmpMobileLow,mediaHls:this.options.firstmediaHls,mediaHlsTablet:this.options.firstmediaHlsTablet,mediaHlsPhone:this.options.firstmediaHlsPhone,articleTitle:this.options.firstTitle,thumbnail:this.options.firstImage,uuid:this.options.firstuuid,duration:this.options.firstDuration,mpxRefId:this.options.firstmpxRefId,mediaRtmpDesktopURI:this.options.firstmediaRtmpDesktopURI,mediaRtmpMobileHighURI:this.options.firstmediaRtmpMobileHighURI,mediaRtmpMobileLowURI:this.options.firstmediaRtmpMobileLowURI,topicname:this.options.firsttopicname,mediaHlsURI:this.options.firstmediaHlsURI,mediaHlsURITablet:this.options.firstmediaHlsTabletURI,mediaHlsURIPhone:this.options.firstmediaHlsURIPhone}};this.unshiftPlaylist(r)}this.getPlayer(this.options.targetElement)||this.injectPlayer(this.playlist[0])},makeWatchNextRequest:function(t,i){e.get("/video-iristv/"+t+"/",i).done(e.proxy(this.iristvWatchNext,this)).fail(function(e){console.log("playlist error"),console.log(e)})},iristvWatchNext:function(e){this.irisWatch=e;var t,i;for(var n in e.next){t=e.next[n];var s={};for(j=0;j<t["media:content"].length;j++)s[t["media:content"][j].medium]=t["media:content"][j];var i={item:{mediaRtmpDesktop:s.mediaRtmpDesktop.content_id,mediaRtmpMobileHigh:s.mediaRtmpMobileHigh.content_id,mediaRtmpMobileLow:s.mediaRtmpMobileLow.content_id,mediaHls:s.mediaHls.content_id,mediaHlsTablet:s.mediaHlsTablet.content_id,mediaHlsPhone:s.mediaHlsPhone.content_id,articleTitle:t.title,uuid:t.uuid,thumbnail:t.image_url,duration:t.duration,mpxRefId:t.platform_id,mediaRtmpDesktopURI:s.mediaRtmpDesktop.url,mediaRtmpMobileHighURI:s.mediaRtmpMobileHigh.url,mediaRtmpMobileLowURI:s.mediaRtmpMobileLow.url,topicname:t.topicname[0],mediaHlsURI:s.mediaHls.url,mediaHlsURITablet:s.mediaHlsTablet.url,mediaHlsURIPhone:s.mediaHlsPhone.url}};this.pushPlaylist(i)}},irisTvUpdate:function(t){if(!this.options.iristvEnabled)return!1;var i={platform_id:this.playlist[0].item.mpxRefId,experience:this.irisWatch.experience,user_id:CBSNEWS.user.ursClientToken,behavior:t};i=e.param(i),e.get("/video-iristv/update/",i).done(function(e){console.log(e)})}})}),function(){!function(){function e(e){return i(t(n(e)))}function t(e){return a(r(s(e),8*e.length))}function i(e){try{}catch(t){f=0}for(var i,n=f?"0123456789ABCDEF":"0123456789abcdef",s="",a=0;a<e.length;a++)i=e.charCodeAt(a),s+=n.charAt(i>>>4&15)+n.charAt(15&i);return s}function n(e){for(var t,i,n="",s=-1;++s<e.length;)t=e.charCodeAt(s),i=s+1<e.length?e.charCodeAt(s+1):0,t>=55296&&56319>=t&&i>=56320&&57343>=i&&(t=65536+((1023&t)<<10)+(1023&i),s++),127>=t?n+=String.fromCharCode(t):2047>=t?n+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n}function s(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(var i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}function a(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}function r(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var i=1732584193,n=-271733879,s=-1732584194,a=271733878,r=0;r<e.length;r+=16){var o=i,p=n,g=s,v=a;i=l(i,n,s,a,e[r+0],7,-680876936),a=l(a,i,n,s,e[r+1],12,-389564586),s=l(s,a,i,n,e[r+2],17,606105819),n=l(n,s,a,i,e[r+3],22,-1044525330),i=l(i,n,s,a,e[r+4],7,-176418897),a=l(a,i,n,s,e[r+5],12,1200080426),s=l(s,a,i,n,e[r+6],17,-1473231341),n=l(n,s,a,i,e[r+7],22,-45705983),i=l(i,n,s,a,e[r+8],7,1770035416),a=l(a,i,n,s,e[r+9],12,-1958414417),s=l(s,a,i,n,e[r+10],17,-42063),n=l(n,s,a,i,e[r+11],22,-1990404162),i=l(i,n,s,a,e[r+12],7,1804603682),a=l(a,i,n,s,e[r+13],12,-40341101),s=l(s,a,i,n,e[r+14],17,-1502002290),n=l(n,s,a,i,e[r+15],22,1236535329),i=d(i,n,s,a,e[r+1],5,-165796510),a=d(a,i,n,s,e[r+6],9,-1069501632),s=d(s,a,i,n,e[r+11],14,643717713),n=d(n,s,a,i,e[r+0],20,-373897302),i=d(i,n,s,a,e[r+5],5,-701558691),a=d(a,i,n,s,e[r+10],9,38016083),s=d(s,a,i,n,e[r+15],14,-660478335),n=d(n,s,a,i,e[r+4],20,-405537848),i=d(i,n,s,a,e[r+9],5,568446438),a=d(a,i,n,s,e[r+14],9,-1019803690),s=d(s,a,i,n,e[r+3],14,-187363961),n=d(n,s,a,i,e[r+8],20,1163531501),i=d(i,n,s,a,e[r+13],5,-1444681467),a=d(a,i,n,s,e[r+2],9,-51403784),s=d(s,a,i,n,e[r+7],14,1735328473),n=d(n,s,a,i,e[r+12],20,-1926607734),i=u(i,n,s,a,e[r+5],4,-378558),a=u(a,i,n,s,e[r+8],11,-2022574463),s=u(s,a,i,n,e[r+11],16,1839030562),n=u(n,s,a,i,e[r+14],23,-35309556),i=u(i,n,s,a,e[r+1],4,-1530992060),a=u(a,i,n,s,e[r+4],11,1272893353),s=u(s,a,i,n,e[r+7],16,-155497632),n=u(n,s,a,i,e[r+10],23,-1094730640),i=u(i,n,s,a,e[r+13],4,681279174),a=u(a,i,n,s,e[r+0],11,-358537222),s=u(s,a,i,n,e[r+3],16,-722521979),n=u(n,s,a,i,e[r+6],23,76029189),i=u(i,n,s,a,e[r+9],4,-640364487),a=u(a,i,n,s,e[r+12],11,-421815835),s=u(s,a,i,n,e[r+15],16,530742520),n=u(n,s,a,i,e[r+2],23,-995338651),i=h(i,n,s,a,e[r+0],6,-198630844),a=h(a,i,n,s,e[r+7],10,1126891415),s=h(s,a,i,n,e[r+14],15,-1416354905),n=h(n,s,a,i,e[r+5],21,-57434055),i=h(i,n,s,a,e[r+12],6,1700485571),a=h(a,i,n,s,e[r+3],10,-1894986606),s=h(s,a,i,n,e[r+10],15,-1051523),n=h(n,s,a,i,e[r+1],21,-2054922799),i=h(i,n,s,a,e[r+8],6,1873313359),a=h(a,i,n,s,e[r+15],10,-30611744),s=h(s,a,i,n,e[r+6],15,-1560198380),n=h(n,s,a,i,e[r+13],21,1309151649),i=h(i,n,s,a,e[r+4],6,-145523070),a=h(a,i,n,s,e[r+11],10,-1120210379),s=h(s,a,i,n,e[r+2],15,718787259),n=h(n,s,a,i,e[r+9],21,-343485551),i=c(i,o),n=c(n,p),s=c(s,g),a=c(a,v)}return Array(i,n,s,a)}function o(e,t,i,n,s,a){return c(p(c(c(t,e),c(n,a)),s),i)}function l(e,t,i,n,s,a,r){return o(t&i|~t&n,e,t,s,a,r)}function d(e,t,i,n,s,a,r){return o(t&n|i&~n,e,t,s,a,r)}function u(e,t,i,n,s,a,r){return o(t^i^n,e,t,s,a,r)}function h(e,t,i,n,s,a,r){return o(i^(t|~n),e,t,s,a,r)}function c(e,t){var i=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(i>>16);return n<<16|65535&i}function p(e,t){return e<<t|e>>>32-t}var g,v;(function(){function e(e,t){return e.set(t[0],t[1]),e}function t(e,t){return e.add(t),e}function i(e,t,i){var n=i.length;switch(n){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function n(e,t){for(var i=-1,n=e.length;++i<n&&t(e[i],i,e)!==!1;);return e}function s(e,t){for(var i=-1,n=e.length;++i<n;)if(!t(e[i],i,e))return!1;return!0}function a(e,t){for(var i=-1,n=e.length,s=0,a=[];++i<n;){var r=e[i];t(r,i,e)&&(a[s++]=r)}return a}function r(e,t){return!!e.length&&f(e,t,0)>-1}function o(e,t,i){for(var n=-1,s=e.length;++n<s;)if(i(t,e[n]))return!0;return!1}function l(e,t){for(var i=-1,n=e.length,s=Array(n);++i<n;)s[i]=t(e[i],i,e);return s}function d(e,t){for(var i=-1,n=t.length,s=e.length;++i<n;)e[s+i]=t[i];return e}function u(e,t,i,n){var s=-1,a=e.length;for(n&&a&&(i=e[++s]);++s<a;)i=t(i,e[s],s,e);return i}function h(e,t){for(var i=-1,n=e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}function c(e,t,i){for(var n=-1,s=e.length;++n<s;){var a=e[n],r=t(a);if(null!=r&&(o===An?r===r:i(r,o)))var o=r,l=a}return l}function p(e,t,i,n){var s;return i(e,function(e,i,a){return t(e,i,a)?(s=n?i:e,!1):void 0}),s}function v(e,t,i){for(var n=e.length,s=i?n:-1;i?s--:++s<n;)if(t(e[s],s,e))return s;return-1}function f(e,t,i){if(t!==t)return P(e,i);for(var n=i-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}function m(e,t,i,n){for(var s=i-1,a=e.length;++s<a;)if(n(e[s],t))return s;return-1}function _(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}function E(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}function y(e,t){return l(t,function(t){return[t,e[t]]})}function b(e){return function(t){return e(t)}}function A(e,t){return l(t,function(t){return e[t]})}function S(e){return e&&e.Object===Object?e:null}function I(e,t){if(e!==t){var i=null===e,n=e===An,s=e===e,a=null===t,r=t===An,o=t===t;if(e>t&&!a||!s||i&&!r&&o||n&&o)return 1;if(t>e&&!i||!o||a&&!n&&s||r&&s)return-1}return 0}function D(e,t,i){for(var n=-1,s=e.criteria,a=t.criteria,r=s.length,o=i.length;++n<r;){var l=I(s[n],a[n]);if(l){if(n>=o)return l;var d=i[n];return l*("desc"==d?-1:1)}}return e.index-t.index}function C(e,t){for(var i=e.length,n=0;i--;)e[i]===t&&n++;return n}function R(e){return ca[e]}function T(e){return"\\"+ga[e]}function P(e,t,i){for(var n=e.length,s=t+(i?0:-1);i?s--:++s<n;){var a=e[s];if(a!==a)return s}return-1}function M(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(i){}return t}function L(e,t){return e="number"==typeof e||xs.test(e)?+e:-1,t=null==t?zn:t,e>-1&&e%1==0&&t>e}function w(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i}function O(e){var t=-1,i=Array(e.size);return e.forEach(function(e,n){i[++t]=[n,e]}),i}function k(e,t){for(var i=-1,n=e.length,s=0,a=[];++i<n;){var r=e[i];(r===t||r===Rn)&&(e[i]=Rn,a[s++]=i)}return a}function N(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}function U(e){if(!e||!la.test(e))return e.length;for(var t=oa.lastIndex=0;oa.test(e);)t++;return t}function B(e){return e.match(oa)}function V(e){if(Ni(e)&&!yr(e)&&!(e instanceof x)){if(e instanceof G)return e;if(Ra.call(e,"__wrapped__"))return Jt(e)}return new G(e)}function j(){}function G(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=An}function x(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Kn,this.__views__=[]}function F(){var e=new x(this.__wrapped__);return e.__actions__=lt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=lt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=lt(this.__views__),e}function H(){if(this.__filtered__){var e=new x(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function W(){var e=this.__wrapped__.value(),t=this.__dir__,i=yr(e),n=0>t,s=i?e.length:0,a=kt(0,s,this.__views__),r=a.start,o=a.end,l=o-r,d=n?o:r-1,u=this.__iteratees__,h=u.length,c=0,p=Ya(l,this.__takeCount__);if(!i||In>s||s==l&&p==l)return Qe(e,this.__actions__);var g=[];e:for(;l--&&p>c;){d+=t;for(var v=-1,f=e[d];++v<h;){var m=u[v],_=m.iteratee,E=m.type,y=_(f);if(E==Hn)f=y;else if(!y){if(E==Fn)continue e;break e}}g[c++]=f}return g}function q(){}function z(e,t){return $(e,t)&&delete e[t]}function Y(e,t){if(Qa){var i=e[t];return i===Cn?An:i}return Ra.call(e,t)?e[t]:An}function $(e,t){return Qa?e[t]!==An:Ra.call(e,t)}function K(e,t,i){e[t]=Qa&&i===An?Cn:i}function J(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function X(){this.__data__={hash:new q,map:Ka?new Ka:[],string:new q}}function Q(e){var t=this.__data__;return Ft(e)?z("string"==typeof e?t.string:t.hash,e):Ka?t.map["delete"](e):he(t.map,e)}function Z(e){var t=this.__data__;return Ft(e)?Y("string"==typeof e?t.string:t.hash,e):Ka?t.map.get(e):ce(t.map,e)}function ee(e){var t=this.__data__;return Ft(e)?$("string"==typeof e?t.string:t.hash,e):Ka?t.map.has(e):pe(t.map,e)}function te(e,t){var i=this.__data__;return Ft(e)?K("string"==typeof e?i.string:i.hash,e,t):Ka?i.map.set(e,t):ve(i.map,e,t),this}function ie(e){var t=-1,i=e?e.length:0;for(this.__data__=new J;++t<i;)this.push(e[t])}function ne(e,t){var i=e.__data__;if(Ft(t)){var n=i.__data__,s="string"==typeof t?n.string:n.hash;return s[t]===Cn}return i.has(t)}function se(e){var t=this.__data__;if(Ft(e)){var i=t.__data__,n="string"==typeof e?i.string:i.hash;n[e]=Cn}else t.set(e,Cn)}function ae(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function re(){this.__data__={array:[],map:null}}function oe(e){var t=this.__data__,i=t.array;return i?he(i,e):t.map["delete"](e)}function le(e){var t=this.__data__,i=t.array;return i?ce(i,e):t.map.get(e)}function de(e){var t=this.__data__,i=t.array;return i?pe(i,e):t.map.has(e)}function ue(e,t){var i=this.__data__,n=i.array;n&&(n.length<In-1?ve(n,e,t):(i.array=null,i.map=new J(n)));var s=i.map;return s&&s.set(e,t),this}function he(e,t){var i=ge(e,t);if(0>i)return!1;var n=e.length-1;return i==n?e.pop():Fa.call(e,i,1),!0}function ce(e,t){var i=ge(e,t);return 0>i?An:e[i][1]}function pe(e,t){return ge(e,t)>-1}function ge(e,t){for(var i=e.length;i--;)if(Ii(e[i][0],t))return i;return-1}function ve(e,t,i){var n=ge(e,t);0>n?e.push([t,i]):e[n][1]=i}function fe(e,t,i,n){return e===An||Ii(e,Da[i])&&!Ra.call(n,i)?t:e}function me(e,t,i){var n=e[t];Ra.call(e,t)&&Ii(n,i)&&(i!==An||t in e)||(e[t]=i)}function _e(e,t){return e&&dt(t,en(t),e)}function Ee(e,t){for(var i=-1,n=null==e,s=t.length,a=Array(s);++i<s;)a[i]=n?An:Xi(e,t[i]);return a}function ye(e){return"function"==typeof e?e:vn}function be(e){return yr(e)?e:Kt(e)}function Ae(e,t,i){return e===e&&(i!==An&&(e=i>=e?e:i),t!==An&&(e=e>=t?e:t)),e}function Se(e,t,i,s,a,r,o){var l;if(s&&(l=r?s(e,a,r,o):s(e)),l!==An)return l;if(!ki(e))return e;var d=yr(e);if(d){if(l=Ut(e),!t)return lt(e,l)}else{var u=Ot(e),h=u==ts||u==is;if(br(e))return Ze(e,t);if(u==as||u==Jn||h&&!r){if(M(e))return r?e:{};if(l=Bt(h?{}:e),!t)return l=_e(l,e),i?ht(e,l):l}else{if(!ha[u])return r?e:{};l=Vt(e,u,t)}}o||(o=new ae);var c=o.get(e);return c?c:(o.set(e,l),(d?n:Pe)(e,function(n,a){me(l,a,Se(n,t,i,s,a,e,o))}),i&&!d?ht(e,l):l)}function Ie(e){return ki(e)?Ga(e):{}}function De(e,t,i,n){var s=-1,a=r,d=!0,u=e.length,h=[],c=t.length;if(!u)return h;i&&(t=l(t,b(i))),n?(a=o,d=!1):t.length>=In&&(a=ne,d=!1,t=new ie(t));e:for(;++s<u;){var p=e[s],g=i?i(p):p;if(d&&g===g){for(var v=c;v--;)if(t[v]===g)continue e;h.push(p)}else a(t,g,n)||h.push(p)}return h}function Ce(e,t){var i=!0;return lr(e,function(e,n,s){return i=!!t(e,n,s)}),i}function Re(e,t,i,n){n||(n=[]);for(var s=-1,a=e.length;++s<a;){var r=e[s];t>0&&Ri(r)&&(i||yr(r)||Di(r))?t>1?Re(r,t-1,i,n):d(n,r):i||(n[n.length]=r)}return n}function Te(e,t){return null==e?e:dr(e,t,tn)}function Pe(e,t){return e&&dr(e,t,en)}function Me(e,t){return a(t,function(t){return wi(e[t])})}function Le(e,t){t=xt(t,e)?[t+""]:be(t);for(var i=0,n=t.length;null!=e&&n>i;)e=e[t[i++]];return i&&i==n?e:An}function we(e,t){return Ra.call(e,t)||"object"==typeof e&&t in e&&null===Ba(e)}function Oe(e,t){return t in Object(e)}function ke(e,t,i){return e>=Ya(t,i)&&e<za(t,i)}function Ne(e,t,n){xt(t,e)||(t=be(t),e=Yt(e,t),t=ei(t));var s=null==e?e:e[t];return null==s?An:i(s,e,n)}function Ue(e,t,i,n,s){return e===t?!0:null==e||null==t||!ki(e)&&!Ni(t)?e!==e&&t!==t:Be(e,t,Ue,i,n,s)}function Be(e,t,i,n,s,a){var r=yr(e),o=yr(t),l=Xn,d=Xn;r||(l=Ot(e),l=l==Jn?as:l),o||(d=Ot(t),d=d==Jn?as:d);var u=l==as&&!M(e),h=d==as&&!M(t),c=l==d;if(c&&!u)return a||(a=new ae),r||Hi(e)?Dt(e,t,i,n,s,a):Ct(e,t,l,i,n,s,a);if(!(s&jn)){var p=u&&Ra.call(e,"__wrapped__"),g=h&&Ra.call(t,"__wrapped__");if(p||g)return a||(a=new ae),i(p?e.value():e,g?t.value():t,n,s,a)}return c?(a||(a=new ae),Rt(e,t,i,n,s,a)):!1}function Ve(e,t,i,n){var s=i.length,a=s,r=!n;if(null==e)return!a;for(e=Object(e);s--;){var o=i[s];if(r&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++s<a;){o=i[s];var l=o[0],d=e[l],u=o[1];if(r&&o[2]){if(d===An&&!(l in e))return!1}else{var h=new ae,c=n?n(d,u,l,e,t,h):An;if(!(c===An?Ue(u,d,n,Vn|jn,h):c))return!1}}return!0}function je(e){var t=typeof e;return"function"==t?e:null==e?vn:"object"==t?yr(e)?We(e[0],e[1]):He(e):yn(e)}function Ge(e){return qa(Object(e))}function xe(e){e=null==e?e:Object(e);var t=[];for(var i in e)t.push(i);return t}function Fe(e,t){var i=-1,n=Ci(e)?Array(e.length):[];return lr(e,function(e,s,a){n[++i]=t(e,s,a)}),n}function He(e){var t=Mt(e);if(1==t.length&&t[0][2]){var i=t[0][0],n=t[0][1];return function(e){return null==e?!1:e[i]===n&&(n!==An||i in Object(e))}}return function(i){return i===e||Ve(i,e,t)}}function We(e,t){return function(i){var n=Xi(i,e);return n===An&&n===t?Zi(i,e):Ue(t,n,An,Vn|jn)}}function qe(e,t,i){var n=-1;t=l(t.length?t:Array(1),Pt());var s=Fe(e,function(e,i,s){var a=l(t,function(t){return t(e)});return{criteria:a,index:++n,value:e}});return _(s,function(e,t){return D(e,t,i)})}function ze(e,t){var i={};return Te(e,function(e,n){t(e,n)&&(i[n]=e)}),i}function Ye(e){return function(t){return null==t?An:t[e]}}function $e(e){return function(t){return Le(t,e)}}function Ke(e,t,i,n){var s=n?m:f,a=-1,r=t.length,o=e;for(i&&(o=l(e,b(i)));++a<r;)for(var d=0,u=t[a],h=i?i(u):u;(d=s(o,h,d,n))>-1;)o!==e&&Fa.call(o,d,1),Fa.call(e,d,1);return e}function Je(e,t,i){var n=-1,s=e.length;0>t&&(t=-t>s?0:s+t),i=i>s?s:i,0>i&&(i+=s),s=t>i?0:i-t>>>0,t>>>=0;for(var a=Array(s);++n<s;)a[n]=e[n+t];return a}function Xe(e,t){var i;return lr(e,function(e,n,s){return i=t(e,n,s),!i}),!!i}function Qe(e,t){var i=e;return i instanceof x&&(i=i.value()),u(t,function(e,t){return t.func.apply(t.thisArg,d([e],t.args))},i)}function Ze(e,t){if(t)return e.slice();var i=new e.constructor(e.length);return e.copy(i),i}function et(e){var t=new e.constructor(e.byteLength);return new Na(t).set(new Na(e)),t}function tt(t){return u(O(t),e,new t.constructor)}function it(e){var t=new e.constructor(e.source,Us.exec(e));return t.lastIndex=e.lastIndex,t}function nt(e){return u(N(e),t,new e.constructor)}function st(e){return rr?Object(rr.call(e)):{}}function at(e,t){var i=t?et(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function rt(e,t,i,n){for(var s=-1,a=e.length,r=i.length,o=-1,l=t.length,d=za(a-r,0),u=Array(l+d),h=!n;++o<l;)u[o]=t[o];for(;++s<r;)(h||a>s)&&(u[i[s]]=e[s]);for(;d--;)u[o++]=e[s++];return u}function ot(e,t,i,n){for(var s=-1,a=e.length,r=-1,o=i.length,l=-1,d=t.length,u=za(a-o,0),h=Array(u+d),c=!n;++s<u;)h[s]=e[s];for(var p=s;++l<d;)h[p+l]=t[l];for(;++r<o;)(c||a>s)&&(h[p+i[r]]=e[s++]);return h}function lt(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}function dt(e,t,i){return ut(e,t,i)}function ut(e,t,i,n){i||(i={});for(var s=-1,a=t.length;++s<a;){var r=t[s],o=n?n(i[r],e[r],r,i,e):e[r];me(i,r,o)}return i}function ht(e,t){return dt(e,pr(e),t)}function ct(e){return yi(function(t,i){var n=-1,s=i.length,a=s>1?i[s-1]:An,r=s>2?i[2]:An;for(a="function"==typeof a?(s--,a):An,r&&Gt(i[0],i[1],r)&&(a=3>s?An:a,s=1),t=Object(t);++n<s;){var o=i[n];o&&e(t,o,n,a)}return t})}function pt(e,t){return function(i,n){if(null==i)return i;if(!Ci(i))return e(i,n);for(var s=i.length,a=t?s:-1,r=Object(i);(t?a--:++a<s)&&n(r[a],a,r)!==!1;);return i}}function gt(e){return function(t,i,n){for(var s=-1,a=Object(t),r=n(t),o=r.length;o--;){var l=r[e?o:++s];if(i(a[l],l,a)===!1)break}return t}}function vt(e,t,i){function n(){var t=this&&this!==Sa&&this instanceof n?a:e;return t.apply(s?i:this,arguments)}var s=t&Tn,a=mt(e);return n}function ft(e){return function(t){t=Ki(t);var i=la.test(t)?B(t):An,n=i?i[0]:t.charAt(0),s=i?i.slice(1).join(""):t.slice(1);return n[e]()+s}}function mt(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=Ie(e.prototype),n=e.apply(i,t);return ki(n)?n:i}}function _t(e,t,n){function s(){for(var r=arguments.length,o=Array(r),l=r,d=wt(s);l--;)o[l]=arguments[l];var u=3>r&&o[0]!==d&&o[r-1]!==d?[]:k(o,d);if(r-=u.length,n>r)return At(e,t,Et,s.placeholder,An,o,u,An,An,n-r);var h=this&&this!==Sa&&this instanceof s?a:e;return i(h,this,o)}var a=mt(e);return s}function Et(e,t,i,n,s,a,r,o,l,d){function u(){for(var m=arguments.length,_=m,E=Array(m);_--;)E[_]=arguments[_];if(g)var y=wt(u),b=C(E,y);if(n&&(E=rt(E,n,s,g)),a&&(E=ot(E,a,r,g)),m-=b,g&&d>m){var A=k(E,y);return At(e,t,Et,u.placeholder,i,E,A,o,l,d-m)}var S=c?i:this,I=p?S[e]:e;return m=E.length,o?E=$t(E,o):v&&m>1&&E.reverse(),h&&m>l&&(E.length=l),this&&this!==Sa&&this instanceof u&&(I=f||mt(I)),I.apply(S,E)}var h=t&Nn,c=t&Tn,p=t&Pn,g=t&(Ln|wn),v=t&Bn,f=p?An:mt(e);return u}function yt(e,t,i){t=Yi(t);var n=U(e);if(!t||n>=t)return"";var s=t-n;i=i===An?" ":i+"";var a=hn(i,Ha(s/U(i)));return la.test(i)?B(a).slice(0,s).join(""):a.slice(0,s)}function bt(e,t,n,s){function a(){for(var t=-1,l=arguments.length,d=-1,u=s.length,h=Array(u+l),c=this&&this!==Sa&&this instanceof a?o:e;++d<u;)h[d]=s[d];for(;l--;)h[d++]=arguments[++t];return i(c,r?n:this,h)}var r=t&Tn,o=mt(e);return a}function At(e,t,i,n,s,a,r,o,l,d){var u=t&Ln,h=o?lt(o):An,c=u?r:An,p=u?An:r,g=u?a:An,v=u?An:a;t|=u?On:kn,t&=~(u?kn:On),t&Mn||(t&=~(Tn|Pn));var f=[e,t,s,g,c,v,p,h,l,d],m=i.apply(An,f);return Ht(e)&&gr(m,f),m.placeholder=n,m}function St(e){var t=Math[e];return function(e,i){if(e=$i(e),i=Yi(i)){var n=(Ki(e)+"e").split("e"),s=t(n[0]+"e"+(+n[1]+i));return n=(Ki(s)+"e").split("e"),+(n[0]+"e"+(+n[1]-i))}return t(e)}}function It(e,t,i,n,s,a,r,o){var l=t&Pn;if(!l&&"function"!=typeof e)throw new TypeError(Dn);var d=n?n.length:0;if(d||(t&=~(On|kn),n=s=An),r=r===An?r:za(Yi(r),0),o=o===An?o:Yi(o),d-=s?s.length:0,t&kn){var u=n,h=s;n=s=An}var c=l?An:hr(e),p=[e,t,i,n,s,u,h,a,r,o];if(c&&zt(p,c),e=p[0],t=p[1],i=p[2],n=p[3],s=p[4],o=p[9]=null==p[9]?l?0:e.length:za(p[9]-d,0),!o&&t&(Ln|wn)&&(t&=~(Ln|wn)),t&&t!=Tn)g=t==Ln||t==wn?_t(e,t,o):t!=On&&t!=(Tn|On)||s.length?Et.apply(An,p):bt(e,t,i,n);else var g=vt(e,t,i);var v=c?ur:gr;return v(g,p)}function Dt(e,t,i,n,s,a){var r=-1,o=s&jn,l=s&Vn,d=e.length,u=t.length;if(d!=u&&!(o&&u>d))return!1;var c=a.get(e);if(c)return c==t;var p=!0;for(a.set(e,t);++r<d;){var g=e[r],v=t[r];if(n)var f=o?n(v,g,r,t,e,a):n(g,v,r,e,t,a);if(f!==An){if(f)continue;p=!1;break}if(l){if(!h(t,function(e){return g===e||i(g,e,n,s,a)})){p=!1;break}}else if(g!==v&&!i(g,v,n,s,a)){p=!1;break}}return a["delete"](e),p}function Ct(e,t,i,n,s,a,r){switch(i){case hs:return e.byteLength==t.byteLength&&n(new Na(e),new Na(t))?!0:!1;case Qn:case Zn:return+e==+t;case es:return e.name==t.name&&e.message==t.message;case ss:return e!=+e?t!=+t:e==+t;case rs:case ls:return e==t+"";case ns:var o=O;case os:var l=a&jn;if(o||(o=N),e.size!=t.size&&!l)return!1;var d=r.get(e);return d?d==t:Dt(o(e),o(t),n,s,a|Vn,r.set(e,t));case ds:if(rr)return rr.call(e)==rr.call(t)}return!1}function Rt(e,t,i,n,s,a){var r=s&jn,o=en(e),l=o.length,d=en(t),u=d.length;if(l!=u&&!r)return!1;for(var h=l;h--;){var c=o[h];if(!(r?c in t:we(t,c)))return!1}var p=a.get(e);if(p)return p==t;var g=!0;a.set(e,t);for(var v=r;++h<l;){c=o[h];var f=e[c],m=t[c];if(n)var _=r?n(m,f,c,t,e,a):n(f,m,c,e,t,a);if(!(_===An?f===m||i(f,m,n,s,a):_)){g=!1;break}v||(v="constructor"==c)}if(g&&!v){var E=e.constructor,y=t.constructor;E!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof E&&E instanceof E&&"function"==typeof y&&y instanceof y)&&(g=!1)}return a["delete"](e),g}function Tt(e){for(var t=e.name+"",i=tr[t],n=Ra.call(tr,t)?i.length:0;n--;){var s=i[n],a=s.func;if(null==a||a==e)return s.name}return t}function Pt(){var e=V.iteratee||fn;return e=e===fn?je:e,arguments.length?e(arguments[0],arguments[1]):e}function Mt(e){for(var t=sn(e),i=t.length;i--;)t[i][2]=qt(t[i][1]);return t}function Lt(e,t){var i=e[t];return Bi(i)?i:An}function wt(e){var t=Ra.call(V,"placeholder")?V:e;return t.placeholder}function Ot(e){return Pa.call(e)}function kt(e,t,i){for(var n=-1,s=i.length;++n<s;){var a=i[n],r=a.size;switch(a.type){case"drop":e+=r;break;case"dropRight":t-=r;break;case"take":t=Ya(t,e+r);break;case"takeRight":e=za(e,t-r)}}return{start:e,end:t}}function Nt(e,t,i){if(null==e)return!1;var n=i(e,t);n||xt(t)||(t=be(t),e=Yt(e,t),null!=e&&(t=ei(t),n=i(e,t)));var s=e?e.length:An;return n||!!s&&Oi(s)&&L(t,s)&&(yr(e)||xi(e)||Di(e))}function Ut(e){var t=e.length,i=e.constructor(t);return t&&"string"==typeof e[0]&&Ra.call(e,"index")&&(i.index=e.index,i.input=e.input),i}function Bt(e){return"function"!=typeof e.constructor||Wt(e)?{}:Ie(Ba(e))}function Vt(e,t,i){var n=e.constructor;switch(t){case hs:return et(e);case Qn:case Zn:return new n(+e);case cs:case ps:case gs:case vs:case fs:case ms:case _s:case Es:case ys:return at(e,i);case ns:return tt(e);case ss:case ls:return new n(e);case rs:return it(e);case os:return nt(e);case ds:return st(e)}}function jt(e){var t=e?e.length:An;return Oi(t)&&(yr(e)||xi(e)||Di(e))?E(t,String):null}function Gt(e,t,i){if(!ki(i))return!1;var n=typeof t;return("number"==n?Ci(i)&&L(t,i.length):"string"==n&&t in i)?Ii(i[t],e):!1}function xt(e,t){return"number"==typeof e?!0:!yr(e)&&(Ms.test(e)||!Ps.test(e)||null!=t&&e in Object(t))}function Ft(e){var t=typeof e;return"number"==t||"boolean"==t||"string"==t&&"__proto__"!=e||null==e}function Ht(e){var t=Tt(e),i=V[t];if("function"!=typeof i||!(t in x.prototype))return!1;if(e===i)return!0;var n=hr(i);return!!n&&e===n[0]}function Wt(e){var t=e&&e.constructor,i="function"==typeof t&&t.prototype||Da;return e===i}function qt(e){return e===e&&!ki(e)}function zt(e,t){var i=e[1],n=t[1],s=i|n,a=(Tn|Pn|Nn)>s,r=n==Nn&&i==Ln||n==Nn&&i==Un&&e[7].length<=t[8]||n==(Nn|Un)&&t[7].length<=t[8]&&i==Ln;if(!a&&!r)return e;n&Tn&&(e[2]=t[2],s|=i&Tn?0:Mn);var o=t[3];if(o){var l=e[3];e[3]=l?rt(l,o,t[4]):lt(o),e[4]=l?k(e[3],Rn):lt(t[4])}return o=t[5],o&&(l=e[5],e[5]=l?ot(l,o,t[6]):lt(o),e[6]=l?k(e[5],Rn):lt(t[6])),o=t[7],o&&(e[7]=lt(o)),n&Nn&&(e[8]=null==e[8]?t[8]:Ya(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=s,e}function Yt(e,t){return 1==t.length?e:Xi(e,Je(t,0,-1))}function $t(e,t){for(var i=e.length,n=Ya(t.length,i),s=lt(e);n--;){var a=t[n];e[n]=L(a,i)?s[a]:An}return e}function Kt(e){var t=[];return Ki(e).replace(Ls,function(e,i,n,s){t.push(n?s.replace(ks,"$1"):i||e)}),t}function Jt(e){if(e instanceof x)return e.clone();var t=new G(e.__wrapped__,e.__chain__);return t.__actions__=lt(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Xt(e){for(var t=-1,i=e?e.length:0,n=0,s=[];++t<i;){var a=e[t];a&&(s[n++]=a)}return s}function Qt(e,t,i){var n=e?e.length:0;return n?(t=i||t===An?1:Yi(t),Je(e,0>t?0:t,n)):[]}function Zt(e,t,i){var n=e?e.length:0;return n?(i=Yi(i),0>i&&(i=za(n+i,0)),f(e,t,i)):-1}function ei(e){var t=e?e.length:0;return t?e[t-1]:An}function ti(e,t){return e&&e.length&&t&&t.length?Ke(e,t):e}function ii(e){return e?$a.call(e):e}function ni(e){var t=V(e);return t.__chain__=!0,t}function si(e,t){return t(e),e}function ai(e,t){return t(e)}function ri(){return ni(this)}function oi(){return new G(this.value(),this.__chain__)}function li(){this.__values__===An&&(this.__values__=zi(this.value()));var e=this.__index__>=this.__values__.length,t=e?An:this.__values__[this.__index__++];return{done:e,value:t}}function di(){return this}function ui(e){for(var t,i=this;i instanceof j;){var n=Jt(i);n.__index__=0,n.__values__=An,t?s.__wrapped__=n:t=n;var s=n;i=i.__wrapped__}return s.__wrapped__=e,t}function hi(){var e=this.__wrapped__;if(e instanceof x){var t=e;return this.__actions__.length&&(t=new x(this)),t=t.reverse(),t.__actions__.push({func:ai,args:[ii],thisArg:An}),new G(t,this.__chain__)}return this.thru(ii)}function ci(){return Qe(this.__wrapped__,this.__actions__)}function pi(e,t,i){var n=yr(e)?s:Ce;return i&&Gt(e,t,i)&&(t=An),n(e,Pt(t,3))}function gi(e,t){if(t=Pt(t,3),yr(e)){var i=v(e,t);return i>-1?e[i]:An}return p(e,t,lr)}function vi(e,t){return"function"==typeof t&&yr(e)?n(e,t):lr(e,ye(t))}function fi(e,t,i,n){e=Ci(e)?e:an(e),i=i&&!n?Yi(i):0;var s=e.length;return 0>i&&(i=za(s+i,0)),xi(e)?s>=i&&e.indexOf(t,i)>-1:!!s&&f(e,t,i)>-1}function mi(e,t){var i=yr(e)?l:Fe;return i(e,Pt(t,3))}function _i(e,t,i){var n=yr(e)?h:Xe;return i&&Gt(e,t,i)&&(t=An),n(e,Pt(t,3))}function Ei(e,t,i){function n(){g&&clearTimeout(g),u&&clearTimeout(u),f=0,d=u=p=g=v=An}function s(t,i){i&&clearTimeout(i),u=g=v=An,t&&(f=_r(),h=e.apply(p,d),g||u||(d=p=An))}function a(){var e=t-(_r()-c);0>=e||e>t?s(v,u):g=setTimeout(a,e)}function r(){return(g&&v||u&&E)&&(h=e.apply(p,d)),n(),h}function o(){s(E,g)}function l(){if(d=arguments,c=_r(),p=this,v=E&&(g||!m),_===!1)var i=m&&!g;else{f||u||m||(f=c);var n=_-(c-f),s=(0>=n||n>_)&&(m||u);
s?(u&&(u=clearTimeout(u)),f=c,h=e.apply(p,d)):u||(u=setTimeout(o,n))}return s&&g?g=clearTimeout(g):g||t===_||(g=setTimeout(a,t)),i&&(s=!0,h=e.apply(p,d)),!s||g||u||(d=p=An),h}var d,u,h,c,p,g,v,f=0,m=!1,_=!1,E=!0;if("function"!=typeof e)throw new TypeError(Dn);return t=$i(t)||0,ki(i)&&(m=!!i.leading,_="maxWait"in i&&za($i(i.maxWait)||0,t),E="trailing"in i?!!i.trailing:E),l.cancel=n,l.flush=r,l}function yi(e,t){if("function"!=typeof e)throw new TypeError(Dn);return t=za(t===An?e.length-1:Yi(t),0),function(){for(var n=arguments,s=-1,a=za(n.length-t,0),r=Array(a);++s<a;)r[s]=n[t+s];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,n[0],r);case 2:return e.call(this,n[0],n[1],r)}var o=Array(t+1);for(s=-1;++s<t;)o[s]=n[s];return o[t]=r,i(e,this,o)}}function bi(e,t,i){var n=!0,s=!0;if("function"!=typeof e)throw new TypeError(Dn);return ki(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),Ei(e,t,{leading:n,maxWait:t,trailing:s})}function Ai(e){return Se(e,!1,!0)}function Si(e){return Se(e,!0,!0)}function Ii(e,t){return e===t||e!==e&&t!==t}function Di(e){return Ri(e)&&Ra.call(e,"callee")&&(!xa.call(e,"callee")||Pa.call(e)==Jn)}function Ci(e){return null!=e&&Oi(cr(e))&&!wi(e)}function Ri(e){return Ni(e)&&Ci(e)}function Ti(e){return e===!0||e===!1||Ni(e)&&Pa.call(e)==Qn}function Pi(e){return Ni(e)&&Pa.call(e)==Zn}function Mi(e){if(Ci(e)&&(yr(e)||xi(e)||wi(e.splice)||Di(e)))return!e.length;for(var t in e)if(Ra.call(e,t))return!1;return!0}function Li(e){return Ni(e)?Pa.call(e)==es||"string"==typeof e.message&&"string"==typeof e.name:!1}function wi(e){var t=ki(e)?Pa.call(e):"";return t==ts||t==is}function Oi(e){return"number"==typeof e&&e>-1&&e%1==0&&zn>=e}function ki(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ni(e){return!!e&&"object"==typeof e}function Ui(e){return ji(e)&&e!=+e}function Bi(e){return null==e?!1:wi(e)?La.test(Ca.call(e)):Ni(e)&&(M(e)?La:js).test(e)}function Vi(e){return null===e}function ji(e){return"number"==typeof e||Ni(e)&&Pa.call(e)==ss}function Gi(e){if(!Ni(e)||Pa.call(e)!=as||M(e))return!1;var t=Ba(e);if(null===t)return!0;var i=t.constructor;return"function"==typeof i&&i instanceof i&&Ca.call(i)==Ta}function xi(e){return"string"==typeof e||!yr(e)&&Ni(e)&&Pa.call(e)==ls}function Fi(e){return"symbol"==typeof e||Ni(e)&&Pa.call(e)==ds}function Hi(e){return Ni(e)&&Oi(e.length)&&!!ua[Pa.call(e)]}function Wi(e){return e===An}function qi(e,t){return t>e}function zi(e){if(!e)return[];if(Ci(e))return xi(e)?B(e):lt(e);if(ja&&e[ja])return w(e[ja]());var t=Ot(e),i=t==ns?O:t==os?N:an;return i(e)}function Yi(e){if(!e)return 0===e?e:0;if(e=$i(e),e===qn||e===-qn){var t=0>e?-1:1;return t*Yn}var i=e%1;return e===e?i?e-i:e:0}function $i(e){if(ki(e)){var t=wi(e.valueOf)?e.valueOf():e;e=ki(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Os,"");var i=Vs.test(e);return i||Gs.test(e)?va(e.slice(2),i?2:8):Bs.test(e)?$n:+e}function Ki(e){if("string"==typeof e)return e;if(null==e)return"";if(Fi(e))return or?or.call(e):"";var t=e+"";return"0"==t&&1/e==-qn?"-0":t}function Ji(e,t){return e&&Pe(e,ye(t))}function Xi(e,t,i){var n=null==e?An:Le(e,t);return n===An?i:n}function Qi(e,t){return Nt(e,t,we)}function Zi(e,t){return Nt(e,t,Oe)}function en(e){var t=Wt(e);if(!t&&!Ci(e))return Ge(e);var i=jt(e),n=!!i,s=i||[],a=s.length;for(var r in e)!we(e,r)||n&&("length"==r||L(r,a))||t&&"constructor"==r||s.push(r);return s}function tn(e){for(var t=-1,i=Wt(e),n=xe(e),s=n.length,a=jt(e),r=!!a,o=a||[],l=o.length;++t<s;){var d=n[t];r&&("length"==d||L(d,l))||"constructor"==d&&(i||!Ra.call(e,d))||o.push(d)}return o}function nn(e,t){return t=Pt(t),ze(e,function(e,i){return!t(e,i)})}function sn(e){return y(e,en(e))}function an(e){return e?A(e,en(e)):[]}function rn(e,t,i){return t=$i(t)||0,i===An?(i=t,t=0):i=$i(i)||0,e=$i(e),ke(e,t,i)}function on(e){return Dr(Ki(e).toLowerCase())}function ln(e,t,i){e=Ki(e),t="string"==typeof t?t:t+"";var n=e.length;return i=i===An?n:Ae(Yi(i),0,n),i-=t.length,i>=0&&e.indexOf(t,i)==i}function dn(e){return e=Ki(e),e&&Ds.test(e)?e.replace(Is,R):e}function un(e,t,i){return e=Ki(e),yt(e,t,i)+e}function hn(e,t){e=Ki(e),t=Yi(t);var i="";if(!e||1>t||t>zn)return i;do t%2&&(i+=e),t=Wa(t/2),e+=e;while(t);return i}function cn(e,t,i){return e=Ki(e),i=Ae(Yi(i),0,e.length),e.lastIndexOf(t,i)==i}function pn(e,t,i){var n=V.templateSettings;i&&Gt(e,t,i)&&(t=An),e=Ki(e),t=Ir({},t,n,fe);var s,a,r=Ir({},t.imports,n.imports,fe),o=en(r),l=A(r,o),d=0,u=t.interpolate||Fs,h="__p += '",c=RegExp((t.escape||Fs).source+"|"+u.source+"|"+(u===Ts?Ns:Fs).source+"|"+(t.evaluate||Fs).source+"|$","g"),p="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++da+"]")+"\n";e.replace(c,function(t,i,n,r,o,l){return n||(n=r),h+=e.slice(d,l).replace(Hs,T),i&&(s=!0,h+="' +\n__e("+i+") +\n'"),o&&(a=!0,h+="';\n"+o+";\n__p += '"),n&&(h+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),d=l+t.length,t}),h+="';\n";var g=t.variable;g||(h="with (obj) {\n"+h+"\n}\n"),h=(a?h.replace(bs,""):h).replace(As,"$1").replace(Ss,"$1;"),h="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var v=Cr(function(){return Function(o,p+"return "+h).apply(An,l)});if(v.source=h,Li(v))throw v;return v}function gn(e){return function(){return e}}function vn(e){return e}function fn(e){return je("function"==typeof e?e:Se(e,!0))}function mn(e,t,i){var s=en(t),a=Me(t,s);null!=i||ki(t)&&(a.length||!s.length)||(i=t,t=e,e=this,a=Me(t,en(t)));var r=ki(i)&&"chain"in i?i.chain:!0,o=wi(e);return n(a,function(i){var n=t[i];e[i]=n,o&&(e.prototype[i]=function(){var t=this.__chain__;if(r||t){var i=e(this.__wrapped__),s=i.__actions__=lt(this.__actions__);return s.push({func:n,args:arguments,thisArg:e}),i.__chain__=t,i}return n.apply(e,d([this.value()],arguments))})}),e}function _n(){return Sa._===this&&(Sa._=Ma),this}function En(){}function yn(e){return xt(e)?Ye(e):$e(e)}function bn(e){return e&&e.length?c(e,vn,qi):An}var An,Sn="4.6.1",In=200,Dn="Expected a function",Cn="__lodash_hash_undefined__",Rn="__lodash_placeholder__",Tn=1,Pn=2,Mn=4,Ln=8,wn=16,On=32,kn=64,Nn=128,Un=256,Bn=512,Vn=1,jn=2,Gn=150,xn=16,Fn=1,Hn=2,Wn=3,qn=1/0,zn=9007199254740991,Yn=1.7976931348623157e308,$n=NaN,Kn=4294967295,Jn="[object Arguments]",Xn="[object Array]",Qn="[object Boolean]",Zn="[object Date]",es="[object Error]",ts="[object Function]",is="[object GeneratorFunction]",ns="[object Map]",ss="[object Number]",as="[object Object]",rs="[object RegExp]",os="[object Set]",ls="[object String]",ds="[object Symbol]",us="[object WeakMap]",hs="[object ArrayBuffer]",cs="[object Float32Array]",ps="[object Float64Array]",gs="[object Int8Array]",vs="[object Int16Array]",fs="[object Int32Array]",ms="[object Uint8Array]",_s="[object Uint8ClampedArray]",Es="[object Uint16Array]",ys="[object Uint32Array]",bs=/\b__p \+= '';/g,As=/\b(__p \+=) '' \+/g,Ss=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Is=/[&<>"'`]/g,Ds=RegExp(Is.source),Cs=/<%-([\s\S]+?)%>/g,Rs=/<%([\s\S]+?)%>/g,Ts=/<%=([\s\S]+?)%>/g,Ps=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ms=/^\w*$/,Ls=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,ws=/[\\^$.*+?()[\]{}|]/g,Os=/^\s+|\s+$/g,ks=/\\(\\)?/g,Ns=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Us=/\w*$/,Bs=/^[-+]0x[0-9a-f]+$/i,Vs=/^0b[01]+$/i,js=/^\[object .+?Constructor\]$/,Gs=/^0o[0-7]+$/i,xs=/^(?:0|[1-9]\d*)$/,Fs=/($^)/,Hs=/['\n\r\u2028\u2029\\]/g,Ws="\\ud800-\\udfff",qs="\\u0300-\\u036f\\ufe20-\\ufe23",zs="\\u20d0-\\u20f0",Ys="\\ufe0e\\ufe0f",$s="["+Ws+"]",Ks="["+qs+zs+"]",Js="\\ud83c[\\udffb-\\udfff]",Xs="(?:"+Ks+"|"+Js+")",Qs="[^"+Ws+"]",Zs="(?:\\ud83c[\\udde6-\\uddff]){2}",ea="[\\ud800-\\udbff][\\udc00-\\udfff]",ta="\\u200d",ia=Xs+"?",na="["+Ys+"]?",sa="(?:"+ta+"(?:"+[Qs,Zs,ea].join("|")+")"+na+ia+")*",aa=na+ia+sa,ra="(?:"+[Qs+Ks+"?",Ks,Zs,ea,$s].join("|")+")",oa=RegExp(Js+"(?="+Js+")|"+ra+aa,"g"),la=RegExp("["+ta+Ws+qs+zs+Ys+"]"),da=-1,ua={};ua[cs]=ua[ps]=ua[gs]=ua[vs]=ua[fs]=ua[ms]=ua[_s]=ua[Es]=ua[ys]=!0,ua[Jn]=ua[Xn]=ua[hs]=ua[Qn]=ua[Zn]=ua[es]=ua[ts]=ua[ns]=ua[ss]=ua[as]=ua[rs]=ua[os]=ua[ls]=ua[us]=!1;var ha={};ha[Jn]=ha[Xn]=ha[hs]=ha[Qn]=ha[Zn]=ha[cs]=ha[ps]=ha[gs]=ha[vs]=ha[fs]=ha[ns]=ha[ss]=ha[as]=ha[rs]=ha[os]=ha[ls]=ha[ds]=ha[ms]=ha[_s]=ha[Es]=ha[ys]=!0,ha[es]=ha[ts]=ha[us]=!1;var ca={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},pa={"function":!0,object:!0},ga={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},va=parseInt,fa=pa[typeof exports]&&exports&&!exports.nodeType?exports:An,ma=pa[typeof module]&&module&&!module.nodeType?module:An,_a=ma&&ma.exports===fa?fa:An,Ea=S(fa&&ma&&"object"==typeof global&&global),ya=S(pa[typeof self]&&self),ba=S(pa[typeof window]&&window),Aa=S(pa[typeof this]&&this),Sa=Ea||ba!==(Aa&&Aa.window)&&ba||ya||Aa||Function("return this")(),Ia=Array.prototype,Da=Object.prototype,Ca=Function.prototype.toString,Ra=Da.hasOwnProperty,Ta=Ca.call(Object),Pa=Da.toString,Ma=Sa._,La=RegExp("^"+Ca.call(Ra).replace(ws,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wa=_a?Sa.Buffer:An,Oa=Sa.Reflect,ka=Sa.Symbol,Na=Sa.Uint8Array,Ua=Oa?Oa.enumerate:An,Ba=Object.getPrototypeOf,Va=Object.getOwnPropertySymbols,ja="symbol"==typeof(ja=ka&&ka.iterator)?ja:An,Ga=Object.create,xa=Da.propertyIsEnumerable,Fa=Ia.splice,Ha=Math.ceil,Wa=Math.floor,qa=Object.keys,za=Math.max,Ya=Math.min,$a=Ia.reverse,Ka=Lt(Sa,"Map"),Ja=Lt(Sa,"Set"),Xa=Lt(Sa,"WeakMap"),Qa=Lt(Object,"create"),Za=Xa&&new Xa,er=!xa.call({valueOf:1},"valueOf"),tr={},ir=Ka?Ca.call(Ka):"",nr=Ja?Ca.call(Ja):"",sr=Xa?Ca.call(Xa):"",ar=ka?ka.prototype:An,rr=ar?ar.valueOf:An,or=ar?ar.toString:An;V.templateSettings={escape:Cs,evaluate:Rs,interpolate:Ts,variable:"",imports:{_:V}};var lr=pt(Pe),dr=gt();Ua&&!xa.call({valueOf:1},"valueOf")&&(xe=function(e){return w(Ua(e))});var ur=Za?function(e,t){return Za.set(e,t),e}:vn,hr=Za?function(e){return Za.get(e)}:En,cr=Ye("length"),pr=Va||function(){return[]};(Ka&&Ot(new Ka)!=ns||Ja&&Ot(new Ja)!=os||Xa&&Ot(new Xa)!=us)&&(Ot=function(e){var t=Pa.call(e),i=t==as?e.constructor:null,n="function"==typeof i?Ca.call(i):"";if(n)switch(n){case ir:return ns;case nr:return os;case sr:return us}return t});var gr=function(){var e=0,t=0;return function(i,n){var s=_r(),a=xn-(s-t);if(t=s,a>0){if(++e>=Gn)return i}else e=0;return ur(i,n)}}(),vr=yi(ti),fr=yi(function(e,t){return Ri(e)?De(e,t):[]}),mr=(yi(function(e){e=Re(e,1);var t=e.length,i=t?e[0]:0,n=this.__wrapped__,s=function(t){return Ee(t,e)};return!(t>1||this.__actions__.length)&&n instanceof x&&L(i)?(n=n.slice(i,+i+(t?1:0)),n.__actions__.push({func:ai,args:[s],thisArg:An}),new G(n,this.__chain__).thru(function(e){return t&&!e.length&&e.push(An),e})):this.thru(s)}),yi(function(e,t){if(null==e)return[];var i=t.length;return i>1&&Gt(e,t[0],t[1])?t=[]:i>2&&Gt(t[0],t[1],t[2])&&(t.length=1),qe(e,Re(t,1),[])})),_r=Date.now,Er=yi(function(e,t,i){var n=Tn;if(i.length){var s=k(i,wt(Er));n|=On}return It(e,n,t,i,s)}),yr=Array.isArray,br=wa?function(e){return e instanceof wa}:gn(!1),Ar=ct(function(e,t){if(er||Wt(t)||Ci(t))return void dt(t,en(t),e);for(var i in t)Ra.call(t,i)&&me(e,i,t[i])}),Sr=ct(function(e,t){if(er||Wt(t)||Ci(t))return void dt(t,tn(t),e);for(var i in t)me(e,i,t[i])}),Ir=ct(function(e,t,i,n){ut(t,tn(t),e,n)}),Dr=ft("toUpperCase"),Cr=yi(function(e,t){try{return i(e,An,t)}catch(n){return Li(n)?n:new Error(n)}}),Rr=yi(function(e,t){return n(Re(t,1),function(t){e[t]=Er(e[t],e)}),e}),Tr=St("round");V.prototype=j.prototype,V.prototype.constructor=V,G.prototype=Ie(j.prototype),G.prototype.constructor=G,x.prototype=Ie(j.prototype),x.prototype.constructor=x,q.prototype=Qa?Qa(null):Da,J.prototype.clear=X,J.prototype["delete"]=Q,J.prototype.get=Z,J.prototype.has=ee,J.prototype.set=te,ie.prototype.push=se,ae.prototype.clear=re,ae.prototype["delete"]=oe,ae.prototype.get=le,ae.prototype.has=de,ae.prototype.set=ue,V.assign=Ar,V.assignIn=Sr,V.assignInWith=Ir,V.bind=Er,V.bindAll=Rr,V.chain=ni,V.compact=Xt,V.constant=gn,V.debounce=Ei,V.drop=Qt,V.iteratee=fn,V.keys=en,V.keysIn=tn,V.map=mi,V.mixin=mn,V.omitBy=nn,V.property=yn,V.pull=vr,V.pullAll=ti,V.rest=yi,V.reverse=ii,V.sortBy=mr,V.tap=si,V.throttle=bi,V.thru=ai,V.toArray=zi,V.toPairs=sn,V.values=an,V.without=fr,V.extend=Sr,V.extendWith=Ir,mn(V,V),V.attempt=Cr,V.capitalize=on,V.clone=Ai,V.cloneDeep=Si,V.endsWith=ln,V.eq=Ii,V.escape=dn,V.every=pi,V.find=gi,V.forEach=vi,V.forOwn=Ji,V.get=Xi,V.has=Qi,V.hasIn=Zi,V.identity=vn,V.includes=fi,V.indexOf=Zt,V.inRange=rn,V.isArguments=Di,V.isArray=yr,V.isArrayLike=Ci,V.isArrayLikeObject=Ri,V.isBoolean=Ti,V.isBuffer=br,V.isDate=Pi,V.isEmpty=Mi,V.isError=Li,V.isFunction=wi,V.isLength=Oi,V.isNaN=Ui,V.isNative=Bi,V.isNull=Vi,V.isNumber=ji,V.isObject=ki,V.isObjectLike=Ni,V.isPlainObject=Gi,V.isString=xi,V.isSymbol=Fi,V.isTypedArray=Hi,V.isUndefined=Wi,V.last=ei,V.lt=qi,V.min=bn,V.noConflict=_n,V.noop=En,V.now=_r,V.padStart=un,V.repeat=hn,V.round=Tr,V.some=_i,V.startsWith=cn,V.template=pn,V.toInteger=Yi,V.toNumber=$i,V.toString=Ki,V.upperFirst=Dr,V.each=vi,mn(V,function(){var e={};return Pe(V,function(t,i){Ra.call(V.prototype,i)||(e[i]=t)}),e}(),{chain:!1}),V.VERSION=Sn,Er.placeholder=V,n(["drop","take"],function(e,t){x.prototype[e]=function(i){var n=this.__filtered__;if(n&&!t)return new x(this);i=i===An?1:za(Yi(i),0);var s=this.clone();return n?s.__takeCount__=Ya(i,s.__takeCount__):s.__views__.push({size:Ya(i,Kn),type:e+(s.__dir__<0?"Right":"")}),s},x.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),n(["filter","map","takeWhile"],function(e,t){var i=t+1,n=i==Fn||i==Wn;x.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Pt(e,3),type:i}),t.__filtered__=t.__filtered__||n,t}}),n(["head","last"],function(e,t){var i="take"+(t?"Right":"");x.prototype[e]=function(){return this[i](1).value()[0]}}),n(["initial","tail"],function(e,t){var i="drop"+(t?"":"Right");x.prototype[e]=function(){return this.__filtered__?new x(this):this[i](1)}}),x.prototype.compact=function(){return this.filter(vn)},x.prototype.find=function(e){return this.filter(e).head()},x.prototype.findLast=function(e){return this.reverse().find(e)},x.prototype.invokeMap=yi(function(e,t){return"function"==typeof e?new x(this):this.map(function(i){return Ne(i,e,t)})}),x.prototype.reject=function(e){return e=Pt(e,3),this.filter(function(t){return!e(t)})},x.prototype.slice=function(e,t){e=Yi(e);var i=this;return i.__filtered__&&(e>0||0>t)?new x(i):(0>e?i=i.takeRight(-e):e&&(i=i.drop(e)),t!==An&&(t=Yi(t),i=0>t?i.dropRight(-t):i.take(t-e)),i)},x.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},x.prototype.toArray=function(){return this.take(Kn)},Pe(x.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),s=V[n?"take"+("last"==t?"Right":""):t],a=n||/^find/.test(t);s&&(V.prototype[t]=function(){var t=this.__wrapped__,r=n?[1]:arguments,o=t instanceof x,l=r[0],u=o||yr(t),h=function(e){var t=s.apply(V,d([e],r));return n&&c?t[0]:t};u&&i&&"function"==typeof l&&1!=l.length&&(o=u=!1);var c=this.__chain__,p=!!this.__actions__.length,g=a&&!c,v=o&&!p;if(!a&&u){t=v?t:new x(this);var f=e.apply(t,r);return f.__actions__.push({func:ai,args:[h],thisArg:An}),new G(f,c)}return g&&v?e.apply(this,r):(f=this.thru(h),g?n?f.value()[0]:f.value():f)})}),n(["pop","push","shift","sort","splice","unshift"],function(e){var t=Ia[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);V.prototype[e]=function(){var e=arguments;return n&&!this.__chain__?t.apply(this.value(),e):this[i](function(i){return t.apply(i,e)})}}),Pe(x.prototype,function(e,t){var i=V[t];if(i){var n=i.name+"",s=tr[n]||(tr[n]=[]);s.push({name:t,func:i})}}),tr[Et(An,Pn).name]=[{name:"wrapper",func:An}],x.prototype.clone=F,x.prototype.reverse=H,x.prototype.value=W,V.prototype.chain=ri,V.prototype.commit=oi,V.prototype.next=li,V.prototype.plant=ui,V.prototype.reverse=hi,V.prototype.toJSON=V.prototype.valueOf=V.prototype.value=ci,ja&&(V.prototype[ja]=di),(ba||ya||{})._=V,"function"==typeof g&&"object"==typeof g.amd&&g.amd?g(function(){return V}):fa&&ma?(_a&&((ma.exports=V)._=V),fa._=V):Sa._=V}).call(this),window.uvpjs={debug:!0,EventType:{AD_END:"onAdEnd",AD_POD_END:"onAdPodEnd",AD_POD_START:"onAdPodStart",AD_START:"onAdStart",CAPTIONS_READY:"onCaptionsReady",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",NO_AD_CONTENT:"onNoAdContent",PLAYER_LOADED:"onPlayerLoaded",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange"},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-ccaption",VOLUME:"btn-volume"}},register:function(e){var t,i,n=e.split("."),s=window,a=n.length;for(t=0;a>t;t++)i=n[t],void 0===s[i]&&(s[i]={}),s=s[i];return s},getClass:function(e){var t,i,n,s,a,r;if("string"!=typeof e)return e;for(t=e.split("."),i=window,n=t.length,s="",a=0;n>a;a++){if(r=t[a],s+=r,void 0===i[r])throw new Error("uvpjs.getClass(): "+s+" is undefined.");n-1>a&&(s+="."),i=i[r]}return i},getObject:function(e){return uvpjs.getClass(e)}},function(){var e=!1,t=/xyz/.test(function(){var e;e=null})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(i){function n(){!e&&this.init&&this.init.apply(this,arguments)}var s,a,r,o,l,d,u,h,c,p,g,v=this.prototype,f=[];e=!0,r=new this,e=!1,a=function(e,t){return function(){var i,n=this._super;return this._super=v[e],i=t.apply(this,arguments),this._super=n,i}};for(p in i)i.hasOwnProperty(p)&&("Implements"!==p?(l=i[p],r[p]="function"==typeof l&&"function"==typeof v[p]&&t.test(l)?a(p,l):l):"Implements"===p&&(f=i[p].slice(0)));if(f.length>0)for(o=0,u=f.length;u>o;o++){s=f[o];for(d in s)if(s.hasOwnProperty(d)&&"function"==typeof s[d]){if(h="function"==typeof i[d],c=h&&s[d].length===i[d].length,!h)throw g="Class does not implement interface method "+s.name+"::"+d+"()",console.dir(i),new Error(g);if(!c)throw g="Class implementation of interface method "+s.name+"::"+d+"() must have same signature",console.dir(i),new Error(g)}}return n.prototype=r,n.prototype.constructor=n,n.subClass=arguments.callee,n}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),function(e){"use strict";e.Configuration={env:"production",hostname:"vidtech.cbsinteractive.com",name:"UVPJS",version:"1.3.1",path:"//vidtech.cbsinteractive.com/uvpjs/1.3.1/",playerName:"CBSI-PLAYER"}}(uvpjs),uvpjs.MediaCapabilities=function(){var e,t,i,n,s,a,r,o,l,d,u,h,c,p,g,v,f,m=uvpjs._,_=!1,E=!1,y={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",MPEG_DASH:"MPEG-DASH",PLATFORM:"platform",IMA:"ima",PLACEHOLDER_M3U8_URL:"//vidtech.cbsinteractive.com/h5/blanks/blank.m3u8",PLACEHOLDER_MP4_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLATFORM_OUTLET_ACCOUNT_ID:"dJ5BDC",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"http://can.cbs.com/thunder/player/videoManifest.php?assetType=HLS&authn=",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",FULLSCREEN_MICROSOFT:"MSFullscreenChange",FULLSCREEN_WEBKIT:"webkitfullscreenchange",FULLSCREEN_MOZILLA:"mozfullscreenchange",FULLSCREEN_DEFAULT:"fullscreenchange",PROGRESSIVE:"progressive",STREAMING:"streaming",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",_detectEnvironment:function(i,n){return typeof i===this.STRING?(e=i,t=!0):(e=navigator.userAgent||null,t=!1),s=document.createElement(this.VIDEO),a=document.createElement(this.AUDIO),typeof n===this.BOOLEAN&&(_=n),b(),D(),U(),E="https:"===location.protocol,this},checkBrowserName:function(e){return typeof e===this.STRING&&this.getBrowserName()===e},canPlayHTML5Video:function(){var e=document.createElement(this.VIDEO);return typeof e===this.OBJECT&&typeof e.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var e=document.createElement(this.AUDIO);return typeof e===this.OBJECT&&typeof e.canPlayType===this.FUNCTION},getBrowserName:function(){return h},getBrowserVersion:function(){return c},getBrowserMajorVersion:function(){return p},getBrowserVendorPrefix:function(){return this.isWebKit()?"webkit":this.isFirefox()?"moz":this.isIE()?"ie":this.isOpera()?"o":void 0},setBrowserVersion:function(e,t){if(typeof t===this.OBJECT){var i=new RegExp(t),n=i.exec(this.getUserAgent()),s="",a="";if(typeof n===this.OBJECT&&n.length&&n.length>1){if(s=n[1]||"",s.indexOf(".")){var r=s.split(".");"object"==typeof r&&r.length&&r.length>0&&(a=r[0])}else a=s;return h=e,c=s,p=a,!0}}return!1},hasTealium:function(){return m.has(window,"utag")||m.has(window,"utag_data")},hasFlash:function(){if(typeof g===this.BOOLEAN)return g;if(this.isIE()&&this.getBrowserVersion()<11)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),g=!0,v=this.GetVariable("$version"),!0}catch(e){return g=!1,!1}else if(navigator.plugins&&navigator.plugins.length>0){var t="application/x-shockwave-flash",i=navigator.mimeTypes;if(i&&i[t]&&i[t].enabledPlugin&&i[t].enabledPlugin.description){g=!0;var n=i[t].enabledPlugin.description,s=/Shockwave\ Flash\ ([^\s]+)\ r([^s]+)/,a=new RegExp(s),r=a.exec(n);return r&&(v=(r[1]||0)+"."+(r[2]||0)),!0}}return g=!1,v=void 0,!1},getFlashVersion:function(){return v},getFlashEnabled:function(){return f},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(e){return typeof e===this.STRING?(this._detectEnvironment(e),!0):!1},getUserAgent:function(){return e},getMimeTypesObj:function(){return i?i:(typeof navigator===this.OBJECT&&navigator.mimeTypes&&navigator.mimeTypes.length>0&&(i=navigator.mimeTypes),i)},getMimeTypes:function(){if(typeof n===this.OBJECT)return n;var e={length:0},t=this.getMimeTypesObj();if(typeof t===this.OBJECT){for(var i=0;i<this.length;i++){var s=t[i].enabledPlugin&&t[i].enabledPlugin.name?t[i].enabledPlugin.name:"";e[t[i].type]={type:t[i].type,description:t[i].description,suffixes:t[i].suffixes,enabledPlugin:t[i].enabledPlugin,enabledPluginName:s},e.length++}return n=e}},getPlatform:function(){return typeof o===this.STRING?o:null},getOS:function(){return typeof l===this.STRING?l:null},getOSVersion:function(){return typeof d===this.STRING?d:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return this.getPlatform()===this.CHROMEOS},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof u===this.BOOLEAN?u:u=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return C()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canPlayHLSJS:function(){return C()&&(this.isFirefox()||this.isChrome()||this.isIE()&&this.getBrowserVersion()>=11)},canPlayNativeHLSAudio:function(){return R()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return C()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return C()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return C()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(e,t){return C()&&this.canPlayMediaType(this.VIDEO,e,t||!1)},canPlayAudioType:function(e,t){return C()&&this.canPlayMediaType(this.AUDIO,e,t||!1)},canPlayMediaType:function(e,t,i){var n=e===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return i=1==i,typeof n===this.OBJECT&&typeof n.canPlayType===this.FUNCTION&&(i&&n.canPlayType(t)===this.PROBABLY||!i&&""!==n.canPlayType(t))?!0:!1},canPlayType:function(e,t){t=1==t;var i=/audio\//,n=i.test(e)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof n===this.OBJECT&&typeof n.canPlayType===this.FUNCTION&&(t&&n.canPlayType(e)===this.PROBABLY||!t&&""!==n.canPlayType(e))?!0:!1},nativeCanPlayType:function(e,t){var i=e===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof i===this.OBJECT&&typeof i.canPlayType===this.FUNCTION?i.canPlayType(t)||null:null},canPlayDASHType:function(e){if(typeof e!==this.STRING||e.length<1)return null;var t=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(e)&&this.hasMSE()&&t.isTypeSupported(e)},canPlayDASH264:function(e){return e=typeof e===this.STRING?e:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(e)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var e="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return e&&!e.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return typeof this._fullscreenEventName===this.STRING},getFullscreenEventName:function(){return this._fullscreenEventName},getDevice:function(){return r?r:null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(e){var t=/\.m3u/i,i=t.test(e);return i},isDashUrl:function(e){var t=/\.mpd/i,i=t.test(e);return i},isSecure:function(){return E},setUrlProtocol:function(e){return E?e.replace("http:","https:"):e}},b=function(){var e=/\s(\([^)]+\))/,t=new RegExp(e),i=t.exec(y.getUserAgent());i&&i.length&&i.length>1&&(i=i[1].replace(/_/gi,"."),S(i)||I(i)||A(i)||P(i))},A=function(e){if(-1!==e.indexOf(y.LINUX)||-1!==e.indexOf(y.ANDROID)){if(o=y.LINUX,-1!==e.indexOf(y.ANDROID)){var t=/\ Android\ ([^\s]+);/,i=new RegExp(t);e=i.exec(e),r=y.ANDROID,l=y.ANDROID,d=e&&e[1]?e[1]:""}return!0}return!1},S=function(e){var t,i,n="like Mac OS X";if(-1!==e.indexOf(y.MAC))return o=y.MAC,r=y.DESKTOP,-1!==e.indexOf(y.OSX)&&(t=/Mac\ OS\ X\ ([\d\.]+)/,i=new RegExp(t),e=i.exec(e),l=y.OSX,d=e&&e[1]?e[1]:null),!0;if(-1!==e.indexOf(n)){o=y.MAC,l=y.IOS;var s=/\(iPhone;/,a=/\(iPad;/,u=/\(iPod;/;i=/\sOS\s([^\s]*)\s/;var h=i.exec(e);if(h&&h[1]&&(d=h[1]),s.test(e))r=y.IPHONE;else if(a.test(e))r=y.IPAD;else{if(!u.test(e))return!1;r=y.IPOD}return!0}return!1},I=function(e){var t=/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/,i=/Windows\ NT\ ([^\s]+)[;\)]/,n=new RegExp(t);if(e=n.exec(y.getUserAgent()),e&&e[2])return o=y.WINDOWS,l=y.WINDOWS_PHONE,d=e[2],r=y.PHONE,!0;if(n=new RegExp(i),e=n.exec(y.getUserAgent()),e&&e[1]){o=y.WINDOWS,l=y.WINDOWS;var s=e[1];return 6==s?l=y.WINDOWS_VISTA:6.1==s?(l=y.WINDOWS7,d=7):6.2==s?(l=y.WINDOWS8,d=8):10==parseInt(s)&&(l=y.WINDOWS10,d=s),r=y.DESKTOP,!0}return!1},D=function(){return T()?!0:M()?!0:L()?!0:w()?!0:O()?!0:k()?!0:N()?!0:!1},C=function(){return s},R=function(){return a},T=function(){var e=/Chrome\/(\S+)/,t=/(Opera|OPR)/,i=/Edge/,n=/CrKey/,s=e.test(y.getUserAgent())&&!t.test(y.getUserAgent())&&!i.test(y.getUserAgent())&&!n.test(y.getUserAgent());return s?(y.setBrowserVersion(y.CHROME,e),!0):!1},P=function(){return null!=y.getUserAgent()&&y.getUserAgent().indexOf(y.CHROMECAST_USER_AGENT)>-1?(o=y.LINUX,r=y.CHROMECAST,l=y.ANDROID,!0):!1},M=function(){var e=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,t=/\ Edge\/([^\s]+)/,i=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return e.test(y.getUserAgent())?(y.setBrowserVersion(y.IE,e),!0):t.test(y.getUserAgent())?(y.setBrowserVersion(y.EDGE,t),!0):i.test(y.getUserAgent())?(y.setBrowserVersion(y.IE,i),!0):!1},L=function(){var e=/Firefox\/(\S+)/;return e.test(y.getUserAgent())?(y.setBrowserVersion(y.FIREFOX,e),!0):!1},w=function(){var e,t=/Version\/(\S+).*Safari\//,i=t.test(y.getUserAgent());return e=l===y.ANDROID?y.ANDROID:y.SAFARI,i?(y.setBrowserVersion(e,t),!0):!1},O=function(){var e=/Opera|OPR\/(\S+)/,t=new RegExp(e),i=t.exec(y.getUserAgent());if(i){var n=-1!==i.indexOf("Opera Mini/")||-1!==i.indexOf("Opera Mobi")?y.OPERA_MOBILE:y.OPERA;return y.setBrowserVersion(n,/Opera|OPR\/(\S+)/),!0}return!1},k=function(){var e=/Silk/i;return e.test(y.getUserAgent())?(y.setBrowserVersion(y.AMAZON_KINDLE,/Silk\/(\S+)/),!0):!1},N=function(){var e=/Android/,t=e.test(y.getUserAgent());return t?(h=y.ANDROID_BROWSER,!0):!1},U=function(){var e=C();e.msRequestFullscreen?y._fullscreenEventName=y.getBrowserVersion()<12?y.FULLSCREEN_MICROSOFT:y.FULLSCREEN_DEFAULT:e.webkitRequestFullscreen?y._fullscreenEventName=y.FULLSCREEN_WEBKIT:e.mozRequestFullScreen?y._fullscreenEventName=y.FULLSCREEN_MOZILLA:e.requestFullscreen?y._fullscreenEventName=y.FULLSCREEN_DEFAULT:e.webkitSupportsFullscreen?y._fullscreenEventName=y.FULLSCREEN_WEBKIT:y._fullscreenEventName=null};return y},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CAPTIONS_MANAGER:"CaptionsManager",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",
VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",DASHJS_LEVEL:"DASHJS_LEVEL",DASHJS_FRAG:"DASHJS_FRAG",DASHJS_FRAME_DROP:"DASHJS_FRAME_DROP"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(e){this.DEBUG_ID=this.configParams.DEBUG_MANAGER;var t=uvpjs._;if(!t.isObject(e))return void this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.");this.cookie=this._getCookie(),this.CDO=e,this.isEnabled=this.cookie.enabled===!0||this._isEnabled(),this.showAll=this.cookie.showAll===!0||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=this.cookie.showTimestamps===!0||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=this.cookie.showClockTime===!0||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),uvpjs.log(this.DEBUG_ID,"initialize this",this);var i=uvpjs.mediaCapabilities;this.supportsFormatting=i.isChrome()||i.isFirefox()||i.isSafari(),this._setupTime()},setSessionStartTime:function(e){this.sessionStartTime=e,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(e,t,i){var n=uvpjs._;if(this.isEnabled||n.isUndefined(this.CDO)){if(!n.isString(e)||!n.isString(t)||n.isUndefined(i))return void console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+i,t);if(this.showAll||n.isUndefined(this.CDO)||this.isParamEnabled(t)||this.cookie[t]===!0){var s=this.showTimestamps?"["+this._timestamp()+"] ":"",a=n.drop(arguments,3),r=n.isEmpty(a)?"":a,o={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[e]("%sUVPJS %s %s",s,t,i,r);console[e]("%s%cUVPJS %c%s%c %s",s,o.bold,o.underline,t,o.normal,i,r)}}},isParamEnabled:function(e){return this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,e)===!0},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return window.console?this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)===!0:!1},_timestamp:function(){var e=uvpjs._,t=new Date,i=t-this.adjustedStartTime,n=i%1e3;i=(i-n)/1e3;var s=i%60;i=(i-s)/60;var a=i%60;i=(i-a)/60;var r=i%24-this.adjustedTimezone;return e.padStart(r,2,"0")+":"+e.padStart(a,2,"0")+":"+e.padStart(s,2,"0")+"."+e.padStart(n,3,"0")},_getCookie:function(){var e=this._readCookie(this.COOKIE_NAME),t={};if(!e)return t;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",e);try{t=JSON.parse(e)}catch(i){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",i)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",t),t},_readCookie:function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0,s=i.length;s>n;n++){for(var a=i[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null},debugMessage:function(e){if(!this.isEnabled){var t="";this.isTimeStamped&&(t=Date.now()+" "),console.log(t+"DebugManager msgStr = "+e)}}},function(e){var t=e._;e.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(){uvpjs.log(this.DEBUG_ID,"init"),this._DOMReadyCB=null,this._areControlsRequired=!1,this.dom={outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}},initialize:function(e,t,i,n){uvpjs.log(this.DEBUG_ID,"initialize"),this.dom.outer.id=e,this._DOMReadyCB=n,this._areControlsRequired=t,this._areAdsRequired=i,this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._isIOS=this.mc.isIOS(),this._setupDOM()},getDOM:function(){return t.clone(this.dom)},_disableContextMenu:function(){return this.dom.video.el.addEventListener?void this.dom.video.el.addEventListener("contextmenu",function(e){e.preventDefault()},!1):void this.dom.video.el.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){return this.dom.outer.el=document.getElementById(this.dom.outer.id),t.isNull(this.dom.outer.el)?void uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",this.dom.outer.id):(this.dom.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),this.dom.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),this.dom.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),this.dom.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),this.dom.content.el=this._getOrCreateElement("content"),this.dom.outer.el.insertBefore(this.dom.content.el,this.dom.outer.el.firstChild),this._createVideoElement(),this._areAdsRequired&&(this._useSeparateTags=this._useSeparateTagsForIMA(),this.dom.ad.el=this._getOrCreateElement("ad"),this.dom.outer.el.insertBefore(this.dom.ad.el,this.dom.content.el.nextSibling)),this._areControlsRequired?(this.dom.controls.el=this._getOrCreateElement("controls"),this.dom.outer.el.appendChild(this.dom.controls.el)):this._addInlineStyles(),this._disableContextMenu(),this.mc.isMobile()&&!this.mc.isChromecast()?void this._createPlaceholderContent():void this._DOMReadyCB())},_createVideoElement:function(){var e=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),i=document.querySelectorAll(e);if(!(t.isObject(i)&&i.length&&t.isObject(i[0])&&i[0].id)){if(e=[this.dom.outer.id,this.dom.video.id].join(" "),i=document.querySelectorAll(e),t.isObject(i)&&i.length&&t.isObject(i[0])){if(i[0].id)return;return i[0].id=this.dom.video.id,void this.dom.content.el.appendChild(i[0])}this.dom.video.el=this._getOrCreateElement("video"),this.dom.content.el.appendChild(this.dom.video.el)}},_createPlaceholderContent:function(){uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this._isIOS?this.mc.PLACEHOLDER_M3U8_URL:this.mc.PLACEHOLDER_MP4_URL,this._useSeparateTags||t.isNull(this._userAgent)&&this.mc.isIPhone()?this.dom.video.el.innerHTML='<source src="'+this.dom.video.url+'">':this.dom.video.el.src=this.dom.video.url,t.bindAll(this,"_handleEvent"),this.dom.video.el.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),this.dom.video.el.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),this.dom.video.el.addEventListener(this.CAN_PLAY,this._handleEvent,!1),this.dom.video.el.addEventListener(this.PLAY,this._handleEvent,!1),this.dom.video.el.addEventListener(this.PAUSE,this._handleEvent,!1),this.dom.video.el.style.width="100%",this._DOMReadyCB()},_handleEvent:function(e){if(uvpjs.log(this.DEBUG_ID,"_handleEvent",e),!t.isNull(this.dom.video.el)){var i=this._useSeparateTags?this.dom.video.el.getElementsByTagName("source")[0]:this.dom.video.el;if(!t.isNull(i)){if(e.type===this.LOADED_METADATA&&(uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._areAdsRequired&&this._useSeparateTags,uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,e.target),this.dom.video.el.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===i.src.indexOf(this.dom.video.url))return this.dom.video.el.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),this.dom.video.el.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),this.dom.video.el.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),this.dom.video.el.removeEventListener(this.PLAY,this._handleEvent,!1),void this.dom.video.el.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(e.type){case this.CAN_PLAY:uvpjs.log(this.DEBUG_ID,"removeEventListener",this.CAN_PLAY),this.dom.video.el.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),this.dom.video.el.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:uvpjs.log(this.DEBUG_ID,"removeEventListener",this.CAN_PLAY_THROUGH),this.dom.video.el.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(uvpjs.log(this.DEBUG_ID,"removeEventListener",this.PLAY),this.dom.video.el.removeEventListener(this.PLAY,this._handleEvent,!1),this.dom.video.el.pause(),!t.isFunction(this.dom.video.callback)){uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:uvpjs.log(this.DEBUG_ID,"removeEventListener",this.PAUSE),this.dom.video.el.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_useSeparateTagsForIMA:function(){return t.isNull(this._userAgent)?!0:this.mc.isChromecast()||this._isIOS||this._userAgent.indexOf("Android 2.")>-1||this._userAgent.indexOf("Android 4.0")>-1||this._userAgent.indexOf("Android 4.1")>-1?!1:!0},_addInlineStyles:function(){this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._areAdsRequired&&(this.dom.ad.el.style.position="absolute",this.dom.ad.el.style.width="100%",this.dom.ad.el.style.height="100%",this.dom.ad.el.style.left="0",this.dom.ad.el.style.top="0")},_getIdByPrefix:function(e){return t.isNull(e)?void 0:uvpjs.domConstants[e]+this.dom.outer.id},_getOrCreateElement:function(e){var i=this.dom[e],n=document.getElementById(i.id);return t.isNull(n)&&(uvpjs.log(this.DEBUG_ID,"Creating element <"+i.type+' id="'+i.id+'">.'),n=document.createElement(i.type),n.id=i.id),n}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",contentVideoStateDefaults:{abrInfo:[],assetId:"",assetURL:"",altURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:"",episodeNumber:"",episodeTitle:"",fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,keywords:"",mediaId:"",pid:"",restrictionCheckResult:"",resumeTime:0,seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:"",videoTitle:""},contentPlaybackStateDefaults:{abrInfo:[],averageDroppedFPS:0,bufferLength:0,curMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxABRLevel:-1,minABRLevel:-1,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"pre_0_1",adParameters:"",adPosition:1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isLinear:!0,isRewindable:!1,isCustomClickTrackingUsed:!1,sourceHeight:0,sourceWidth:0},adPlaybackStateDefaults:{currentTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,t.assign(this.contentVideoState,this.contentVideoStateDefaults),t.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults),t.assign(this.adVideoState,this.adVideoStateDefaults),t.assign(this.adPlaybackState,this.adPlaybackStateDefaults),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.abrStartIndex=-1,this.adNum=0,this.medNum=0,this.isCurrVideoAd=!1,this.adPods={},this.dwPageParams={},"undefined"==typeof DW||t.isUndefined(DW.pageParams)||(this.dwPageParams=DW.pageParams)},initialize:function(e,i,n,s){return t.isString(e)&&t.isObject(i)&&t.isObject(n)?(uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+e),this.vidContId=e,this.cviMgr=i,this.CDO=n,this.sessionOptions=s,this.eventsMgr=i.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),void this.mergeCDOData()):void uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN")},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(e){if(t.isPlainObject(e)&&e.target===this.vidContId&&t.isNumber(e.payload.newState)){uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+e.payload.newState);var i=e.payload.newState;(i===uvpjs.mediaCapabilities.EMPTY||i===uvpjs.mediaCapabilities.LOADING||i===uvpjs.mediaCapabilities.STOPPED||i===uvpjs.mediaCapabilities.PLAYING||i===uvpjs.mediaCapabilities.PAUSED||i===uvpjs.mediaCapabilities.BUFFERING)&&(this.playbackState=i,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(e){e.target===this.vidContId&&(this.isCurrVideoAd=e.payload.isAd,this.playbackState=e.payload.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=e.payload.currentTime,this.adPlaybackState.duration=e.payload.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=e.payload.playbackStarted,this.adPlaybackState.playbackComplete=e.payload.playbackComplete,this.adPlaybackState.sourceBitrate=e.payload.sourceBitrate,this.adPlaybackState.playbackBitrate=e.payload.playbackBitrate,this.adPlaybackState.errorInfo=e.payload.errorInfo,this.adPlaybackState.lastSecondCompleted=e.payload.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=e.payload.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=e.payload.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=e.payload.playbackStarted,this.contentPlaybackState.playbackComplete=e.payload.playbackComplete,this.contentPlaybackState.sourceBitrate=e.payload.sourceBitrate,this.contentPlaybackState.playbackBitrate=e.payload.playbackBitrate,this.contentPlaybackState.videoFramerate=e.payload.videoFramerate,this.contentPlaybackState.isSeeking=e.payload.isSeeking,this.contentPlaybackState.isHDStreamLive=e.payload.isHDStreamLive,this.contentPlaybackState.isPlayingLive=e.payload.isPlayingLive,this.contentPlaybackState.currentContentSegment=e.payload.currentContentSegment,this.contentPlaybackState.curMaxBandwidth=e.payload.curMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=e.payload.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=e.payload.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=e.payload.lastPercentageCompleted,this.contentPlaybackState.bufferLength=e.payload.bufferLength,this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=e.payload.facadeState))},onVideoVolumeChange:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&t.isNumber(e.payload.vol)&&(this.volume=e.payload.vol,uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&(uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&(uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(e){t.isPlainObject(e)&&e.target===this.vidContId&&(this.isFullscreen=e.payload.isFs)},onContextMetadata:function(e){!t.isPlainObject(e)||e.target!==this.vidContId||!t.isPlainObject(e.target.contextMetadata)},getValueForKey:function(e){var i=void 0;return e&&t.isString(e)&&this.hasOwnProperty(e)&&!t.isFunction(this[e])&&(i=this[e]),i},getModule:function(e){return t.isString(e)?this.CDO.getModule(e):void 0},getModuleParam:function(e,i){return t.isString(e)&&t.isString(i)?this.CDO.getModuleParam(e,i):void 0},getModules:function(){return this.CDO.getModules()},isModuleEnabled:function(e){return e&&t.isString(e)?this.CDO.isModuleEnabled(e):!1},getClass:function(e){return t.isString(e)?this.CDO.getClass(e):void 0},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(e,t){return this.CDO.getClassProperty(e,t)},getClassListItems:function(e){return this.CDO.getClassListItems(e)},getClassListItemProperty:function(e,t,i){return this.CDO.getClassListItemProperty(e,t,i)},getCurrentPlaybackState:function(){var e;return e=this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getContentVideoState:function(){var e={};return t.assign(e,this.contentVideoState),e},getAdVideoState:function(){var e={};return t.assign(e,this.adVideoState),e},getContentPlaybackState:function(){var e={};return t.assign(e,this.contentPlaybackState),e},getAdPlaybackState:function(){var e={};return t.assign(e,this.adPlaybackState),e},setContentVideoStateItems:function(e){if(uvpjs.log(this.DEBUG_ID,"setContentVideoStateItems items = ",e),t.isObject(e))for(var i in this.contentVideoState)e.hasOwnProperty(i)&&!t.isFunction(e[i])&&(this.contentVideoState[i]=e[i])},setContentPlaybackStateItems:function(e){if(!t.isObject(e))return void uvpjs.warn(this.DEBUG_ID,"setContentPlaybackStateItems !_.isObject(items)");for(var i in this.contentPlaybackState)e.hasOwnProperty(i)&&!t.isFunction(e[i])&&(this.contentPlaybackState[i]=e[i])},setAdVideoStateItems:function(e){if(t.isObject(e))for(var i in this.adVideoState)e.hasOwnProperty(i)&&!t.isFunction(e[i])&&(this.adVideoState[i]=e[i])},setAdPlaybackStateItems:function(e){if(t.isObject(e))for(var i in this.adPlaybackState)e.hasOwnProperty(i)&&!t.isFunction(e[i])&&(this.adPlaybackState[i]=e[i])},setNonDefaultContentVideoStateItems:function(e){this.setContentVideoStateItems(this._removeDefaults(e,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(e){this.setAdVideoStateItems(this._removeDefaults(e,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},mergeCDOData:function(){uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var e=this;t.forOwn(this.sessionOptions,function(i,n){return t.isString(i)?t.has(e.contentVideoState,n)?void(e.contentVideoState[n]=i):t.has(e.adVideoState,n)?void(e.adVideoState[n]=i):void 0:void 0}),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState)},_removeDefaults:function(e,i){return t.omitBy(e,function(t,n){return e[n]===i[n]})}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CONFIG_MODULE_NAME:"ClosedCaptions",CONFIG_STYLE_NAME:"configModule",PAGE_INPUT_STYLE_NAME:"pageInput",CSS_CLASS_NAME:".uvpjs__closed-captions",LOAD_VTT_WAIT:50,CAPTIONS_FILES_RANK:0,CONFIG_MODULE_RANK:1,PAGE_INPUT_RANK:2,init:function(){uvpjs.log(this.DEBUG_ID,"init"),this.captions={url:null,xml:null,json:null,cues:[],module:{},styles:{}},this.css={"background-color":"#000000",color:"#FFFFFF","font-family":"Arial, sans-serif","font-size":"18px","font-weight":"normal",opacity:"1","text-decoration":"none","text-shadow":"none"}},initialize:function(e){uvpjs.log(this.DEBUG_ID,"initialize"),this.CVIModel=e,this.eventsMgr=this.CVIModel.eventsMgr,this.mc=uvpjs.mediaCapabilities,this.video=null,this.track=null,this.vidContId=this.CVIModel.vidContId,this.internalNS="."+this.vidContId+".captionsMgr",this._supportsVTTCue=!t.isUndefined(window.VTTCue),this._supportsCSS=!this.mc.isFirefox(),this.captions.styles[this.CONFIG_STYLE_NAME]=null,this.captions.styles[this.PAGE_INPUT_STYLE_NAME]=null,this._addEventListeners()},hideCaptions:function(e){e.target===this.vidContId&&t.get(this,"video.textTracks")&&(uvpjs.log(this.DEBUG_ID,"hideCaptions",this.video.textTracks),t(this.video.textTracks).each(function(e){e.mode="hidden"}))},showCaptions:function(e){e.target===this.vidContId&&t.get(this,"video.textTracks")&&(uvpjs.log(this.DEBUG_ID,"showCaptions",this.video.textTracks),t(this.video.textTracks).each(function(e){e.mode="showing"}))},getCaptionsStyle:function(){return uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),t.clone(this.css)},setCaptionsStyle:function(e){if(uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",e),!t.isArray(e)||t.isEmpty(e))return void uvpjs.warn(this.DEBUG_ID,"Captions properties not an array or empty.",e);var i=this.captions.styles[this.PAGE_INPUT_STYLE_NAME];t(e).each(function(e){var t=e.name,n=e.value;return a(t,n)?(this.css[t]=n,i.css[t]=n,void uvpjs.log(this.DEBUG_ID,"setCaptionsStyle name, value, style",t,n,i)):void uvpjs.log(this.DEBUG_ID,"setCaptionsStyle not valid CSS",t,n)}.bind(this)),this._addCSSToDOM()},setCaptionsCueProperty:function(e,i){uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",this.track),e&&i&&this.track&&this._supportsVTTCue&&t.each(this.track.cues,function(t){t[e]=i})},_addEventListeners:function(){var e=this.eventsMgr.eventTypes;this.eventsMgr.addEventListener(e.CONTROL_LOAD_CAPTIONS+this.internalNS,this._onControlLoadCaptions.bind(this)),this.eventsMgr.addEventListener(e.CONTENT_DATA_LOADED+this.internalNS,this._onContentDataLoaded.bind(this)),this.eventsMgr.addEventListener(e.CONTROL_SHOW_CAPTIONS+this.internalNS,this.showCaptions.bind(this)),this.eventsMgr.addEventListener(e.CONTROL_HIDE_CAPTIONS+this.internalNS,this.hideCaptions.bind(this))},_dispatchCaptionsError:function(e){uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:e},this.vidContId)},_dispatchCaptionsReady:function(){uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},_onContentDataLoaded:function(e){if(e.target===this.vidContId){var i=e.payload.vidState.closedCaptionPath;t.isString(i)&&(uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",e.target),this._loadCaptionsUrl(i))}},_onControlLoadCaptions:function(e){if(e.target===this.vidContId){var i=e.payload.url;t.isString(i)&&(uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",e.target),this._loadCaptionsUrl(i))}},_loadCaptionsUrl:function(e){if(t.isString(e)&&!t.isEmpty(e)){var i=t.endsWith(e,".vtt");if(this.captions.url=e,this.video=document.getElementById(this.VIDEO_ID_PREFIX+this.vidContId),this._setCDOParams(),this._createPageInputCSS(),i)return void this._createTrackElement(e);var n=new uvpjs.CodeLoader;n.loadXHR(e,this._onLoadComplete.bind(this),this._onLoadError.bind(this))}},_createTrackElement:function(e){uvpjs.log(this.DEBUG_ID,"_createTrackElement",e);var t=this,i=this.video;-1===e.indexOf(window.location.host)&&(uvpjs.log(t.DEBUG_ID,'_createTrackElement adding crossorigin="use-credentials" to <video> element.'),i.setAttribute("crossorigin","use-credentials"));var n=document.createElement("track");n.kind="captions",n.label="English",n.srclang="en",n.src=e,t.track=n,i.appendChild(n);var s=function(){s.done||(uvpjs.log(t.DEBUG_ID,"_createTrackElement <track> loaded",n),s.done=!0,t._captionsCreated())};n.addEventListener("load",setTimeout(s,t.LOAD_VTT_WAIT)),n.addEventListener("loaded",setTimeout(s,t.LOAD_VTT_WAIT))},_onLoadComplete:function(e){var t=e.responseText;uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",e);try{t=t.replace(/\n/g,""),t=t.substr(t.indexOf("<?xml"));var i=new DOMParser,n=i.parseFromString(t,"text/xml");this._xmlToCues(n)}catch(s){var a="Error parsing closed captions XML.";this._dispatchCaptionsError(a),uvpjs.error(this.DEBUG_ID,a,s)}},_onLoadError:function(e){var t=e.status,i="Unknown error";switch(t){case 404:i="File not found";break;case 500:i="Server error";break;case 0:i="Request aborted"}i+=" "+t,this._dispatchCaptionsError(i),uvpjs.error(this.DEBUG_ID,"onLoadError",i)},_xmlToCues:function(e){var s,a,r,o,l,d,u,h,c,p=this,g=n(e);if(this.captions.xml=e,this.captions.json=g,uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",g),!t.isEmpty(g)&&t.isPlainObject(g)){if(s=t.get(g,"tt.body.div.p"),uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",s),t.isUndefined(s)||t.isEmpty(s))return void uvpjs.warn(this.DEBUG_ID,"No cues found in XML file.");var v=this._supportsVTTCue?window.VTTCue:window.TextTrackCue;if(!v)return void uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions.");if(this.track)for(a=this.track.cues,r=a&&a.length||0;r--;)this.track.removeCue(a[r]);for(o=this.track||this.video.addTextTrack("captions","English","en"),l=s.length,r=0;l>r;r++)u=s[r],d=u.text,t.isEmpty(d)||(d="<c"+p.CSS_CLASS_NAME+">"+d+"</c>",h={begin:i(u.begin),end:i(u.end),text:d},c=new v(h.begin,h.end,h.text),c.snapToLines=!1,o.addCue(c));this.track=o,this._captionsCreated()}},_captionsCreated:function(){try{this._applyCueStyles(),this._addCSSToDOM()}catch(e){this._dispatchCaptionsError(e),uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",e)}this._dispatchCaptionsReady()},_applyCueStyles:function(){var e=this,i=t.get(this.captions.json,"tt.head.styling.style");return uvpjs.log(this.DEBUG_ID,"_applyCueStyles styles",i),t.isUndefined(i)?void uvpjs.log(this.DEBUG_ID,"No styling found in XML file."):(t.isArray(i)||(i=[i]),void t.each(i,function(t){var i={id:t["xml:id"]||t.id,rank:e.CAPTIONS_FILES_RANK,params:{extent:t["tts:extent"],origin:t["tts:origin"]},css:{backgroundColor:t["tts:backgroundColor"],color:t["tts:color"],fontFamily:t["tts:fontFamily"],fontSize:t["tts:fontSize"],fontStyle:t["tts:fontStyle"],fontWeight:t["tts:fontWeight"],textAlign:t["tts:textAlign"],textDecoration:t["tts:textDecoration"]}};e.captions.styles[i.id]=i}))},_addCSSToDOM:function(e){if(uvpjs.log(this.DEBUG_ID,"_addCSSToDOM",e),this._supportsCSS){e=e||t.sortBy(this.captions.styles,"rank"),t.isArray(e)||(e=[e]),t.each(e,this._updateCSSObj.bind(this));var i="#"+this.VIDEO_ID_PREFIX+this.vidContId+"::cue("+this.CSS_CLASS_NAME+")",n=t.map(this.css,function(e,t){return{name:t,value:e}});uvpjs.log(this.DEBUG_ID,"_addCSSToDOM selector, rules",i,n),this._addCSSRules(i,n)}},_setCDOParams:function(){var e=this.CVIModel.getModule(this.CONFIG_MODULE_NAME);if(uvpjs.log(this.DEBUG_ID,"_setCDOParams module",e),!e)return void uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found.");if(this.captions.module=e,e.enabled!==!0)return void uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled.");if(t.isEmpty(e.params))return void uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty.");var i={};i.id=this.CONFIG_STYLE_NAME,i.rank=this.CONFIG_MODULE_RANK,i.css={},i.params={},t.each(e.params,function(e){var t=e.name,n=e.value;if(t&&n){var r=s(t);return a(r,n)?void(i.css[t]=n):void(i.params[t]=n)}}),uvpjs.log(this.DEBUG_ID,"_setCDOParams style",i),this.captions.styles[this.CONFIG_STYLE_NAME]=i},_createPageInputCSS:function(){uvpjs.log(this.DEBUG_ID,"_createPageInputCSS");var e={};e.id=this.PAGE_INPUT_STYLE_NAME,e.rank=this.PAGE_INPUT_RANK,e.css={},e.params={},uvpjs.log(this.DEBUG_ID,"_createPageInputCSS style",e),this.captions.styles[this.PAGE_INPUT_STYLE_NAME]=e},_updateCSSObj:function(e){return e?void t.each(e.css,function(e,i){if(!t.isUndefined(e)&&!t.isUndefined(i)){var n=s(i);return a(n,e)?void(this.css[n]=e):void uvpjs.warn(this.DEBUG_ID,"Unsupported CSS property name or value.",n,e)}}.bind(this)):void uvpjs.log(this.DEBUG_ID,"_updateCSSObj updateStyle empty style object.",e)},_addCSSRules:function(e,i){uvpjs.log(this.DEBUG_ID,"_addCSSRules selector, rules",e,i);var n=document.createElement("style");n.setAttribute("type","text/css"),n.appendChild(document.createTextNode("")),document.head.appendChild(n);var s=n.sheet,a=s.cssRules.length;t(i).each(function(t){var i=t.name+":"+t.value;return s.insertRule?void s.insertRule(e+"{"+i+"}",a):s.addRule?void s.addRule(e,i,a):void 0})}});var i=function(e){if(!t.isNull(e)&&!t.isUndefined(e)){var i=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},n=e.split(":"),s=60*Number(n[0])*60,a=60*Number(n[1]),r=Number(n[2]),o=s+a+r;return i(o,2)}},n=function(e){var i={};if(1===e.nodeType&&e.attributes.length>0)for(var s=0,a=e.attributes.length;a>s;s++){var r=e.attributes.item(s);i[r.nodeName]=r.nodeValue}else 3===e.nodeType&&(i=e.nodeValue);if("p"===e.nodeName&&(i.text="",t.each(e.childNodes,function(e){if("metadata"!==e.nodeName){var t=(new XMLSerializer).serializeToString(e);1===e.nodeType&&(i.text+="br"===e.tagName?"\n":t),3===e.nodeType&&(i.text+=t)}})),e.hasChildNodes())for(var o=0,l=e.childNodes.length;l>o;o++){var d=e.childNodes.item(o),u=d.nodeName;if("undefined"!=typeof i[u]){if("undefined"==typeof i[u].push){var h=i[u];i[u]=[],i[u].push(h)}i[u].push(n(d))}else i[u]=n(d)}return i},s=function(e){return t.isString(e)&&!t.isEmpty(e)?e.replace(/([A-Z])/g,"-$1").toLowerCase():void 0},a=function(e,i){return e&&i?t.get(window,"CSS.supports")?window.CSS.supports(e,i):"string"==typeof document.createElement("div").style[e]:void 0}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CodeLoader=uvpjs.Class.subClass({init:function(){this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.intervalHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,this.clearInterval(this.intervalHandle),this.intervalHandle=null},loadScript:function(e,i,n){var s,a;for(uvpjs.log(this.DEBUG_ID,"loadScript urls",e),this.scriptsLoadedCB=i,this.timeout=n||this.REQUEST_TIMEOUT,t.isString(e)&&this.urls.push(e),t.isArray(e)&&(this.urls=e),a=this.urls.length,s=0;a>s;s++)this._getScript(this.urls[s])},_getScript:function(e){uvpjs.log(this.DEBUG_ID,"_getScript url",e);var i=this,n=function(e){return!t.isFunction(i._onScriptLoaded)||i._onScriptLoaded.done?void uvpjs.warn(i.DEBUG_ID,"_getScript _doCallback callback not a function or already called."):(i.urls=t.without(i.urls,e),
void i._onScriptLoaded())},s=document.createElement("script");s.src=this._setUrlProtocol(e),s.async=!0,s.onreadystatechange=s.onload=function(){(!s.readyState||/loaded|complete/.test(s.readyState))&&n(e)},s.onerror=function(t){uvpjs.error(i.DEBUG_ID,"_getScript "+t.target.src+" is not accessible."),n(e)},document.querySelector("head").appendChild(s),this.intervalHandle=setInterval(function(e){var s=-1===t.indexOf(i.urls,e);s||(uvpjs.warn(i.DEBUG_ID,"_getScript request timeout! Aborting setup."),n(e))},this.timeout)},_onScriptLoaded:function(){uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var e=t.isEmpty(this.urls);uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),e&&t.isFunction(this.scriptsLoadedCB)&&(uvpjs.log(this.DEBUG_ID,"loadAgentPlugins _pluginsLoaded all loaded."),this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB())},createCORSRequest:function(e,t){var i=new XMLHttpRequest;return t=this._setUrlProtocol(t),"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(e,t)):i=!1,i},loadXHR:function(e,i,n){e=this._setUrlProtocol(e);var s=this.createCORSRequest("GET",e);if(s===!1){var a="loadXHR CORS not supported for url = "+e;return uvpjs.warn(this.DEBUG_ID,a),void n(s)}s.timeout=this.REQUEST_TIMEOUT,s.onload=function(){return t.inRange(s.status,200,400)?void i(s):void n(s)},s.onerror=function(){n(s)},s.ontimeout=function(){n(s)},s.send()}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(){this.vidContId="",this.eventsMgr={},this.cviModel={},this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.contentInitializedForIMA=!1,this.adVideoDiv={}},initialize:function(e,i,n,s){uvpjs.log(this.DEBUG_ID,"initialize vidContId = ",e),t.isString(e)&&t.isObject(i)&&t.isObject(n)&&(this.vidContId=e,this.eventsMgr=i,this.cviModel=new uvpjs.CVI_Model,this.cviModel.initialize(e,this,n,s),this.RPM=new uvpjs.ResourcePlaylistManager,this.RPM.initialize(e,this),this.trackingMgr=new uvpjs.TrackingManager,this.trackingMgr.initialize(e,this),this.captionsMgr=new uvpjs.CaptionsManager,this.captionsMgr.initialize(this.cviModel))},constructSharedIMAClasses:function(){return uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses"),"undefined"==typeof google?void uvpjs.warn(this.DEBUG_ID,"constructSharedIMAClasses google IMA SDK not loaded"):t.isEmpty(this.imaAdDisplayContainer)?(this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer),this.adsLoader.getSettings().setAutoPlayAdBreaks(!0),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),void this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)):void uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed")},_createIMAAdDisplayContainer:function(){uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer");var e={};this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId);var t=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),i=t.getElementsByTagName("video")[0],n=document.getElementById(uvpjs.domConstants.AD_LEARNMORE_ID_PREFIX+this.vidContId);return e=new google.ima.AdDisplayContainer(this.adVideoDiv,i,n),uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",e),e},onAdsManagerLoaded:function(e){return uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded adsManagerLoadedEvent = ",e),t.isEmpty(this.RPM)||t.isEmpty(this.RPM.currRP)?void uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded _.isEmpty(this.RPM) || _.isEmpty(this.RPM.currRP)  RETURN   unable to call   this.RPM.currRP.onAdsManagerLoaded(adsManagerLoadedEvent);"):void this.RPM.currRP.onAdsManagerLoaded(e)},onAdError:function(e){return uvpjs.log(this.DEBUG_ID,"onAdError adErrorEvent = ",e),t.isEmpty(this.RPM)||t.isEmpty(this.RPM.currRP)?void uvpjs.log(this.DEBUG_ID,"onAdError _.isEmpty(this.RPM) || _.isEmpty(this.RPM.currRP)  RETURN   unable to call   this.RPM.currRP.onAdError(adErrorEvent);"):void(e&&this.RPM.currRP.onAdError(e))},destroyIMAAdsLoader:function(){uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(e){uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",e),this.RPM.loadDynamicAdCall(e)},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(){uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,{},this.vidContId)},seekToRequest:function(e){uvpjs.log(this.DEBUG_ID,"seekToRequest = "+e),t.isNaN(e)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:e},this.vidContId)},stopVideoRequest:function(){uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){uvpjs.log(this.DEBUG_ID,"mute"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(e){uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",e),t.isNaN(e)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:e},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(e){uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",e),t.isString(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:e},this.vidContId)},showCaptionsRequest:function(){uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{},this.vidContId)},hideCaptionsRequest:function(){uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},setCaptionsStyleRequest:function(e){uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",e),this.captionsMgr.setCaptionsStyle(e)},setCaptionsCuePropertyRequest:function(e,t){uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",e,t),this.captionsMgr.setCaptionsCueProperty(e,t)},getCaptionsStyleRequest:function(){return uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getCaptionsStyle()},resizeRequest:function(e,i){uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+e+"  height = "+i),!t.isNaN(e)&&!t.isNaN(i)&&e>=0&&i>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:e,height:i},this.vidContId)},fullscreenRequest:function(e){uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",e),t.isBoolean(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:e},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){var e=this.cviModel.getContentVideoState();return e},getAdVideoData:function(){var e=this.cviModel.getAdVideoState();return e},setPageContextMetadata:function(e){uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",e),t.isPlainObject(e)},setNativeControls:function(e){uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",e),t.isBoolean(e)&&(this.cviModel.nativeControls=e)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,registeredEventsTable:{},timerCBOs:[],sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,internalNS:"EventsManager",init:function(){this._startUVPJSClock(this.uvpjsClockInterval)},addEventListener:function(e,i){if(!(e&&t.isString(e)&&i&&t.isFunction(i)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var n=this._returnValidEvtTypeAndNameSpace(e);if(n===!1)return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE do not addListener RETURN"},this.internalNS);var s=n[0],a=n[1];return this.registeredEventsTable[s]||(this.registeredEventsTable[s]={}),this.registeredEventsTable[s][a]?(uvpjs.warn(this.DEBUG_ID,"addEventListener               DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",s," ns = ",a),void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN"},this.internalNS)):(uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",s," ns = ",a),void(this.registeredEventsTable[s][a]=i))},removeEventListener:function(e){if(!e||!t.isString(e))return uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",e),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var i=this._returnValidEvtTypeAndNameSpace(e);if(i===!1)return uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",e),void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE do not addListener RETURN"},this.internalNS);var n=i[0],s=i[1];return this.registeredEventsTable[n]&&this.registeredEventsTable[n][s]?(uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",e),void delete this.registeredEventsTable[n][s]):(uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",e),void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeEventListener name space not found in this.registeredEventsTable[evtType][ns] RETURN"},this.internalNS))},dispatchEvent:function(e,i,n){var s={};if(!e||!t.isString(e))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent evtType MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*"},this.internalNS);if(!t.isUndefined(i)&&!t.isPlainObject(i))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);if(!t.isUndefined(n)&&!t.isString(n))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);var a=this.registeredEventsTable[e];if(a){t.isUndefined(i)&&(i={}),t.isUndefined(n)&&(n=""),s.type=e,s.payload=i,s.target=n;for(var r in a)a.hasOwnProperty(r)&&a[r](s)}},_returnValidEvtTypeAndNameSpace:function(e){var t=[],i=e.split(".");if(i.length<2)return!1;var n=i[0];i.shift();var s=i.join("_");return!this._validateEventType(n)||s.indexOf("undefined")>-1?!1:(t[0]=n,t[1]=s,t)},_validateEventType:function(e){var t=!1,i=this.eventTypes;for(var n in i)if(i.hasOwnProperty(n)&&i[n]===e){t=!0;break}return t},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(e){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),e)},destroyUVPJSClock:function(){uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(e,i,n,s){uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",i);var a={};if(!e||!t.isNumber(e)||!i||!t.isString(i)||!n||!t.isFunction(n)||s&&!t.isNumber(s)&&(s>=1||-1===s))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);e<this.uvpjsClockInterval&&(e=this.uvpjsClockInterval);var r=i.split(".");i=r.join("_"),a={freq:e,ns:i,cb:n,rptCnt:-1,nextTime:Date.now()+e},s&&(a.rptCnt=s),uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",e),this.timerCBOs.push(a)},removeTimedEventCallback:function(e,i){if(uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",e+" ns = "+i),!(e&&t.isNumber(e)&&i&&t.isString(i)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var n,s,a=i.split(".");for(i=a.join("_"),n=this.timerCBOs.length-1;n>=0;n--)s=this.timerCBOs[n],s.freq===e&&s.ns===i&&(uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",s.freq+" CBO.ns = "+s.ns),this.timerCBOs.splice(n,1))},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;var e,t,i=Date.now();for(e=this.timerCBOs.length-1;e>=0;e--)t=this.timerCBOs[e],i>=t.nextTime&&(t.cb(),t.nextTime=i+t.freq,-1!==t.rptCnt&&(t.rptCnt=t.rptCnt-1,0===t.rptCnt&&this.timerCBOs.splice(e,1)))},eventTypes:{UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_ERROR:"onCaptionsError",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_ERROR:uvpjs.EventType.VIDEO_ERROR,VIDEO_CUEPOINT:"onVideoCuePoint",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",BITRATE_SWITCH_REQUEST:"bitrateSwitchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"videoTransisionStart",VIDEO_TRANSITION_COMPLETE:"videoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest"}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(){this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.mc=uvpjs.mediaCapabilities,this.playlistPaused=!1},initialize:function(e,i){return uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",e),t.isString(e)&&t.isObject(i)?(this.vidContId=e,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",void this._addEventListeners()):void uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS")},onResourceLoadRequest:function(e){if(e.target===this.vidContId){uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",e.payload.rcObj),this.playlistPaused=!1;var t=this._createResourceProvider(e.payload.rcObj);this.rscProviders.unshift(t),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(e){if(e.target===this.vidContId){uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",e.payload.rcObjs);var i,n,s=e.payload.rcObjs;for(i in s)n=this._createResourceProvider(s[i]),this.rscProviders.push(n);t.isEmpty(this.currRP)&&(uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(e){e.target===this.vidContId&&uvpjs.log(this.DEBUG_ID,"onResourceRemoveRequest this.vidContId = ",this.vidContId)},onResourcePlaylistPause:function(e){uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),e.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(e){e.target===this.vidContId&&this.playlistPaused&&(uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,t.isEmpty(this.currRP)&&this.rscProviders.length>0&&(uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(e){e.target===this.vidContId&&(uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.playlistPaused=!1,this.playlistInterruptionCleanup())},onResourcePlaylistDestroy:function(e){e.target===this.vidContId&&(uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup())},loadDynamicAdCall:function(e){uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",e),t.isEmpty(this.currRP)||this.currRP.rco.type!==this.mc.RP_IMA?uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(e)},playlistInterruptionCleanup:function(){uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),t.isEmpty(this.currRP)||t.isNull(this.currRP.rco)?(uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(e){uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",e);var t;switch(e.type){case this.mc.RP_URL:t=new uvpjs.RP_URL;break;case this.mc.RP_PLATFORM:t=new uvpjs.RP_Platform;break;case this.mc.RP_IMA:t=new uvpjs.RP_IMA;break;case this.mc.RP_MDIALOG:t=new uvpjs.RP_Mdialog}return t.initialize(e,this.cviMgr,this.vidContId),t},_loadNextRP:function(){uvpjs.log(this.DEBUG_ID,"_loadNextRP                           this.rscProviders.length = ",this.rscProviders.length),uvpjs.log(this.DEBUG_ID,"_loadNextRP                                this.playlistPaused = ",this.playlistPaused),t.isEmpty(this.currRP)||t.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(e){return uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),t.isObject(this.currRP)?void this.currRP.loadVideoAndBeginPlayback():(uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.onResourcePlaylistAdvance())},rpDataLoadErrorCB:function(e){uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",e),this.onResourcePlaylistAdvance()},resourceStart:function(e){uvpjs.log(this.DEBUG_ID,"resourceStart                                                       dispatch        RESOURCE_START         rcoSeed = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:e},this.vidContId)},resourceEnd:function(e){uvpjs.log(this.DEBUG_ID,"resourceEnd                                                         dispatch        RESOURCE_END             rcoSeed = ",e),uvpjs.log(this.DEBUG_ID,"resourceEnd                                                         dispatch                         this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:e,playlistLength:this.rscProviders.length},this.vidContId),uvpjs.log(this.DEBUG_ID,"resourceEnd                                                         dispatch                 AFTER   this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!t.isEmpty(this.currRP)&&t.isNull(this.currRP.rco)&&(uvpjs.log(this.DEBUG_ID,"resourceEnd                                                         dispatch                        _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.VideoControlInterface=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,init:function(){this.vciReadyCB={},this.skinMgr={},this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null},initialize:function(e,i,n,s,a){var r;return uvpjs.log(this.DEBUG_ID,"initialize vidContId =",e),t.isString(e)&&t.isObject(i)&&t.isObject(n)&&t.isFunction(s)?(this.vidContId=e,this.eventsMgr=i,this.vciReadyCB=s,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager,this.CVI_Mgr.initialize(e,i,n,a),r={skin:a.skin,autoPlay:a.autoPlay,customCSS:a.customCSS,previewImage:a.previewImage},this._isMobile=this.mc.isMobile(),this._loadSkinFlag=r.skin===!0,this._autoPlay=!this._loadSkinFlag||r.autoPlay===!0&&!this._isMobile,this._usesIMA=a.usesIMA,this.DOMMgr=new uvpjs.DOMManager,void this.DOMMgr.initialize(this.vidContId,this._loadSkinFlag,this._usesIMA,this.onDOMReady.bind(this,r))):void uvpjs.log(this.DEBUG_ID,"-")},onDOMReady:function(e){return this.dom=this.DOMMgr.getDOM(),this._loadSkinFlag?void(this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:e})):void this.onVCIReady()},onVCIReady:function(){uvpjs.log(this.DEBUG_ID,"onVCIReady"),this._vciReadySent||(!this._loadSkinFlag||this._autoPlay||this._previewButtonDone)&&(this._usesIMA&&!this._isMobile&&(uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this._vciReadySent=!0,this.vciReadyCB(this))},loadDynamicAdCall:function(e){return uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",e),t.isString(e)?void this.CVI_Mgr.loadDynamicAdCall(e):void uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)")},onPreviewButton:function(e){return uvpjs.log(this.DEBUG_ID,"onPreviewButton"),t.isFunction(e)?(this._usesIMA&&(uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this._isMobile&&!this._playBlankVideoDone?(uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=e,void this.playBlankVideo()):(uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),void e())):void uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function.")},addEventListener:function(e,i){return e&&t.isString(e)&&t.isFunction(i)?void this.eventsMgr.addEventListener(e,i):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId)},removeEventListener:function(e){return e&&t.isString(e)?void this.eventsMgr.removeEventListener(e):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.dom.video.el.load(),this.dom.video.el.play(),this.dom.video.callback=function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo callback"),this._playBlankVideoDone=!0,this._playBlankVideoCallback()}.bind(this)},loadAndPlayResource:function(e){if(uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",e),this._isMobile&&!this._playBlankVideoDone)return uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,e),void this.playBlankVideo();var i=this.createResourceConfig(e);t.isObject(i)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:i},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(e){if(uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",e),this._isMobile&&!this._playBlankVideoDone)return uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,e),void this.playBlankVideo();if(t.isArray(e)&&e.length>0){var i,n,s=[];for(i in e)n=this.createResourceConfig(e[i]),t.isObject(n)?s.push(n):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);s.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:s},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(e){uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",e);var i,n="";if(!t.isPlainObject(e))return n="VideoControlInterface createResourceConfig INVALID rcObj argument is not a Plain Object RETURN FALSE this.vidContId = "+this.vidContId,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:n},this.vidContId),!1;if(!t.isString(e.type))return n="VideoControlInterface createResourceConfig MISSING or NON-STRING rcObj.type this.vidContId = "+this.vidContId,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:n},this.vidContId),!1;switch(this.rcoIdIndex++,e.id=this.rcoIdIndex+"_"+this.vidContId,e.vidContId=this.vidContId,e.type){case this.mc.RP_URL:i=new uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:i=new uvpjs.RCO_Platform;break;case this.mc.RP_IMA:i=new uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:i=new uvpjs.RCO_Mdialog;break;default:return n="VideoControlInterface createResourceConfig UNSUPPORTED Resource Config Object .type value RETURN FALSE this.vidContId = "+this.vidContId+"  rcObj.type = "+e.type,
this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:n},this.vidContId),!1}return i.initialize(e)===!1?(n="VideoControlInterface createResourceConfig INVALID Resource Config Object catch-all RETURN FALSE this.vidContId = "+this.vidContId,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:n},this.vidContId),!1):i},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(e){t.isArray(e)&&e.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:e},this.vidContId)},destroyPlaylist:function(){uvpjs.log(this.DEBUG_ID,"playVideo         dispatch      RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(){uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest()},seekTo:function(e){uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",e),isNaN(e)||this.CVI_Mgr.seekToRequest(e)},stopVideo:function(){uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(e){uvpjs.log(this.DEBUG_ID,"disableButton",e),t.isEmpty(this.skinMgr)||t.isEmpty(e)||this.skinMgr.disableButton(e)},enableButton:function(e){uvpjs.log(this.DEBUG_ID,"enableButton",e),t.isEmpty(this.skinMgr)||t.isEmpty(e)||this.skinMgr.enableButton(e)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(e){t.isNaN(e)||this.CVI_Mgr.volumeChangeRequest(e)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(e){uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",e),t.isString(e)&&this.CVI_Mgr.loadCaptionsRequest(e)},showCaptions:function(){uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest()},hideCaptions:function(){uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},setCaptionsStyle:function(e){uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",e),this.CVI_Mgr.setCaptionsStyleRequest(e)},setCaptionsStyleProperty:function(e,t){uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",e,t),this.CVI_Mgr.setCaptionsStyleRequest([{name:e,value:t}])},getCaptionsStyle:function(){return uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(e,t){uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",e,t),this.CVI_Mgr.setCaptionsCuePropertyRequest(e,t)},setSize:function(e,i){uvpjs.log(this.DEBUG_ID,"setSize  width = "+e+"  height = "+i),t.isNumber(e)||t.isNumber(i)||this.CVI_Mgr.resizeRequest(e,i)},fullscreen:function(e){uvpjs.log(this.DEBUG_ID,"fullscreen onOrOff = ",e),t.isBoolean(e)&&this.CVI_Mgr.fullscreenRequest(e)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},setPageContextMetadata:function(e){e&&t.isPlainObject(e)&&(uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:e},this.vidContId))},removeNativeControls:function(e){uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",e),t.isBoolean(e)&&this.CVI_Mgr.setNativeControls(e)},useDynamicSwitching:function(e){uvpjs.log(this.DEBUG_ID,"HLSJS: useDynamicSwitching:",e),t.isBoolean(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:e},this.vidContId)},switchBitrateUp:function(){uvpjs.log(this.DEBUG_ID,"HLSJS: switchBitrateUp:"),this.switchBitrateTo("up")},switchBitrateDown:function(){uvpjs.log(this.DEBUG_ID,"HLSJS:  switchBitrateDown:"),this.switchBitrateTo("down")},switchBitrateTo:function(e){uvpjs.log(this.DEBUG_ID,"HLSJS: switchBitrateSwitchRequest: idxOrDirection = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.BITRATE_SWITCH_REQUEST,{idxOrDirection:e},this.vidContId)},setMinimumBitrateAllowed:function(e){uvpjs.log(this.DEBUG_ID,"HLSJS: setMinimumBitrateAllowed:",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{idx:e},this.vidContId)},setMaximumBitrateAllowed:function(e){uvpjs.log(this.DEBUG_ID,"HLSJS: setMaximumBitrateAllowed:",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{idx:e},this.vidContId)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.VideoManager=uvpjs.Class.subClass({init:function(){this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,this.internalNS=".Video_Manager",this.VCIs={},this.vidMgrReadyCB={},this.CDO={},this.currActiveVCI={},this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,uvpjs.log=uvpjs.DebugManager.log.bind(uvpjs.DebugManager),uvpjs.warn=uvpjs.DebugManager.warn.bind(uvpjs.DebugManager),uvpjs.error=uvpjs.DebugManager.error.bind(uvpjs.DebugManager),uvpjs.DebugManager.setSessionStartTime(new Date)},initialize:function(e,i,n){if(uvpjs.log(this.DEBUG_ID,"initialize options = ",e),this.eventsMgr=new uvpjs.EventsManager,this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),!i||!t.isFunction(i))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_ERROR,{msg:"VideoManager initialize MISSING OR MISS_TYPED successCallback PARAM RETURN"},this.internalNS);if(n&&t.isFunction(n)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager initialize MISSING OR MISS_TYPED errorCallback"},this.internalNS),this.vidMgrReadyCB=i,this.vidMgrInitErrorCB=n,!e||!t.isPlainObject(e)){var s="VideoManager initialize MISSING OR MISS_TYPED options PARAM RETURN";return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_ERROR,{msg:s},this.internalNS),void(n&&t.isFunction(n)&&this.vidMgrInitErrorCB(s))}this.configMgr=new uvpjs.ConfigManager(e,this.onCongfigMgrReady.bind(this))},onCongfigMgrReady:function(e){if(!t.isObject(e))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS);this.CDO=e,this._allowConcurrentPlayback=this.CDO.sessionOptions.allowConcurrentPlayback,this.setupDebugManager();var i=new uvpjs.TrackingManager;i.loadAgentPlugins(this.CDO,this.trackingAgentsLoadedCB.bind(this))},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO)},trackingAgentsLoadedCB:function(){uvpjs.log(this.DEBUG_ID,"trackingAgentsLoadedCB Dispatch PLAYER_LOADED and invoke VideoManagerReady callback."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this.vidMgrReadyCB()},addEventListener:function(e,i){return e&&t.isString(e)&&t.isFunction(i)?void this.eventsMgr.addEventListener(e,i):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(e){return e&&t.isString(e)?void this.eventsMgr.removeEventListener(e):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS)},createVideoPlayer:function(e,i,n){if(uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),!t.isString(e)||!t.isFunction(i)||n&&!t.isPlainObject(n))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);var s=[e,i];n&&s.push(n),this.createMultipleVideoPlayers([s])},destroyVideoPlayer:function(e){return uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),t.isString(e)?t.isEmpty(this.VCIs)||!this.VCIs[e]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+e},this.internalNS),!1):delete this.VCIs[e]:(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},createMultipleVideoPlayers:function(e){var i,n,s,a,r,o,l;if(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!t.isEmpty(this.VCIs)),!t.isArray(e))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS);for(s=e.length,n=0;s>n;n++)if(a=e[n],r=a[0],o=a[1],l=a[2],a.length<2||!t.isString(r)||!t.isFunction(o)||!t.isUndefined(l)&&!t.isPlainObject(l))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),n=0;s>n;n++)a=e[n],r=a[0],o=a[1],l=a[2]||{},uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",r),l=this.CDO.getSessionOptions(l),this._allowConcurrentPlayback===!1&&l.autoPlay===!0&&(this._disableAutoplay&&(l.autoPlay=!1),this._disableAutoplay=!0),i=new uvpjs.VideoControlInterface,this.VCIs[r]=i,i.initialize(r,this.eventsMgr,this.CDO,o,l);uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs)},overrideSessionOptions:function(e){e&&t.isPlainObject(e)&&this.CDO.overrideSessionOptions(e)},onVideoProgress:function(e){if(!(this._allowConcurrentPlayback||!t.isPlainObject(e)||t.isUndefined(e.target)||t.isUndefined(e.payload)||t.isUndefined(e.payload.playbackState)||e.payload.playbackState!==this.mc.PLAYING)){var i=e.target;t.isEmpty(this.currActiveVCI)&&!t.isUndefined(this.VCIs[i])&&(this.currActiveVCI=this.VCIs[i]),i===this.currActiveVCI.vidContId||t.isUndefined(this.VCIs[i])||(uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",i),this.VCIs[i].pauseVideo())}},onVideoPlaybackInitiated:function(e){if(uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",e),!this._allowConcurrentPlayback&&t.isPlainObject(e)&&!t.isUndefined(e.target)){var i=e.target;uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),t.isEmpty(this.VCIs)||t.isUndefined(this.VCIs[i])||(t.isEmpty(this.currActiveVCI)||this.currActiveVCI.vidContId!==i)&&(uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI.vidContId WAS = ",this.currActiveVCI.vidContId),this.currActiveVCI=this.VCIs[i],uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI.vidContId NEW = ",this.currActiveVCI.vidContId))}},uvpjsError:function(e){e?uvpjs.error(this.DEBUG_ID,"ERROR: ",e.payload.msg):uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(e){e?uvpjs.warn(this.DEBUG_ID,"WARNING: ",e.payload.msg):uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.ConfigDataObject=uvpjs.Class.subClass({debug:!0,sessionOptions:{cms:"",ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"123456",usesIMA:!1,usesTealium:!1,skin:!0,autoPlay:!1,customCSS:null,previewImage:null,allowConcurrentPlayback:!1,browserVer:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",maxDynamicSwitchingIndex:"",minDynamicSwitchingIndex:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",referrer:"",sessionId:"",useAutoDynamicSwitching:"",userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:""},init:function(e){this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],this.initialize(e)},initialize:function(e){uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",e),this.overrideSessionOptions(e)},destroy:function(){this.modules=null,this.classes=null},overrideSessionOptions:function(e){var i=this.getSessionOptions(e);return i&&t.isPlainObject(i)?void(this.sessionOptions=i):void uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type.")},getSessionOptions:function(e){var i,n,s;if(uvpjs.log(this.DEBUG_ID,"ConfigDataObject getSessionOptions options = "+e),i=t.clone(this.sessionOptions),!e||!t.isPlainObject(e))return i;if(n=e.skinConfig,n&&!t.isEmpty(n)){uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists.                    Please relocate the properties to the `sessionOption` object.");for(s in n)i.hasOwnProperty(s)&&(i[s]=n[s])}for(s in i)e.hasOwnProperty(s)&&(i[s]=e[s]);return i},getModule:function(e){return n(this.modules,e)},getModules:function(){return this.modules},getModuleParam:function(e,t){var i=n(this.modules,e),s=n(i.params,t);return s&&s.hasOwnProperty("value")?s.value:void 0},setModule:function(e){r(this.modules,e,"name",this.DEBUG_ID)},isModuleEnabled:function(e){var t=this.getModule(e);if(!t){var i="ConfigDataObject isModuleEnabled module not found: "+e;return uvpjs.log(this.DEBUG_ID,i),!1}return uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+e+":",t.enabled),t.enabled},getClass:function(e){return n(this.classes,e)},getClasses:function(){return this.classes},getClassProperty:function(e,t){var i=n(this.classes,e),s=a.call(this,i,"properties",this.DEBUG_ID),r=n(s,t);return a.call(this,r,"value",this.DEBUG_ID)},getClassListItems:function(e){var t=n(this.classes,e);return a.call(this,t,"list",this.DEBUG_ID)},getClassListItemProperty:function(e,t,i){var r=this.getClassListItems(e),o=s(r,t),l=a.call(this,o,"properties",this.DEBUG_ID),d=n(l,i);return a.call(this,d,"value",this.DEBUG_ID)},setClass:function(e){r(this.classes,e,"name",this.DEBUG_ID)},isCAN:function(){return t.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()}});var i=function(e,t,i){for(var n in e)if(e[n][t]==i)return e[n];return!1},n=function(e,t){return i(e,"name",t)},s=function(e,t){return i(e,"id",t)},a=function(e,t,i){return e?e.hasOwnProperty(t)?e[t]:(uvpjs.warn(i,"ConfigDataObject findItemProperty no item property:",e,t),!1):(uvpjs.warn(i,"ConfigDataObject findItemProperty item not found:",e),!1)},r=function(e,t,i,n){for(var s in e)if(e[s][i]==t[i])return uvpjs.log(n,"ConfigDataObject _addItemToArray updating existing item",t),void(e[s]=t);uvpjs.log(n,"ConfigDataObject _addItemToArray creating item",t),e.push(t)}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.ConfigManager=uvpjs.Class.subClass({init:function(e,t){this.initCallback=t,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,uvpjs.log(this.DEBUG_ID,"init sessionOptions =",e),this.CDO=new uvpjs.ConfigDataObject(e),uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.CDO.isCAN()&&this.configSources.push(uvpjs.ConfigManager.CAN_CONFIG_PATH),uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null},loadConfig:function(){if(!this.configSources.length)return void(t.isFunction(this.initCallback)&&this.initCallback(this.CDO));var e=this.configSources.shift();if(null!==e&&void 0!==e)switch(e.constructor){case String:if(""===e)break;var i=new uvpjs.CodeLoader;return void i.loadXHR(e,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=e.concat(this.configSources);break;case Object:this.updateCDO(e)}this.loadConfig()},onLoadComplete:function(e){var i,n=e.responseText,s=e.getResponseHeader("Content-Type");if(t.endsWith(s,"xml")){var a=new DOMParser,r=a.parseFromString(n,"text/xml");i=this.xmlToCDO(r)}else t.endsWith(s,"json")&&(i=JSON.parse(n));this.updateCDO(i),this.loadConfig()},onLoadError:function(e){var t="unknown error";switch(e.status){case 0:t="request timeout"}uvpjs.error(this.DEBUG_ID,"onLoadError error =",t,e),this.loadConfig()},updateCDO:function(e){if(uvpjs.log(this.DEBUG_ID,"updateCDO newObj =",e),t.isEmpty(e))return void uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty");var n=["classes","modules"];n.map(function(t){e.hasOwnProperty(t)&&(this.CDO[t]=i(this.CDO[t],e[t]))},this),uvpjs.log(this.DEBUG_ID,"updateCDO updated CDO",this.CDO)},xmlToCDO:function(e){var t={},i=function(e){return"y"===e||"n"===e},a=function(e){return"y"===e},r=n(e);return r.hasOwnProperty("player-config")&&(r=r["player-config"]),t.modules=function(){var e=s(r.modules.module),t=[];for(var n in e){var o=e[n],l={name:o.name,category:o.category,enabled:a(o.enabled),params:[]};if(e[n].hasOwnProperty("params")){var d=s(o.params.param);for(var u in d){var h=d[u];h.name&&(i(h.value)&&(h.value=a(h.value)),l.params.push(h))}}o.category||"unknown",t.push(l)}return t}(t),t.classes=function(){var e=s(r.classes),t=[];for(var i in e){var n=e[i];if(n.hasOwnProperty("classDef")&&(n=n.classDef),n.name){var a={name:n.name,className:n.className,properties:[],list:[]};if(n.hasOwnProperty("list")){var o=s(n.list.listitem);for(var l in o){var d=o[l];d.id&&(d.hasOwnProperty("properties")&&(d.properties=d.properties.property),a.list.push(d))}}n.hasOwnProperty("properties")&&(a.properties=n.properties.property),t.push(a)}}return t}(),t},getCDO:function(){return this.CDO}}),e.ConfigManager.CAN_CONFIG_PATH="//canstatic.cbs.com/chromeless/uvp/can.xml";var i=function(e,t){for(var i in t){var n=!1;for(var s in e)if(e[s].name===t[i].name){n=!0;break}n||e.push(t[i])}return e},n=function(e){var t,i={};if(1===e.nodeType&&e.attributes.length>0){t=e.attributes.length;for(var s=0;t>s;s++){var a=e.attributes.item(s);i[a.nodeName]=a.nodeValue}}if(e.hasChildNodes()){t=e.childNodes.length;for(var r=0;t>r;r++){var o=e.childNodes.item(r),l=o.nodeName;if(3!==o.nodeType)if("undefined"!=typeof i[l]){if("undefined"==typeof i[l].push){var d=i[l];i[l]=[],i[l].push(d)}i[l].push(n(o))}else i[l]=n(o)}}return i},s=function(e){return"undefined"!=typeof e&&e.constructor!==String?(e.constructor===Object&&(e=[e]),e):void 0}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",PREFIX_CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",hasManifestParsingError:!1,usingDynamicVariantPlaylist:!1,init:function(){uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagId="",this.videoTagRef={},this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={}},initialize:function(e){this.resourceProvider=e,this.vidContId=this.resourceProvider.vidContId,this.vidContentId=this.PREFIX_CONTENT+this.vidContId,this.internalNS="."+this.vidContId+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+this.vidContId),uvpjs.log(this.DEBUG_ID,"initialize   this.internalNS = "+this.internalNS)},testParentMethod:function(e){uvpjs.log(this.DEBUG_ID,"testParentMethod msgStr = "+e)},setupHTML5Facade:function(e){if(uvpjs.log(this.DEBUG_ID,"setupHTML5Facade initObj = ",e),t.has(e,"volume")&&t.inRange(e.volume,0,1)&&this.videoTagRef.volume!=e.volume&&(this.videoTagRef.volume=e.volume),t.has(e,"isMuted")){var i=1==e.isMuted;this.videoTagRef.muted!=i&&(this.videoTagRef.muted=i)}},addHTML5Events:function(){uvpjs.log(this.DEBUG_ID,"addHTML5Events");for(var e in this.eventTypes.HTML5)e!==this.eventTypes.HTML5.CLICK&&e!==this.eventTypes.HTML5.TOUCHEND&&this.videoTagRef.addEventListener(this.eventTypes.HTML5[e],this,!1);this.supportsTouchEvents?this.videoTagRef.addEventListener(this.eventTypes.HTML5.TOUCH_END,this,!1):this.videoTagRef.addEventListener(this.eventTypes.HTML5.CLICK,this,!1),uvpjs.mediaCapabilities.hasNativeFullscreen()&&document.addEventListener(uvpjs.mediaCapabilities.getFullscreenEventName(),this.handleFullscreenEvent.bind(this),!1)},removeHTML5Events:function(){uvpjs.log(this.DEBUG_ID,"removeHTML5Events");for(var e in this.eventTypes.HTML5)e!==this.eventTypes.HTML5.CLICK&&e!==this.eventTypes.HTML5.TOUCHEND&&this.videoTagRef.removeEventListener(this.eventTypes.HTML5[e],this,!1);this.supportsTouchEvents?this.videoTagRef.removeEventListener(this.eventTypes.HTML5.TOUCH_END):this.videoTagRef.removeEventListener(this.eventTypes.HTML5.CLICK,this,!1),uvpjs.mediaCapabilities.hasNativeFullscreen()&&document.removeEventListener(uvpjs.mediaCapabilities.getFullscreenEventName(),this.handleFullscreenEvent)},handleFullscreenEvent:function(e){uvpjs.log(this.DEBUG_ID,this.isFullscreenMode()),this.isFullscreenMode()},handleEvent:function(e){if(t.isObject(this.videoTagRef)){var i=this.eventTypes.HTML5;switch(e.type){case i.ABORT:break;case i.CAN_PLAY:uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(i.CAN_PLAY,this,!1);break;case i.CAN_PLAY_THROUGH:uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(i.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade  handleEvent CAN_PLAY_THROUGH   iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case i.CLICK:break;case i.DURATION_CHANGE:this.resourceProvider.facadeDurationChanged({duration:this.videoTagRef.duration});break;case i.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case i.ENDED:uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case i.ERROR:uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(e.target.error);break;case i.LOAD_START:if(uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),t.isEmpty(this.resourceProvider))return void uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!");if(uvpjs.mediaCapabilities.isIOS())return void uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!");break;case i.LOADED_METADATA:uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case i.LOADED_DATA:uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case i.PAUSE:uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case i.PLAY:this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case i.PLAYING:this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case i.PROGRESS:this.videoLoading();break;case i.RATE_CHANGE:break;case i.SEEKED:uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED"),this.seeked();break;case i.SEEKING:uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING"),this.playbackStateChange(uvpjs.mediaCapabilities.BUFFERING);break;case i.STALLED:break;case i.SUSPEND:break;case i.TIME_UPDATE:break;case i.VOL_CHANGE:this.volumeChanged();break;case i.WAITING:this.playbackStateChange(uvpjs.mediaCapabilities.BUFFERING)}}},seeked:function(){this.playbackStateChange(this.videoTagRef.paused?uvpjs.mediaCapabilities.PAUSED:uvpjs.mediaCapabilities.PLAYING),uvpjs.log(this.DEBUG_ID,"!! Is the Video in a Paused State? "+this.videoTagRef.paused,this.playbackState),this.resourceProvider.facadeSeeked()},timeUpdate:function(){this.playbackState!==uvpjs.mediaCapabilities.LOADING&&this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING)},videoLoading:function(){var e;try{e=this.videoTagRef.buffered.end(0)||0}catch(t){e=0}var i={bufferLength:e,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(i)},videoProgress:function(){var e={currentTime:this.videoTagRef.currentTime,duration:this.videoTagRef.duration,facadeState:this.getFacadeState()};this.resourceProvider.facadeProgress(e)},volumeChanged:function(){var e=this.videoTagRef.volume;!t.isNumber(e)||0>e?e=0:e>1&&(e=1),this.resourceProvider.facadeVolumeChange(e)},error:function(e){var i="VideoPlayerFacade handleEvent error: ";switch(e.code){case e.MEDIA_ERR_ABORTED:i+="You aborted the video playback.";break;case e.MEDIA_ERR_NETWORK:i+="A network error caused the video download to fail part-way.";break;case e.MEDIA_ERR_DECODE:i+="The video playback was aborted due to a corruption problem or because the video used features your browser did not support.";break;case e.MEDIA_ERR_SRC_NOT_SUPPORTED:i+="The video could not be loaded, either because the server or network failed or because the format is not supported.";break;default:i+="An unknown error occurred."}return uvpjs.error(this.DEBUG_ID,i),t.isEmpty(this.resourceProvider)?void uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade playbackStateChange  this.resourceProvider === {}   RETURN !!!!! errMsg = "+i):void this.resourceProvider.facadeError(i)},getVideoTagRef:function(){return t.isObject(this.videoTagRef)?this.videoTagRef:null},removePoster:function(){this.videoTagRef&&this.videoTagRef.removeAttribute(this.POSTER,"")},addPoster:function(e){this.videoTagRef&&this.videoTagRef.setAttribute(this.POSTER,e)},getCurrentSourcePath:function(){return t.isObject(this.videoTagRef)?this.videoTagRef.getElementsByTagName(this.SOURCE)[0].src:null},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){this.videoTagRef&&(uvpjs.log(this.DEBUG_ID,"playVideo"),this.videoTagRef.play())},pauseVideo:function(){this.videoTagRef&&(uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(e){uvpjs.log(this.DEBUG_ID,"seekTo",e),isNaN(e)||this.videoTagRef&&e>=0&&e<this.videoTagRef.duration&&(this.videoTagRef.currentTime=e)},toggleMute:function(){this.videoTagRef.muted=!this.videoTagRef.muted},loadVideo:function(){uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(){this.videoTagRef&&(this.videoTagRef.muted=!0)},unMuteVideo:function(){this.videoTagRef&&(this.videoTagRef.muted=!1)},getVolume:function(){return this.videoTagRef.volume||0},setVolume:function(e){this.videoTagRef&&e>=0&&1>=e&&(this.videoTagRef.volume=e)},getDuration:function(){return this.videoTagRef.duration||0},getCurrentTime:function(){return this.videoTagRef.currentTime||0},getWidth:function(){return this.videoTagRef.width||0},getHeight:function(){return this.videoTagRef.height||0},getPlaybackRate:function(){return this.videoTagRef.playbackRate||0},setPlaybackRate:function(e){this.videoTagRef&&t.isNumber(e)&&(this.videoTagRef.playbackRate=e)},showControls:function(){this.videoTagRef&&this.videoTagRef.setAttribute(this.CONTROLS,"")},hideControls:function(){this.videoTagRef&&this.videoTagRef.removeAttribute(this.CONTROLS,"")},switchUp:function(){},switchDown:function(){},switchToIndex:function(){},setBitrateLockLevel:function(e,t){},videoDone:function(){uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},cleanUp:function(){return t.isEmpty(this.resourceProvider)?void uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade            cleanUp          this.resourceProvider isEmpty  IT WOULD APPEAR THIS FACADE HAS BEEN CLEANED UP"):(uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade            cleanUp          this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),this.videoTagRef.src="",this.videoTagRef=null,this.resourceProvider=null,this.vidContId=null,this.videoTagId=null,this.videoTagRef=null,this.supportsTouchEvents=null,this.resourceProvider=null,this.vidContId=null,this.vidContentId=null,void(this.internalNS=null))},setSize:function(e,t){},getBuffered:function(){if(this.videoTagRef){var e,t,i=0;try{e=this.videoTagRef.buffered.start(0)}catch(n){e=0}try{t=this.videoTagRef.buffered.end(0)}catch(n){t=0}return i=t-e>0?t-e:0}return null},getCurrentSrc:function(){return this.videoTagRef?this.videoTagRef.src:void 0},getError:function(){return this.videoTagRef?this.videoTagRef.error:void 0},getReadyState:function(){return this.videoTagRef?this.videoTagRef.readyState:void 0},getNetworkState:function(){return this.videoTagRef?this.videoTagRef.networkState:void 0},isFullscreenMode:function(){var e=this.videoTagRef;return e.msRequestFullscreen?!!document.msFullscreenElement:e.webkitRequestFullscreen?!!document.webkitIsFullScreen:e.mozRequestFullScreen?!!document.mozFullScreen:e.requestFullscreen?!!document.fullscreen:!1},manageNativeControls:function(e){if(this.videoTagRef){var t=this.videoTagRef.hasAttribute(this.CONTROLS);e&&!t?this.videoTagRef.setAttribute("controls",this.CONTROLS):!e&&t&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(e){if(e!==this.playbackState){if(this.playbackState=e,uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+e),t.isEmpty(this.resourceProvider))return void uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!");
this.resourceProvider.facadePlaybackStateChange(e)}},getPlaybackState:function(){return this.playbackState},getFacadeState:function(){return this.facadeState},getAssetURL:function(){var e=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!t.isUndefined(e),(this.hasManifestParsingError||!this.usingDynamicVariantPlaylist)&&(this.usingDynamicVariantPlaylist=!1,e=this.resourceProvider.getAssetURL()),uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",e),e},onDynamicVariantManifestParsingError:function(){uvpjs.warn(this.DEBUG_ID,"Dynamic variant playlist manifest parsing error. Will now attempt original asset URL."),this.hasManifestParsingError=!0,this.setSource(),this.playVideo()}})}(uvpjs.register("uvpjs")),function(e){e._,e.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this._super()},initialize:function(e,t){uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize   resourceProvider.rco.id = ",e.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize              this.initObj = ",t),this._super(e),this.setupFacade(t),this.addEvents(),this.setSource(),uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.initObj = ",t)},setSource:function(){this.videoTagRef.src=this.getAssetURL(),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},setupFacade:function(e){this.setupHTML5Facade(e)},addEvents:function(){uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this.addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent.bind(this),!1)},removeEvents:function(){uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this.removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1)},getFacadeState:function(){return this.facadeState||{}},onStalledEvent:function(e){var t=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",e,t),!this.usingDynamicVariantPlaylist||this.hasManifestParsingError||t||this.onDynamicVariantManifestParsingError()}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"production"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LEVEL_SWITCH_UP:"up",LEVEL_SWITCH_DOWN:"down",VIDEO_TRANSITION_START:"Start",VIDEO_TRANSITION_COMPLETE:"Complete",_withCredentials:!1,init:function(){this._super(),this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,xhrSetup:function(e,i){t.isNull(i)||t.isEmpty(i)||!t.isString(i)||(this._withCredentials=this._withCredentials||i.indexOf("akamaihd")>-1&&i.indexOf("csmil")>-1,uvpjs.log(this.DEBUG_ID,"init xhrSetup _withCredentials",this._withCredentials),e.withCredentials=this._withCredentials)}.bind(this)},this.facadeState={startIndex:-1,minABRLevel:-1,maxABRLevel:-1,levelLoading:null,levelLoaded:null,useDynamicSwitching:!0,videoTransitionStatus:null,abrInfo:[],lastFacadeMessage:"",currentAbr:{levelId:{},info:{},detail:{},stats:{},updated:!1}}},initialize:function(e,t){uvpjs.log(this.DEBUG_ID,"VPF_HLSJS  initialize  STARTED   this.initObj = ",t),uvpjs.log(this.DEBUG_ID,"VPF_HLSJS  initialize  STARTED   resourceProvider.rco.id = ",e.rco.id),this._super(e),this.hlsLib=new Hls(this.libConfig),this.setupFacade(t),this.addEvents(),this.setSource(),uvpjs.log(this.DEBUG_ID,"VPF_HLSJS  initialize  COMPLETE   this.initObj = ",t)},setSource:function(){var e=this.getAssetURL();return this.mc.canPlayNativeHLS()?void(this.videoTagRef.src=e):(this.hlsLib.loadSource(e),void this.hlsLib.attachMedia(this.videoTagRef))},setupFacade:function(e){this.setupHTML5Facade(e);var i=-1;t.has(e,"abrStartIndex")&&(i=t.isNumber(e.abrStartIndex)&&e.abrStartIndex>=-1?e.abrStartIndex:i),t.has(e,"useDynamicSwitching")&&(this.facadeState.useDynamicSwitching=1==e.useDynamicSwitching,i>=0&&1!=e.useDynamicSwitching?(this.useDynamicSwitching(!1),this.facadeState.startIndex=i,this.hlsLib.startIndex=i):this.useDynamicSwitching(!0))},isAbrStreamingsSupported:function(){return t.isObject(this.hlsLib)&&!this.mc.isSafari()&&!this.mc.isAndroid()&&t.isFunction(this.hlsLib.isSupported)?this.hlsLib.isSupported():this.mc.canPlayHLSJS()&&!this.mc.isSafari()},addEvents:function(){uvpjs.log(this.DEBUG_ID,"VPF_HLSJS addEvents"),this.addHTML5Events();for(var e in Hls.Events)this.hlsLib.on(Hls.Events[e],this.outputEvent,!1),uvpjs.log(this.LEVEL_DEBUG_ID,"VPF_HLSJS: binding event: "+e);this.hlsLib.on(Hls.Events.MEDIA_ATTACHING,this.onMediaAttaching.bind(this),!1),this.hlsLib.on(Hls.Events.MEDIA_ATTACHED,this.onMediaAttached.bind(this),!1),this.hlsLib.on(Hls.Events.MEDIA_DETACHING,this.onMediaDetaching.bind(this),!1),this.hlsLib.on(Hls.Events.MANIFEST_PARSED,this.onManifestParsed.bind(this),!1),this.hlsLib.on(Hls.Events.MANIFEST_LOADED,this.onManifestLoaded.bind(this),!1),this.hlsLib.on(Hls.Events.MANIFEST_LOADING,this.onManifestLoading.bind(this),!1),this.hlsLib.on(Hls.Events.LEVEL_SWITCH,this.onLevelSwitch.bind(this),!1),this.hlsLib.on(Hls.Events.LEVEL_LOADING,this.onLevelLoading.bind(this),!1),this.hlsLib.on(Hls.Events.LEVEL_LOADED,this.onLevelLoaded.bind(this),!1),this.hlsLib.on(Hls.Events.LEVEL_UPDATED,this.onLevelUpdated.bind(this),!1),this.hlsLib.on(Hls.Events.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated.bind(this),!1),this.hlsLib.on(Hls.Events.FRAG_LOADING,this.onFragLoading.bind(this),!1),this.hlsLib.on(Hls.Events.FRAG_LOAD_PROGRESS,this.onFragLoadProgess.bind(this),!1),this.hlsLib.on(Hls.Events.FRAG_LOADED,this.onFragLoaded.bind(this),!1),this.hlsLib.on(Hls.Events.FRAG_PARSED,this.onFragParsed.bind(this),!1),this.hlsLib.on(Hls.Events.FRAG_BUFFERED,this.onFragBuffered.bind(this),!1),this.hlsLib.on(Hls.Events.FRAG_CHANGED,this.onFragChanged.bind(this),!1),this.hlsLib.on(Hls.Events.FPS_DROP,this.onFrameDropped.bind(this),!1),this.hlsLib.on(Hls.Events.ERROR,this.onError.bind(this),!1),this.hlsLib.on(Hls.Events.ERROR,this.outputEvent.bind(this),!1)},onLevelSwitch:function(e,t){uvpjs.log(this.LEVEL_DEBUG_ID,"onLevelSwitch "+e,t),this.facadeState.levelSwitch=t.level,this.facadeState.levelLoading=null,this.facadeState.levelLoaded=null,this.facadeState.levelDetails=null,this.facadeState.levelUrl=null,this.facadeState.currentAbr={levelId:t.level,updated:null},this.facadeState.videoTransitionStatus=this.VIDEO_TRANSITION_START,this.facadeState.lastFacadeMessage="onLevelSwitch",this.resourceProvider.facadeVideoTransitionStart(t.level)},onLevelLoading:function(e,t){uvpjs.log(this.LEVEL_DEBUG_ID,"onLevelLoading "+e,t),this.facadeState.levelSwitch=null,this.facadeState.levelLoading=t.level,this.facadeState.levelLoaded=null,this.facadeState.levelDetails=t.details||null,this.facadeState.levelUrl=t.url||null,this.facadeState.currentAbr.updated=!1,this.facadeState.lastFacadeMessage="onLevelLoading"},onLevelLoaded:function(e,t){uvpjs.log(this.LEVEL_DEBUG_ID,"onLevelLoaded "+e,t),this.levelDataChanged(t),this.facadeState.lastFacadeMessage="levelDataChanged",this.facadeState.videoTransitionStatus===this.VIDEO_TRANSITION_START&&(this.facadeState.videoTransitionStatus=this.VIDEO_TRANSITION_COMPLETE,this.facadeState.lastFacadeMessage="onLevelLoaded",this.resourceProvider.facadeVideoTransitionComplete(t.level))},onLevelUpdated:function(e,t){uvpjs.log(this.LEVEL_DEBUG_ID,"onLevelUpdated "+e,t),this.facadeState.currentAbr.updated=!0,this.levelDataChanged(t),this.facadeState.lastFacadeMessage="onLevelUpdated"},onLevelPtsUpdated:function(e,t){this.levelDataChanged(t),this.facadeState.lastFacadeMessage="onLevelPtsUpdated"},onMediaAttaching:function(e,t){uvpjs.log(this.DEBUG_ID,"onMediaAttaching "+e,t)},onMediaAttached:function(e,t){uvpjs.log(this.DEBUG_ID,"onMediaAttached "+e,t)},onMediaDetaching:function(e,t){uvpjs.log(this.DEBUG_ID,"onMediaDetaching "+e,t)},onMediaDetached:function(e,t){uvpjs.log(this.DEBUG_ID,"onMediaDetached "+e,t)},onManifestLoading:function(e,t){uvpjs.log(this.DEBUG_ID,"onManifestLoading "+e,t)},onManifestParsed:function(e,t){uvpjs.log(this.DEBUG_ID,"onManifestParsed "+e,t)},onManifestLoaded:function(e,i){uvpjs.log(this.DEBUG_ID,"onManifestLoaded "+e,i),this.hlsLib.autoStartLoad||this.hlsLib.startLoad(),this.facadeState.startIndex>-1&&this.facadeState.startIndex!=i.firstLevel&&(this.hlsLib.nextLevel=this.facadeState.startIndex),t.has(i,"levels")&&(this.facadeState.abrInfo=i.levels),t.has(i,"firstLevel")&&(this.facadeState.firstLevelInManifest=i.firstLevel),{type:"manifest",name:"",start:0,end:i.levels.length,time:i.stats.trequest,latency:i.stats.tfirst-i.stats.trequest,load:i.stats.tload-i.stats.tfirst,duration:i.stats.tload-i.stats.tfirst}},onFragLoading:function(e,t){uvpjs.log(this.FRAG_DEBUG_ID,"onFragLoading "+e,t)},onFragLoadProgess:function(e,t){uvpjs.log(this.FRAG_DEBUG_ID,"onFragLoadProgess "+e,t)},onFragLoaded:function(e,t){uvpjs.log(this.FRAG_DEBUG_ID,"onFragLoaded "+e,t)},onFragParsed:function(e,t){uvpjs.log(this.FRAG_DEBUG_ID,"onFragParsed "+e,t)},onFragBuffered:function(e,t){uvpjs.log(this.FRAG_DEBUG_ID,"onFragBuffered "+e,t)},onFragChanged:function(e,t){uvpjs.log(this.FRAG_DEBUG_ID,"onFragChanged "+e,t)},onFrameDropped:function(e,t){uvpjs.log(this.FRAME_DROP_DEBUG_ID,"onFrameDropped "+e,t)},levelDataChanged:function(e){var i=e.levelId||e.level,n=null;e.details||null,t.isObject(this.facadeState.abrInfo[i])&&(n=this.facadeState.abrInfo[i]),this.facadeState.currentAbr={levelId:i,details:e.detail||null,stats:e.stats||null,info:n},this.facadeState.levelSwitch=null,this.facadeState.levelLoading=null,this.facadeState.levelLoaded=i,this.facadeState.levelDetails=e.details},useDynamicSwitching:function(e){return uvpjs.log(this.LEVEL_DEBUG_ID,"DYN: ("+e+") checking dynamic switching: "+this.facadeState.useDynamicSwitching,this.hlsLib),this.facadeState.useDynamicSwitching==e?(this.resourceProvider.facadeDynamicSwitchingChange(this.facadeState.useDynamicSwitching),void uvpjs.log(this.LEVEL_DEBUG_ID,"UVPJS is already set to useDynamicSwitching "+e+".",this.hlsLib)):(this.facadeState.useDynamicSwitching=1==e,this.resourceProvider.facadeDynamicSwitchingChange(this.facadeState.useDynamicSwitching),e?this.hlsLib.nextLevel=-1:this.hlsLib.nextLevel=this.facadeState.levelLoaded,void(this.facadeState.lastFacadeMessage="useDynamicSwitching"))},switchBitrateTo:function(e){if(this.facadeState.useDynamicSwitching)return void uvpjs.log(this.LEVEL_DEBUG_ID,"UVPJS: No Level Switch. UVPJS currently set to use automatic switching.",this.hlsLib);var i,n=this.getMaxABRLevel(),s=this.getMinABRLevel(),a=this.facadeState.levelLoaded;if(t.isNumber(e)){if(e>=s&&n>=e)return this.hlsLib.currentLevel!==e&&(this.useDynamicSwitching(!1),this.hlsLib.currentLevel=e),void(this.facadeState.lastFacadeMessage="switchBitrateTo")}else t.isString(e)&&(e==this.LEVEL_SWITCH_UP?(i=n>a?a+1:a,i!==a&&(this.useDynamicSwitching(!1),this.hlsLib.currentLevel=i)):e==this.LEVEL_SWITCH_DOWN&&(i=a>s?a-1:a,i!==a&&(this.useDynamicSwitching(!1),this.hlsLib.currentLevel=i)));this.facadeState.lastFacadeMessage="switchBitrateTo"},setMinimumBitrateAllowed:function(e){return!t.isNumber(parseInt(e))||e>this.facadeState.maxABRLevel&&this.facadeState.maxABRLevel>-1?this.facadeState.maxABRLevel:-1>e||this.facadeState.abrInfo.length>0&&e>this.facadeState.abrInfo.length-1?null:(e=e>=-1?parseInt(e):-1,(!this.facadeState.abrInfo||this.facadeState.abrInfo.length<1||this.facadeState.abrInfo.length>0&&e>=-1)&&(this.facadeState.minABRLevel=e),e>-1&&(this.useDynamicSwitching(!1),(e>this.hlsLib.currentLevel||-1==this.hlsLib.currentLevel)&&(this.hlsLib.currentLevel=e)),this.facadeState.lastFacadeMessage="setMinimumBitrateAllowed",e)},setMaximumBitrateAllowed:function(e){return!t.isNumber(parseInt(e))||e<this.facadeState.minABRLevel&&-1!=e?this.facadeState.minABRLevel:-1>e||this.facadeState.abrInfo.length>0&&e>this.facadeState.abrInfo.length-1?null:(e=e>=-1?parseInt(e):-1,(!this.facadeState.abrInfo||this.facadeState.abrInfo.length<1||this.facadeState.abrInfo.length>0&&e<this.facadeState.abrInfo.length)&&(this.facadeState.maxABRLevel=e),this.hlsLib.autoLevelCapping=e,e>-1&&(this.useDynamicSwitching(!1),(e<this.hlsLib.currentLevel||-1==this.hlsLib.currentLevel)&&(this.hlsLib.currentLevel=e)),this.facadeState.lastFacadeMessage="setMaximumBitrateAllowed",e)},getMaxABRLevel:function(){var e=this.facadeState.abrInfo||[];return this.facadeState.maxABRLevel>-1?Math.min(e.length,this.facadeState.maxABRLevel):e.length-1},getMinABRLevel:function(){return this.facadeState.abrInfo||[],this.facadeState.minABRLevel>-1?Math.max(0,this.facadeState.minABRLevel):0},getFacadeState:function(){var e=this.facadeState;return e.abrLibrary=this.hlsLib,e||{}},outputEvent:function(e,t){},onError:function(e,i){if(t.isObject(i)&&t.has(i,"type")&&t.has(i,"details")&&t.has(i,"fatal")){var n=i.type,s=i.details,a=i.fatal;if(a?uvpjs.error(this.LEVEL_DEBUG_ID,"onError: errorType errorDetails errorFatal: ",n,s,a):uvpjs.warn(this.LEVEL_DEBUG_ID,"onError: errorType errorDetails errorFatal: ",n,s,a),this.usingDynamicVariantPlaylist&&s===Hls.ErrorDetails.MANIFEST_PARSING_ERROR)return void this.onDynamicVariantManifestParsingError();if(a)switch(n){case Hls.ErrorTypes.NETWORK_ERROR:uvpjs.error(this.LEVEL_DEBUG_ID,"fatal network error encountered, try to recover"),this.hlsLib.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:uvpjs.error(this.LEVEL_DEBUG_ID,"fatal media error encountered, try to recover");break;default:this.hlsLib.destroy()}else switch(s){case Hls.ErrorDetails.BUFFER_SEEK_OVER_HOLE:break;case Hls.ErrorDetails.MANIFEST_LOAD_ERROR:break;case Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT:break;case Hls.ErrorDetails.MANIFEST_PARSING_ERROR:break;case Hls.ErrorDetails.LEVEL_LOAD_ERROR:break;case Hls.ErrorDetails.LEVEL_LOAD_TIMEOUT:break;case Hls.ErrorDetails.LEVEL_SWITCH_ERROR:break;case Hls.ErrorDetails.FRAG_LOAD_ERROR:break;case Hls.ErrorDetails.FRAG_LOOP_LOADING_ERROR:break;case Hls.ErrorDetails.FRAG_LOAD_TIMEOUT:break;case Hls.ErrorDetails.FRAG_DECRYPT_ERROR:break;case Hls.ErrorDetails.FRAG_PARSING_ERROR:break;case Hls.ErrorDetails.BUFFER_APPEND_ERROR:break;case Hls.ErrorDetails.BUFFER_APPENDING_ERROR:}}},removeEvents:function(){uvpjs.log(this.DEBUG_ID,"VPF_HLSJS removeEvents"),this.removeHTML5Events()}})}(uvpjs.register("uvpjs")),function(e){e._,e.ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(){this.id=-1,this.rcoSeed={}},initialize:function(e){uvpjs.log(this.DEBUG_ID,"ResourceConfigObject initialize rcInitObj = ",e),this.rcoSeed=e;for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(){uvpjs.log(this.DEBUG_ID,"RCO_URL init"),this._super()},initialize:function(e){return uvpjs.log(this.DEBUG_ID,"RCO_URL initialize vidContId   rcInitObj  = ",e),t.isPlainObject(e)&&t.isString(e.type)&&t.isString(e.assetURL)&&e.type===uvpjs.mediaCapabilities.RP_URL?(this._super(e),this):(uvpjs.warn(this.DEBUG_ID,"RCO_URL WARNING initialize invalid  rcInitObj Resource Config Object"),!1)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(){uvpjs.log(this.DEBUG_ID,"RCO_IMA Init"),this._super()},initialize:function(e){return uvpjs.log(this.DEBUG_ID,"RCO_IMA initialize vidContId  rcInitObj  = ",e),"undefined"==typeof google?(uvpjs.warn(this.DEBUG_ID,"RCO_IMA initialize WARNING RETURN FALSE typeof google === undefined, Google IMA SDK not loaded or found"),!1):t.isPlainObject(e)&&t.isString(e.type)&&e.type===uvpjs.mediaCapabilities.RP_IMA?(this._super(e),this):(uvpjs.warn(this.DEBUG_ID,"RCO_IMA initialize WARNING RETURN FALSE invalid rcInitObj Resource Config Object !_.isPlainObject(rcInitObj) || !_.isString(rcInitObj.type) || rcInitObj.type !== uvpjs.mediaCapabilities.RP_IMA"),!1)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(){uvpjs.log(this.DEBUG_ID,"RCO_Mdialog Init"),this._super()},initialize:function(e){return uvpjs.log(this.DEBUG_ID,"RCO_Mdialog initialize vidContId  rcInitObj  = ",e),t.isPlainObject(e)&&t.isString(e.type)&&t.isString(e.assetURL)&&e.type===uvpjs.mediaCapabilities.RP_MDIALOG?(this._super(e),this):(uvpjs.warn(this.DEBUG_ID,"RCO_Mdialog WARNING initialize invalid rcInitObj Resource Config Object"),!1)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(){uvpjs.log(this.DEBUG_ID,"RCO_Platform Init"),this._super()},initialize:function(e){return uvpjs.log(this.DEBUG_ID,"RCO_Platform initialize vidContId  rcInitObj  = ",e),t.isPlainObject(e)&&t.isString(e.type)&&(t.isString(e.pid)||t.isString(e.selectorCall))&&e.type===uvpjs.mediaCapabilities.RP_PLATFORM?(this._super(e),this):(uvpjs.warn(this.DEBUG_ID,"RCO_Platform initialize invalid rcInitObj Resource Config Object"),!1)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(){this.vidContId="",this.internalNS="",this.rco={},this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB={},this.dataLoadErrorCB={},this.errMsg="",this.contentStartOpen=!1,this.mc=uvpjs.mediaCapabilities},initialize:function(e,i,n){uvpjs.log(this.DEBUG_ID,"ResourceProvider initialize rcObj = ",e),this.rco=e,this.vidContId=n,this.cviMgr=i,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",this.contentVideoState={},t.assign(this.contentVideoState,this.cviModel.contentVideoStateDefaults)},_addVideoProgressTimerCallback:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider _addVideoProgressTimerCallback"),this.eventsMgr.addTimedEventCallback(this.eventsMgr.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this))},_removeVideoProgressTimerCallback:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider _removeVideoProgressTimerCallback"),this.eventsMgr.removeTimedEventCallback(this.eventsMgr.TENTH_SECOND,this.internalNS)},cleanUp:function(){if(t.isEmpty(this.facade))uvpjs.log(this.DEBUG_ID,"ResourceProvider cleanUp   this.facade empty, facade already cleaned up");else{uvpjs.log(this.DEBUG_ID,"ResourceProvider cleanUp  dispatches   DISPATCHES CONTENT_END   this.rco.id = ",this.rco.id);var e=this.rco.rcoSeed;this.dispatchVideoDone(),this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this._removeVideoProgressTimerCallback(),this._removeUVPEventListeners(),this.facade.cleanUp(),this.cleanUpObjects(),this.RPM.resourceEnd(e)}},cleanUpObjects:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider cleanUpObjects"),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=null,this.dataLoadErrorCB=null,this.errMsg=null},loadVideoAndBeginPlayback:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider loadVideoAndBeginPlayback   this.vidContId = "+this.vidContId+" this.rco = "+this.rco),this.cviModel.setNonDefaultContentVideoStateItems(this.contentVideoState),this.cviModel.setContentVideoStateItems(this.rco),this.cviModel.mergeCDOData();var e=t.clone(this.cviModel.contentVideoState);this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:e},this.vidContId),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),this.facade=this.createFacade(),this.cviModel.incrementMedNum();var i={volume:this.cviModel.volume,isMuted:this.cviModel.isMuted,useDynamicSwitching:this.cviModel.useDynamicSwitching,abrStartIndex:this.cviModel.abrStartIndex};this.facade.initialize(this,i),this.facade.manageNativeControls(this.cviModel.nativeControls),this.facade.playVideo()},overwriteContentVideoStateItems:function(e){if(t.isObject(e))for(var i in this.contentVideoState)e.hasOwnProperty(i)&&!t.isFunction(e[i])&&(this.contentVideoState[i]=e[i])},getAssetURL:function(){var e=this.cviModel.contentVideoState.assetURL;return uvpjs.log(this.DEBUG_ID,"ResourceProvider getAssetURL videoURL = ",e),e},getAltURL:function(){var e=this.cviModel.contentVideoState.altURL;return uvpjs.log(this.DEBUG_ID,"ResourceProvider getAltURL videoURL = ",e),t.isString(e)&&!t.isEmpty(e)?e:void 0},startVideoProgressTimer:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var e=this.cviModel.getContentVideoState();uvpjs.log(this.DEBUG_ID,"ResourceProvider                                                           dispatch        CONTENT_START           state = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:e},this.vidContId)},dispatchContentEnd:function(){var e=this.cviModel.getContentVideoState();uvpjs.log(this.DEBUG_ID,"ResourceProvider                                                           dispatch        CONTENT_END             state = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:e},this.vidContId)},dispatchVideoDone:function(){uvpjs.log(this.DEBUG_ID,"dispatchVideoDone                                                          dispatch        VIDEO_DONE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId)},facadeDisplayReady:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider facadeDisplayReady  this.rco.id = "+this.rco.id),this.RPM.currRP.rco.type!==this.mc.RP_IMA&&(this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart())},facadeProgress:function(e){if(t.isObject(e)&&e.currentTime&&e.duration){this.cviModel.setContentPlaybackStateItems({currentTime:e.currentTime});var i=parseInt(e.duration);e.duration>0&&this.cviModel.contentVideoState.duration!==i&&this.cviModel.setContentVideoStateItems({duration:i})}},facadeDurationChanged:function(e){if(t.isObject(e)&&e.duration){var i=parseInt(e.duration);e.duration>0&&this.cviModel.contentVideoState.duration!==i&&(this.cviModel.setContentVideoStateItems({duration:i}),this.cviModel.setContentPlaybackStateItems({duration:i}))}},facadeDone:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider facadeDone calls this.dispatchContentEnd();this.rco.id = "+this.rco.id),this.RPM.currRP.rco.type===this.mc.RP_IMA?(uvpjs.log(this.DEBUG_ID,"ResourceProvider facadeDone calls this.RPM.currRP.this.imaContentComplete();"),this.RPM.currRP.imaContentComplete()):(uvpjs.log(this.DEBUG_ID,"ResourceProvider facadeDone dispatches this.cleanUp();"),this.cleanUp())},facadeSeeked:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider facadeSeeked  this.rco.id = "+this.rco.id)},facadeError:function(e){uvpjs.log(this.DEBUG_ID,"ResourceProvider facadeError  this.rco.id = "+this.rco.id+" errMsg = "+e),uvpjs.warn(this.DEBUG_ID,"ResourceProvider facadeError  errMsg      = ",e),this.cleanUp()},facadePlaybackStateChange:function(e){uvpjs.log(this.DEBUG_ID,"ResourceProvider facadePlaybackStateChange  this.rco.id = "+this.rco.id+" newState = "+e),t.isNumber(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:e,isAd:!1},this.vidContId)},facadeDynamicSwitchingChange:function(e){t.isBoolean(e)&&(uvpjs.log(this.DEBUG_ID,"ResourceProvider facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" bOnOrOff = ",e),this.cviModel.useDynamicSwitching=e)},facadeVideoTransitionStart:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{index:e},this.vidContId)},facadeVideoTransitionComplete:function(e){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{index:e},this.vidContId)},createFacade:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider createFacade, this.rco.id = "+this.rco.id);var e=this.getAssetURL(),t=this.mc.isHlsUrl(e),i=this.mc.isDashUrl(e);return t&&(this._isAbrStreamingSupported()||this.mc.canPlayNativeHLS())&&(this.contentVideoState.deliveryType=this.mc.STREAMING,this.cviModel.setContentVideoStateItems({deliveryType:this.contentVideoState.deliveryType})),t&&this._isAbrStreamingSupported()?new uvpjs.VPF_HLSJS:i?uvpjs.VPF_DASHJS?new uvpjs.VPF_DASHJS:void uvpjs.warn(this.DEBUG_ID,"Unable to create Facade, DASHJS not installed in this library."):new uvpjs.VPF_HTML5},_isAbrStreamingSupported:function(){return this.facade&&this.facade.facadeType&&this.facade.facadeType===uvpjs.mediaCapabilities.MPEG_DASH?this.facade.isAbrStreamingsSupported():t.isObject(this.facade)&&t.isFunction(this.facade._isAbrStreamingSupported)?this.facade.isAbrStreamingsSupported():this.mc.canPlayHLSJS()&&!this.mc.isSafari()&&!this.mc.isAndroid()},_addUVPEventListeners:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider _addUVPEventListeners this.rco.id = ",this.rco.id),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_SEEK+this.internalNS,this.onVideoSeekTo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PAUSE+this.internalNS,this.onPauseVideo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onPlayVideo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onMuteVideo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onUnMuteVideo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onChangeVideoVolume.bind(this)),this._isAbrStreamingSupported()&&(this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.BITRATE_SWITCH_REQUEST+this.internalNS,this.onBitrateSwitchRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING+this.internalNS,this.onUseDynamiceSwitching.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED+this.internalNS,this.onMaximumBitrateAllowed.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED+this.internalNS,this.onMinimumBitrateAllowed.bind(this)))},_removeUVPEventListeners:function(){uvpjs.log(this.DEBUG_ID,"ResourceProvider _removeUVPEventListeners this.rco.id = ",this.rco.id),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_SEEK+this.internalNS,this.onVideoSeekTo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_PAUSE+this.internalNS,this.onPauseVideo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onPlayVideo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onMuteVideo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onUnMuteVideo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onChangeVideoVolume.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.BITRATE_SWITCH_REQUEST+this.internalNS,this.onBitrateSwitchRequest.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING+this.internalNS,this.onUseDynamiceSwitching.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED+this.internalNS,this.onMaximumBitrateAllowed.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED+this.internalNS,this.onMinimumBitrateAllowed.bind(this))},onBitrateSwitchRequest:function(e){t.has(e,"payload.idxOrDirection")&&t.has(e,"target")&&e.target===this.vidContId&&this.facade.switchBitrateTo(e.payload.idxOrDirection)},onUseDynamiceSwitching:function(e){t.has(e,"payload.data")&&t.has(e,"target")&&e.target===this.vidContId&&t.isBoolean(e.payload.data)&&this.facade.useDynamicSwitching(e.payload.data)},onMinimumBitrateAllowed:function(e){if(t.has(e,"payload.idx")&&t.has(e,"target")&&e.target===this.vidContId){var i=this.facade.setMinimumBitrateAllowed(e.payload.idx);t.isNumber(parseInt(i))&&this.cviModel.setContentPlaybackStateItems({minABRLevel:i})}},onMaximumBitrateAllowed:function(e){if(t.has(e,"payload.idx")&&t.has(e,"target")&&e.target===this.vidContId){var i=this.facade.setMaximumBitrateAllowed(e.payload.idx);t.isNumber(parseInt(i))&&this.cviModel.setContentPlaybackStateItems({maxABRLevel:i})}},onVideoSeekTo:function(e){if(t.has(e,"payload.seekTime")&&e.target===this.vidContId){var i=e.payload.seekTime;i>=0&&i<=this.cviModel.contentVideoState.duration?(uvpjs.warn(this.DEBUG_ID,"ResourceProvider onVideoSeekTo  seekTime = ",i),this.facade.seekTo(i)):uvpjs.warn(this.DEBUG_ID,"ResourceProvider onVideoSeekTo seekTime out of range seekTime = ",i)}},facadeVolumeChange:function(e){!t.isNaN(e)&&t.isNumber(e)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:e},this.vidContId)},facadeLoading:function(e){var t={data:e};e&&(e.bufferLength||e.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,t,this.vidContId)},onPauseVideo:function(e){uvpjs.log(this.DEBUG_ID,"ResourceProvider onPauseVideo  this.vidContId = ",this.vidContId," evtObj.target = ",e.target),t.has(e,"target")&&e.target===this.vidContId&&this.facade.pauseVideo()},onPlayVideo:function(e){uvpjs.log(this.DEBUG_ID,"ResourceProvider onPlayVideo  this.vidContId = ",this.vidContId," evtObj.target = ",e.target),t.has(e,"target")&&e.target===this.vidContId&&this.facade.playVideo()},onChangeVideoVolume:function(e){t.has(e,"target")&&t.has(e,"payload.vol")&&e.target===this.vidContId&&t.isNumber(e.payload.vol)&&!this.cviModel.isMuted&&e.payload.vol>=0&&e.payload.vol<=1&&this.facade.setVolume(e.payload.vol)},onMuteVideo:function(e){t.has(e,"target")&&e.target===this.vidContId&&this.facade.muteVideo()},onUnMuteVideo:function(e){t.has(e,"target")&&e.target===this.vidContId&&this.facade.unMuteVideo()},onUVPJSTimerTick:function(){if(!t.isEmpty(this.facade)&&this.facade.getPlaybackState()===this.mc.PLAYING){var e=this.createContentVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,e,this.vidContId)}},createContentVideoProgressPayload:function(){var e=this.cviModel.contentVideoState.duration,i={isAd:!1,duration:e,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,curMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:0,bufferLength:0,playbackState:this.mc.EMPTY,facadeState:{}};return t.isObject(this.facade)&&!t.isEmpty(this.facade)&&(i.currentTime=this.facade.getCurrentTime()||0,i.bufferLength=this.facade.getBuffered()||0,i.playbackState=this.facade.getPlaybackState(),i.facadeState=this.facade.getFacadeState()),i}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(){this._super()},initialize:function(e,t,i){uvpjs.log(this.DEBUG_ID,"RP_URL initialize vidContId        = ",i),this._super(e,t,i)},loadData:function(e,i){return uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),t.isFunction(e)&&t.isFunction(i)?(this.dataLoadedCB=e,this.dataLoadErrorCB=i,void this.dataLoadedCB()):void this.eventsMgr.dispatchEvent(this["this"].eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"
},this.internalNS)},loadVideoAndBeginPlayback:function(){uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback                        this.rco = ",this.rco),this.cviModel.isCurrVideoAd=!1,this._super()}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,SMIL_START_TOKEN:"{",SMIL_END_TOKEN:");",CMS_DATA_DEFAULT:"CMSDataDefault",AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_CALL_IDENTIFIER_DOUBLECLICK_IMA:"pubads.g.doubleclick.net",AD_CALL_IDENTIFIER_DOUBLECLICK:"ad.doubleclick.net",AD_CALL_IDENTIFIER_PHP:"request.php",AD_CALL_IDENTIFIER_JSP:"Request.jsp",AKAMAI_CDN_HD:"akamai_hd",_numVideoTags:0,init:function(){this.contentNode=null,this.chapTimesString="",this.imaAdCall="",this.paramValues={},this._super()},initialize:function(e,t,i){uvpjs.log(this.DEBUG_ID,"RP_Platform initialize vidContId        = "+i),this._super(e,t,i),this.mc=uvpjs.mediaCapabilities},loadData:function(e,i){uvpjs.log(this.DEBUG_ID,"*******************  RP_Platform loadData");var n=this.rco.selectorCall;if(uvpjs.log(this.DEBUG_ID,"RP_Platform loadData  selCall = ",n),!(t.isString(n)&&""!==n||(n=this.returnSelectorCall())))return uvpjs.error(this.DEBUG_ID,"*******************  RP_Platform loadData UNABLE TO CREATE A SELECTOR CALL!"),!1;n&&n.indexOf("&callback=uvpHandleJsonpResult")<0&&(n+="&callback=uvpHandleJsonpResult"),this.dataLoadedCB=e,this.dataLoadErrorCB=i;var s=new uvpjs.CodeLoader;s.loadXHR(n,this.onLoadComplete.bind(this),this.onLoadError.bind(this))},returnSelectorCall:function(){var e=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");return e&&(e=e.replace(/\$PID\$/g,this.rco.pid),e=e.replace(/manifest=f4m/g,"manifest=m3u")),uvpjs.log(this.DEBUG_ID,"*******************  RP_Platform returnSelectorCall RETURN MPXurl = ",e),e},onLoadComplete:function(e){var t=e.responseText,i="",n=JSON.parse(t.substring(t.indexOf(this.SMIL_START_TOKEN),t.indexOf(this.SMIL_END_TOKEN)));uvpjs.log(this.DEBUG_ID,"*******************  RP_Platform onLoadComplete COMPLETE   smilObj = ",typeof n),uvpjs.log(this.DEBUG_ID,""),i=n.metafile,uvpjs.log(this.DEBUG_ID,"*******************  RP_Platform onLoadComplete COMPLETE    smil = ",i),uvpjs.log(this.DEBUG_ID,"");var s=new DOMParser,a=s.parseFromString(i,"application/xml");uvpjs.log(this.DEBUG_ID,"RP_Platform onLoadComplete smilXmlDoc =",a),this.parseSmilXML(a)?(uvpjs.log(this.DEBUG_ID,"RP_Platform onLoadComplete SMIL PARSE SUCCESSFUL"),this.dataLoadedCB()):this.dataLoadErrorCB(this.errMsg)},loadVideoAndBeginPlayback:function(){uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback                        this.rco = ",this.rco),this._super()},parseSmilXML:function(e){uvpjs.log(this.DEBUG_ID,"RP_Platform.parseSmilXML smilXmlData = ",e);var i,n,s,a,r=e.getElementsByTagName("ref"),o=(this.cviModel.getModuleParam.bind(this.cviModel,this.CMS_DATA_DEFAULT),"Unavailable"),l="Unavailable",d="placeholder",u=this.cviModel.getModule(this.CMS_DATA_DEFAULT);if(!t.isUndefined(u)&&u.enabled&&(t.isUndefined(u.PlaylistUnavailableSrc)||(o=u.PlaylistUnavailableSrc.split(".")[0]),t.isUndefined(u.PlaylistUnavailableTitle)||(l=u.PlaylistUnavailableTitle)),null!=r[0]){var h=r[0];if(null!=h.getAttribute("src")&&h.getAttribute("src").indexOf(o)>-1||null!=h.getAttribute("title")&&h.getAttribute("title").indexOf(l)>-1)return null!=h.getAttribute("abstract")&&h.getAttribute("abstract").indexOf(d)>-1?(uvpjs.warn(this.DEBUG_ID,"RP_Platform.parseSmilXML  PID GeoBlocked"),this.contentVideoState.isGeoRestricted=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.GEO_BLOCK_ERROR_STATE,isAd:!1},this.internalNS),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_GEO_BLOCKED,{country:""},this.internalNS)):(uvpjs.warn(this.DEBUG_ID,"RP_Platform.parseSmilXML  expired PID video Unavailable"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.VIDEO_NOT_AVAILABLE_ERROR_STATE,isAd:!1},this.internalNS),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_NOT_AVAILABLE,{vidOrImg:"video"},this.internalNS)),this.errMsg="WARNING   RP_Platform.parseSmilXML  PID GeoBlocked or WARNING   RP_Platform.parseSmilXML  expired PID video Unavailable",!1}var c,p=e.getElementsByTagName("switch");if(c=p[0]?p[0].getElementsByTagName("video"):e.getElementsByTagName("video"),null==c[0])return this.errMsg="ERROR   RP_Platform.parseSmilXML Malformed SMIL video[0] == null",!1;this._numVideoTags=c.length,this.contentNode=null,this.chapTimesString="";var g,v;if(null!=r[0])for(n=this.checkForAdCallOverride(),g=0,i=r.length;i>g;g++)v=r[g],a=v.attributes.src.nodeValue,this.isAdCallURL(a)?(uvpjs.log(this.DEBUG_ID,"RP_Platform.parseSmilXML ad node encountered!"),null!=this.imaAdCall&&""!=this.imaAdCall||(null!=n&&""!=n?(uvpjs.log(this.DEBUG_ID,"RP_Platform.parseSmilXML adCallOverride exists!"),uvpjs.log(this.DEBUG_ID,"RP_Platform.parseSmilXML adCallOverride is imaAdCall!"),this.imaAdCall=n):this.imaAdCall=a)):(null==this.contentNode&&(this.contentNode=v,uvpjs.log(this.DEBUG_ID,"RP_Platform.parseSmilXML contentRef node found: this.contentNode.getAttribute(src) = ",this.contentNode.getAttribute("src")),this.contentVideoState.assetURL=this.contentNode.getAttribute("src"),this.paramNodes=v.getElementsByTagName("param")),null!=v.getAttribute("clipEnd")&&(this.chapTimesString+=v.getAttribute("clipEnd")+","));for(this.chapTimesString.length>0&&(this.chapTimesString=this.chapTimesString.substring(0,this.chapTimesString.length-1)),g=0,i=c.length;i>g&&(s=c[g],a=s.attributes.src.nodeValue,null!=this.contentNode||(this.contentNode=s,uvpjs.log(this.DEBUG_ID,"RP_Platform.parseSmilXML contentRef node is video node: this.contentNode.getAttribute(src) = ",this.contentNode.getAttribute("src")),this.contentVideoState.assetURL=this.contentNode.getAttribute("src"),this.paramNodes=s.getElementsByTagName("param"),null!=s.getAttribute("clipEnd")));g++)null!=s.getAttribute("clipEnd")&&(this.chapTimesString+=s.getAttribute("clipEnd")+",");this.paramNodes&&(this.paramValues=this.createParamsTable(this.paramNodes)),this.contentVideoState.videoTitle=this.contentNode.getAttribute("title"),this.contentVideoState.episodeAbstract=this.contentNode.getAttribute("abstract"),this.contentVideoState.copyright=this.contentNode.getAttribute("copyright"),this.contentVideoState.mediaId=this.getMediaId(),this.contentVideoState.duration=this.getDuration(),this.contentVideoState.sourceWidth=this.contentNode.getAttribute("width"),this.contentVideoState.sourceHeight=this.contentNode.getAttribute("height"),null!=this.contentNode.getAttribute("guid")?this.contentVideoState.cmsRefGuid=this.contentNode.getAttribute("guid"):this.contentVideoState.cmsRefGuid=this.contentNode.getAttribute("vid"),this.contentVideoState.keywords=this.contentNode.getAttribute("keywords"),this.contentVideoState.chapterStartTimes=this.convertChapterTimesToSeconds(this.chapTimesString),this.contentVideoState.episodeNumber=this.getParamElementValue("EpisodeNumber"),this.contentVideoState.isEmbedable="true"===this.getParamElementValue("Embeddable"),this.contentVideoState.isLive="true"===this.getParamElementValue("IsLive"),this.contentVideoState.cdn=this.getParamElementValue("IsLiveCDN"),this.contentVideoState.category=this.getParamElementValue("PrimaryCategoryName"),this.contentVideoState.seasonNumber=this.getParamElementValue("SeasonNumber"),this.contentVideoState.episodeFlag="true"===this.getParamElementValue("EpisodeFlag"),this.contentVideoState.VTAG=this.getParamElementValue("VTAG"),this.contentVideoState.sourceOwner=this.getSourceOwner(),this.contentVideoState.closedCaptionPath=this.getParamElementValue("ClosedCaptionURL"),this.contentVideoState.useWatermark="true"===this.getParamElementValue("WatermarkPlayback"),this.contentVideoState.seriesTitle=this.getParamElementValue("SeriesTitle");var f=this.mc.MP4;return this.contentVideoState.assetURL.indexOf(this.mc.M3U)>-1?(this.contentVideoState.cdn=this.AKAMAI_CDN_HD,f=this.mc.M3U):this.contentVideoState.assetURL.indexOf(this.mc.MP3)>-1&&(f=this.mc.MP3),this.contentVideoState.fileType=f,this.checkForDynamicVariantService(),this.errMsg="No SMIL Parsing Errors",!0},onLoadError:function(e){uvpjs.log(this.DEBUG_ID,"*******************  RP_Platform onLoadError ERROR");var t="unknown error";switch(e.status){case 0:t="request timeout"}uvpjs.error(this.DEBUG_ID,"onLoadError error =",t,e),this.dataLoadErrorCB(t)},isAdCallURL:function(e){return e.indexOf(this.AD_CALL_IDENTIFIER_DOUBLECLICK)>-1||e.indexOf(this.AD_CALL_IDENTIFIER_DOUBLECLICK_IMA)>-1||e.indexOf(this.AD_CALL_IDENTIFIER_PHP)>-1||e.indexOf(this.AD_CALL_IDENTIFIER_JSP)>-1?(uvpjs.log(this.DEBUG_ID,"RP_Platform.prototype.isAdCallURL return TRUE"),!0):(uvpjs.log(this.DEBUG_ID,"RP_Platform.prototype.isAdCallURL return FALSE"),!1)},createParamsTable:function(e){uvpjs.log(this.DEBUG_ID,"RP_Platform.createParamsTable");var t={};if(null!=e&&e.length>0){var i,n,s,a;for(a=0,s=e.length;s>a;a++)i=e[a].getAttribute("name"),n=e[a].getAttribute("value"),uvpjs.log(this.DEBUG_ID,"RP_Platform.createParamsTable paramNodes[i].getAttribute(name)  = "+e[a].getAttribute("name")+" = "+e[a].getAttribute("value")),null!=i&&null!=n&&(t[i]=n)}return uvpjs.log(this.DEBUG_ID,"RP_Platform.createParamsTable paramsTable = ",t),t},checkForAdCallOverride:function(){uvpjs.log(this.DEBUG_ID,"RP_Platform checkForAdCallOverride");var e="",i=this.cviModel.getModule(this.AD_SETTINGS);return null==i||1!=i.enabled||t.isUndefined(this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE))||(e=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),uvpjs.log(this.DEBUG_ID,"RP_Platform checkForAdCallOverride OVERRIDE AD CALL FOUND altAdCall = "+e)),e},checkForDynamicVariantService:function(){uvpjs.log(this.DEBUG_ID,"RP_Platform checkForDynamicVariantService");var e=this.cviModel.sessionOptions.partner,i=this.contentVideoState,n=i.cmsRefGuid,s=this.returnSelectorCall();if(uvpjs.log(this.DEBUG_ID,"RP_Platform checkForDynamicVariantService this._numVideoTags",this._numVideoTags),uvpjs.log(this.DEBUG_ID,"RP_Platform checkForDynamicVariantService videoState.fileType",i.fileType),uvpjs.log(this.DEBUG_ID,"RP_Platform checkForDynamicVariantService selectorCall",s),!(t.isEmpty(i)||t.isEmpty(n)||t.isEmpty(e)||this._numVideoTags<=1||"m3u"!==i.fileType||-1===s.indexOf(this.mc.PLATFORM_OUTLET_ACCOUNT_ID))){var a=(new Date).getTime(),r=[e,n,a].join(",");this.contentVideoState.altURL=this.mc.CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL+r,uvpjs.log(this.DEBUG_ID,"RP_Platform checkForDynamicVariantService this.contentVideoState.altURL",this.contentVideoState.altURL)}},convertChapterTimesToSeconds:function(e){var t=[];if(uvpjs.log(this.DEBUG_ID,"RP_Platform convertChapterTimesToSeconds cTimes = ",e),null==e||""==e)return t;for(var i,n,s,a=e.split(","),r=0,o=a.length;o>r;r++)i=a[r],n=i.split(":"),s=parseInt(60*n[0])+parseInt(n[1]),t.push(s);return uvpjs.log(this.DEBUG_ID,"RP_Platform convertChapterTimesToSeconds retArr = ",t),t},getMediaId:function(){var e="",t=this.getParamElementValue("trackingData");if(""==t)return e;var i,n,s=t.split("|");for(i=0,n=s.length;n>i;i++)s[i].indexOf("cid=")>-1&&(e=s[i].split("=")[1]);return e},getParamElementValue:function(e){return null!=this.paramValues&&null!=this.paramValues[e]?this.paramValues[e]:""},getDuration:function(){var e=parseInt(this.contentNode.getAttribute("dur"))||0;return e>0&&(e/=1e3),e},getSourceOwner:function(){var e=this.getParamElementValue("Source");return""!=e?e:"true"===this.getParamElementValue("WatermarkPlayback")?"Entertainment":""}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(){this._super()},initialize:function(e,t,i){uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",i),this._super(e,t,i)},loadData:function(e,i){return uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),t.isFunction(e)?(this.dataLoadedCB=e,this.dataLoadErrorCB=i,void this.dataLoadedCB()):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS)}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.RP_IMA=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",CUSTOM_PARAM_TOKEN:"cust_params=",init:function(){return"undefined"==typeof google?void uvpjs.error(this.DEBUG_ID,"RP_IMA init FATAL ERROR google IMA JavaScript SDK not loaded!"):(uvpjs.log(this.DEBUG_ID,"RP_IMA init google.ima.VERSION = ",google.ima.VERSION),this.imaScenario="",this.platformRP={},this.platformContentVideoState={},this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.wrapperAdID="",this.dynamicMidRollPodCount=0,this._uvpEventListenersAdded=!1,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.allAdsComplete=!1,void this._super())},initialize:function(e,i,n){uvpjs.log(this.DEBUG_ID,"RP_IMA initialize                    rcObj = ",e),uvpjs.log(this.DEBUG_ID,"RP_IMA initialize                vidContId = ",n),this.playbackState=this.mc.EMPTY,this.vidContId=n,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=e;var s;if(t.isString(this.rco.pid)&&!t.isEmpty(this.rco.pid)||t.isString(this.rco.selectorCall)&&!t.isEmpty(this.rco.selectorCall))this.imaScenario=this.PLATFORM;else if(t.isString(this.rco.assetURL)&&!t.isEmpty(this.rco.assetURL))this.imaScenario=this.CONTENT_AND_AD_CALL;else{if(!t.isString(this.rco.adCall)||t.isEmpty(this.rco.adCall))return s="RP_IMA Cannot determine IMA Scenario from RCO contents. END IMA RP WITHOUT PLAYING ADS. Return to RPM",uvpjs.warn(this.DEBUG_ID,s),void console.warn(this.DEBUG_ID,s);this.imaScenario=this.AD_CALL_ONLY}uvpjs.log(this.DEBUG_ID,"RP_IMA initialize        this.imaScenario = ",this.imaScenario);var a=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId);return this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=a.getElementsByTagName("video")[0],this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),uvpjs.log(this.DEBUG_ID,"RP_IMA initialize         this.adVideoDiv = ",this.adVideoDiv),this._super(e,i,n),this.cviModel.isCurrVideoAd=!0,this.imaViewMode=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adVideoState={},t.assign(this.adVideoState,this.cviModel.adVideoStateDefaults),this.cviModel.sessionOptions.usesIMA?void 0:(s="RP_IMA `usesIMA` session option is `false`, but RP_IMA RCO encountered in playlist. END IMA RP WITHOUT PLAYING ADS. Return to RPM",uvpjs.warn(this.DEBUG_ID,s),void console.warn(this.DEBUG_ID,s))},loadData:function(e,t){switch(uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this.dataLoadedCB=e,this.dataLoadErrorCB=t,this._updateIMAPlaybackState(this.mc.LOADING),this.mc.isChromecast()||(this.containerWidth=0,this.containerHeight=0,this._updateAdSize()),this.imaScenario){case this.AD_CALL_ONLY:this.dataLoadedCB();break;case this.PLATFORM:this.loadPlatformMetadata();break;case this.CONTENT_AND_AD_CALL:this.dataLoadedCB();break;default:uvpjs.warn(this.DEBUG_ID,"RP_IMA loadData unknown this.imaScenario = ",this.imaScenario),this.dataLoadErrorCB("RP_IMA loadData unknown this.imaScenario encountered")}},loadVideoAndBeginPlayback:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA loadVideoAndBeginPlayback                  this.vidContId = ",this.vidContId),uvpjs.log(this.DEBUG_ID,"RP_IMA loadVideoAndBeginPlayback                     this.rco.id = ",this.rco.id),uvpjs.log(this.DEBUG_ID,"RP_IMA loadVideoAndBeginPlayback                        this.rco = ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader;var e,i;switch(this.imaScenario){case this.AD_CALL_ONLY:this.cviModel.setNonDefaultAdVideoStateItems(this.adVideoState),this.cviModel.mergeCDOData(),e=this._populateImaAdCallValues(this.rco.adCall),uvpjs.log(this.DEBUG_ID,"RP_IMA loadVideoAndBeginPlayback AD_CALL_ONLY CASE adCallUrl = ",e),this.RPM.resourceStart(this.rco.rcoSeed),this._requestAdsManager(e);break;case this.PLATFORM:this.cviModel.setNonDefaultContentVideoStateItems(this.platformContentVideoState),this.cviModel.setContentVideoStateItems(this.rco),this.cviModel.mergeCDOData(),i=t.clone(this.cviModel.contentVideoState),uvpjs.log(this.DEBUG_ID,"RP_IMA loadVideoAndBeginPlayback PLATFORM CASE dispatch CONTENT_DATA_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:i},this.vidContId),this.contentNeedsToBeLoaded=!0,e=t.isString(this.rco.adCall)&&!t.isEmpty(this.rco.adCall)?this._populateImaAdCallValues(this.rco.adCall):this._populateImaAdCallValues(this.platformRP.imaAdCall),uvpjs.log(this.DEBUG_ID,"RP_IMA loadVideoAndBeginPlayback PLATFORM CASE adCallUrl = ",e),this.RPM.resourceStart(this.rco.rcoSeed),t.isString(e)&&!t.isEmpty(e)?this._requestAdsManager(e):this._onContentResumeRequested();break;case this.CONTENT_AND_AD_CALL:this.cviModel.setContentVideoStateItems(this.contentVideoState),this.cviModel.setContentVideoStateItems(this.rco),this.cviModel.mergeCDOData(),i=t.clone(this.cviModel.contentVideoState),uvpjs.log(this.DEBUG_ID,"RP_IMA loadVideoAndBeginPlayback CONTENT_AND_AD_CALL CASE   DISPATCH CONTENT_DATA_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:i},this.vidContId),this.contentNeedsToBeLoaded=!0,e=this._populateImaAdCallValues(this.rco.adCall),uvpjs.log(this.DEBUG_ID,"RP_IMA loadVideoAndBeginPlayback CONTENT_AND_AD_CALL CASE adCallUrl = ",e),this.RPM.resourceStart(this.rco.rcoSeed),t.isString(e)&&!t.isEmpty(e)?this._requestAdsManager(e):this._onContentResumeRequested()}},createContentFacade:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA createContentFacade"),this.facade=this.createFacade(),this.cviModel.incrementMedNum();var e={volume:this.cviModel.volume,isMuted:this.cviModel.isMuted,useDynamicSwitching:this.cviModel.useDynamicSwitching,abrStartIndex:this.cviModel.abrStartIndex};this.facade.initialize(this,e),this.facade.manageNativeControls(this.cviModel.nativeControls)},onAdEvent:function(e){if("undefined"==typeof google||t.isUndefined(e))return void uvpjs.warn(this.DEBUG_ID,"UVP_IMA::onAdEvent  typeof google = undefined OR _.isUndefined(adEvent)  CANNOT PROCESS AD EVENTS RETURN");var i,n,s=e.getAdData(),a=e.getAd();switch(e.type){case google.ima.AdEvent.Type.LOADED:if(uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",a),!this.adPodInProgress){this.adPodInProgress=!0;var r=a.getAdPodInfo();if(n=r.getPodIndex(),uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED podIdx = ",n),uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED adPodInfo = ",r),0===n?i="pre":-1===n?i="post":n>=1&&(i="mid_"+n),this.currAdPod=this.APM.getAdPodById(i),t.isUndefined(this.currAdPod))return uvpjs.warn(this.DEBUG_ID,"onAdEvent google.ima.AdEvent.Type.LOADED this.currAdPod is undefined."),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.currAdPod.adCount=r.getTotalAds(),this.currAdPod.podDuration=r.getMaxDuration(),uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED this.currAdPod = ",this.currAdPod),(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}break;case google.ima.AdEvent.Type.STARTED:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this._populateAdVideoState(a),this.adVideoState.isCustomClickTrackingUsed=this.adsManager.isCustomClickTrackingUsed(),this.cviModel.setNonDefaultAdVideoStateItems(this.adVideoState),this.cviModel.mergeCDOData(),this.initializeMoat(),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._dispatchAdStart(),this._startRemainingTimeInterval();break;case google.ima.AdEvent.Type.FIRST_QUARTILE:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case google.ima.AdEvent.Type.MIDPOINT:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent       google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case google.ima.AdEvent.Type.THIRD_QUARTILE:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId);break;case google.ima.AdEvent.Type.COMPLETE:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent       google.ima.AdEvent.Type.COMPLETE"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd();break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||t.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case google.ima.AdEvent.Type.CLICK:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause();break;case google.ima.AdEvent.Type.PAUSED:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case google.ima.AdEvent.Type.RESUMED:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case google.ima.AdEvent.Type.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case google.ima.AdEvent.Type.LOG:uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent onAdEventNon-fatal  google.ima.AdEvent.Type.LOG"),s&&s.adError&&uvpjs.warn(this.DEBUG_ID,"RP_IMA onAdEvent onAdEventNon-fatal error occurred: ",s.adError.getMessage());break;default:return void uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",e.type)}},_populateAdVideoState:function(e){if(uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState ad = ",e),!t.isObject(e))return void uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState    !_.isObject(ad)     RETURN");this.duration=e.getDuration();var i=e.getAdPodInfo().getPodIndex();if(this.adVideoState.adPosition=e.getAdPodInfo().getAdPosition(),uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState ad.getDuration()             = ",this.duration),uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState                       podIdx = ",i),uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState this.adVideoState.adPosition = ",this.adVideoState.adPosition),0===i?this.adVideoState.adClipID="pre_0_"+this.adVideoState.adPosition:-1===i?this.adVideoState.adClipID="post_0_"+this.adVideoState.adPosition:i>=1&&(this.adVideoState.adClipID="mid_"+i+"_"+this.adVideoState.adPosition),uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState  this.adVideoState.adClipID  = ",this.adVideoState.adClipID),this.adVideoState.adServerName=this.mc.IMA,this.adVideoState.adVideoTitle=e.getTitle(),this.adVideoState.duration=this.duration,e.getWrapperAdIds()){var n=e.getWrapperAdIds();n&&n.length>0?this.adVideoState.adVideoId=n[0]:e.getAdId()&&(this.adVideoState.adVideoId=e.getAdId()),n&&n.length>1?this.wrapperAdID=n[1]:this.wrapperAdID=""}else uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState NO ad.getWrapperAdIds()");uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState this.adVideoState.adVideoId  = ",this.adVideoState.adVideoId)},loadPlatformMetadata:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA loadPlatformMetadata this.vidContId = ",this.vidContId);var e={type:this.mc.RP_PLATFORM,pid:this.rco.pid,selectorCall:this.rco.selectorCall,vidContId:this.vidContId};this.platformRP=new uvpjs.RP_Platform,this.platformRP.initialize(e,this.cviMgr,this.vidContId),this.platformRP.loadData(this.platformDataLoadCB.bind(this),this.platformDataLoadErrorCB.bind(this))},platformDataLoadCB:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA platformDataLoadCB this.vidContId = ",this.vidContId),this.platformContentVideoState=this.platformRP.contentVideoState,uvpjs.log(this.DEBUG_ID,"RP_IMA platformDataLoadCB this.platformContentVideoState = ",this.platformContentVideoState),uvpjs.log(this.DEBUG_ID,"RP_IMA platformDataLoadCB this.platformContentVideoState.assetURL = ",this.platformContentVideoState.assetURL),this.dataLoadedCB()},platformDataLoadErrorCB:function(e){uvpjs.warn(this.DEBUG_ID,"RP_IMA platformDataLoadErrorCB this.vidContId = ",this.vidContId," error message: ",e),this.cleanUpRP_IMA()},_requestAdsManager:function(e){uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",e),this.adStartEventReceived=!1;var t=new google.ima.AdsRequest;t.adTagUrl=e,this._updateAdSize(),t.linearAdSlotWidth=this.containerWidth,t.linearAdSlotHeight=this.containerHeight,t.nonLinearAdSlotWidth=this.containerWidth,t.nonLinearAdSlotHeight=this.containerHeight,this.adsLoader.requestAds(t)},onAdsManagerLoaded:function(e){uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded                       adsManagerLoadedEvent = ",e);var i,n=new google.ima.AdsRenderingSettings;n.bitrate=750,n.restoreCustomPlaybackStateOnAdBreakComplete=!1,this.imaScenario===this.AD_CALL_ONLY?this.adsManager=e.getAdsManager(this.contentVideoTag,n):this.adsManager=e.getAdsManager(this.contentPlayheadTracker,n),uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded              this.adsManager.isCustomPlaybackUsed() = ",this.adsManager.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded         this.adsManager.isCustomClickTrackingUsed() = ",this.adsManager.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded                      this.adsManager.getCuePoints() = ",this.adsManager.getCuePoints()),this.imaScenario!==this.PLATFORM||t.isEmpty(this.platformRP)||uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.platformRP.contentVideoState.chapterStartTimes = ",this.platformRP.contentVideoState.chapterStartTimes),i=this.adsManager.getCuePoints(),t.isEmpty(i)&&(i=[0]),this.APM=new uvpjs.AdPlaylistManager,this.imaScenario===this.PLATFORM?(uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaScenario === this.PLATFORM         this.platformRP.contentVideoState.chapterStartTimes = ",this.platformRP.contentVideoState.chapterStartTimes),this.APM.initialize(this.vidContId,this.platformRP.contentVideoState.chapterStartTimes,i,this.platformRP.imaAdCall)):this.imaScenario===this.CONTENT_AND_AD_CALL?(uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaScenario === this.CONTENT_AND_AD_CALL   this.cviModel.contentVideoState.chapterStartTimes = ",this.cviModel.contentVideoState.chapterStartTimes),this.APM.initialize(this.vidContId,this.cviModel.contentVideoState.chapterStartTimes,i,this.rco.adCall)):this.APM.initialize(this.vidContId,[],i,this.rco.adCall),this._addAdsManagerEventListeners(),this.imaViewMode=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,this.imaViewMode),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded !!!!! INVOKE  this.startAds();"),this.startAds()},initializeMoat:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA initializeMoat"),this.imaViewMode=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL;var e="";this.cviModel.dwPageParams.pagetype&&(e=this.cviModel.dwPageParams.pagetype);var t={partnerCode:"cbsiimajsint708425247896",viewMode:this.imaViewMode,level1:"",level2:"",level3:this.cviModel.adVideoState.adVideoId,level4:this.adVideoState.adVideoId,slicer1:"vaw-can",slicer2:this.cviModel.sessionOptions.partner,moatVASTSystem:this.cviModel.adVideoState.adServerName,moatVASTAdID:this.wrapperAdID};""!=e&&(t.slicer3=e),this.initMoatTracking(this.adsManager,t,this.cviMgr.adVideoDiv)},startAds:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(e){uvpjs.warn(this.DEBUG_ID,"RP_IMA   ERROR startAds adError = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},_onContentPauseRequested:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA              _onContentPauseRequested by AdsManager"),t.isEmpty(this.facade)||(this.cviModel.contentVideoState.isLive?(this.cviModel.isMuted=!0,this.facade.muteVideo()):this.facade.pauseVideo())},_onContentResumeRequested:function(){return uvpjs.log(this.DEBUG_ID,"RP_IMA                _onContentResumeRequested by AdsManager this.adStartEventReceived = ",this.adStartEventReceived),this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.dispatchAdPodEnd()),!t.isEmpty(this.APM)&&this.APM.isPostRoll(this.currAdPod)?void uvpjs.log(this.DEBUG_ID,"RP_IMA                _onContentResumeRequested by AdsManager post-roll case, content already done RETURN"):(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),this.adStartEventReceived?(uvpjs.log(this.DEBUG_ID,"RP_IMA                _onContentResumeRequested  this.adStartEventReceived === TRUE  this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),void(t.isEmpty(this.facade)?(uvpjs.log(this.DEBUG_ID,"RP_IMA                _onContentResumeRequested	  this.facade isEmpty, no content video to play CHECK FOR POST-ROLL IN AD_CALL_ONLY CASE and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!t.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(uvpjs.warn(this.DEBUG_ID,"RP_IMA                _onContentResumeRequested	  this.facade isEmpty, no content video to play HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA())):(uvpjs.log(this.DEBUG_ID,"RP_IMA                _onContentResumeRequested	  this.facade.playVideo()  PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.playVideo()))):(uvpjs.log(this.DEBUG_ID,"RP_IMA                _onContentResumeRequested this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this._updateIMAPlaybackState(this.mc.STOPPED),void this.adErrorCheckForContentVideoBeforeCallingCleanUp()))},imaContentComplete:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!t.isEmpty(this.APM)&&this.APM.hasPostRoll()?(uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete       this.APM.hasPostRoll()       call  this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete       !this.APM.hasPostRoll()  NO POST ROLL wrap it up!     call  this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},_updateIMAPlaybackState:function(e){uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState  this.playbackState = "+this.playbackState,"  newState = ",e),
e!==this.playbackState&&(this.playbackState=e,uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE  newState = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.playbackState,isAd:!0},this.vidContId))},_dispatchAdStart:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart                                                    dispatch        AD_START"),this.uvpjsAdStartOpened=!0;var e=this.cviModel.getAdVideoState();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{adData:e},this.vidContId)},_dispatchAdEnd:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd                                                      dispatch        AD_END"),this.uvpjsAdStartOpened=!1;var e=this.cviModel.getAdVideoState();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:e},this.vidContId)},dispatchAdPodStart:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart                                                  dispatch        AD_POD_START            this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},dispatchAdPodEnd:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodEnd                                                    dispatch        AD_POD_END              this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId)},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(){if(!this.mc.isChromecast()){var e=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),t=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height"));(e!==this.containerWidth||t!==this.containerHeight)&&(this.containerWidth=e,this.containerHeight=t,this.adsManager&&(this.imaViewMode=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,this.imaViewMode)))}},_updateCurrentAdTime:function(){this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY&&(this.currImaAdTime=Math.floor(this.duration-this.adsManager.getRemainingTime()),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime}))},_startRemainingTimeInterval:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0==this.remainingTimeInterval&&(this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!=this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!=this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null)},onAdError:function(e){if(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp(),e){var t=e.getError();uvpjs.warn(this.DEBUG_ID,"RP_IMA onAdError  ERROR   err.getErrorCode()  = ",t.getErrorCode())}},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){return uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),t.isEmpty(this.facade)?(uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA()):(this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),void this.facade.playVideo())},cleanUpRP_IMA:function(){if(uvpjs.log(this.DEBUG_ID,"RP_IMA   cleanUpRP_IMA                                                                  RP_IMA    this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var e=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.uvpjsAdStartOpened&&this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeVideoProgressTimerCallback(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.dispatchAdPodEnd()),this.platformRP={},this.platformContentVideoState={},this.APM={},this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(e)}},_cleanUpContentVideoFacade:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),t.isEmpty(this.facade)||(this.facade.cleanUp(),this.facade={})},loadDynamicAdCall:function(e){if(uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",e),null!=this.adsManager)return void uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null && !this.allAdsComplete) RETURN before making dynamic ad call");this.dynamicMidRollPodCount++;var t=this._populateImaAdCallValues(e);this.rco.adCall=t,this._requestAdsManager(t)},onPauseVideo:function(e){uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo  this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE   this._super(evtObj);  have the Resource Provider parent pause the CONTENT video"),this._super(e)))},onPlayVideo:function(e){uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE    this._super(evtObj);  have the Resource Provider parent play the CONTENT video"),this._super(e)))},onVideoSeekTo:function(e){if(uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",e),e.target!==this.vidContId||!t.has(e,"payload.seekTime")||t.isEmpty(this.facade)||e.payload.seekTime<0||e.payload.seekTime>this.cviModel.contentVideoState.duration)return void uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN");if(t.isEmpty(this.APM)||!this.APM.hasMidRoll())return uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo  NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(e);var i,n,s;i=e.payload.seekTime,n=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(i):i,s=this.APM.returnPrecedingUnplayedAdPod(n),t.isEmpty(s)||s.hasPlayed?(uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo  NO UNPLAYED POD  CALL SUPER with evtObj argument and seek content"),this._super(e)):(uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo  UNPLAYED AD POD FOUND   unplayedPod.startTime = ",s.startTime),this.savedSeekToTime=n,this.contentPlayheadTracker.pendingSeekTime=s.startTime)},returnAbsSeekTime:function(e){var t=e;return t},onChangeVideoVolume:function(e){t.has(e,"target")&&e.target===this.vidContId&&!this.cviModel.isMuted&&e.payload.vol>=0&&e.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(e.payload.vol):this._super(e))},onMuteVideo:function(e){t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?(uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE this.adsManager.setVolume(0) aka mute this.vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE    this._super(evtObj);  have the Resource Provider parent mute the CONTENT volume"),this._super(e)))},onUnMuteVideo:function(e){t.has(e,"target")&&e.target===this.vidContId&&(this.adPodInProgress?(uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE this.adsManager.setVolume(this.cviModel.volume) aka unmute this.vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE    this._super(evtObj);  have the Resource Provider parent unmute the CONTENT volume"),this._super(e)))},_addAdsManagerEventListeners:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _addAdsManagerEventListeners  ADD listeners"),this.adsManager&&"undefined"!=typeof google&&(this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.MIDPOINT,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.RESUMED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.USER_CLOSE,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOG,this.onAdEvent.bind(this)))},_removeAdsManagerEventListeners:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners  REMOVE listeners"),this.adsManager&&(this.adsManager.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.LOADED,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.STARTED,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.MIDPOINT,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.CLICK,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.PAUSED,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.RESUMED,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.USER_CLOSE,this.onAdEvent.bind(this)),this.adsManager.removeEventListener(google.ima.AdEvent.Type.LOG,this.onAdEvent.bind(this)))},_addUVPEventListeners:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _addUVPEventListeners this.rco.id = ",this.rco.id),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_SEEK+this.internalNS,this.onVideoSeekTo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PAUSE+this.internalNS,this.onPauseVideo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onPlayVideo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onMuteVideo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onUnMuteVideo.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onChangeVideoVolume.bind(this)))},_removeUVPEventListeners:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _removeUVPEventListeners this.rco.id = ",this.rco.id),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_SEEK+this.internalNS,this.onVideoSeekTo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_PAUSE+this.internalNS,this.onPauseVideo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onPlayVideo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onMuteVideo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onUnMuteVideo.bind(this)),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onChangeVideoVolume.bind(this))},_addVideoProgressTimerCallback:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _addVideoProgressTimerCallback"),this.eventsMgr.addTimedEventCallback(this.eventsMgr.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this))},_removeVideoProgressTimerCallback:function(){uvpjs.log(this.DEBUG_ID,"RP_IMA _removeVideoProgressTimerCallback"),this.eventsMgr.removeTimedEventCallback(this.eventsMgr.TENTH_SECOND,this.internalNS)},onUVPJSTimerTick:function(){if((this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL)&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:t.isEmpty(this.facade)?this.contentPlayheadTracker.currentTime=0:this.contentPlayheadTracker.currentTime=this.facade.getCurrentTime()),!this.adPodInProgress)return void this._super();if(this.playbackState===this.mc.PLAYING){var e=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,e,this.vidContId)}},createAdVideoProgressPayload:function(){var e={isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,curMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}};return e},_populateImaAdCallValues:function(e){uvpjs.log(this.DEBUG_ID,"RP_IMA _populateImaAdCallValues OLD adCall = ",e);var i,n,s,a,r;return!t.isString(e)||t.isEmpty(e)?(uvpjs.log(this.DEBUG_ID,"RP_IMA _populateImaAdCallValues !_.isString(adCallUrl) || _.isEmpty(adCallUrl) NEW adCall is an empty string"),""):(i=this.imaScenario===this.PLATFORM?this.platformContentVideoState.cmsRefGuid:this.imaScenario===this.CONTENT_AND_AD_CALL?this.cviModel.contentVideoState.cmsRefGuid:"",uvpjs.log(this.DEBUG_ID,"RP_IMA _populate cmsRefGuid = ",i),n=/{mediaReferenceId}/g,e=e.replace(n,i),uvpjs.log(this.DEBUG_ID,"RP_IMA _populateImaAdCallValues partner = ",this.cviModel.sessionOptions.partner),s=encodeURIComponent(this.cviModel.sessionOptions.partner),n=/PARTNER/g,e=e.replace(n,s),r=e.indexOf("{ptype}")>-1?/{VGUID}/g:/%7BVGUID%7D/g,a="",t.isUndefined(this.cviModel.dwPageParams.viewguid)||(a=this.cviModel.dwPageParams.viewguid),""!==a||t.isUndefined(this.cviModel.dwPageParams.pguid)||(a=this.cviModel.dwPageParams.pguid),e.indexOf("VGUID")>-1?e=e.replace(r,a):""!==a&&(e=this._addCustomAdCallParameters(e,"vguid="+a)),uvpjs.log(this.DEBUG_ID,"RP_IMA _populateImaAdCallValues NEW adCall = ",e),e)},_addCustomAdCallParameters:function(e,t){uvpjs.log(this.DEBUG_ID,"RP_IMA _addCustomAdCallParameters OLD adCall = ",e);var i="",n="",s=e.indexOf(this.CUSTOM_PARAM_TOKEN),a=-1,r=-1,o="",l="&",d="?";return-1===s?(i=e.slice(0),i+=-1==i.indexOf(d)?d+this.CUSTOM_PARAM_TOKEN:l+this.CUSTOM_PARAM_TOKEN,i+=encodeURIComponent(t)):(a=s+this.CUSTOM_PARAM_TOKEN.length,r=e.indexOf(l,a),-1===r?r=e.length:o=e.substring(r,e.length),n=decodeURIComponent(e.substring(a,r)),t=l+t,n+=t,uvpjs.log(this.DEBUG_ID,"RP_IMA  _addCustomAdCallParameters customParams = "+n),i=e.substr(0,a)+encodeURIComponent(n)+o),uvpjs.log(this.DEBUG_ID,"RP_IMA  _addCustomAdCallParameters _resultCall = "+i),i},initMoatTracking:function(e,t,i){if(uvpjs.log(this.DEBUG_ID,"RP_IMA  initMoatTracking"),!1===t.hasOwnProperty("partnerCode"))return!1;var n=document.createElement("script");i=i||e&&("undefined"!=typeof e.O?e.O.parentNode:document.body)||document.body;var s=[],a={adsManager:e,ids:t,imaSDK:!0,events:[]},r={complete:"AdVideoComplete",firstquartile:"AdVideoFirstQuartile",impression:"AdImpression",loaded:"AdLoaded",midpoint:"AdVideoMidpoint",pause:"AdPaused",skip:"AdSkipped",start:"AdVideoStart",thirdquartile:"AdVideoThirdQuartile",volumeChange:"AdVolumeChange"};if(google&&google.ima&&e){var o,l="_moatApi"+Math.floor(1e8*Math.random());for(o in google.ima.AdEvent.Type){var d=function(t){if(a.sendEvent){for(t=s.length-1;t>=0;t--)e.removeEventListener(s[t].type,s[t].func);a.sendEvent(a.events)}else a.events.push({type:r[t.type]||t.type,adVolume:e.getVolume()})};e.addEventListener(google.ima.AdEvent.Type[o],d),s.push({type:google.ima.AdEvent.Type[o],func:d})}}var u,h,l="undefined"!=typeof l?l:"";try{u=i.ownerDocument,h=u.defaultView||u.parentWindow}catch(c){u=document,h=window}h[l]=a,n.type="text/javascript",i&&i.appendChild(n),n.src="https://z.moatads.com/"+t.partnerCode+"/moatvideo.js#"+l}})}(uvpjs.register("uvpjs")),function(){function e(e){var t=e.__resizeTriggers__,i=t.firstElementChild,n=t.lastElementChild,s=i.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,s.style.width=i.offsetWidth+1+"px",s.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}function t(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height}function i(i){var n=this;e(this),this.__resizeRAF__&&o(this.__resizeRAF__),this.__resizeRAF__=r(function(){t(n)&&(n.__resizeLast__.width=n.offsetWidth,n.__resizeLast__.height=n.offsetHeight,n.__resizeListeners__.forEach(function(e){e.call(n,i)}))})}function n(){if(!a){var e=(_?_:"")+".resize-triggers { "+(E?E:"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t.appendChild(i),a=!0}}var s=document.attachEvent,a=!1;if(!s){var r=function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)};return function(t){return e(t)}}(),o=function(){var e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(t){return e(t)}}(),l=!1,d="animation",u="",h="animationstart",c="Webkit Moz O ms".split(" "),p="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),g="",v=document.createElement("fakeelement");if(void 0!==v.style.animationName&&(l=!0),l===!1)for(var f=0;f<c.length;f++)if(void 0!==v.style[c[f]+"AnimationName"]){g=c[f],d=g+"Animation",u="-"+g.toLowerCase()+"-",h=p[f],l=!0;break}var m="resizeanim",_="@"+u+"keyframes "+m+" { from { opacity: 0; } to { opacity: 0; } } ",E=u+"animation: 1ms "+m+"; "}window.addResizeListener=function(t,a){s?t.attachEvent("onresize",a):(t.__resizeTriggers__||("static"==getComputedStyle(t).position&&(t.style.position="relative"),n(),t.__resizeLast__={},t.__resizeListeners__=[],(t.__resizeTriggers__=document.createElement("div")).className="resize-triggers",t.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',t.appendChild(t.__resizeTriggers__),e(t),t.addEventListener("scroll",i,!0),h&&t.__resizeTriggers__.addEventListener(h,function(i){i.animationName==m&&e(t)})),t.__resizeListeners__.push(a))},window.removeResizeListener=function(e,t){s?e.detachEvent("onresize",t):(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||(e.removeEventListener("scroll",i),e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)))}}(),!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof g&&g.amd?g(t):e.Spinner=t()}(this,function(){"use strict";function e(e,t){var i,n=document.createElement(e||"div");for(i in t)n[i]=t[i];return n}function t(e){for(var t=1,i=arguments.length;i>t;t++)e.appendChild(arguments[t]);return e}function i(e,t,i,n){var s=["opacity",t,~~(100*e),i,n].join("-"),a=.01+i/n*100,r=Math.max(1-(1-e)/t*(100-a),e),o=d.substring(0,d.indexOf("Animation")).toLowerCase(),l=o&&"-"+o+"-"||"";return c[s]||(u.insertRule("@"+l+"keyframes "+s+"{0%{opacity:"+r+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+t)%100+"%{opacity:"+e+"}100%{opacity:"+r+"}}",u.cssRules.length),c[s]=1),s}function n(e,t){var i,n,s=e.style;if(t=t.charAt(0).toUpperCase()+t.slice(1),void 0!==s[t])return t;for(n=0;n<h.length;n++)if(i=h[n]+t,void 0!==s[i])return i}function s(e,t){for(var i in t)e.style[n(e,i)||i]=t[i];return e}function a(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)void 0===e[n]&&(e[n]=i[n])}return e}function r(e,t){return"string"==typeof e?e:e[t%e.length]}function o(e){this.opts=a(e||{},o.defaults,p)}function l(){function i(t,i){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}u.addRule(".spin-vml","behavior:url(#default#VML)"),o.prototype.lines=function(e,n){function a(){return s(i("group",{coordsize:u+" "+u,coordorigin:-d+" "+-d}),{width:u,height:u})}function o(e,o,l){t(c,t(s(a(),{rotation:360/n.lines*e+"deg",left:~~o}),t(s(i("roundrect",{arcsize:n.corners}),{width:d,height:n.scale*n.width,left:n.scale*n.radius,top:-n.scale*n.width>>1,filter:l}),i("fill",{color:r(n.color,e),opacity:n.opacity}),i("stroke",{opacity:0}))))}var l,d=n.scale*(n.length+n.width),u=2*n.scale*d,h=-(n.width+n.length)*n.scale*2+"px",c=s(a(),{position:"absolute",top:h,left:h});if(n.shadow)for(l=1;l<=n.lines;l++)o(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=n.lines;l++)o(l);return t(e,c)},o.prototype.opacity=function(e,t,i,n){var s=e.firstChild;n=n.shadow&&n.lines||0,s&&t+n<s.childNodes.length&&(s=s.childNodes[t+n],s=s&&s.firstChild,s=s&&s.firstChild,s&&(s.opacity=i))}}var d,u,h=["webkit","Moz","ms","O"],c={},p={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(o.defaults={},a(o.prototype,{spin:function(t){this.stop();var i=this,n=i.opts,a=i.el=e(null,{className:n.className});if(s(a,{position:n.position,width:0,zIndex:n.zIndex,left:n.left,top:n.top}),t&&t.insertBefore(a,t.firstChild||null),a.setAttribute("role","progressbar"),i.lines(a,i.opts),!d){var r,o=0,l=(n.lines-1)*(1-n.direction)/2,u=n.fps,h=u/n.speed,c=(1-n.opacity)/(h*n.trail/100),p=h/n.lines;!function g(){o++;for(var e=0;e<n.lines;e++)r=Math.max(1-(o+(n.lines-e)*p)%h*c,n.opacity),i.opacity(a,e*n.direction+l,r,n);i.timeout=i.el&&setTimeout(g,~~(1e3/u))}()}return i},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(n,a){function o(t,i){return s(e(),{position:"absolute",width:a.scale*(a.length+a.width)+"px",height:a.scale*a.width+"px",background:t,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*u+a.rotate)+"deg) translate("+a.scale*a.radius+"px,0)",borderRadius:(a.corners*a.scale*a.width>>1)+"px"})}for(var l,u=0,h=(a.lines-1)*(1-a.direction)/2;u<a.lines;u++)l=s(e(),{position:"absolute",top:1+~(a.scale*a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:d&&i(a.opacity,a.trail,h+u*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&t(l,s(o("#000","0 0 4px #000"),{top:"2px"})),t(n,t(l,o(r(a.color,u),"0 0 1px rgba(0,0,0,.1)")));return n},opacity:function(e,t,i){t<e.childNodes.length&&(e.childNodes[t].style.opacity=i)}}),"undefined"!=typeof document){u=function(){var i=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}();var g=s(e("group"),{behavior:"url(#default#VML)"});!n(g,"transform")&&g.adj?l():d=n(g,"animation")}return o}),function(e){var t=e._;e.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TOUCH_CLICK_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",MUTED_MODIFIER:"muted",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},eventTypes:{MOUSE_ENTER:"mouseenter"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{label:"25%",value:".25"},{label:"50%",value:".50"},{label:"75%",value:".75"},{label:"100%",value:"1","default":!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black","default":!0}]},{name:"background-opacity",label:"Background opacity",items:[{label:"0%",value:"0"},{label:"25%",value:".25"},{label:"50%",value:".50"},{label:"75%",value:".75"},{label:"100%",value:"1","default":!0}]},{name:"color",label:"Font color",items:[{value:"#ffffff",label:"White","default":!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"opacity",label:"Font opacity",items:[{label:"0%",value:"0"},{label:"25%",value:".25"},{label:"50%",value:".50"},{label:"75%",value:".75"},{label:"100%",value:"1","default":!0}]},{name:"font-size",label:"Font size",enabled:!0,items:[{value:"50%"},{value:"75%"},{value:"100%","default":!0},{value:"150%"},{value:"200%"},{value:"300%"},{value:"400%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal","default":!0},{value:"Bold"}]},{name:"text-shadow",label:"Character edge style",items:[{value:"None","default":!0},{value:"2px 2px 3px #000",label:"Drop Shadow"},{value:"-1px -1px 1px #fff, 1px 1px 1px #000",label:"Raised"},{value:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",label:"Outline"}]}]}],init:function(e){this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,uvpjs.log(this.DEBUG_ID,"init"),this.VCI=e.vci,this.dom=this.VCI.dom,this._skinReadyCB=e.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.captions={loaded:!1,css:{}},this.internalNS=null,this._previewCB=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._currentVolume=1,this._unmuteVolume=1,this._unmuteClick=!1,this._returnToPause=!1,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._cssPath="",this._cssRules={},this._styleSheet=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isMobile=this.mc.isMobile(),this._isIOS=this.mc.isIOS(),this._isTouch=this._isMobile&&this.mc.isTouch(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(e.skinConfig)},destroy:function(){var e=function(){};this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),this.VCI=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this.dom=null,this.mc=null,this._skinReadyCB=e,this._previewCB=e,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null},initialize:function(e){uvpjs.log(this.DEBUG_ID,"initialize skinConfig",e),this._autoPlay=e.autoPlay,this._previewImage=e.previewImage,this._previewCB=this.VCI.onPreviewButton.bind(this.VCI,this._skinReadyCB.bind(this)),this._cssPath=t.isString(e.customCSS)&&!t.isEmpty(e.customCSS)?e.customCSS:uvpjs.Configuration.path+this.DEFAULT_SKIN_PATH,
this.internalNS="."+this.dom.outer.id+".skin",this._canFullscreen=this._hasNativeFullscreen(),uvpjs.log(this.DEBUG_ID,"initialize this.dom.outer.id = "+this.dom.outer.id),uvpjs.log(this.DEBUG_ID,"initialize this._cssPath = "+this._cssPath),uvpjs.log(this.DEBUG_ID,"initialize this._previewImage = "+this._previewImage),this._hideContainers(),this._setupDOM(),this._addStylesheetToDOM()},disableButton:function(e){t.includes(this._disabledButtons,e)||this._disabledButtons.push(e),this._disableButton(e)},enableButton:function(e){t.pull(this._disabledButtons,e),this._enableButton(e)},_disableButton:function(e){this._disable(e);var t=this._queryByElementName(e);t&&(t.disabled=!0)},_enableButton:function(e){if(!t.includes(this._disabledButtons,e)){this._enable(e);var i=this._queryByElementName(e);i&&(i.disabled=!1)}},_addUVPJSEventListeners:function(){var e=this.VCI,t=this.internalNS,i=uvpjs.EventType;e.addEventListener(i.AD_START+t,this._onAdStart.bind(this)),e.addEventListener(i.AD_END+t,this._onAdEnd.bind(this)),e.addEventListener(i.CAPTIONS_READY+t,this._onCaptionsReady.bind(this)),e.addEventListener(i.CONTENT_START+t,this._onContentStart.bind(this)),e.addEventListener(i.CONTENT_END+t,this._onContentEnd.bind(this)),e.addEventListener(i.VIDEO_PROGRESS+t,this._onVideoProgress.bind(this)),e.addEventListener(i.VIDEO_STATE_CHANGE+t,this._onVideoStateChange.bind(this)),e.addEventListener(i.VIDEO_LOADING+t,this._onVideoLoading.bind(this)),e.addEventListener(i.CONTROL_MUTE+t,this._onControlMuteUnmute.bind(this)),e.addEventListener(i.CONTROL_UNMUTE+t,this._onControlMuteUnmute.bind(this)),e.addEventListener(i.RESOURCE_END+t,this._onResourceEnd.bind(this))},_removeUVPJSEventListeners:function(){var e=this.VCI,t=this.internalNS,i=uvpjs.EventType;e&&e instanceof uvpjs.VideoControlInterface&&(e.removeEventListener(i.AD_START+t),e.removeEventListener(i.AD_END+t),e.removeEventListener(i.CAPTIONS_READY+t),e.removeEventListener(i.CONTENT_START+t),e.removeEventListener(i.CONTENT_END+t),e.removeEventListener(i.VIDEO_PROGRESS+t),e.removeEventListener(i.VIDEO_STATE_CHANGE+t),e.removeEventListener(i.VIDEO_LOADING+t),e.removeEventListener(i.CONTROL_MUTE+t),e.removeEventListener(i.CONTROL_UNMUTE+t),e.removeEventListener(i.RESOURCE_END+t))},_addUIEventListeners:function(){for(var e=this.mc.isIE()?"change":"input",i=this.dom.outer.el,n=this.dom.video.el,s=this.css,a=["_hideMenu","_onUVPJSGestureEvent","_onLoadedMetadata","_onPreviewBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_handleFullscreenEvent","_onFullscreenBtnClick","_onUVPJSResize"],r=a.length;r--;)this[a[r]]=this[a[r]].bind(this);var o=this._onUVPJSGestureEvent,l=this._onProgressSliderEvent,d=this._onVolumeSliderEvent,u=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),i.addEventListener("mouseenter",o,!0),i.addEventListener("mouseleave",o,!0),i.addEventListener("mousemove",o,!0),i.addEventListener("mousedown",o,!1),i.addEventListener("mouseup",o,!1),i.addEventListener("click",o,!1),i.addEventListener("touchstart",o,!0),i.addEventListener("touchend",o,!0),this._isIOS&&n.addEventListener("loadedmetadata",this._onLoadedMetadata,!0),this._previewBtn=this._queryByElementName(s.PREVIEW_BTN),this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchstart",this._onPreviewBtn,!0),this._controlBar=this._queryByElementName(s.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(s.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(s.PROGRESS_SLIDER),this._progressSlider.addEventListener(e,l,!1),this._progressSlider.addEventListener("mousedown",l,!1),this._progressSlider.addEventListener("mouseup",l,!1),this._progressSlider.addEventListener("touchstart",l,!0),this._progressSlider.addEventListener("touchend",l,!0),this._volumeSlider=this._queryByElementName(s.VOLUME_SLIDER),this._volumeSlider.addEventListener(e,d,!1),this._volumeSlider.addEventListener("mouseover",d,!1),this._volumeSlider.addEventListener("mouseout",d,!1),this._playstateBtn=this._queryByElementName(s.PLAYSTATE_BTN),this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._playToggleFrame=this._queryByElementName(s.LARGE_PLAY_BTN),this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(s.VOLUME_BTN),this._volumeBtn.addEventListener("click",u,!1),this._volumeBtn.addEventListener("mouseover",u,!1),this._volumeBtn.addEventListener("mouseout",u,!1),this._ccBtn=this._queryByElementName(s.CLOSED_CAPTION_BTN),this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn=this._queryByElementName(s.SETTINGS_BTN),this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),addResizeListener(i,this._onUVPJSResize),this._updateProgressSlider=t.throttle(this._updateSliderUI.bind(this,this._progressSlider,this.css.PROGRESS_SLIDER),this.THROTTLE_WAIT),this._fullscreenBtn=this._queryByElementName(s.FULLSCREEN_BTN),this._setupFullscreenEventListener()},_removeUIEventListeners:function(){var e=this.mc.isIE()?"change":"input",t=this.dom.outer.el,i=this.dom.video.el,n=this._onUVPJSGestureEvent,s=this._onProgressSliderEvent,a=this._onVolumeSliderEvent,r=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),t.removeEventListener("mouseenter",n,!0),t.removeEventListener("mouseleave",n,!0),t.removeEventListener("mousemove",n,!0),t.removeEventListener("mousedown",n,!1),t.removeEventListener("mouseup",n,!1),t.removeEventListener("click",n,!1),t.removeEventListener("touchstart",n,!0),t.removeEventListener("touchend",n,!0),this._isIOS&&i.removeEventListener("loadedmetadata",this._onLoadedMetadata,!1),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchstart",this._onPreviewBtn,!0),this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider.removeEventListener(e,s,!1),this._progressSlider.removeEventListener("mousedown",s,!1),this._progressSlider.removeEventListener("mouseup",s,!1),this._progressSlider.removeEventListener("touchstart",s,!0),this._progressSlider.removeEventListener("touchend",s,!0),this._volumeSlider.removeEventListener(e,a,!1),this._volumeSlider.removeEventListener("mouseover",a,!1),this._volumeSlider.removeEventListener("mouseout",a,!1),this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn.removeEventListener("click",r,!1),this._volumeBtn.removeEventListener("mouseover",r,!1),this._volumeBtn.removeEventListener("mouseout",r,!1),this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),removeResizeListener(t,this._onUVPJSResize),this._canFullscreen&&(this._fullscreenBtn.removeEventListener("touchend",this._handleFullscreenEvent,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1),document.removeEventListener(this.mc.getFullscreenEventName(),this._handleFullscreenEvent,!1))},_addStylesheetToDOM:function(){for(var e=!0,i=0,n=document.styleSheets.length;n>i;i++){var s=document.styleSheets[i];t.isString(s.href)&&s.href.indexOf(this._cssPath)>-1&&(uvpjs.warn(this.DEBUG_ID,"CSS file already in the page.",this._cssPath),e=!1)}var a=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));return e?void this._createStyleSheet(this._cssPath,a):void a()},_haveControlsLoaded:function(){uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList);var e=!0;for(var t in this._controlList)this._checkControlOnDOM(this._controlList[t])||(e=!1);return e},_waitForControls:function(e){uvpjs.log(this.DEBUG_ID,"_waitForControls."),setTimeout(function(){if(!(++this._waitCount>100)){if(this._haveControlsLoaded())return uvpjs.log(this.DEBUG_ID,"controls loaded."),void e.call(this);uvpjs.log(this.DEBUG_ID,"controls not loaded.",this._waitCount),this._waitForControls(e)}}.bind(this),50)},_setupDOM:function(){var e=this.dom,t=this.css;uvpjs.log(this.DEBUG_ID,"creating skin controls this.dom.outer.id = ",this.dom.outer.id),n(e.outer.el,this.PRIMARY_BLOCK),n(e.content.el,this._getClassName(t.CONTENT)),n(e.controls.el,this._getClassName(t.CONTROLS)),e.ad.el&&n(e.ad.el,this._getClassName(t.AD)),this._hide(t.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(t.BUFFERING_FRAME),this._hide(t.LARGE_PLAY_BTN),this._hide(t.CONTROL_BAR),this._hide(t.PROGRESS),this._hide(t.VOLUME_SLIDER),this._hide(t.AD_LEARNMORE),this._show(t.CONTROLS),this._hide(t.BUFFERING_FRAME),this._hide(t.SETTINGS_MENU),this._hide(t.PREVIEW_BTN),(this._autoPlay!==!0||this._isMobile)&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._isMobile&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){var e=this.dom;e.outer.el.style.visibility="hidden",e.content.el.style.visibility="hidden",e.video.el.style.visibility="hidden",e.controls.el.style.visibility="hidden"},_showContainers:function(){var e=this.dom;e.outer.el.style.visibility="visible",e.content.el.style.visibility="visible",e.video.el.style.visibility="visible",e.controls.el.style.visibility="visible"},_appendControlList:function(e){this._controlList[this.ID_SELECTOR_PREFIX+this.dom.controls.id+" "+this.CLASS_SELECTOR_PREFIX+e]=e},_setupControlsContainer:function(){var e=[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this.dom.controls.el.innerHTML=this._templateToHTML(e)},_generateSettingsMenu:function(e,i){uvpjs.log(this.DEBUG_ID,"_generateSettingsMenu",e);var n=function(e,i){if(e.enabled!==!1){var n={};return e.value?(n.el="SETTINGS_MENU_INPUT",n.type="menu",n.label=e.label||e.value,n.value=e.value,n.property=t.last(i.split(":")),n.selected=this.captions.css[n.property]===n.value.toLowerCase(),n):(n.el="SETTINGS_MENU_ITEM",n.type="button",n.label=e.label,n.target=i,n)}}.bind(this),s=t.map(e,function(e){var s=i;return e.name&&(s=t.isEmpty(i)?e.name:[i,e.name].join(":")),n(e,s)});if(i){var a=this._findMenuItem(i),r=i.split(":").slice(0,-1).join(":"),o=n(a,r);o.cls=this._getClassName(this.css.SETTINGS_MENU_ITEM)+"--back",s.unshift(o)}var l=this._queryByElementName(this.css.SETTINGS_MENU),d=document.createRange();d.selectNodeContents(l),d.deleteContents(),l.insertAdjacentHTML("beforeend",this._templateToHTML(s));var u,h=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM);if(h)for(u=h.length;u--;)h[u].addEventListener("click",this._onSettingsMenuBtnClick);var c=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);if(c)for(u=c.length;u--;)c[u].addEventListener("click",this._onSettingsMenuInputClick)},_removeMenuEventListeners:function(){var e,t=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM);if(t)for(e=t.length;e--;)t[e].removeEventListener("click",this._onSettingsMenuBtnClick);var i=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);if(i)for(e=i.length;e--;)i[e].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(e){var i={items:this.settingsMenu};if(t.isEmpty(e))return i;var n=this,s=e.split(":");return t(s).each(function(e){uvpjs.log(n.DEBUG_ID,"_findMenuItem key",e),i=t.find(i.items,function(t){return t.name===e})}),i},_createAdLearnMoreButton:function(){var e=document.createElement("button");e.id=uvpjs.domConstants.AD_LEARNMORE_ID_PREFIX+this.ID_SELECTOR_PREFIX+this.dom.outer.id,e.className=this._getClassName(this.css.AD_LEARNMORE),e.innerHTML=this.AD_LEARNMORE_TEXT,e.setAttribute("aria-label",this.AD_LEARNMORE_TEXT),this.dom.controls.el.appendChild(e)},_setupPreview:function(){uvpjs.log(this.DEBUG_ID,"_setupPreview");var e=this._queryByElementName(this.css.PREVIEW_BTN),i=this._previewImage;uvpjs.log(this.DEBUG_ID,"_setupPreview",this._previewImage),t.isEmpty(this._previewImage)||(e.style.backgroundImage="url('"+i+"')"),this._show(this.css.PREVIEW_BTN)},_addBufferingIndicator:function(){var e=this._getClassName(this.css.BUFFERING_FRAME),t={lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:e,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};new Spinner(t).spin(this.dom.controls.el)},_disableInactiveButtons:function(){this._disableButton(this.css.SETTINGS_BTN),this._disableButton(this.css.CLOSED_CAPTION_BTN),this._canFullscreen||this._disableButton(this.css.FULLSCREEN_BTN),this._isIOS&&this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(e){var t=this.css;return uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.dom.outer.id===e.target?(this._disableButton(t.SETTINGS_BTN),this._disableButton(t.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),e.payload.adData.isCustomClickTrackingUsed?(this._show(t.AD_LEARNMORE),void this._addModifier(this.PRIMARY_BLOCK,t.AD_LEARNMORE)):void this._disable(t.LARGE_PLAY_BTN)):void 0},_onAdEnd:function(e){uvpjs.log(this.DEBUG_ID,"_onAdEnd",this.dom.outer.id,e.target),this.dom.outer.id===e.target&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._hide(this.css.AD_LEARNMORE))},_onCaptionsReady:function(e){uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",e),this.dom.outer.id===e.target&&(this.captions.loaded=!0,this.captions.css=this.VCI.getCaptionsStyle(),(this.mc.isOpera()||this.mc.isSafari()||this.mc.isChrome())&&this._enableMenuItem("cc"),this._enableSettingsBtn(),this._enableButton(this.css.CLOSED_CAPTION_BTN))},_onContentStart:function(e){uvpjs.log(this.DEBUG_ID,"_onContentStart",e),this.dom.outer.id===e.target&&(this._enableProgress(),this.captions.loaded&&(this._enableSettingsBtn(),this._enableButton(this.css.CLOSED_CAPTION_BTN)),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._hide(this.css.AD_LEARNMORE)),this._isLive()?this._addModifier(this.PRIMARY_BLOCK,this.LIVE_MODIFIER):this._isStreaming()&&this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER))},_onContentEnd:function(e){uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this.dom.outer.id===e.target&&(this._removeModifier(this.PRIMARY_BLOCK,this.LIVE_MODIFIER),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER))},_onControlMuteUnmute:function(e){return t.has(e,"target")&&this.dom.outer.id===e.target&&(uvpjs.log(this.DEBUG_ID,"_onControlMuteUnmute",e),t.has(e,"type"))?"controlMute"===e.type?void this._updateVolumeUI(0):void("controlUnmute"===e.type&&this._updateVolumeUI(this._currentVolume)):void 0},_onResourceEnd:function(e){t.has(e,"target")&&this.dom.outer.id===e.target&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",e),this._hide(this.css.CONTROLS))},_onVolumeChange:function(e){if(uvpjs.log(this.DEBUG_ID,"_onVolumeChange",e),!t.isUndefined(e)){var i=this.VCI.getPlayerMuted();if(0===this._currentVolume&&!i&&this._unmuteClick)return this._unmuteClick=!1,this._currentVolume=this._unmuteVolume,void this.VCI.setVolume(this._unmuteVolume);0===e&&this._currentVolume>0?this.VCI.mute():0===this._currentVolume&&e>0&&this.VCI.unMute(),this._updateVolumeUI(e),this._currentVolume=e}},_onVideoProgress:function(e){var i=this.VCI.getVolume();if(i!==this._currentVolume&&this._onVolumeChange(i),t.has(e,"target")&&this.dom.outer.id===e.target){var n=e.payload,s=n.playbackState;s!==this._playbackState&&(this._playbackState=s,this._updatePlaybackStateUI(this._playbackState));var a=this._queryByElementName(this.css.TIME_DURATION),r=this._queryByElementName(this.css.TIME_CURRENT);a.innerHTML=this._formatTimestampByType(this.css.TIME_DURATION,parseInt(n.duration)),r.innerHTML=this._formatTimestampByType(this.css.TIME_CURRENT,parseInt(n.currentTime)),this._updateProgressLoad(n),s===this.mc.PLAYING&&this._updateProgressUI(n)}},_onVideoLoading:function(e){t.has(e,"target")&&this.dom.outer.id===e.target&&t.isObject(e)&&t.has(e,"payload.data")&&this._updateProgressLoad(e.payload.data)},_onVideoStateChange:function(e){if(uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",e),t.isObject(e)&&this.dom.outer.id===e.target&&t.isObject(e.payload)&&t.isNumber(parseInt(e.payload.newState))){var i=e.payload.newState;i!==this._playbackState&&(this._playbackState=i,this._updatePlaybackStateUI(this._playbackState))}},_updatePlaybackStateUI:function(e){var t=this.css;switch(uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",e),e){case this.mc.PLAYING:this._show(t.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(t.LARGE_PLAY_BTN),this._hide(t.PREVIEW_BTN),this._hide(t.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER);break;case this.mc.PAUSED:this._show(t.CONTROLS),this._showControlBar(),this._hide(t.BUFFERING_FRAME),this._show(t.LARGE_PLAY_BTN),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER);break;case this.mc.STOPPED:this._hide(t.CONTROLS);break;case this.mc.BUFFERING:this._show(t.CONTROLS),this._hide(t.PREVIEW_BTN),this._hide(t.LARGE_PLAY_BTN),this._show(t.BUFFERING_FRAME);break;case this.mc.LOADING:this._show(t.CONTROLS),this._hide(t.PREVIEW_BTN),this._hide(t.LARGE_PLAY_BTN),this._show(t.BUFFERING_FRAME)}},_updateProgressUI:function(e){var t=Math.ceil(e.currentTime/e.duration*1e4)/1e4;this._updateProgressSlider(t)},_updateVolumeUI:function(e){var t=this.VCI.getPlayerMuted(),i=t?0:e;this._volumeSlider.value=i,this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,i);var a=this._getClassName(this.css.VOLUME_BTN,this.MUTED_MODIFIER);return t?void n(this._volumeBtn,a):void s(this._volumeBtn,a)},_updateSliderUI:function(e,i,n){if(!t.isUndefined(this._vendorPrefix)&&!t.isUndefined(e)){var s=this,a={};if(a.id="#"+this.dom.outer.id,a.cls=s._getClass(i),a.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[s._vendorPrefix],this._isMSEdge&&(a.pseudo=""),a.add=function(e,i,n){if(!t.isUndefined(this.pseudo)){var a=this.id+(i||"")+" "+this.cls+(n||"")+this.pseudo;s._addCSSRule(a,"background-size",100*e+"% 100%")}},a.before=function(e,t){this.add(e,s._getClass(s.PRIMARY_BLOCK,t),null)},a.after=function(e,t){this.add(e,null,t)},i===s.css.VOLUME_SLIDER)return void a.add(n);var r=n*e.offsetWidth,o=(.5-n)*e.offsetHeight,l=r/e.offsetWidth,d=(r+o)/e.offsetWidth;e.value=n;var u=s._hasAd();a.before(l,u?s.AD_MODIFIER:null),u||a.after(d,":hover"),this._isTouch&&a.before(d,s.TOUCH_MODIFIER)}},_onUVPJSGestureEvent:function(e){switch(e.type){case"mouseenter":this._onUVPJSMouseEnter(e);break;case"mouseleave":this._onUVPJSMouseLeave(e);break;case"mousemove":this._onUVPJSMouseMove(e);break;case"mousedown":this._onUVPJSMouseDown(e);break;case"mouseup":this._onUVPJSMouseUp(e);break;case"click":this._showControlBar(e);break;case"touchstart":this._onUVPJSTouchStart(e);break;case"touchend":this._onUVPJSTouchEnd(e)}},_onProgressSliderEvent:function(e){switch(e.type){case"input":case"change":this._onProgressSliderChange(e);break;case"touchstart":case"mousedown":this._onProgressSliderStart(e);break;case"touchend":case"mouseup":this._onProgressSliderEnd(e)}},_onVolumeSliderEvent:function(e){switch(e.type){case"input":case"change":this._onVolumeSliderChange(e);break;case"mouseover":this._showVolumeSlider(e);break;case"mouseout":this._hideVolumeSlider(e)}},_onVolumeBtnEvent:function(e){switch(e.type){case"click":this._onVolumeBtnClick(e);break;case"mouseover":this._showVolumeSlider(e);break;case"mouseout":this._hideVolumeSlider(e)}},_onUVPJSMouseEnter:function(e){e.stopPropagation(),this.dom.outer.el===e.target&&(this._hasPaused()||this._showControlBar(e))},_onUVPJSMouseDown:function(e){e.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(e){if(uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),!this._previewCallbackDone)return void uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart preview not called yet.");if(!this._hasDisabled(this.css.CONTROLS)){var t=this.VCI.getCurrentPlaybackState().playbackState;if(t!==this.mc.EMPTY&&(this._updateProgressSlider.cancel(),this._onUVPJSTouchStart.timeStamp=e.timeStamp,this._onUVPJSTouchStart.isFirstTouch=!this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),e.target===this._progressSlider)){var i=1-(e.target.clientWidth-e.layerX)/e.target.clientWidth;this._onProgressSliderChange(e,i)}}},_onUVPJSTouchEnd:function(e){var i=this.css;if(!this._hasDisabled(i.CONTROLS)){var n=this,s=n._onUVPJSTouchStart,a=n._onUVPJSTouchEnd,r={};r.duration=e.timeStamp-s.timeStamp,r.timeoutID=a.timeoutID,r.buttons=[i.PLAYSTATE_BTN,i.FULLSCREEN_BTN,i.SETTINGS_BTN,i.SETTINGS_MENU,i.SETTINGS_MENU_ITEM,i.SETTINGS_MENU_INPUT],r.isFirstTouch=s.isFirstTouch,r.isButton=t.some(r.buttons,function(t){return e.target.className.indexOf(t)>-1}),r.isPaused=this._hasPaused(),r.setup=function(){t.isNumber(this.timeoutID)&&this.cancel(),this.preventClick=!this.isButton&&(this.isFirstTouch||this.duration>this.TOUCH_CLICK_THRESHOLD),this.delay=this.timeoutID||this.preventClick?n.HIDE_DELAY:0,this.preventClick&&e.preventDefault(),a.timeoutID=setTimeout(this.end.bind(this),this.delay)},r.cancel=function(){clearTimeout(this.timeoutID)},r.end=function(){n._hasPaused()||(n._removeModifier(n.PRIMARY_BLOCK,n.TOUCH_MODIFIER),a.timeoutID=void 0)},r.setup()}},_onUVPJSMouseUp:function(e){e.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(e){var t=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[t]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[t]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(e){var t=this._getClassName(e,this.ACTIVE_MODIFIER);-1!==this._intervals[t]&&(this._isMouseActive||(this._removeModifier(e,this.ACTIVE_MODIFIER),this._hideControlBar(),clearInterval(this._intervals[t]),this._intervals[t]=-1))},_onUVPJSMouseLeave:function(e){e.stopPropagation(),this.dom.outer.el===e.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(e){e.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(e){e.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(e){var t=this.dom.outer.el.offsetWidth;t>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),t<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(e){return this._hasDisabled(this.css.VOLUME_BTN)?void 0:this.VCI.getPlayerMuted()?(this._unmuteClick=!0,void this.VCI.unMute()):void this.VCI.mute()},_onVolumeSliderChange:function(e){var t=parseFloat(e.target.value),i=this.VCI.getPlayerMuted();i&&t>0&&this.VCI.unMute(),this.VCI.setVolume(t),this._updateVolumeUI(t)},_onFullscreenBtnClick:function(){return this._hideVolumeSlider(),this._hasFullscreenMode()?void this._exitFullscreen():void this._enterFullscreen()},_onPlayToggle:function(e){uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.VCI.vidContId = ",this.VCI.vidContId),e.stopPropagation(),e.preventDefault();var t=this.VCI.getCurrentPlaybackState().playbackState;return uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",t),t===this.mc.PAUSED||t===this.mc.EMPTY||t===this.mc.LOADING?void this.VCI.playVideo():void(t!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.VCI.pauseVideo()))},_onPreviewBtn:function(e){uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),e.stopPropagation(),this._previewCallbackDone||(this._previewCallbackDone=!0,this._previewCB())},_onLoadedMetadata:function(e){uvpjs.log(this.DEBUG_ID,"_onLoadedMetadata"),this._canFullscreen=this._hasNativeFullscreen(),this._canFullscreen&&(this._enableButton(this.css.FULLSCREEN_BTN),this._setupFullscreenEventListener())},_setupFullscreenEventListener:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._handleFullscreenEvent.bind(this),!0),this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1),document.addEventListener(this.mc.getFullscreenEventName(),this._handleFullscreenEvent.bind(this),!1))},_onClosedCaptionBtnClick:function(e){uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),e.stopPropagation();var t=this.css.CLOSED_CAPTION_BTN,i=this._hasActive(t);return i?(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.VCI.hideCaptions()):(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.VCI.showCaptions(),void this._setCCVerticalPosition())},_onSettingsBtnClick:function(e){uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),e.stopPropagation();var t=this.css.SETTINGS_MENU,i=this._hasHidden(t);return uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",i),i?(this._addModifier(t,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(t)):(this._removeModifier(t,this.ACTIVE_MODIFIER),void this._hide(t))},_onSettingsMenuBtnClick:function(e){uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",e);var t=e.target.getAttribute("data-target");uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",t),e.target.parentNode.setAttribute("data-target",t);var i=this._findMenuItem(t);this._generateSettingsMenu(i.items,t)},_onSettingsMenuInputClick:function(e){uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",e);var i=e.target,n=i.parentNode,s=n.getAttribute("data-target"),a=s.split(":")[0];t(n.children).each(function(e){e.setAttribute("data-selected","false")}.bind(this)),i.setAttribute("data-selected","true"),"cc"===a?this._onSettingsCaptionsChange(e):"controls"===a&&this._onSettingsControlsChange(e)},_onSettingsCaptionsChange:function(e){uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange",e);var t=e.target,i=t.getAttribute("data-property"),n=t.getAttribute("data-value").toLowerCase();if(this.captions.css[i]=n,"background-opacity"===i){var s=this.captions.css["background-color"],a=r(s);if(uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange bgColor, rgb",s,a),a){var o=[a.r,a.g,a.b].join(",");i="background-color",n="rgba("+o+","+n+")"}}uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",i,n),this._setCaptionsStyleProperty(i,n)},_onSettingsControlsChange:function(e){uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",e);var t=e.target,i=t.getAttribute("data-property"),n=t.getAttribute("data-value").toLowerCase(),s="#"+this.dom.outer.id+" ";if("background-opacity"===i){i="background-color";var a=this._queryByElementName(this.css.CONTROL_BAR),r=getComputedStyle(a).getPropertyValue(i);if(-1===r.indexOf("rgba"))return;n=r.split(",").slice(0,-1).join(",")+", "+n+")",uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",n),s+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(s,i,n)},_setCaptionsStyle:function(e){this.captions.loaded&&(uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",e),this.VCI.setCaptionsStyle(e))},_setCaptionsStyleProperty:function(e,t){this.captions.loaded&&(uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",e,t),this.VCI.setCaptionsStyleProperty(e,t))},_setCueProperty:function(e,t){if(this.captions.loaded){var i=this.dom.video.el.textTracks;i&&(uvpjs.log(this.DEBUG_ID,"_setCueProperty",e,t),this.VCI.setCaptionsCueProperty(e,t))}},_setCCVerticalPosition:function(){if(this.captions.loaded){var e=this.dom.video.el.textTracks;if(e){var t=this.css.CONTROL_BAR,i=this._hasHidden(t)?0:this._queryByElementName(t).offsetHeight,n=this.dom.video.el.offsetHeight,s=100*(1-(i+this.CAPTION_PADDING)/n);this._setCueProperty("line",s)}}},_showControlBar:function(e){var i=this.css;if(this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)){uvpjs.log(this.DEBUG_ID,"_showControlBar");var n=this.VCI.getCurrentPlaybackState().playbackState;n!==this.mc.EMPTY&&(t.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[i.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(i.CONTROL_BAR),this._show(i.PROGRESS),this._setCCVerticalPosition())}},_hideMenu:function(e){this._hasHidden(this.css.SETTINGS_MENU)||e.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(e){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(uvpjs.log(this.DEBUG_ID,"_hideControlBar"),this._hideControlBar.hide=t.debounce(function(){return this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch?void this._hideControlBar.hide.cancel():(this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS),void this._setCCVerticalPosition())},e||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(e){var t=this.css;this._hasDisabled(t.VOLUME_BTN)||this._hasDisabled(t.CONTROLS)||(this._hasActive(t.SETTINGS_MENU)&&this._hide(t.SETTINGS_MENU),this._addModifier(t.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(t.VOLUME_SLIDER))},_hideVolumeSlider:function(e){this._isMouseActive||(this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS);
},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableSettingsBtn:function(){var e=t.some(this.settingsMenu,"enabled");e&&this._enableButton(this.css.SETTINGS_BTN)},_setUnmuteVolume:function(e){0!==this._currentVolume&&(this._unmuteVolume=this._currentVolume)},_onProgressSliderChange:function(e,t){uvpjs.log(this.DEBUG_ID,"_onProgressSliderChange");var i=this.VCI.getContentVideoData(),n=this.VCI.getCurrentPlaybackState(),s=t||this._progressSlider.value;s=s>1?1:0>s?0:s;var a=Math.ceil(s*i.duration*1e4)/1e4,r=Math.abs((n.currentTime-a)/a);this._updateProgressSlider(s),this._updateProgressSlider.flush(),this._hasActive(this.css.PROGRESS_SLIDER)||.02>=r||this.VCI.seekTo(a)},_onProgressMouseOver:function(e){e.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(e){e.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(e){return this._hasAd()||this._hasDisabled(this.css.PROGRESS)?(e.stopPropagation(),void e.preventDefault()):(uvpjs.log(this.DEBUG_ID,"_onProgressSliderStart"),this._addModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._returnToPause=this.VCI.getCurrentPlaybackState().playbackState===this.mc.PAUSED,void(this._returnToPause||this.VCI.pauseVideo()))},_onProgressSliderEnd:function(e){return this._hasAd()||this._hasDisabled(this.css.PROGRESS)?(e.stopPropagation(),void e.preventDefault()):(this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._onProgressSliderChange(e),this._returnToPause||this.VCI.playVideo(),void(this._returnToPause=!1))},_updateProgressLoad:function(e){if(!this._isLive()){var i=Math.ceil(e.bufferLength/e.duration*1e4)/1e4;if(!t.isNaN(i)&&(this._downloaded=i,!this._hasAd())){var n=this._queryByElementName(this.css.PROGRESS_LOADED);n.value=this._downloaded}}},_checkControlOnDOM:function(e){var t=this.ID_SELECTOR_PREFIX+this.dom.controls.id+" "+this.CLASS_SELECTOR_PREFIX+e,i=this._controlCache[t];return i||(i=document.querySelector(t)),i?(this._controlCache[t]=i,!0):!1},_getClassName:function(e,t){var i=this.PRIMARY_BLOCK;return e!==this.PRIMARY_BLOCK&&(i+=this.BLOCK_ELEMENT_DELIMITER+e),t&&(i+=this.ELEMENT_MODIFIER_DELIMITER+t),i},_getClass:function(e,t){return this.CLASS_SELECTOR_PREFIX+this._getClassName(e,t)},_queryByClassName:function(e){var t=this.ID_SELECTOR_PREFIX+this.dom.outer.id;e!==this.PRIMARY_BLOCK&&(t+=" "+this.CLASS_SELECTOR_PREFIX+e);var i=this._controlCache[t]||document.querySelector(t);return i&&(this._controlCache[t]=i),i},_queryAllByClassName:function(e){var t=this.ID_SELECTOR_PREFIX+this.dom.outer.id;return e!==this.PRIMARY_BLOCK&&(t+=" "+this.CLASS_SELECTOR_PREFIX+e),document.querySelectorAll(t)},_queryByElementName:function(e){return this._queryByClassName(this._getClassName(e))},_queryAllByElementName:function(e){return this._queryAllByClassName(this._getClassName(e))},_show:function(e){this._removeModifier(e,this.HIDDEN_MODIFIER)},_hide:function(e){this._addModifier(e,this.HIDDEN_MODIFIER)},_enable:function(e){this._removeModifier(e,this.DISABLED_MODIFIER)},_disable:function(e){this._addModifier(e,this.DISABLED_MODIFIER)},_enableMenuItem:function(e){if(e){var t=this._findMenuItem(e);t&&(t.enabled=!0)}},_hasHidden:function(e){return this._hasModifier(e,this.HIDDEN_MODIFIER)},_hasActive:function(e){return this._hasModifier(e,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(e){return this._hasModifier(e,this.DISABLED_MODIFIER)},_hasFullscreen:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){var e=this.VCI.getContentVideoData();return e.isLive&&this._isStreaming()},_isPlaying:function(){var e=this.VCI.getContentVideoData();return e.deliveryType&&e.deliveryType===this.mc.PLAYING},_isStreaming:function(){var e=this.VCI.getContentVideoData();return e.deliveryType&&e.deliveryType===this.mc.STREAMING},_hasModifier:function(e,n){t.isArray(n)&&(n=n.join(this.MODIFIER_DELIMETER));var s=this._getClassName(e,n),a=this._queryByElementName(e);return a?i(a,s):!1},_addModifier:function(e,i){t.isArray(i)&&(i=i.join(this.MODIFIER_DELIMETER));var s=this._getClassName(e,i),a=this._queryByElementName(e);a&&n(a,s)},_removeModifier:function(e,i){t.isArray(i)&&(i=i.join(this.MODIFIER_DELIMETER));var n=this._getClassName(e,i),a=this._queryByElementName(e);a&&s(a,n)},_toggleModifier:function(e,i){t.isArray(i)&&(i=i.join(this.MODIFIER_DELIMETER));var n=this._getClassName(e,i),s=this._queryByElementName(e);s&&a(s,n)},_handleFullscreenEvent:function(e){return this._hide(this.css.VOLUME_SLIDER),e.stopPropagation(),this._hasFullscreen()?(this.VCI.fullscreen(!1),void this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER)):(this.VCI.fullscreen(!0),void this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER))},_hasFullscreenMode:function(){var e=!1,t=this.dom.video.el;return document.msFullscreenElement?document.msFullscreenEnabled:(document.mozFullScreenElement?e=document.mozFullScreenEnabled:document.webkitFullscreenElement?e=document.webkitFullscreenEnabled:document.fullscreenElement?e=document.fullscreenEnabled:t.webkitDisplayingFullscreen&&(e=t.webkitDisplayingFullscreen),e)},_hasNativeFullscreen:function(){var e=this.dom.video.el;return e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.requestFullscreen||e.webkitSupportsFullscreen?!0:!1},_enterFullscreen:function(){var e=this.dom.outer.el,t=this.dom.video.el;if(this._isIOS){if(t.webkitDisplayingFullscreen)return!1;if(t.webkitEnterFullscreen)return t.webkitEnterFullscreen(),!0}return e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?!1:(e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),!0)},_exitFullscreen:function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},_formatTimestamp:function(e){if(t.isNull(e))return this.NULL_TIME;t.isNaN(e)&&(e=0),e=Math.floor(e);var i=0,n=0,s=0;e>=3600&&(i=Math.floor(e/3600),e=Math.floor(e-3600*i)),e>=60?(n=Math.floor(e/60),s=Math.floor(e-60*n)):t.isNaN(e)||(s=e),n=2!=n.toString().length?"0"+n:n,s=2!=s.toString().length?"0"+s:s;var a="00"!=i?i+":":"";return a+=n+":"+s},_formatTimestampByType:function(e,t){if("undefined"==typeof t||0>t){if(e===this.css.TIME_DURATION)return this.NULL_TIME;if(e===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(t)},_addCSSRule:function(e,i,n){var s=this._styleSheet.sheet,a=s.cssRules.length;if(!t.isUndefined(this._cssRules[e])){var r=s.rules||s.cssRules;if(r.length>0)return void(r[this._cssRules[e]].style[i]=n)}this._cssRules[e]=a;var o=i+":"+n;return s.insertRule?void s.insertRule(e+"{"+o+"}",a):void(s.addRule&&s.addRule(e,o,a))},_createStyleSheet:function(e,i){var n=t.isString(e),s=this.mc.isFirefox(),a=!n||s?"style":"link",r=document.createElement(a);r.setAttribute("type","text/css"),r.appendChild(document.createTextNode("")),n&&(r.setAttribute("rel","stylesheet"),r.setAttribute("href",this._cssPath),r.textContent='@import "'+this._cssPath+'"');var o=this;r.onload=function(){i(r)},r.addEventListener&&r.addEventListener("load",i.bind(o,r),!1),r.onreadystatechange=function(){var e=r.readyState;("loaded"===e||"complete"===e)&&(link.onreadystatechange=null,i(r))};var l=document.styleSheets.length,d=setInterval(function(){document.styleSheets.length>l&&(i(r),clearInterval(d))},10);if(s)var u=setInterval(function(){try{r.sheet.cssRules,i(r),clearInterval(u)}catch(e){uvpjs.log(o.DEBUG_ID,"Error trying to load CSS in Firefox.",e)}},10);document.getElementsByTagName("head")[0].appendChild(r)},_setStyleSheet:function(e){function i(i){this._styleSheet=i,t.isFunction(e)&&!e.done&&(uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),e.done=!0,e())}uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleSheet||this._createStyleSheet(null,i.bind(this))},_templateToHTML:function(e){function i(e){var a="";return t(e).each(function(e){e&&(e.cls=t.isUndefined(e.cls)?n(e.el):[e.cls,n(e.el)].join(" "),e.children&&(e.children=i(e.children)),a+=t.template(s[e.type],{variable:"o"})(e))}),a}if(t.isArray(e)&&!t.isEmpty(e)){var n=function(e){return this._getClassName(this.css[e])}.bind(this),s={button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'};return i(e)}}});var i=function(e,i){return!t.isNull(e.className.match(new RegExp("(\\s|^)"+i+"(\\s|$)")))},n=function(e,t){i(e,t)||(e.className=(e.className+=" "+t).trim())},s=function(e,t){e.className=e.className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)")," ").trim()},a=function(e,t){return i(e,t)?void s(e,t):void n(e,t)},r=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,n){return t+t+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.adPods={}},initialize:function(e,i,n,s){return uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",e),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",i),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",n),t.isArray(i)?(this.vidContId=e,void this._generateAdPods(i,n,s)):void uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN")},_generateAdPods:function(e,i,n){uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",e),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",i);var s,a;this.adPods={},i.length>0&&(i.indexOf(0)>-1&&(this.adPods[this.PRE]={startTime:0,hasPlayed:!1,adPodId:this.PRE+"_0",adCount:0,podDuration:0,adCallURL:n}),i.indexOf(-1)>-1&&(this.adPods[this.POST]={startTime:0,hasPlayed:!1,adPodId:this.POST+"_0",adCount:0,podDuration:0,adCallURL:n}));for(s in e)a=Number(s)+1,t.isNaN(e[s])||(this.adPods[this.MID_+a]={startTime:e[s],hasPlayed:!1,adPodId:this.MID_+a,adCount:0,podDuration:0,adCallURL:n});uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods        this.adPods = ",this.adPods)},getAdPodById:function(e){if(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",e),t.isString(e)){var i=this.adPods[e];return uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",i),i}},isPreRoll:function(e){return t.isUndefined(e.adPodId)?!1:e.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(e){return t.isUndefined(e.adPodId)?!1:e.adPodId.indexOf(this.MID)>-1},isPostRoll:function(e){return t.isUndefined(e.adPodId)?!1:e.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){return t.some(this.adPods,this.isMidRoll)},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(e){uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod      absSeekTime = ",e);var i,n,s={};for(var i in this.adPods)n=this.adPods[i],this.isPreRoll(n)||this.isPostRoll(n)||n.startTime<=e&&(t.isEmpty(s)?s=n:e-n.startTime<e-s.startTime&&(s=n));return uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod        rtnPod.hasPlayed = ",s.hasPlayed),!t.isEmpty(s)&&s.hasPlayed&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod !_.isEmpty(rtnPod) && rtnPod.hasPlayed   rtnPod = {} "),s={}),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod       rtnPod.adPodId = ",s.adPodId),s}})}(uvpjs.register("uvpjs")),function(t){var i=t._;t.TrackingManager=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",VOD:"vod"},_contentFirstQFired:!1,_contentMidFired:!1,_contentThirdQFired:!1,_contentVODFired:{},init:function(){uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.progressEventCBs={},this.agents=[],this.pluginsLoaded=!1,this.componentid=e("randomString"+Math.floor(1e6*Math.random())),this.mc=uvpjs.mediaCapabilities},initialize:function(e,t){uvpjs.log(this.DEBUG_ID,"initialize"),i.isString(e)&&i.isObject(t)&&(this.vidContId=e,this.cviMgr=t,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this._createAgentsArray(),this._addTrackingEventListeners(),this._initializeAgents())},loadAgentPlugins:function(e,t){if(this._createAgentsArray(e),i.isEmpty(this.agents))return uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled."),void t();var n=this.mc.hasTealium();n&&uvpjs.log(this.DEBUG_ID,"Tealium detected on the page."),this.agentsLoadedCB=t;var s=this;i.forEach(s.agents,function(t){return i.isFunction(t.loadPlugin)?void t.loadPlugin(s._onPluginLoaded.bind(s),e.sessionOptions):(s.agents.pop(t),void s._onPluginLoaded.call(s))})},fireTrackingPixel:function(e){var t=(new Date).getTime(),i=document.createElement("img");i.setAttribute("id","img_"+t),i.setAttribute("src",e),i.setAttribute("width","1"),i.setAttribute("height","1"),i.setAttribute("border","0"),i.style.position="absolute",i.style.bottom="0",i.style.right="0";var n=document.createElement("div");n.id="uvpjstrack_"+t,n.appendChild(i),document.getElementsByTagName("body")[0].appendChild(n)},registerEventCallbacks:function(e){if(i.isPlainObject(e)&&!i.isEmpty(e))for(var t in e)this.eventCBs[t]=this.eventCBs[t]||[],this.eventCBs[t].push(e[t])},registerProgressEvents:function(e){if(i.isPlainObject(e)&&!i.isEmpty(e))for(var t in e)uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",t),this.progressEvents[t]=this.progressEvents[t]||[],this.progressEvents[t].push(e[t])},getPlayhead:function(){return this.cviModel.contentPlaybackState.currentTime},getPlayerName:function(e,t){var n=this.PLAYER_NAME;return i.isEmpty(n)?"UVPJS":(e&&(n=n.replace("_",e)),t&&(n=n.replace(/\./g,t)),n)},_addAgentEventListeners:function(){for(var e in this.eventCBs)this.eventsMgr.addEventListener(e+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(e){if(e.target===this.vidContId){var t=this.eventCBs[e.type];if(!i.isEmpty(t))for(var n=0;n<t.length;n++)t[n](e)}},_createAgentsArray:function(e){var t=e||this.cviModel,i=t.isModuleEnabled.bind(t);i(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),this.adobeHeartbeatAgent=new uvpjs.AdobeHeartbeatAgent,this.agents.push(this.adobeHeartbeatAgent)),i(this.COMSCORE_SS_MODULE_NAME)&&(uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),this.comScoreAgent=new uvpjs.ComScoreAgent,this.agents.push(this.comScoreAgent)),(i(this.DW_MODULE_NAME)||i(this.LEGACY_DW_MODULE_NAME))&&(uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),this.dwAgent=new uvpjs.DWAgent,this.agents.push(this.dwAgent))},_onPluginLoaded:function(){uvpjs.log(this.DEBUG_ID,"_onPluginLoaded");var e=i.every(this.agents,"pluginLoadedCB.done");uvpjs.log(this.DEBUG_ID,"pluginLoadedCB pluginsLoaded",e),e&&i.isFunction(this.agentsLoadedCB)&&(uvpjs.log(this.DEBUG_ID,"loadAgentPlugins _pluginsLoaded all loaded."),this.agentsLoadedCB())},_initializeAgents:function(){if(uvpjs.log(this.DEBUG_ID,"_initializeAgents"),i.isEmpty(this.agents))return void uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled.");var e=this;i.forEach(e.agents,function(t){t.initialize(e)}),this._addAgentEventListeners()},_addTrackingEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this._onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.AD_QUARTILE+this.internalNS,this._onAdQuartile.bind(this))},_onAdQuartile:function(e){uvpjs.log(this.DEBUG_ID,"_onAdQuartile",e.payload)},_onProgressEvent:function(e){var t=this.progressEvents[e];i.isEmpty(t)||i(t).forEach(function(e){e()})},_onVideoProgress:function(){var e=this.getPlayhead(),t=Math.round(e);if(t%15===0&&60>=t||t%60===0){if(this._contentVODFired[t])return;this._contentVODFired[t]=!0,uvpjs.log(this.DEBUG_ID,"_onVideoProgress roundedTime",t),this._onProgressEvent(this.progressEvents.VOD)}var n=this.cviModel.contentVideoState.duration;if(!(10>=n)){var s=Math.floor(e/n*100);s!==this.percentDone&&(this.percentDone=s),i.inRange(s,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),i.inRange(s,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),s>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE))}}})}(uvpjs.register("uvpjs")),function(e){var t=e._;e.AdobeHeartbeatAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_LIB,SDK_VERSION:"1.6.7beta",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.path+"lib/tracking/AdobeAppMeasurement.js",HEARTBEAT:uvpjs.Configuration.path+"lib/tracking/AdobeHeartbeat.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_VIDEO_LOAD:"VideoLoad",HEARTBEAT_VIDEO_UNLOAD:"VideoUnload",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",_videoLoaded:!1,_isSeeking:!1,_isBuffering:!1,_adCompleted:!1,_adPlaying:!1,_hasNielsen:!1,_heartbeatDebug:!1,_appMeasurementData:{},_heartbeatData:{},_visitorData:{},_nielsenData:{},_contextMetadata:{},_sessionMetadata:{},_s:null,_usesTealium:!1,_waitForTealium:!1,init:function(){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init"),this.pluginLoadedCB={}},initialize:function(e){return uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),t.isObject(e)?(this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this.trackingMgr=e,this.eventsMgr=this.trackingMgr.eventsMgr,this.CVIModel=this.trackingMgr.cviModel,this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),t.isUndefined(this._visitorData.marketingCloudOrgId)?void uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."):void this.loadPlugin(this._initializePlugin)):void 0},loadPlugin:function(e,n){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),n=n||this.CVIModel.sessionOptions,this.pluginLoadedCB=e,this._usesTealium=n.usesTealium;var s=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];return this._usesTealium&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),s=t.without(s,this.scriptPaths.APP_MEASUREMENT)),i()&&!this.pluginLoadedCB.done?(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(s,this.pluginLoadedCB)):(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),t.isFunction(this.pluginLoadedCB)?void this.pluginLoadedCB():void uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!"))},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){return null},getNielsenMetadataInfo:function(){return{}},getNielsenAdMetadataInfo:function(){return{}},getNielsenChannelInfo:function(){return{}},_loadConfigData:function(){var e=this.CVIModel.getModuleParam.bind(this.CVIModel,this.trackingMgr.ADOBE_HEARTBEAT_MODULE_NAME),i=e(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),n=e(this.TRACKING_SERVER_PARAM_NAME),s=e(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME);if(this.mc.isSecure()&&(t.isString(n)&&(n=n.replace("om.","som.")),t.isString(i)&&(i=i.replace("heartbeats.omtrdc.net","cbsinteractive.hb.omtrdc.net"))),this._appMeasurementData={account:e(this.ACCOUNT_PARAM_NAME),charSet:e(this.CHAR_SET_PARAM_NAME),trackingServer:n},this._heartbeatData={publisher:s,trackingServer:i},this._visitorData={marketingCloudOrgId:s,trackingServer:n},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this._hasNielsen=this.CVIModel.isModuleEnabled(this.trackingMgr.NIELSEN_MODULE_NAME),this._hasNielsen){var a=this.CVIModel.getModuleParam.bind(this.CVIModel,this.trackingMgr.NIELSEN_MODULE_NAME);this._nielsenData={appInfo:{sfcode:a(this.NIELSEN_SFCODE_PARAM_NAME),apid:a(this.NIELSEN_APID_PARAM_NAME)||this.NIELSEN_DEFAULT_APID,apn:this.trackingMgr.PLAYER_NAME,nol_sdkDebug:a(this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME)},channelInfo:a(this.NIELSEN_CHANNEL_INFO_PARAM_NAME),configKey:"922e1d53d3e10abdde5cbea1b55459f5bacc65d4/55ba372b3336330017000bbf"}}uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._hasNielsen",this._hasNielsen),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._nielsenData =",this._nielsenData)},_loadSessionOptions:function(){var e=this.CVIModel.sessionOptions;this._usesTealium=e.usesTealium;var i={ftag:"ftag",netwk:"Network"};t.each(i,function(i,n){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",i,n);var s=e[n];t.isNull(s)||t.isUndefined(s)||t.isEmpty(s)||(this._sessionMetadata[i]=s)}.bind(this)),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks");var e=this.eventsMgr.eventTypes,t={};t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.CONTROL_SEEK]=this._onControlSeek.bind(this),t[e.RESOURCE_END]=this._onResourceEnd.bind(this),t[e.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),t[e.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),t[e.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),t[e.PLAYER_LOADED]=this._updateVideoInfo.bind(this),t[e.RESOURCE_START]=this._updateVideoInfo.bind(this),t[e.VIDEO_RESUME]=this._updateVideoInfo.bind(this),t[e.VIDEO_DONE]=this._updateVideoInfo.bind(this),this._setupContextMetadataEventCallback.done||(t[e.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(t)},_setupContextMetadataEventCallback:function(){var e={};e[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e),this._setupContextMetadataEventCallback.done=!0},_initializePlugin:function(){if(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),i())return void uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded.");var e=ADB.va.Heartbeat,s=ADB.va.HeartbeatConfig,a=ADB.va.plugins.videoplayer.VideoPlayerPlugin,r=ADB.va.plugins.videoplayer.VideoPlayerPluginConfig,o=ADB.va.plugins.aa.AdobeAnalyticsPlugin,l=ADB.va.plugins.aa.AdobeAnalyticsPluginConfig,d=ADB.va.plugins.ah.AdobeHeartbeatPlugin,u=ADB.va.plugins.ah.AdobeHeartbeatPluginConfig,h=ADB.va.plugins.nielsen.NielsenPlugin,c=ADB.va.plugins.nielsen.NielsenPluginConfig,p=this.mc.isSecure();if(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!n(this._s)&&!this._waitForTealium)return uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium detected on the page."),void this._getTealium();if(this._usesTealium)var g=this._s;else{if("undefined"==typeof Visitor)return void uvpjs.error(this.DEBUG_ID,"Unable to create Visitor object. Adobe Heartbeat tracking setup failed.");if("undefined"==typeof AppMeasurement)return void uvpjs.error(this.DEBUG_ID,"Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed.");var v=this._appMeasurementData.account;if(t.isString(v)&&t.isEmpty(v))return this._setupContextMetadataEventCallback(),void uvpjs.warn(this.DEBUG_ID,'Adobe Heartbeat "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.');var f=new Visitor(this._visitorData.marketingCloudOrgId);f.trackingServer=this._visitorData.trackingServer,f.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),g=new AppMeasurement,g.visitor=f,g.account=v,g.trackingServer=this._appMeasurementData.trackingServer,g.pageName=this._appMeasurementData.pageName,g.charSet=this._appMeasurementData.charSet,g.visitorID=this._appMeasurementData.visitorID}if(t.isNull(g))return void uvpjs.error(this.DEBUG_ID,"Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed.");this._playerPlugin=new a(new uvpjs.CustomVideoPlayerPluginDelegate(this));var m=new r;m.debugLogging=this._heartbeatDebug,this._playerPlugin.configure(m),this._aaPlugin=new o(g,new uvpjs.CustomAdobeAnalyticsPluginDelegate);var _=new l;_.channel=this._heartbeatData.channel,_.debugLogging=this._heartbeatDebug,this._aaPlugin.configure(_);var E=new d(new uvpjs.CustomAdobeHeartbeatPluginDelegate),y=new u(this._heartbeatData.trackingServer,this._heartbeatData.publisher);y.ovp="",y.sdk=this.SDK_VERSION,y.debugLogging=this._heartbeatDebug,y.ssl=p,E.configure(y);var b=[this._playerPlugin,this._aaPlugin,E];if(this._hasNielsen){var A=new h(new uvpjs.CustomNielsenPluginDelegate(this._nielsenData,this)),S=new c;S.debugLogging=this._heartbeatDebug,S.appInfo=this._nielsenData.appInfo,S.configKey=this._nielsenData.configKey,A.configure(S),b.push(A)}this._heartbeat=new e(new uvpjs.CustomHeartbeatDelegate,b);var I=new s;I.debugLogging=this._heartbeatDebug,I.ssl=p,this._heartbeat.configure(I),this._setupEventCallbacks(),this.CVIModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad()},_getTealium:function(){if(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),n(this._s)||this._waitForTealium)return void uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.");this._getTealium.timer||(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin setting timeout."),this._getTealium.timer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT));var e=this;return t.has(window,"s")&&n(window.s)?(this._s=window.s,this._waitForTealium=!0,void this._initializePlugin()):(uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent `usesTealium` is `true`, but no Tealium `s` object detected.",window.s),void setTimeout(e.loadPlugin.bind(e,e.pluginLoadedCB.bind(e)),this.TEALIUM_RETRY_INTERVAL))},_onTealiumTimeout:function(){uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealium.timer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(e,i){if(t.isNull(this._playerPlugin))return void uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined");switch(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",e),e){case this.HEARTBEAT_VIDEO_LOAD:this._playerPlugin.trackVideoLoad();break;case this.HEARTBEAT_VIDEO_UNLOAD:this._playerPlugin.trackVideoUnload();break;case this.HEARTBEAT_SESSION_START:this._playerPlugin.trackSessionStart();break;case this.HEARTBEAT_PLAY:this._playerPlugin.trackPlay();break;case this.HEARTBEAT_PAUSE:this._playerPlugin.trackPause();break;case this.HEARTBEAT_COMPLETE:this._playerPlugin.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._playerPlugin.trackSeekStart();break;case this.HEARTBEAT_SEEK_COMPLETE:this._playerPlugin.trackSeekComplete();break;case this.HEARTBEAT_BUFFER_START:this._playerPlugin.trackBufferStart();break;case this.HEARTBEAT_BUFFER_COMPLETE:this._playerPlugin.trackBufferComplete();break;case this.HEARTBEAT_AD_START:this._playerPlugin.trackAdStart();break;case this.HEARTBEAT_AD_COMPLETE:this._playerPlugin.trackAdComplete();break;case this.HEARTBEAT_CHAPTER_START:this._playerPlugin.trackChapterStart();break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._playerPlugin.trackChapterComplete();break;case this.HEARTBEAT_BITRATE_CHANGE:this._playerPlugin.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._playerPlugin.trackVideoPlayerError(i)}},_getContentVideoMetadata:function(){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata");var e=this.CVIModel.getContentVideoState(),i={},n=this;return t.each(this._contextMetadata,function(e,t){uvpjs.log(n.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata this._contextMetadata",e,t),
i[t]=e}),t.each(this._sessionMetadata,function(e,t){uvpjs.log(n.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata this._sessionMetadata",e,t),i[t]=e}),i.tl=unescape(e.videoTitle),uvpjs.log(n.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",i),i},_onContextMetadata:function(e){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",e);var i=e.payload.contextMetadata;if(!t.isNull(i)&&!t.isEmpty(i)&&(this._contextMetadata=i,uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),!t.isEmpty(this._contextMetadata[this.PAGE_REPORT_SUITE_ID_KEY]),!t.isEmpty(this._contextMetadata[this.PAGE_SITE_ACCOUNT_KEY]))){var n=t.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=this._contextMetadata[this.PAGE_SITE_ACCOUNT_KEY],n&&(uvpjs.warn(this.DEBUG_ID,'No Adobe Heartbeat account specified in config. Attempting to reinitialize plugin with "account" =',this._appMeasurementData.account),this._initializePlugin())}},_setVideoLoad:function(){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad"),this._updateVideoInfo(),this._aaPlugin.setVideoMetadata(this._getContentVideoMetadata()),this._videoLoaded=!0,this._trackHeartbeatInfo(this.HEARTBEAT_VIDEO_LOAD),this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(e){if(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",e),!this._chapterInfo){var i=ADB.va.plugins.videoplayer.ChapterInfo;this._chapterInfo=new i}var n=e.chapterStartTimes,s=e.chapterStartTimes.length,a=parseInt(e.currentContentSegment);t.isNaN(a)&&(a=1);var r=0>a?0:a-1,o=0>=r?0:n[r],l=r+1>s?e.duration:n[r+1];uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",l,o),this._chapterInfo.name="",this._chapterInfo.length=l-o,this._chapterInfo.position=a,this._chapterInfo.startTime=n[r],uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(e){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",e),this._videoLoaded||this._setVideoLoad();var i=e.payload.adData;this._adPlaying=!0,this._adCompleted=!1;var n=ADB.va.plugins.videoplayer.AdBreakInfo,s=ADB.va.plugins.videoplayer.AdInfo,a=t.isEmpty(i.adVideoTitle)?"na":i.adVideoTitle;this._adBreakInfo=new n,this._adBreakInfo.name=a,this._adBreakInfo.position=1,this._adBreakInfo.playerName=this.trackingMgr.PLAYER_NAME,this._adBreakInfo.startTime=this._videoInfo.playhead,this._adInfo=new s,this._adInfo.id=t.isEmpty(i.adVideoId)?t.isEmpty(i.adVatId)?"na":i.adVatId:i.adVideoId,this._adInfo.name=a,this._adInfo.length=i.duration,this._adInfo.position=i.adPosition,this._aaPlugin.setAdMetadata({affiliate:"",campaign:""}),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._adPlaying=!1,this._adCompleted=!0,this._trackHeartbeatInfo(this.HEARTBEAT_AD_COMPLETE)},_onContentStart:function(e){var t=e.payload.contentData;uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",t),this._videoLoaded||this._setVideoLoad(),t.chapterStartTimes.length>0&&(this._setChapterInfo(t),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START)),this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onContentEnd:function(e){var t=e.payload.contentData;uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentEnd"),this._videoLoaded&&(this._aaPlugin.setVideoMetadata(),t.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE)),this._videoLoaded=!1,this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._trackHeartbeatInfo(this.HEARTBEAT_VIDEO_UNLOAD))},_onResourceEnd:function(e){this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null},_onControlPlay:function(){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(){uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._isSeeking=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START)},_onVideoStateChange:function(e){var t=this.CVIModel.playbackState;return this._isSeeking&&t===this.mc.PLAYING?(this._isSeeking=!1,void this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE)):this._isBuffering||t!==this.mc.BUFFERING?this._isBuffering&&t!==this.mc.BUFFERING?(this._isBuffering=!1,void this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):void 0:(this._isBuffering=!0,void this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START))},_updateVideoInfo:function(e){if(uvpjs.log(this.DEBUG_ID,"_updateVideoInfo this._videoInfo",this._videoInfo),"undefined"!=typeof ADB){var i=(this.eventsMgr.eventTypes,this.CVIModel.getCurrentPlaybackState()),n=this.CVIModel.getContentVideoState();if(!this._videoInfo){var s=ADB.va.plugins.videoplayer.VideoInfo;this._videoInfo=new s}this._videoInfo.id=t.isEmpty(n.mediaId)?"na":n.mediaId,this._videoInfo.name=n.videoTitle,this._videoInfo.playerName=this.trackingMgr.PLAYER_NAME,this._videoInfo.length=n.isLive?-1:n.duration,this._videoInfo.playhead=i.currentTime;var a=ADB.va.plugins.videoplayer.AssetType;this._videoInfo.streamType=n.isLive?a.ASSET_TYPE_LIVE:a.ASSET_TYPE_VOD,uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo evtObj",e),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo vs",n),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo ps",i),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)}},_updatePlayhead:function(e){var t=e.payload;this._videoInfo&&t&&(t.isAd||(this._videoInfo.playhead=t.currentTime))}});var i=function(){return"undefined"==typeof ADB||"undefined"===t.get(ADB,"va.Hearbeat")},n=function(e){return t.isObject(e)&&!t.isEmpty(e)&&t.isFunction(e.isReadyToTrack)}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.ComScoreAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,SCRIPT_PATH:uvpjs.Configuration.path+"lib/tracking/streamsense.5.1.1.160316.min.js",COMSCORE_SS_MODULE_NAME:"ComScore_ss",PARTNER_ID_PARAM_NAME:"partnerID",C2_PARAM_NAME:"c2",C3_PARAM_NAME:"c3",C4_PARAM_NAME:"c4",C6_PARAM_NAME:"c6",init:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.pluginLoadedCB={},this.streamingTag=null,this.partnerID=null,this.c2="3005086",this.c3="*null",this.c4="*null",this.c6="*null",this.clipCount=0},initialize:function(e){uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),t.isObject(e)&&(this.trackingMgr=e,this.eventsMgr=this.trackingMgr.eventsMgr,this.cviModel=this.trackingMgr.cviModel,this._loadConfigData(),this.loadPlugin(this._initializePlugin))},loadPlugin:function(e){return uvpjs.log(this.DEBUG_ID,"ComScoreAgent loadPlugin"),this.pluginLoadedCB=e,i()&&!this.pluginLoadedCB.done?(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.SCRIPT_PATH,this.pluginLoadedCB)):(uvpjs.log(this.DEBUG_ID,"ComScoreAgent loadPlugin plugin already loaded into the page"),t.isFunction(this.pluginLoadedCB)?void this.pluginLoadedCB():void uvpjs.warn(this.DEBUG_ID,"ComScoreAgent loadPlugin no callback supplied."))},_loadConfigData:function(){var e=this.cviModel.getModuleParam.bind(this.cviModel,this.COMSCORE_SS_MODULE_NAME);this.partnerID=e(this.PARTNER_ID_PARAM_NAME),this.c2=e(this.C2_PARAM_NAME)||this.c2,this.c3=e(this.C3_PARAM_NAME)||this.partnerID,this.c4=e(this.C4_PARAM_NAME)||this.trackingMgr.getPlayerName("|","_"),this.c6=e(this.C6_PARAM_NAME),uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.CONTROL_SEEK]=this._onControlSeek.bind(this),t[e.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(t)},_initializePlugin:function(){return i()?void uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."):(this.streamingTag=new ns_.StreamingTag({customerC2:this.c2}),uvpjs.log(this.DEBUG_ID,"ComScoreAgent _initializePlugin this.streamingTag",this.streamingTag),void this._setupEventCallbacks())},_getMetadata:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent _getMetadata");var e=this.cviModel.getContentVideoState(),i=this.cviModel.getContentPlaybackState();uvpjs.log(this.DEBUG_ID,"ComScoreAgent _getMetadata this.cviModel.getContentVideoState()",e),uvpjs.log(this.DEBUG_ID,"ComScoreAgent _getMetadata this.cviModel.getContentPlaybackState()",i);var n={c2:this.c2,c3:this.c3,c4:this.c4,c6:this.c6,ns_st_cn:this.clipCount,ns_st_pu:this.partnerID,ns_st_cl:1e3*i.duration||0,ns_st_de:e.seriesTitle,ns_st_pr:e.seriesTitle,ns_st_ep:t.isEmpty(e.episodeTitle)?e.videoTitle:e.episodeTitle,ns_st_pn:i.currentContentSegment,ns_st_cu:t.isEmpty(e.assetURL)?"none":e.assetURL,ns_st_ct:e.isLive?"vc13":i.duration>6e5?"vc12":"vc11",ns_st_ci:t.isEmpty(e.cmsRefGuid)?"na":e.cmsRefGuid,ns_st_tp:null,ns_st_pl:null,ns_st_st:null,ns_st_dt:null,ns_st_fee:null,ns_st_ge:null};return uvpjs.log(this.DEBUG_ID,"ComScoreAgent _getMetadata metadata",n),n},_onAdStart:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart"),this.clipCount++,this.streamingTag.playAdvertisement()},_onAdEnd:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd"),this.streamingTag.stop()},_onContentStart:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart"),this.clipCount++,this.streamingTag.playVideoContentPart(this._getMetadata())},_onContentEnd:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd"),this.streamingTag.stop()},_onControlPlay:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay"),this.streamingTag.playVideoContentPart(this._getMetadata())},_onControlPause:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this.streamingTag.stop()},_onControlSeek:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlSeek")},_onVideoStateChange:function(){uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange this.cviModel.ps",this.cviModel.ps)}});var i=function(){return"undefined"==typeof ns_||t.isUndefined(ns_.StreamSense)}}(uvpjs.register("uvpjs")),function(e){var t=e._;e.DWAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"//dw.cbsi.com/levt/video/e.gif?",RESUME_BEACON_URL:"//dw.cbsi.com/levt/beacon/e.gif?",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end"},tags:{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0},page:{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},whitelist:{},_gestval:{},_pauseStart:0,_agentStartTime:0,moduleName:"",init:function(){uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.whitelist[this.events.INIT]=["pageurl","testgroup","testname","testversion"]},initialize:function(e){uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),t.isObject(e)&&(this.trackingMgr=e,this.eventsMgr=this.trackingMgr.eventsMgr,this.cviModel=this.trackingMgr.cviModel,this.CDO=this.cviModel.CDO,this.moduleName=this.CDO.isModuleEnabled(this.DW_MODULE_NAME)?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,this.dwPageParams={},this.tags.content.componentid=this.trackingMgr.componentid,this.tags.content.device=this._getDevice(),this.tags.content.mapp=this.trackingMgr.getPlayerName(";"),this.tags.content.part=this.cviModel.sessionOptions.partner,this.tags.content.playertime=0,this.tags.content.siteid=this.trackingMgr.DEFAULT_SITEID,this.tags.content.ts=this.eventsMgr.sessionStartTime,this._setCMSDependentValues(),this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit())},_setCMSDependentValues:function(){var e=this.cviModel.sessionOptions.cms,t=this.cviModel.getContentVideoState(),i=this.cviModel.getCurrentPlaybackState(),n=uvpjs.mediaCapabilities;if(n.isChromecast()&&t.isLive)return void(this.tags.content.medastid="601");if(t.isLive&&i.isHDStreamLive)return this.tags.content.medastid="601",void(this.tags.ad.adastid=e===this.trackingMgr.PLATFORM_CMS?"43":"0");switch(e){case this.trackingMgr.PLATFORM_CMS:this.tags.ad.adastid="43",this.tags.content.medastid="595";break;case this.trackingMgr.LUMIERE_CMS:this.tags.ad.adastid="400",this.tags.content.medastid="31";break;case this.trackingMgr.PI_CMS:this.tags.ad.adastid="400",this.tags.content.medastid="9";break;default:this.tags.ad.adastid="0",this.tags.content.medastid="0",uvpjs.warn(this.DEBUG_ID,"DWAgent _setCMSDependentValues unknown CMS type.")}t.isLive&&t.isAffiliateFeed&&(this.tags.content.medastid="cbsnews"===this.cviModel.sessionOptions.playerId?"601":"600"),uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",this.tags.content.medastid,this.tags.ad.adastid)},_loadConfigParams:function(){var e=this,i=this.cviModel.getModuleParam.bind(this.cviModel,this.moduleName),n=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"];t.forEach(n,function(n){var s=e._getTagType(n),a=i(n);t.isUndefined(s)||t.isUndefined(a)||t.isNull(a)||t.isEmpty(a)||(uvpjs.log(e.DEBUG_ID,"DWAgent _loadConfigParams key",n,a),e.tags[s][n]=a)}),uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this.tags updated",this.tags)},_loadDWPageParams:function(){if("undefined"==typeof DW||t.isUndefined(DW.pageParams)||(this.dwPageParams=DW.pageParams),!t.isEmpty(this.dwPageParams)){var e=this,i=["asid","assetguid","astid","cid","edid","omnicookie","onid","pagetype","pguid","ptid","rsid","siteid","testgroup","testname","testversion","topicbrcrm","topicguid","ursuid","viewguid"];t.forEach(i,function(i){var n=e._getTagType(i),s=e.dwPageParams[i];t.isUndefined(n)||t.isUndefined(s)||t.isEmpty(s)||(e.tags[n][i]=e.dwPageParams[i])}),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this.tags updated",this.tags)}},_setupEventCallbacks:function(){var e=this.eventsMgr.eventTypes,t={};t[e.AD_START]=this._onAdStart.bind(this),t[e.AD_END]=this._onAdEnd.bind(this),t[e.AD_QUARTILE]=this._onAdQuartile.bind(this),t[e.CONTENT_START]=this._onContentStart.bind(this),t[e.CONTENT_END]=this._onContentEnd.bind(this),t[e.CONTROL_PLAY]=this._onControlPlay.bind(this),t[e.CONTROL_PAUSE]=this._onControlPause.bind(this),t[e.CONTROL_SEEK]=this._onControlSeek.bind(this),t[e.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),t[e.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(t),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var e=this.trackingMgr.progressEvents,t={};t[e.FIRST_QUARTILE]=this._onProgressEvent.bind(this,e.FIRST_QUARTILE),t[e.MID_QUARTILE]=this._onProgressEvent.bind(this,e.MID_QUARTILE),t[e.THIRD_QUARTILE]=this._onProgressEvent.bind(this,e.THIRD_QUARTILE),t[e.VOD]=this._onProgressEvent.bind(this,e.VOD),this.trackingMgr.registerProgressEvents(t)},_getDevice:function(){var e=uvpjs.mediaCapabilities,t={type:(e.getDevice()||"").toLowerCase(),os:(e.getOS()||"").toLowerCase(),ver:e.getOSVersion(),screensz:[screen.width,screen.height].join("x")};return s(t)},_getPlayerSize:function(){var e=this.cviModel.getContentVideoState();return[e.sourceWidth,e.sourceHeight].join("x")},_sendDWEvent:function(e){uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),this.tags.content.gestval=s(this._gestval);var t=this.BASE_URL+n(this.tags.content);e&&(t+="&"+n(this.tags.ad)),this.tags.content.event!==this.events.INIT&&(this.tags.content.playertime=this._getPlayerTime()),uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url",t,this.tags),this.trackingMgr.fireTrackingPixel(t),this._gestval={},this.tags.content.eventdur=0},_onProgressEvent:function(e){uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",e);var t=this.trackingMgr.progressEvents;if(e)switch(e){case t.FIRST_QUARTILE:this._gestval.pct=25;break;case t.MID_QUARTILE:this._gestval.pct=50;break;case t.THIRD_QUARTILE:this._gestval.pct=75}this._onControlPlay(),delete this._gestval.pct},_onInit:function(){uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,this.cviModel.getContentVideoState(),this.tags.content.event=this.events.INIT,this.tags.content.pageurl=location.href,this.tags.content.mso=this.trackingMgr.mso,this.tags.content.srchost=location.host;var e=uvpjs.mediaCapabilities;this.tags.page.ursuid=this.cviModel.sessionOptions.ursuid,this.tags.page.omnicookie=e.isMobile()?"mobile%20web":"desktop%20web",this.tags.content.v16=this.tags.page.viewguid,this.tags.content.v17=this.tags.page.topic,this.tags.content.v18=this.tags.page.topicbrcrm,this.tags.content.v19=this.tags.page.pagetype,this.tags.content.v20=this.tags.page.assetguid,this.tags.content.v21=e.isChromecast()?"chromecast":this.tags.page.omnicookie,this.tags.content.v23=this.tags.page.rsid,this.tags.content.v25=this.cviModel.sessionOptions.userStatus,this._onInit.done=!0,this._sendDWEvent()},_onAdStart:function(e){uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",e),this._setStartTags(e);var i=e.payload.adData,n=i.adClipID,s=n.indexOf("pre")>-1?"pre":n.indexOf("mid")>-1?"mid":n.indexOf("post")>-1?"post":"";this.tags.ad.adid=t.isEmpty(i.adVideoId)?"999":i.adVideoId,this.tags.ad.adnum=this.cviModel.adNum,this.tags.ad.adtime=0,this.tags.ad.adtitle=i.adVideoTitle,this.tags.ad.adtype=i.adType,this.tags.ad.adlength=i.duration,this.tags.ad.adbreak="",this.tags.ad.adpod=0,this.tags.ad.adpodpos=0,this.tags.ad.adpos=s,this._sendDWEvent(!0)},_onAdQuartile:function(e){uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",e),this.tags.content.event=this.events.PLAY,this.tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(e){uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",e);var t=e.payload.adData;this.tags.content.event=this.events.END,this.tags.ad.adtime=t.duration,this._sendDWEvent(!0)},_setStartTags:function(e){uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",e);var t=this.cviModel.getCurrentPlaybackState(),i=this.cviModel.getContentVideoState();uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags ps, vs",t,i),this.tags.content.event=this.events.START,this.tags.content.codec=i.fileType,this.tags.content.distntwrk=this.cviModel.sessionOptions.netwk,this.tags.content.playersz=this._getPlayerSize(),this.tags.content.sdlvrytype=this._getStreamType(),this.tags.content.v22=i.cmsRefGuid,this.tags.content.medid=i.isLive?"2344":i.mediaId,this.tags.content.medlength=i.duration,this.tags.content.mednum=this.cviModel.medNum,this.tags.content.medrls=i.pid,this.tags.content.medtitle=i.videoTitle,this._setStartTags.done=!0},_onContentStart:function(e){uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",e),this._setStartTags(e),this._updateTimeTags(),this._sendDWEvent()},_onContentEnd:function(){uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this.tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this.tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPlay:function(){uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),this._onInit.done&&this._setStartTags.done&&(this.tags.content.event=this.events.PLAY,this._pauseStart>0&&(this.tags.content.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),this.tags.content.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0),this._sendDWEvent())},_onControlPause:function(){uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this.tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlSeek:function(e){uvpjs.log(this.DEBUG_ID,"DWAgent _onControlSeek",e);var t=this.cviModel.contentPlaybackState,i=e.payload.seekTime,n=t.currentTime-i;this.tags.content.eventdur=Math.floor(Math.abs(n)),this.tags.content.event=n>0?this.events.REWIND:this.events.FORWARD,uvpjs.log(this.DEBUG_ID,"DWAgent seek",this.tags.content.event,this.tags.content.eventdur),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onVideoStateChange:function(e){},_updateTimeTags:function(){var e=this.trackingMgr.getPlayhead();this.tags.content.medtime=parseInt(e)},_getTagType:function(e){return t.has(this.tags.ad,e)?"ad":t.has(this.tags.content,e)?"content":t.has(this.tags.page,e)?"page":void 0},_getStreamType:function(e){var t=this.cviModel.getContentVideoState(),i=uvpjs.mediaCapabilities,n=t.deliveryType,s=t.isLive;return n===i.STREAMING?s?5:4:n===i.PROGRESSIVE?3:void 0},_getPlayerTime:function(){return t.isDate(this._agentStartTime)?parseInt((new Date-this._agentStartTime)/1e3):0}});var i=function(e,i,n){var s=[];return t.forEach(e,function(e,n){e=t.isUndefined(e)?"":encodeURIComponent(e),s.push([n,e].join(i))}),s.join(n)},n=function(e){return i(e,"=","&")},s=function(e){return i(e,":",";")}}(uvpjs.register("uvpjs"));var f=0;!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof g&&g.amd)g([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Hls=e()}}(function(){return function e(t,i,n){function s(r,o){if(!i[r]){if(!t[r]){var l="function"==typeof v&&v;if(!o&&l)return l(r,!0);if(a)return a(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var u=i[r]={exports:{}};t[r][0].call(u.exports,function(e){var i=t[r][1][e];return s(i?i:e)},u,u.exports,e,t,i,n)}return i[r].exports}for(var a="function"==typeof v&&v,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function a(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!a(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,a,l,d;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[e],o(i))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(r(i))for(a=Array.prototype.slice.call(arguments,1),d=i.slice(),n=d.length,l=0;n>l;l++)d[l].apply(this,a);return!0},n.prototype.addListener=function(e,t){var i;if(!s(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,"function"==typeof console.trace)),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!s(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var i,n,a,o;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],a=i.length,n=-1,i===t||s(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(i)){for(o=a;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){n=o;break}if(0>n)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],s(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(s(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,i){var n=arguments[3],s=arguments[4],a=arguments[5],r=JSON.stringify;t.exports=function(e){for(var t,i=Object.keys(a),o=0,l=i.length;l>o;o++){var d=i[o],u=a[d].exports;if(u===e||u["default"]===e){t=d;break}}if(!t){t=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},o=0,l=i.length;l>o;o++){var d=i[o];h[d]=d}s[t]=[Function(["require","module","exports"],"("+e+")(self)"),h]}var c=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[t]=t,s[c]=[Function(["require"],"var f = require("+r(t)+");(f.default ? f.default : f)(self);"),p];var g="("+n+")({"+Object.keys(s).map(function(e){return r(e)+":["+s[e][0]+","+r(s[e][1])+"]"}).join(",")+"},{},["+r(c)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(v.createObjectURL(new Blob([g],{type:"text/javascript"})))}},{}],3:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=e("../events"),d=n(l),u=e("../event-handler"),h=n(u),c=e("../helper/buffer-helper"),p=n(c),g=e("../errors"),v=e("../utils/logger"),f=e("./ewma-bandwidth-estimator"),m=n(f),_=function(e){function t(e){s(this,t);var i=a(this,Object.getPrototypeOf(t).call(this,e,d["default"].FRAG_LOADING,d["default"].FRAG_LOADED,d["default"].ERROR));return i.lastLoadedFragLevel=0,i._autoLevelCapping=-1,i._nextAutoLevel=-1,i.hls=e,i.onCheck=i.abandonRulesCheck.bind(i),i}return r(t,e),o(t,[{key:"destroy",value:function(){this.clearTimer(),h["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var t=this.hls,i=e.frag.level,n=t.levels[i].details.live,s=t.config,a=void 0,r=void 0;n?(a=s.abrEwmaFastLive,r=s.abrEwmaSlowLive):(a=s.abrEwmaFastVoD,r=s.abrEwmaSlowVoD),this.bwEstimator=new m["default"](t,r,a,s.abrEwmaDefaultEstimate)}var o=e.frag;o.trequest=performance.now(),this.fragCurrent=o}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,i=this.fragCurrent;if(!i.loader||i.loader.stats&&i.loader.stats.aborted)return v.logger.warn("frag loader destroy or aborted, disarm abandonRulesCheck"),void this.clearTimer();if(t&&(!t.paused||!t.readyState)&&i.autoLevel&&i.level){var n=performance.now()-i.trequest;if(n>500*i.duration){var s=e.levels,a=Math.max(1,1e3*i.loaded/n),r=Math.max(i.loaded,Math.round(i.duration*s[i.level].bitrate/8)),o=t.currentTime,l=(r-i.loaded)/a,u=p["default"].bufferInfo(t,o,e.config.maxBufferHole).end-o;if(u<2*i.duration&&l>u){var h=void 0,c=void 0;for(c=i.level-1;c>=0&&(h=i.duration*s[c].bitrate/(6.4*a),v.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay["+c+"] :"+l.toFixed(1)+"/"+u.toFixed(1)+"/"+h.toFixed(1)),!(u>h));c--);l>h&&(c=Math.max(0,c),e.nextLoadLevel=c,this.bwEstimator.sample(n,i.loaded),v.logger.warn("loading too slow, abort fragment loading and switch to level "+c),i.loader.abort(),this.clearTimer(),e.trigger(d["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:i}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.stats;void 0===t.aborted&&1===e.frag.loadCounter&&this.bwEstimator.sample(performance.now()-t.trequest,t.loaded),this.clearTimer(),this.lastLoadedFragLevel=e.frag.level,this._nextAutoLevel=-1}},{key:"onError",value:function(e){switch(e.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e,t,i=this.hls,n=i.levels,s=i.config;if(t=-1===this._autoLevelCapping&&n&&n.length?n.length-1:this._autoLevelCapping,-1!==this._nextAutoLevel)return Math.min(this._nextAutoLevel,t);var a=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,r=void 0;for(e=0;t>=e;e++)if(r=e<=this.lastLoadedFragLevel?s.abrBandWidthFactor*a:s.abrBandWidthUpFactor*a,r<n[e].bitrate)return Math.max(0,e-1);return e-1},set:function(e){this._nextAutoLevel=e}}]),t}(h["default"]);i["default"]=_},{"../errors":21,"../event-handler":22,"../events":23,"../helper/buffer-helper":24,"../utils/logger":38,"./ewma-bandwidth-estimator":6}],4:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,
n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=e("../events"),d=n(l),u=e("../event-handler"),h=n(u),c=e("../utils/logger"),p=e("../errors"),g=function(e){function t(e){s(this,t);var i=a(this,Object.getPrototypeOf(t).call(this,e,d["default"].MEDIA_ATTACHING,d["default"].MEDIA_DETACHING,d["default"].BUFFER_RESET,d["default"].BUFFER_APPENDING,d["default"].BUFFER_CODECS,d["default"].BUFFER_EOS,d["default"].BUFFER_FLUSHING,d["default"].LEVEL_UPDATED));return i._msDuration=null,i._levelDuration=null,i.onsbue=i.onSBUpdateEnd.bind(i),i.onsbe=i.onSBUpdateError.bind(i),i}return r(t,e),o(t,[{key:"destroy",value:function(){h["default"].prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var i=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(i)}}},{key:"onMediaDetaching",value:function(){var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(t){c.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc);try{this.media.src="",this.media.removeAttribute("src")}catch(t){c.logger.warn("onMediaDetaching:"+t.message+" while unlinking video.src")}this.mediaSource=null,this.media=null,this.pendingTracks=null,this.sourceBuffer=null}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(t["default"].MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){c.logger.log("media source opened"),this.hls.trigger(d["default"].MEDIA_ATTACHED,{media:this.media}),this.mediaSource.removeEventListener("sourceopen",this.onmso);var e=this.pendingTracks;e&&(this.onBufferCodecs(e),this.pendingTracks=null,this.doAppending())}},{key:"onMediaSourceClose",value:function(){c.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){c.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){this._needsFlush&&this.doFlush(),this._needsEos&&this.onBufferEos(),this.hls.trigger(d["default"].BUFFER_APPENDED),this.doAppending()}},{key:"onSBUpdateError",value:function(e){c.logger.error("sourceBuffer error:"+e),this.hls.trigger(d["default"].ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;if(e){for(var t in e){var i=e[t];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer=null}this.flushRange=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){var t=this.mediaSource;if(!t||"open"!==t.readyState)return void(this.pendingTracks=e);if(!this.sourceBuffer){var i={};for(var n in e){var s=e[n],a=s.levelCodec||s.codec,r=s.container+";codecs="+a;c.logger.log("creating sourceBuffer with mimeType:"+r);var o=i[n]=t.addSourceBuffer(r);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe)}this.sourceBuffer=i}}},{key:"onBufferAppending",value:function(e){this.segments?this.segments.push(e):this.segments=[e],this.doAppending()}},{key:"onBufferAppendFail",value:function(e){c.logger.error("sourceBuffer error:"+e.event),this.hls.trigger(d["default"].ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;t&&"open"===t.readyState&&(e.audio&&e.audio.updating||e.video&&e.video.updating?this._needsEos=!0:(c.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment"),t.endOfStream(),this._needsEos=!1))}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(e){var t=e.details;0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){if(null!==this._levelDuration){var e=this.media,t=this.mediaSource,i=this.sourceBuffer;if(e&&t&&i&&0!==e.readyState&&"open"===t.readyState){for(var n in i)if(i[n].updating)return;null===this._msDuration&&(this._msDuration=t.duration),this._levelDuration>this._msDuration&&(c.logger.log("Updating mediasource duration to "+this._levelDuration),t.duration=this._levelDuration,this._msDuration=this._levelDuration)}}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,i=this.sourceBuffer;if(i)for(var n in i)t+=i[n].buffered.length;this.appended=t,this.hls.trigger(d["default"].BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.sourceBuffer,i=this.segments;if(t){if(this.media.error)return i=[],void c.logger.error("trying to append although a media error occured, flush segment and abort");for(var n in t)if(t[n].updating)return;if(i.length){var s=i.shift();try{t[s.type].appendBuffer(s.data),this.appendError=0,this.appended++}catch(t){c.logger.error("error while trying to append buffer:"+t.message),i.unshift(s);var a={type:p.ErrorTypes.MEDIA_ERROR};if(22===t.code)return this.segments=[],a.details=p.ErrorDetails.BUFFER_FULL_ERROR,void e.trigger(d["default"].ERROR,a);if(this.appendError?this.appendError++:this.appendError=1,a.details=p.ErrorDetails.BUFFER_APPEND_ERROR,a.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return c.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i=[],a.fatal=!0,void e.trigger(d["default"].ERROR,a);a.fatal=!1,e.trigger(d["default"].ERROR,a)}}}}},{key:"flushBuffer",value:function(e,t){var i,n,s,a,r,o;if(this.flushBufferCounter<this.appended&&this.sourceBuffer)for(var l in this.sourceBuffer){if(i=this.sourceBuffer[l],i.updating)return c.logger.warn("cannot flush, sb updating in progress"),!1;for(n=0;n<i.buffered.length;n++)if(s=i.buffered.start(n),a=i.buffered.end(n),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(r=e,o=t):(r=Math.max(s,e),o=Math.min(a,t)),Math.min(o,a)-r>.5)return this.flushBufferCounter++,c.logger.log("flush "+l+" ["+r+","+o+"], of ["+s+","+a+"], pos:"+this.media.currentTime),i.remove(r,o),!1}else c.logger.warn("abort flushing too many retries");return c.logger.log("buffer flushed"),!0}}]),t}(h["default"]);i["default"]=g},{"../errors":21,"../event-handler":22,"../events":23,"../utils/logger":38}],5:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=e("../events"),d=n(l),u=e("../event-handler"),h=n(u),c=function(e){function t(e){return s(this,t),a(this,Object.getPrototypeOf(t).call(this,e,d["default"].MEDIA_ATTACHING,d["default"].MANIFEST_PARSED))}return r(t,e),o(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){this.hls.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,this.hls.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;e&&(this.hls.autoLevelCapping=this.getMaxLevel(e-1),this.hls.autoLevelCapping>this.autoLevelCapping&&this.hls.streamController.nextLevelSwitch(),this.autoLevelCapping=this.hls.autoLevelCapping)}}},{key:"getMaxLevel",value:function(e){var t=void 0,i=void 0,n=void 0,s=this.mediaWidth,a=this.mediaHeight,r=0,o=0;for(i=0;e>=i&&(n=this.levels[i],t=i,r=n.width,o=n.height,!(r>=s||o>=a));i++);return t}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0;return this.media&&(e=this.media.width||this.media.clientWidth||this.media.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0;return this.media&&(e=this.media.height||this.media.clientHeight||this.media.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(h["default"]);i["default"]=c},{"../event-handler":22,"../events":23}],6:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("../utils/ewma"),o=n(r),l=function(){function e(t,i,n,a){s(this,e),this.hls=t,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new o["default"](i),this.fast_=new o["default"](n)}return a(e,[{key:"sample",value:function(e,t){e=Math.max(e,this.minDelayMs_);var i=8e3*t/e,n=e/1e3;this.fast_.sample(n,i),this.slow_.sample(n,i)}},{key:"getEstimate",value:function(){return!this.fast_||!this.slow_||this.fast_.getTotalWeight()<this.minWeight_?this.defaultEstimate_:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}},{key:"destroy",value:function(){}}]),e}();i["default"]=l},{"../utils/ewma":37}],7:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=e("../events"),d=n(l),u=e("../event-handler"),h=n(u),c=e("../utils/logger"),p=e("../errors"),g=function(e){function t(e){s(this,t);var i=a(this,Object.getPrototypeOf(t).call(this,e,d["default"].MANIFEST_LOADED,d["default"].LEVEL_LOADED,d["default"].ERROR));return i.ontick=i.tick.bind(i),i._manualLevel=i._autoLevelCapping=-1,i}return r(t,e),o(t,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0,this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,i,n=[],s=[],a={},r=!1,o=!1,l=this.hls;if(e.levels.forEach(function(e){e.videoCodec&&(r=!0),e.audioCodec&&(o=!0);var t=a[e.bitrate];void 0===t?(a[e.bitrate]=n.length,e.url=[e.url],e.urlId=0,n.push(e)):n[t].url.push(e.url)}),r&&o?n.forEach(function(e){e.videoCodec&&s.push(e)}):s=n,s=s.filter(function(e){var t=function(e){return MediaSource.isTypeSupported("audio/mp4;codecs="+e)},i=function(e){return MediaSource.isTypeSupported("video/mp4;codecs="+e)},n=e.audioCodec,s=e.videoCodec;return(!n||t(n))&&(!s||i(s))}),s.length){for(t=s[0].bitrate,s.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=s,i=0;i<s.length;i++)if(s[i].bitrate===t){this._firstLevel=i,c.logger.log("manifest loaded,"+s.length+" level(s) found, first bitrate:"+t);break}l.trigger(d["default"].MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:e.stats})}else l.trigger(d["default"].ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:l.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels;if(e>=0&&e<t.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level=e,c.logger.log("switching to level "+e),this.hls.trigger(d["default"].LEVEL_SWITCH,{level:e});var i=t[e];if(void 0===i.details||i.details.live===!0){c.logger.log("(re)loading playlist for level "+e);var n=i.urlId;this.hls.trigger(d["default"].LEVEL_LOADING,{url:i.url[n],level:e,id:n})}}else this.hls.trigger(d["default"].ERROR,{type:p.ErrorTypes.OTHER_ERROR,details:p.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t=e.details,i=this.hls,n=void 0,s=void 0,a=!1;switch(t){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:n=e.frag.level;break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:n=e.level,a=!0}if(void 0!==n)if(s=this._levels[n],s.urlId<s.url.length-1)s.urlId++,s.details=void 0,c.logger.warn("level controller,"+t+" for level "+n+": switching to redundant stream id "+s.urlId);else{var r=-1===this._manualLevel&&n;r?(c.logger.warn("level controller,"+t+": emergency switch-down for next fragment"),i.abrController.nextAutoLevel=0):s&&s.details&&s.details.live?(c.logger.warn("level controller,"+t+" on live stream, discard"),a&&(this._level=void 0)):t!==p.ErrorDetails.FRAG_LOAD_ERROR&&t!==p.ErrorDetails.FRAG_LOAD_TIMEOUT&&(c.logger.error("cannot recover "+t+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0,i.trigger(d["default"].ERROR,e))}}}},{key:"onLevelLoaded",value:function(e){if(e.level===this._level){var t=e.details;if(t.live){var i=1e3*t.targetduration,n=this._levels[e.level],s=n.details;s&&t.endSN===s.endSN&&(i/=2,c.logger.log("same live playlist, reload twice faster")),i-=performance.now()-e.stats.trequest,i=Math.max(1e3,Math.round(i)),c.logger.log("live playlist, reload in "+i+" ms"),this.timer=setTimeout(this.ontick,i)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],i=t.urlId;this.hls.trigger(d["default"].LEVEL_LOADING,{url:t.url[i],level:e,id:i})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){return void 0===this._startLevel?this._firstLevel:this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(h["default"]);i["default"]=g},{"../errors":21,"../event-handler":22,"../events":23,"../utils/logger":38}],8:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=e("../demux/demuxer"),d=n(l),u=e("../events"),h=n(u),c=e("../event-handler"),p=n(c),g=e("../utils/logger"),v=e("../utils/binary-search"),f=n(v),m=e("../helper/buffer-helper"),_=n(m),E=e("../helper/level-helper"),y=n(E),b=e("../errors"),A={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"},S=function(e){function t(e){s(this,t);var i=a(this,Object.getPrototypeOf(t).call(this,e,h["default"].MEDIA_ATTACHED,h["default"].MEDIA_DETACHING,h["default"].MANIFEST_LOADING,h["default"].MANIFEST_PARSED,h["default"].LEVEL_LOADED,h["default"].KEY_LOADED,h["default"].FRAG_LOADED,h["default"].FRAG_LOAD_EMERGENCY_ABORTED,h["default"].FRAG_PARSING_INIT_SEGMENT,h["default"].FRAG_PARSING_DATA,h["default"].FRAG_PARSED,h["default"].ERROR,h["default"].BUFFER_APPENDED,h["default"].BUFFER_FLUSHED));return i.config=e.config,i.audioCodecSwap=!1,i.ticks=0,i.ontick=i.tick.bind(i),i}return r(t,e),o(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),p["default"].prototype.destroy.call(this),this.state=A.STOPPED}},{key:"startLoad",value:function(e){if(this.levels){var t=this.media,i=this.lastCurrentTime;this.stopLoad(),this.demuxer=new d["default"](this.hls),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,t&&i>0?(g.logger.log("configure startPosition @"+i),this.lastPaused||(g.logger.log("resuming video"),t.play()),this.state=A.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=A.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else g.logger.warn("cannot start loading as manifest not parsed yet"),this.state=A.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=A.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,i,n=this.hls,s=n.config,a=this.media,r=a&&a.seeking;switch(this.state){case A.ERROR:case A.PAUSED:break;case A.STARTING:var o=n.startLevel;-1===o&&(o=0,this.fragBitrateTest=!0),this.level=n.nextLoadLevel=o,this.state=A.WAITING_LEVEL,this.loadedmetadata=!1;break;case A.IDLE:if(!a&&(this.startFragRequested||!s.startFragPrefetch))break;e=this.loadedmetadata?a.currentTime:this.nextLoadPosition,t=n.nextLoadLevel;var l,d=_["default"].bufferInfo(a,e,s.maxBufferHole),u=d.len,c=d.end,p=this.fragPrevious;if(this.levels[t].hasOwnProperty("bitrate")?(l=Math.max(8*s.maxBufferSize/this.levels[t].bitrate,s.maxBufferLength),l=Math.min(l,s.maxMaxBufferLength)):l=s.maxBufferLength,l>u){if(n.nextLoadLevel=t,this.level=t,i=this.levels[t].details,"undefined"==typeof i||i.live&&this.levelLastLoaded!==t){this.state=A.WAITING_LEVEL;break}var v=i.fragments,m=v.length,E=v[0].start,y=v[m-1].start+v[m-1].duration,S=void 0;if(i.live){var I=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*i.targetduration;if(c<Math.max(E,y-I)){var D=void 0!==s.liveSyncDuration?s.liveSyncDuration:s.liveSyncDurationCount*i.targetduration,C=E+Math.max(0,i.totalduration-D);g.logger.log("buffer end: "+c+" is located too far from the end of live sliding playlist, reset currentTime to : "+C.toFixed(3)),c=C,a&&a.readyState&&a.duration>C&&(a.currentTime=C)}if(i.PTSKnown&&c>y)break;if(this.startFragRequested&&!i.PTSKnown){if(p){var R=p.sn+1;R>=i.startSN&&R<=i.endSN&&(S=v[R-i.startSN],g.logger.log("live playlist, switching playlist, load frag with next SN: "+S.sn))}S||(S=v[Math.min(m-1,Math.round(m/2))],g.logger.log("live playlist, switching playlist, unknown, load middle frag : "+S.sn))}}else E>c&&(S=v[0]);if(S||!function(){var e=s.maxFragLookUpTolerance;y>c?((c>y-e||r)&&(e=0),S=f["default"].search(v,function(t){return t.start+t.duration-e<=c?1:t.start-e>c?-1:0})):S=v[m-1]}(),S){if(E=S.start,p&&S.level===p.level&&S.sn===p.sn){if(!(S.sn<i.endSN)){i.live||(this.hls.trigger(h["default"].BUFFER_EOS),r||(this.state=A.ENDED));break}var T=p.deltaPTS,P=S.sn-i.startSN;if(T&&T>s.maxBufferHole&&p.dropped?(S=v[P-1],g.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),p.loadCounter--):(S=v[P+1],g.logger.log("SN just loaded, load next one: "+S.sn)),!S)break}if(null!=S.decryptdata.uri&&null==S.decryptdata.key)g.logger.log("Loading key for "+S.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+t),this.state=A.KEY_LOADING,n.trigger(h["default"].KEY_LOADING,{frag:S});else{if(g.logger.log("Loading "+S.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+t+", currentTime:"+e+",bufferEnd:"+c.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,S.loadCounter){S.loadCounter++;var M=s.fragLoadingLoopThreshold;if(S.loadCounter>M&&Math.abs(this.fragLoadIdx-S.loadIdx)<M)return void n.trigger(h["default"].ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:S})}else S.loadCounter=1;S.loadIdx=this.fragLoadIdx,this.fragCurrent=S,this.startFragRequested=!0,S.autoLevel=n.autoLevelEnabled,n.trigger(h["default"].FRAG_LOADING,{frag:S}),this.state=A.FRAG_LOADING}}}break;case A.WAITING_LEVEL:t=this.levels[this.level],t&&t.details&&(this.state=A.IDLE);break;case A.FRAG_LOADING_WAITING_RETRY:var L=performance.now(),w=this.retryDate;(!w||L>=w||r)&&(g.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=A.IDLE);break;case A.STOPPED:case A.FRAG_LOADING:case A.PARSING:case A.PARSED:case A.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"getBufferRange",value:function(e){var t,i,n=this.bufferRange;if(n)for(t=n.length-1;t>=0;t--)if(i=n[t],e>=i.start&&e<=i.end)return i;return null}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"isBuffered",value:function(e){var t=this.media;if(t)for(var i=t.buffered,n=0;n<i.length;n++)if(e>=i.start(n)&&e<=i.end(n))return!0;return!1}},{key:"_checkFragmentChanged",value:function(){var e,t,i=this.media;if(i&&i.seeking===!1&&(t=i.currentTime,t>i.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),this.isBuffered(t)?e=this.getBufferRange(t):this.isBuffered(t+.1)&&(e=this.getBufferRange(t+.1)),e)){var n=e.frag;n!==this.fragPlaying&&(this.fragPlaying=n,this.hls.trigger(h["default"].FRAG_CHANGED,{frag:n}))}}},{key:"immediateLevelSwitch",value:function(){if(g.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=A.PAUSED,this.hls.trigger(h["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY})}},{key:"immediateLevelSwitchEnd",value:function(){this.immediateSwitch=!1;var e=this.media;e&&e.readyState&&(e.currentTime-=1e-4,this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,i=void 0,n=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,i=this.getBufferRange(e.currentTime),i&&i.start>1&&(this.state=A.PAUSED,this.hls.trigger(h["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:i.start-1})),e.paused)t=0;else{var s=this.hls.nextLoadLevel,a=this.levels[s],r=this.fragLastKbps;t=r&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*r)+1:0}if(n=this.getBufferRange(e.currentTime+t),n&&(n=this.followingBufferRange(n))){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.state=A.PAUSED,this.hls.trigger(h["default"].BUFFER_FLUSHING,{startOffset:n.start,endOffset:Number.POSITIVE_INFINITY})}}}},{key:"onMediaAttached",value:function(e){var t=this.media=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(g.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){if(this.state===A.FRAG_LOADING){if(0===_["default"].bufferInfo(this.media,this.media.currentTime,this.config.maxBufferHole).len){g.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.state=A.IDLE}}else this.state===A.ENDED&&(this.state=A.IDLE);this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaSeeked",value:function(){this.tick()}},{key:"onMediaEnded",value:function(){g.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){g.logger.log("trigger BUFFER_RESET"),this.hls.trigger(h["default"].BUFFER_RESET),this.bufferRange=[],this.stalled=!1}},{key:"onManifestParsed",value:function(e){var t,i=!1,n=!1;e.levels.forEach(function(e){t=e.audioCodec,t&&(-1!==t.indexOf("mp4a.40.2")&&(i=!0),-1!==t.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=i&&n,this.audioCodecSwitch&&g.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var s=this.config;s.autoStartLoad&&this.hls.startLoad(s.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,i=e.level,n=this.levels[i],s=t.totalduration,a=0;if(g.logger.log("level "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+s),this.levelLastLoaded=i,t.live){var r=n.details;r?(y["default"].mergeDetails(r,t),a=t.fragments[0].start,t.PTSKnown?g.logger.log("live playlist sliding:"+a.toFixed(3)):g.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,g.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(n.details=t,this.hls.trigger(h["default"].LEVEL_UPDATED,{details:t,level:i}),this.startFragRequested===!1){if(-1===this.startPosition){var o=t.startTimeOffset;if(isNaN(o))if(t.live){var l=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;this.startPosition=Math.max(0,a+s-l)}else this.startPosition=0;else g.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o}this.nextLoadPosition=this.startPosition}this.state===A.WAITING_LEVEL&&(this.state=A.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===A.KEY_LOADING&&(this.state=A.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===A.FRAG_LOADING&&t&&e.frag.level===t.level&&e.frag.sn===t.sn)if(g.logger.log("Loaded  "+t.sn+" of level "+t.level),this.fragBitrateTest===!0)this.state=A.IDLE,this.fragBitrateTest=!1,this.startFragRequested=!1,e.stats.tparsed=e.stats.tbuffered=performance.now(),this.hls.trigger(h["default"].FRAG_BUFFERED,{stats:e.stats,frag:t});else{this.state=A.PARSING,this.stats=e.stats;var i=this.levels[this.level],n=i.details,s=n.totalduration,a=void 0===t.startDTS||isNaN(t.startDTS)?t.start:t.startDTS,r=t.level,o=t.sn,l=i.audioCodec||this.config.defaultAudioCodec;this.audioCodecSwap&&(g.logger.log("swapping playlist audio codec"),void 0===l&&(l=this.lastAudioCodec),l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingAppending=0,g.logger.log("Demuxing "+o+" of ["+n.startSN+" ,"+n.endSN+"],level "+r+", cc "+t.cc);var d=this.demuxer;d&&d.push(e.payload,l,i.videoCodec,a,t.cc,r,o,s,t.decryptdata)}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){if(this.state===A.PARSING){var t,i,n=e.tracks;if(i=n.audio){var s=this.levels[this.level].audioCodec,a=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(g.logger.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===a.indexOf("firefox")&&(s="mp4a.40.5"),-1!==a.indexOf("android")&&(s="mp4a.40.2",g.logger.log("Android: force audio codec to"+s)),i.levelCodec=s}if(i=n.video,i&&(i.levelCodec=this.levels[this.level].videoCodec),e.unique){var r={codec:"",levelCodec:""};for(t in e.tracks)i=n[t],r.container=i.container,r.codec&&(r.codec+=",",r.levelCodec+=","),i.codec&&(r.codec+=i.codec),i.levelCodec&&(r.levelCodec+=i.levelCodec);n={audiovideo:r}}this.hls.trigger(h["default"].BUFFER_CODECS,n);for(t in n){i=n[t],g.logger.log("track:"+t+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var o=i.initSegment;o&&(this.pendingAppending++,this.hls.trigger(h["default"].BUFFER_APPENDING,{type:t,data:o}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this;if(this.state===A.PARSING){this.tparse2=Date.now();var i=this.levels[this.level],n=this.fragCurrent;g.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0));var s=y["default"].updateFragPTSDTS(i.details,n.sn,e.startPTS,e.endPTS,e.startDTS,e.endDTS),a=this.hls;a.trigger(h["default"].LEVEL_PTS_UPDATED,{
details:i.details,level:this.level,drift:s}),"video"===e.type&&(n.dropped=e.dropped),[e.data1,e.data2].forEach(function(i){i&&(t.pendingAppending++,a.trigger(h["default"].BUFFER_APPENDING,{type:e.type,data:i}))}),this.nextLoadPosition=e.endPTS,this.bufferRange.push({type:e.type,start:e.startPTS,end:e.endPTS,frag:n}),this.tick()}else g.logger.warn("not in PARSING state but "+this.state+", ignoring FRAG_PARSING_DATA event")}},{key:"onFragParsed",value:function(){this.state===A.PARSING&&(this.stats.tparsed=performance.now(),this.state=A.PARSED,this._checkAppendedParsed())}},{key:"onBufferAppended",value:function(){switch(this.state){case A.PARSING:case A.PARSED:this.pendingAppending--,this._checkAppendedParsed()}}},{key:"_checkAppendedParsed",value:function(){if(this.state===A.PARSED&&0===this.pendingAppending){var e=this.fragCurrent,t=this.stats;e&&(this.fragPrevious=e,t.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*t.length/(t.tbuffered-t.tfirst)),this.hls.trigger(h["default"].FRAG_BUFFERED,{stats:t,frag:e}),g.logger.log("media buffered : "+this.timeRangesToString(this.media.buffered)),this.state=A.IDLE),this.tick()}}},{key:"onError",value:function(e){switch(e.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var t=this.fragLoadError;if(t?t++:t=1,t<=this.config.fragLoadingMaxRetry||this.media&&this.isBuffered(this.media.currentTime)){this.fragLoadError=t,e.frag.loadCounter=0;var i=Math.min(Math.pow(2,t-1)*this.config.fragLoadingRetryDelay,64e3);g.logger.warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.state=A.FRAG_LOADING_WAITING_RETRY}else g.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(h["default"].ERROR,e),this.state=A.ERROR}break;case b.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==A.ERROR&&(this.state=e.fatal?A.ERROR:A.IDLE,g.logger.warn("mediaController: "+e.details+" while loading frag,switch to "+this.state+" state ..."));break;case b.ErrorDetails.BUFFER_FULL_ERROR:this.state!==A.PARSING&&this.state!==A.PARSED||(this.config.maxMaxBufferLength/=2,g.logger.warn("reduce max buffer length to "+this.config.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=A.IDLE)}}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,i=e.buffered;if(!this.loadedmetadata&&i.length){this.loadedmetadata=!0;var n=this.startPosition;if(!t&&t!==n&&n){g.logger.log("target start position:"+n);var s=i.start(0),a=i.end(0);(s>n||n>a)&&(n=s,g.logger.log("target start position not buffered, seek to buffered.start(0) "+s)),g.logger.log("adjust currentTime from "+t+" to "+n),e.currentTime=n}}else{var r=_["default"].bufferInfo(e,t,0),o=!(e.paused||e.ended||0===e.buffered.length),l=.4,d=t>e.playbackRate*this.lastCurrentTime;if(this.stalled&&d&&(this.stalled=!1,g.logger.log("playback not stuck anymore @"+t)),o&&r.len<=l&&(d?(l=0,this.seekHoleNudgeDuration=0):this.stalled?this.seekHoleNudgeDuration+=this.config.seekHoleNudgeDuration:(this.seekHoleNudgeDuration=0,g.logger.log("playback seems stuck @"+t),this.hls.trigger(h["default"].ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1}),this.stalled=!0),r.len<=l)){var u=r.nextStart,c=u-t;if(u&&c<this.config.maxSeekHole&&c>0){g.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+u+" + nudge "+this.seekHoleNudgeDuration);var p=u+this.seekHoleNudgeDuration-e.currentTime;e.currentTime=u+this.seekHoleNudgeDuration,this.hls.trigger(h["default"].ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:p})}}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=A.IDLE,this.tick()}},{key:"onBufferFlushed",value:function(){var e,t,i=[];for(t=0;t<this.bufferRange.length;t++)e=this.bufferRange[t],this.isBuffered((e.start+e.end)/2)&&i.push(e);this.bufferRange=i,this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.state=A.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"timeRangesToString",value:function(e){for(var t="",i=e.length,n=0;i>n;n++)t+="["+e.start(n)+","+e.end(n)+"]";return t}},{key:"currentLevel",get:function(){if(this.media){var e=this.getBufferRange(this.media.currentTime);if(e)return e.frag.level}return-1}},{key:"nextBufferRange",get:function(){return this.media?this.followingBufferRange(this.getBufferRange(this.media.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}}]),t}(p["default"]);i["default"]=S},{"../demux/demuxer":17,"../errors":21,"../event-handler":22,"../events":23,"../helper/buffer-helper":24,"../helper/level-helper":25,"../utils/binary-search":35,"../utils/logger":38}],9:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=e("../events"),d=n(l),u=e("../event-handler"),h=n(u),c=e("../utils/cea-708-interpreter"),p=n(c),g=function(e){function t(e){s(this,t);var i=a(this,Object.getPrototypeOf(t).call(this,e,d["default"].MEDIA_ATTACHING,d["default"].MEDIA_DETACHING,d["default"].FRAG_PARSING_USERDATA,d["default"].MANIFEST_LOADING,d["default"].FRAG_LOADED));return i.hls=e,i.config=e.config,i.config.enableCEA708Captions&&(i.cea708Interpreter=new p["default"]),i}return r(t,e),o(t,[{key:"destroy",value:function(){h["default"].prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;this.cea708Interpreter.attach(t)}},{key:"onMediaDetaching",value:function(){this.cea708Interpreter.detach()}},{key:"onManifestLoading",value:function(){this.lastPts=Number.POSITIVE_INFINITY}},{key:"onFragLoaded",value:function(e){var t=e.frag.start;t<=this.lastPts&&this.cea708Interpreter.clear(),this.lastPts=t}},{key:"onFragParsingUserdata",value:function(e){for(var t=0;t<e.samples.length;t++)this.cea708Interpreter.push(e.samples[t].pts,e.samples[t].bytes)}}]),t}(h["default"]);i["default"]=g},{"../event-handler":22,"../events":23,"../utils/cea-708-interpreter":36}],10:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){n(this,e),this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._precompute();var i,s,a,r,o,l=this._tables[0][4],d=this._tables[1],u=t.length,h=1;if(4!==u&&6!==u&&8!==u)throw new Error("Invalid aes key size="+u);for(r=t.slice(0),o=[],this._key=[r,o],i=u;4*u+28>i;i++)a=r[i-1],(i%u===0||8===u&&i%u===4)&&(a=l[a>>>24]<<24^l[a>>16&255]<<16^l[a>>8&255]<<8^l[255&a],i%u===0&&(a=a<<8^a>>>24^h<<24,h=h<<1^283*(h>>7))),r[i]=r[i-u]^a;for(s=0;i;s++,i--)a=r[3&s?i:i-4],4>=i||4>s?o[s]=a:o[s]=d[0][l[a>>>24]]^d[1][l[a>>16&255]]^d[2][l[a>>8&255]]^d[3][l[255&a]]}return s(e,[{key:"_precompute",value:function(){var e,t,i,n,s,a,r,o,l,d=this._tables[0],u=this._tables[1],h=d[4],c=u[4],p=[],g=[];for(e=0;256>e;e++)g[(p[e]=e<<1^283*(e>>7))^e]=e;for(t=i=0;!h[t];t^=n||1,i=g[i]||1)for(r=i^i<<1^i<<2^i<<3^i<<4,r=r>>8^255&r^99,h[t]=r,c[r]=t,a=p[s=p[n=p[t]]],l=16843009*a^65537*s^257*n^16843008*t,o=257*p[r]^16843008*r,e=0;4>e;e++)d[e][t]=o=o<<24^o>>>8,u[e][r]=l=l<<24^l>>>8;for(e=0;5>e;e++)d[e]=d[e].slice(0),u[e]=u[e].slice(0)}},{key:"decrypt",value:function(e,t,i,n,s,a){var r,o,l,d,u=this._key[1],h=e^u[0],c=n^u[1],p=i^u[2],g=t^u[3],v=u.length/4-2,f=4,m=this._tables[1],_=m[0],E=m[1],y=m[2],b=m[3],A=m[4];for(d=0;v>d;d++)r=_[h>>>24]^E[c>>16&255]^y[p>>8&255]^b[255&g]^u[f],o=_[c>>>24]^E[p>>16&255]^y[g>>8&255]^b[255&h]^u[f+1],l=_[p>>>24]^E[g>>16&255]^y[h>>8&255]^b[255&c]^u[f+2],g=_[g>>>24]^E[h>>16&255]^y[c>>8&255]^b[255&p]^u[f+3],f+=4,h=r,c=o,p=l;for(d=0;4>d;d++)s[(3&-d)+a]=A[h>>>24]<<24^A[c>>16&255]<<16^A[p>>8&255]<<8^A[255&g]^u[f++],r=h,h=c,c=p,p=g,g=r}}]),e}();i["default"]=a},{}],11:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("./aes"),o=n(r),l=function(){function e(t,i){s(this,e),this.key=t,this.iv=i}return a(e,[{key:"ntoh",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"doDecrypt",value:function(e,t,i){var n,s,a,r,l,d,u,h,c,p=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),g=new o["default"](Array.prototype.slice.call(t)),v=new Uint8Array(e.byteLength),f=new Int32Array(v.buffer);for(n=~~i[0],s=~~i[1],a=~~i[2],r=~~i[3],c=0;c<p.length;c+=4)l=~~this.ntoh(p[c]),d=~~this.ntoh(p[c+1]),u=~~this.ntoh(p[c+2]),h=~~this.ntoh(p[c+3]),g.decrypt(l,d,u,h,f,c),f[c]=this.ntoh(f[c]^n),f[c+1]=this.ntoh(f[c+1]^s),f[c+2]=this.ntoh(f[c+2]^a),f[c+3]=this.ntoh(f[c+3]^r),n=l,s=d,a=u,r=h;return v}},{key:"localDecrypt",value:function(e,t,i,n){var s=this.doDecrypt(e,t,i);n.set(s,e.byteOffset)}},{key:"decrypt",value:function(e){var t=32e3,i=new Int32Array(e),n=new Uint8Array(e.byteLength),s=0,a=this.key,r=this.iv;for(this.localDecrypt(i.subarray(s,s+t),a,r,n),s=t;s<i.length;s+=t)r=new Uint32Array([this.ntoh(i[s-4]),this.ntoh(i[s-3]),this.ntoh(i[s-2]),this.ntoh(i[s-1])]),this.localDecrypt(i.subarray(s,s+t),a,r,n);return n}}]),e}();i["default"]=l},{"./aes":10}],12:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("./aes128-decrypter"),o=n(r),l=e("../errors"),d=e("../utils/logger"),u=function(){function e(t){s(this,e),this.hls=t;try{var i=window?window.crypto:crypto;this.subtle=i.subtle||i.webkitSubtle,this.disableWebCrypto=!this.subtle}catch(i){this.disableWebCrypto=!0}}return a(e,[{key:"destroy",value:function(){}},{key:"decrypt",value:function(e,t,i,n){this.disableWebCrypto&&this.hls.config.enableSoftwareAES?this.decryptBySoftware(e,t,i,n):this.decryptByWebCrypto(e,t,i,n)}},{key:"decryptByWebCrypto",value:function(e,t,i,n){var s=this;d.logger.log("decrypting by WebCrypto API"),this.subtle.importKey("raw",t,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(a){s.subtle.decrypt({name:"AES-CBC",iv:i.buffer},a,e).then(n)["catch"](function(a){s.onWebCryptoError(a,e,t,i,n)})})["catch"](function(a){s.onWebCryptoError(a,e,t,i,n)})}},{key:"decryptBySoftware",value:function(e,t,i,n){d.logger.log("decrypting by JavaScript Implementation");var s=new DataView(t.buffer),a=new Uint32Array([s.getUint32(0),s.getUint32(4),s.getUint32(8),s.getUint32(12)]);s=new DataView(i.buffer);var r=new Uint32Array([s.getUint32(0),s.getUint32(4),s.getUint32(8),s.getUint32(12)]),l=new o["default"](a,r);n(l.decrypt(e).buffer)}},{key:"onWebCryptoError",value:function(e,t,i,n,s){this.hls.config.enableSoftwareAES?(d.logger.log("disabling to use WebCrypto API"),this.disableWebCrypto=!0,this.decryptBySoftware(t,i,n,s)):(d.logger.error("decrypting error : "+e.message),this.hls.trigger(Event.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}}]),e}();i["default"]=u},{"../errors":21,"../utils/logger":38,"./aes128-decrypter":11}],13:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("./adts"),o=n(r),l=e("../utils/logger"),d=e("../demux/id3"),u=n(d),h=function(){function e(t,i){s(this,e),this.observer=t,this.remuxerClass=i,this.remuxer=new this.remuxerClass(t),this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}return a(e,[{key:"push",value:function(e,t,i,n,s,a,r,d){var h,c,p,g,v,f,m,_,E,y=this._aacTrack,b=new u["default"](e),A=90*b.timeStamp;for(v=b.length,_=e.length;_-1>v&&(255!==e[v]||240!==(240&e[v+1]));v++);for(y.audiosamplerate||(h=o["default"].getAudioConfig(this.observer,e,v,t),y.config=h.config,y.audiosamplerate=h.samplerate,y.channelCount=h.channelCount,y.codec=h.codec,y.duration=d,l.logger.log("parsed codec:"+y.codec+",rate:"+h.samplerate+",nb channel:"+h.channelCount)),g=0,p=9216e4/y.audiosamplerate;_>v+5&&(f=1&e[v+1]?7:9,c=(3&e[v+3])<<11|e[v+4]<<3|(224&e[v+5])>>>5,c-=f,c>0&&_>=v+f+c);)for(m=A+g*p,E={unit:e.subarray(v+f,v+f+c),pts:m,dts:m},y.samples.push(E),y.len+=c,v+=c+f,g++;_-1>v&&(255!==e[v]||240!==(240&e[v+1]));v++);this.remuxer.remux(this._aacTrack,{samples:[]},{samples:[{pts:A,dts:A,unit:b.payload}]},{samples:[]},n)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t,i,n=new u["default"](e);if(n.hasTimeStamp)for(t=n.length,i=e.length;i-1>t;t++)if(255===e[t]&&240===(240&e[t+1]))return!0;return!1}}]),e}();i["default"]=h},{"../demux/id3":19,"../utils/logger":38,"./adts":14}],14:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=e("../utils/logger"),r=e("../errors"),o=function(){function e(){n(this,e)}return s(e,null,[{key:"getAudioConfig",value:function(e,t,i,n){var s,o,l,d,u,h=navigator.userAgent.toLowerCase(),c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return s=((192&t[i+2])>>>6)+1,o=(60&t[i+2])>>>2,o>c.length-1?void e.trigger(Event.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o}):(d=(1&t[i+2])<<2,d|=(192&t[i+3])>>>6,a.logger.log("manifest codec:"+n+",ADTS data:type:"+s+",sampleingIndex:"+o+"["+c[o]+"Hz],channelConfig:"+d),-1!==h.indexOf("firefox")?o>=6?(s=5,u=new Array(4),l=o-3):(s=2,u=new Array(2),l=o):-1!==h.indexOf("android")?(s=2,u=new Array(2),l=o):(s=5,u=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&o>=6?l=o-3:((n&&-1!==n.indexOf("mp4a.40.2")&&o>=6&&1===d||!n&&1===d)&&(s=2,u=new Array(2)),l=o)),u[0]=s<<3,u[0]|=(14&o)>>1,u[1]|=(1&o)<<7,u[1]|=d<<3,5===s&&(u[1]|=(14&l)>>1,u[2]=(1&l)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:c[o],channelCount:d,codec:"mp4a.40."+s})}}]),e}();i["default"]=o},{"../errors":21,"../utils/logger":38}],15:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("../events"),o=n(r),l=e("../errors"),d=e("../demux/aacdemuxer"),u=n(d),h=e("../demux/tsdemuxer"),c=n(h),p=e("../remux/mp4-remuxer"),g=n(p),v=e("../remux/passthrough-remuxer"),f=n(v),m=function(){function e(t,i){s(this,e),this.hls=t,this.typeSupported=i}return a(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,i,n,s,a,r,d){var h=this.demuxer;if(!h){var p=this.hls;if(c["default"].probe(e))h=this.typeSupported.mp2t===!0?new c["default"](p,f["default"]):new c["default"](p,g["default"]);else{if(!u["default"].probe(e))return void p.trigger(o["default"].ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});h=new u["default"](p,g["default"])}this.demuxer=h}h.push(e,t,i,n,s,a,r,d)}}]),e}();i["default"]=m},{"../demux/aacdemuxer":13,"../demux/tsdemuxer":20,"../errors":21,"../events":23,"../remux/mp4-remuxer":32,"../remux/passthrough-remuxer":33}],16:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("../demux/demuxer-inline"),a=n(s),r=e("../events"),o=n(r),l=e("events"),d=n(l),u=function(e){var t=new d["default"];t.trigger=function(e){for(var i=arguments.length,n=Array(i>1?i-1:0),s=1;i>s;s++)n[s-1]=arguments[s];t.emit.apply(t,[e,e].concat(n))},t.off=function(e){for(var i=arguments.length,n=Array(i>1?i-1:0),s=1;i>s;s++)n[s-1]=arguments[s];t.removeListener.apply(t,[e].concat(n))},e.addEventListener("message",function(i){var n=i.data;switch(n.cmd){case"init":e.demuxer=new a["default"](t,n.typeSupported);break;case"demux":e.demuxer.push(new Uint8Array(n.data),n.audioCodec,n.videoCodec,n.timeOffset,n.cc,n.level,n.sn,n.duration)}}),t.on(o["default"].FRAG_PARSING_INIT_SEGMENT,function(t,i){e.postMessage({event:t,tracks:i.tracks,unique:i.unique})}),t.on(o["default"].FRAG_PARSING_DATA,function(t,i){var n={event:t,type:i.type,startPTS:i.startPTS,endPTS:i.endPTS,startDTS:i.startDTS,endDTS:i.endDTS,data1:i.data1.buffer,data2:i.data2.buffer,nb:i.nb,dropped:i.dropped};e.postMessage(n,[n.data1,n.data2])}),t.on(o["default"].FRAG_PARSED,function(t){e.postMessage({event:t})}),t.on(o["default"].ERROR,function(t,i){e.postMessage({event:t,data:i})}),t.on(o["default"].FRAG_PARSING_METADATA,function(t,i){var n={event:t,samples:i.samples};e.postMessage(n)}),t.on(o["default"].FRAG_PARSING_USERDATA,function(t,i){var n={event:t,samples:i.samples};e.postMessage(n)})};i["default"]=u},{"../demux/demuxer-inline":15,"../events":23,events:1}],17:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("../events"),o=n(r),l=e("../demux/demuxer-inline"),d=n(l),u=e("../demux/demuxer-worker"),h=n(u),c=e("../utils/logger"),p=e("../crypt/decrypter"),g=n(p),v=e("../errors"),f=function(){function t(i){s(this,t),this.hls=i;var n={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:i.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t")};if(i.config.enableWorker&&"undefined"!=typeof Worker){c.logger.log("demuxing in webworker");try{var a=e("webworkify"),r=this.w=a(h["default"]);this.onwmsg=this.onWorkerMessage.bind(this),r.addEventListener("message",this.onwmsg),r.onerror=function(e){i.trigger(o["default"].ERROR,{type:v.ErrorTypes.OTHER_ERROR,details:v.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},r.postMessage({cmd:"init",typeSupported:n})}catch(o){c.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),this.demuxer=new d["default"](i,n)}}else this.demuxer=new d["default"](i,n);this.demuxInitialized=!0}return a(t,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var i=this.decrypter;i&&(i.destroy(),this.decrypter=null)}},{key:"pushDecrypted",value:function(e,t,i,n,s,a,r,o){var l=this.w;if(l)l.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:i,timeOffset:n,cc:s,level:a,sn:r,duration:o},[e]);else{var d=this.demuxer;d&&d.push(new Uint8Array(e),t,i,n,s,a,r,o)}}},{key:"push",value:function(e,t,i,n,s,a,r,o,l){if(e.byteLength>0&&null!=l&&null!=l.key&&"AES-128"===l.method){null==this.decrypter&&(this.decrypter=new g["default"](this.hls));var d=this;this.decrypter.decrypt(e,l.key,l.iv,function(e){d.pushDecrypted(e,t,i,n,s,a,r,o)})}else this.pushDecrypted(e,t,i,n,s,a,r,o)}},{key:"onWorkerMessage",value:function(e){var t=e.data;switch(t.event){case o["default"].FRAG_PARSING_INIT_SEGMENT:var i={};i.tracks=t.tracks,i.unique=t.unique,this.hls.trigger(o["default"].FRAG_PARSING_INIT_SEGMENT,i);break;case o["default"].FRAG_PARSING_DATA:this.hls.trigger(o["default"].FRAG_PARSING_DATA,{data1:new Uint8Array(t.data1),data2:new Uint8Array(t.data2),startPTS:t.startPTS,endPTS:t.endPTS,startDTS:t.startDTS,endDTS:t.endDTS,type:t.type,nb:t.nb,dropped:t.dropped});break;case o["default"].FRAG_PARSING_METADATA:this.hls.trigger(o["default"].FRAG_PARSING_METADATA,{samples:t.samples});break;case o["default"].FRAG_PARSING_USERDATA:this.hls.trigger(o["default"].FRAG_PARSING_USERDATA,{samples:t.samples});break;default:this.hls.trigger(t.event,t.data)}}}]),t}();i["default"]=f},{"../crypt/decrypter":12,"../demux/demuxer-inline":15,"../demux/demuxer-worker":16,"../errors":21,"../events":23,"../utils/logger":38,webworkify:2}],18:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=e("../utils/logger"),r=function(){function e(t){n(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return s(e,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,t=new Uint8Array(4),i=Math.min(4,this.bytesAvailable);if(0===i)throw new Error("no bytes available");t.set(this.data.subarray(e,e+i)),this.word=new DataView(t.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0?i<<t|this.readBits(t):i}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,i,n=8,s=8;for(t=0;e>t;t++)0!==s&&(i=this.readEG(),s=(n+i+256)%256),n=0===s?n:s}},{key:"readSPS",value:function(){var e,t,i,n,s,a,r,o,l,d=0,u=0,h=0,c=0,p=1;if(this.readUByte(),e=this.readUByte(),t=this.readBits(5),this.skipBits(3),i=this.readUByte(),this.skipUEG(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var g=this.readUEG();if(3===g&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(o=3!==g?8:12,l=0;o>l;l++)this.readBoolean()&&(6>l?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var v=this.readUEG();if(0===v)this.readUEG();else if(1===v)for(this.skipBits(1),this.skipEG(),this.skipEG(),n=this.readUEG(),l=0;n>l;l++)this.skipEG();if(this.skipUEG(),this.skipBits(1),s=this.readUEG(),a=this.readUEG(),r=this.readBits(1),0===r&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(d=this.readUEG(),u=this.readUEG(),h=this.readUEG(),c=this.readUEG()),this.readBoolean()&&this.readBoolean()){var f=void 0,m=this.readUByte();switch(m){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()]}f&&(p=f[0]/f[1])}return{width:Math.ceil((16*(s+1)-2*d-2*u)*p),height:(2-r)*(a+1)*16-(r?2:4)*(h+c)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();i["default"]=r},{"../utils/logger":38}],19:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=e("../utils/logger"),r=function(){function e(t){n(this,e),this._hasTimeStamp=!1;for(var i,s,r,o,l,d,u,h,c=0;;)if(u=this.readUTF(t,c,3),c+=3,"ID3"===u)c+=3,i=127&t[c++],s=127&t[c++],r=127&t[c++],o=127&t[c++],l=(i<<21)+(s<<14)+(r<<7)+o,d=c+l,this._parseID3Frames(t,c,d),c=d;else{if("3DI"!==u)return c-=3,h=c,void(h&&(this.hasTimeStamp||a.logger.warn("ID3 tag found, but no timestamp"),this._length=h,this._payload=t.subarray(0,h)));c+=7,a.logger.log("3DI footer found, end: "+c)}}return s(e,[{key:"readUTF",value:function(e,t,i){var n="",s=t,a=t+i;do n+=String.fromCharCode(e[s++]);while(a>s);return n}},{key:"_parseID3Frames",value:function(e,t,i){for(var n,s,r,o,l;i>=t+8;)switch(n=this.readUTF(e,t,4),t+=4,s=e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],o=e[t++]<<8+e[t++],r=t,n){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var d=1&e[t++];this._hasTimeStamp=!0,l=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,d&&(l+=47721858.84),l=Math.round(l),a.logger.trace("ID3 timestamp found: "+l),this._timeStamp=l}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();i["default"]=r},{"../utils/logger":38}],20:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("./adts"),o=n(r),l=e("../events"),d=n(l),u=e("./exp-golomb"),h=n(u),c=e("../utils/logger"),p=e("../errors"),g=function(){function e(t,i){s(this,e),this.observer=t,this.remuxerClass=i,this.lastCC=0,this.remuxer=new this.remuxerClass(t)}return a(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0},this._aacTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcNaluState=0,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,i,n,s,a,r,o){var l,u,h,g,v,f,m,_,E=e.length,y=this.remuxer.passthrough,b=!1;this.audioCodec=t,this.videoCodec=i,this.timeOffset=n,this._duration=o,this.contiguous=!1,s!==this.lastCC&&(c.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=s),a!==this.lastLevel?(c.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=a):r===this.lastSN+1&&(this.contiguous=!0),this.lastSN=r;var A=this.pmtParsed,S=this._avcTrack.id,I=this._aacTrack.id,D=this._id3Track.id;for(E-=E%188,g=0;E>g;g+=188)if(71===e[g]){if(v=!!(64&e[g+1]),f=((31&e[g+1])<<8)+e[g+2],m=(48&e[g+3])>>4,m>1){if(_=g+5+e[g+4],_===g+188)continue}else _=g+4;if(A)if(f===S){if(v){if(l&&(this._parseAVCPES(this._parsePES(l)),y&&this._avcTrack.codec&&(-1===I||this._aacTrack.codec)))return void this.remux(e);l={data:[],size:0}}l&&(l.data.push(e.subarray(_,g+188)),l.size+=g+188-_)}else if(f===I){if(v){if(u&&(this._parseAACPES(this._parsePES(u)),y&&this._aacTrack.codec&&(-1===S||this._avcTrack.codec)))return void this.remux(e);u={data:[],size:0}}u&&(u.data.push(e.subarray(_,g+188)),u.size+=g+188-_)}else f===D&&(v&&(h&&this._parseID3PES(this._parsePES(h)),h={data:[],size:0}),h&&(h.data.push(e.subarray(_,g+188)),h.size+=g+188-_));else v&&(_+=e[_]+1),0===f?this._parsePAT(e,_):f===this._pmtId?(this._parsePMT(e,_),A=this.pmtParsed=!0,S=this._avcTrack.id,I=this._aacTrack.id,D=this._id3Track.id,b&&(c.logger.log("reparse from beginning"),b=!1,g=-188)):(c.logger.log("unknown PID found before PAT/PMT"),b=!0)}else this.observer.trigger(d["default"].ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});l&&this._parseAVCPES(this._parsePES(l)),u&&this._parseAACPES(this._parsePES(u)),h&&this._parseID3PES(this._parsePES(h)),this.remux(null)}},{key:"remux",value:function(e){this.remuxer.remux(this._aacTrack,this._avcTrack,this._id3Track,this._txtTrack,this.timeOffset,this.contiguous,e)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){this._pmtId=(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t){var i,n,s,a;
for(i=(15&e[t+1])<<8|e[t+2],n=t+3+i-4,s=(15&e[t+10])<<8|e[t+11],t+=12+s;n>t;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 15:this._aacTrack.id=a;break;case 21:this._id3Track.id=a;break;case 27:this._avcTrack.id=a;break;default:c.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}}},{key:"_parsePES",value:function(e){var t,i,n,s,a,r,o,l,d,u=0,h=e.data;if(t=h[0],n=(t[0]<<16)+(t[1]<<8)+t[2],1===n){for(s=(t[4]<<8)+t[5],i=t[7],192&i&&(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,o>4294967295&&(o-=8589934592),64&i?(l=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,l>4294967295&&(l-=8589934592)):l=o),a=t[8],d=a+9,e.size-=d,r=new Uint8Array(e.size);h.length;){t=h.shift();var c=t.byteLength;if(d){if(d>c){d-=c;continue}t=t.subarray(d),c-=d,d=0}r.set(t,u),u+=c}return{data:r,pts:o,dts:l,len:s}}return null}},{key:"_parseAVCPES",value:function(e){var t,i,n,s,a=this,r=this._avcTrack,o=r.samples,l=this._parseAVCNALu(e.data),d=[],u=!1,p=!1,g=0;if(0===l.length&&o.length>0){var v=o[o.length-1],f=v.units.units[v.units.units.length-1],m=new Uint8Array(f.data.byteLength+e.data.byteLength);m.set(f.data,0),m.set(e.data,f.data.byteLength),f.data=m,v.units.length+=e.data.byteLength,r.len+=e.data.byteLength}e.data=null;var _="",E=function(){d.length&&(p===!0||r.sps&&(o.length||this.contiguous)?(i={units:{units:d,length:g},pts:e.pts,dts:e.dts,key:p},o.push(i),r.len+=g,r.nbNalu+=d.length):r.dropped++,d=[],g=0)}.bind(this);l.forEach(function(i){switch(i.type){case 1:n=!0,u&&(_+="NDR ");break;case 5:n=!0,u&&(_+="IDR "),p=!0;break;case 6:n=!0,u&&(_+="SEI "),t=new h["default"](i.data),t.readUByte();var o=t.readUByte();if(4===o){var l=0;do l=t.readUByte();while(255===l);var c=t.readUByte();if(181===c){var v=t.readUShort();if(49===v){var f=t.readUInt();if(1195456820===f){var m=t.readUByte();if(3===m){var y=t.readUByte(),b=t.readUByte(),A=31&y,S=[y,b];for(s=0;A>s;s++)S.push(t.readUByte()),S.push(t.readUByte()),S.push(t.readUByte());a._txtTrack.samples.push({type:3,pts:e.pts,bytes:S})}}}}}break;case 7:if(n=!0,u&&(_+="SPS "),!r.sps){t=new h["default"](i.data);var I=t.readSPS();r.width=I.width,r.height=I.height,r.sps=[i.data],r.duration=a._duration;var D=i.data.subarray(1,4),C="avc1.";for(s=0;3>s;s++){var R=D[s].toString(16);R.length<2&&(R="0"+R),C+=R}r.codec=C}break;case 8:n=!0,u&&(_+="PPS "),r.pps||(r.pps=[i.data]);break;case 9:n=!1,u&&(_+="AUD "),E();break;default:n=!1,_+="unknown NAL "+i.type+" "}n&&(d.push(i),g+=i.data.byteLength)}),(u||_.length)&&c.logger.log(_),E()}},{key:"_parseAVCNALu",value:function(e){for(var t,i,n,s,a,r,o=0,l=e.byteLength,d=this.avcNaluState,u=[];l>o;)switch(t=e[o++],d){case 0:0===t&&(d=1);break;case 1:d=0===t?2:0;break;case 2:case 3:if(0===t)d=3;else if(1===t&&l>o){if(s=31&e[o],a)n={data:e.subarray(a,o-d-1),type:r},u.push(n);else{var h=this.avcNaluState;if(h&&4-h>=o){var c=this._avcTrack,p=c.samples;if(p.length){var g=p[p.length-1],v=g.units.units,f=v[v.length-1];f.state&&(f.data=f.data.subarray(0,f.data.byteLength-h),g.units.length-=h,c.len-=h)}}if(i=o-d-1,i>0){var m=this._avcTrack,_=m.samples;if(_.length){var E=_[_.length-1],y=E.units.units,b=y[y.length-1],A=new Uint8Array(b.data.byteLength+i);A.set(b.data,0),A.set(e.subarray(0,i),b.data.byteLength),b.data=A,E.units.length+=i,m.len+=i}}}a=o,r=s,d=0}else d=0}return a&&(n={data:e.subarray(a,l),type:r,state:d},u.push(n),this.avcNaluState=d),u}},{key:"_parseAACPES",value:function(e){var t,i,n,s,a,r,l,u,h,g=this._aacTrack,v=e.data,f=e.pts,m=0,_=this._duration,E=this.audioCodec,y=this.aacOverFlow,b=this.aacLastPTS;if(y){var A=new Uint8Array(y.byteLength+v.byteLength);A.set(y,0),A.set(v,y.byteLength),v=A}for(a=m,u=v.length;u-1>a&&(255!==v[a]||240!==(240&v[a+1]));a++);if(a){var S,I;if(u-1>a?(S="AAC PES did not start with ADTS header,offset:"+a,I=!1):(S="no ADTS header found in AAC PES",I=!0),this.observer.trigger(d["default"].ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:I,reason:S}),I)return}if(g.audiosamplerate||(t=o["default"].getAudioConfig(this.observer,v,a,E),g.config=t.config,g.audiosamplerate=t.samplerate,g.channelCount=t.channelCount,g.codec=t.codec,g.duration=_,c.logger.log("parsed codec:"+g.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)),s=0,n=9216e4/g.audiosamplerate,y&&b){var D=b+n;Math.abs(D-f)>1&&(c.logger.log("AAC: align PTS for overlapping frames by "+Math.round((D-f)/90)),f=D)}for(;u>a+5&&(r=1&v[a+1]?7:9,i=(3&v[a+3])<<11|v[a+4]<<3|(224&v[a+5])>>>5,i-=r,i>0&&u>=a+r+i);)for(l=f+s*n,h={unit:v.subarray(a+r,a+r+i),pts:l,dts:l},g.samples.push(h),g.len+=i,a+=i+r,s++;u-1>a&&(255!==v[a]||240!==(240&v[a+1]));a++);y=u>a?v.subarray(a,u):null,this.aacOverFlow=y,this.aacLastPTS=l}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),e}();i["default"]=g},{"../errors":21,"../events":23,"../utils/logger":38,"./adts":14,"./exp-golomb":18}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},i.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException"}},{}],22:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("./utils/logger"),l=e("./errors"),d=e("./events"),u=n(d),h=function(){function e(t){s(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;i>a;a++)n[a-1]=arguments[a];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}return r(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===a(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var i=function(e,t){var i="on"+e.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,t)};try{i.call(this,e,t).call()}catch(t){o.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(u["default"].ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();i["default"]=h},{"./errors":21,"./events":23,"./utils/logger":38}],23:[function(e,t,i){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded"}},{}],24:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return s(e,null,[{key:"bufferInfo",value:function(e,t,i){if(e){var n,s=e.buffered,a=[];for(n=0;n<s.length;n++)a.push({start:s.start(n),end:s.end(n)});return this.bufferedInfo(a,t,i)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,i){var n,s,a,r,o,l=[];for(e.sort(function(e,t){var i=e.start-t.start;return i?i:t.end-e.end}),o=0;o<e.length;o++){var d=l.length;if(d){var u=l[d-1].end;e[o].start-u<i?e[o].end>u&&(l[d-1].end=e[o].end):l.push(e[o])}else l.push(e[o])}for(o=0,n=0,s=a=t;o<l.length;o++){var h=l[o].start,c=l[o].end;if(t+i>=h&&c>t)s=h,a=c,n=a-t;else if(h>t+i){r=h;break}}return{len:n,start:s,end:a,nextStart:r}}}]),e}();i["default"]=a},{}],25:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=e("../utils/logger"),r=function(){function e(){n(this,e)}return s(e,null,[{key:"mergeDetails",value:function(t,i){var n,s=Math.max(t.startSN,i.startSN)-i.startSN,r=Math.min(t.endSN,i.endSN)-i.startSN,o=i.startSN-t.startSN,l=t.fragments,d=i.fragments,u=0;if(s>r)return void(i.PTSKnown=!1);for(var h=s;r>=h;h++){var c=l[o+h],p=d[h];p&&c&&(u=c.cc-p.cc,isNaN(c.startPTS)||(p.start=p.startPTS=c.startPTS,p.endPTS=c.endPTS,p.duration=c.duration,n=p))}if(u)for(a.logger.log("discontinuity sliding from playlist, take drift into account"),h=0;h<d.length;h++)d[h].cc+=u;if(n)e.updateFragPTSDTS(i,n.sn,n.startPTS,n.endPTS,n.startDTS,n.endDTS);else if(o>=0&&o<l.length){var g=l[o].start;for(h=0;h<d.length;h++)d[h].start+=g}i.PTSKnown=t.PTSKnown}},{key:"updateFragPTSDTS",value:function(t,i,n,s,a,r){var o,l,d,u;if(i<t.startSN||i>t.endSN)return 0;if(o=i-t.startSN,l=t.fragments,d=l[o],!isNaN(d.startPTS)){var h=Math.abs(d.startPTS-n);isNaN(d.deltaPTS)?d.deltaPTS=h:d.deltaPTS=Math.max(h,d.deltaPTS),n=Math.min(n,d.startPTS),s=Math.max(s,d.endPTS),a=Math.min(a,d.startDTS),r=Math.max(r,d.endDTS)}var c=n-d.start;for(d.start=d.startPTS=n,d.endPTS=s,d.startDTS=a,d.endDTS=r,d.duration=s-n,u=o;u>0;u--)e.updatePTS(l,u,u-1);for(u=o;u<l.length-1;u++)e.updatePTS(l,u,u+1);return t.PTSKnown=!0,c}},{key:"updatePTS",value:function(e,t,i){var n=e[t],s=e[i],r=s.startPTS;isNaN(r)?i>t?s.start=n.start+n.duration:s.start=n.start-s.duration:i>t?(n.duration=r-n.start,n.duration<0&&a.logger.error("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(s.duration=n.start-r,s.duration<0&&a.logger.error("negative duration computed for frag "+s.sn+",level "+s.level+", there should be some duration drift between playlist and fragment!"))}}]),e}();i["default"]=r},{"../utils/logger":38}],26:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("./events"),o=n(r),l=e("./errors"),d=e("./loader/playlist-loader"),u=n(d),h=e("./loader/fragment-loader"),c=n(h),p=e("./controller/abr-controller"),g=n(p),v=e("./controller/buffer-controller"),f=n(v),m=e("./controller/cap-level-controller"),_=n(m),E=e("./controller/stream-controller"),y=n(E),b=e("./controller/level-controller"),A=n(b),S=e("./controller/timeline-controller"),I=n(S),D=e("./utils/logger"),C=e("./utils/xhr-loader"),R=n(C),T=e("events"),P=n(T),M=e("./loader/key-loader"),L=n(M),w=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];s(this,e);var i=e.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var n in i)n in t||(t[n]=i[n]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,D.enableLogs)(t.debug),this.config=t;var a=this.observer=new P["default"];a.trigger=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];a.emit.apply(a,[e,e].concat(i))},a.off=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];a.removeListener.apply(a,[e].concat(i))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.trigger=a.trigger.bind(a),this.playlistLoader=new u["default"](this),this.fragmentLoader=new c["default"](this),this.levelController=new A["default"](this),this.abrController=new t.abrController(this),this.bufferController=new t.bufferController(this),this.capLevelController=new t.capLevelController(this),this.streamController=new t.streamController(this),this.timelineController=new t.timelineController(this),this.keyLoader=new L["default"](this)}return a(e,null,[{key:"isSupported",value:function(){return window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function(){return o["default"]}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,debug:!1,capLevelToPlayerSize:!1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,seekHoleNudgeDuration:.01,stalledInBufferedNudgeThreshold:10,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,appendErrorMaxRetry:3,loader:R["default"],fLoader:void 0,pLoader:void 0,abrController:g["default"],bufferController:f["default"],capLevelController:_["default"],streamController:y["default"],timelineController:I["default"],enableCEA708Captions:!0,enableMP2TPassThrough:!1,abrEwmaFastLive:5,abrEwmaSlowLive:9,abrEwmaFastVoD:4,abrEwmaSlowVoD:15,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.8,abrBandWidthUpFactor:.7}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),a(e,[{key:"destroy",value:function(){D.logger.log("destroy"),this.trigger(o["default"].DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.streamController.destroy(),this.timelineController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){D.logger.log("attachMedia"),this.media=e,this.trigger(o["default"].MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){D.logger.log("detachMedia"),this.trigger(o["default"].MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){D.logger.log("loadSource:"+e),this.url=e,this.trigger(o["default"].MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length<=0||void 0===arguments[0]?-1:arguments[0];D.logger.log("startLoad"),this.levelController.startLoad(),this.streamController.startLoad(e)}},{key:"stopLoad",value:function(){D.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad()}},{key:"swapAudioCodec",value:function(){D.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){D.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){D.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){D.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){D.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return this.levelController.firstLevel},set:function(e){D.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){D.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){D.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}}]),e}();i["default"]=w},{"./controller/abr-controller":3,"./controller/buffer-controller":4,"./controller/cap-level-controller":5,"./controller/level-controller":7,"./controller/stream-controller":8,"./controller/timeline-controller":9,"./errors":21,"./events":23,"./loader/fragment-loader":28,"./loader/key-loader":29,"./loader/playlist-loader":30,"./utils/logger":38,"./utils/xhr-loader":40,events:1}],27:[function(e,t,i){"use strict";t.exports=e("./hls.js")["default"]},{"./hls.js":26}],28:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=e("../events"),d=n(l),u=e("../event-handler"),h=n(u),c=e("../errors"),p=function(e){function t(e){return s(this,t),a(this,Object.getPrototypeOf(t).call(this,e,d["default"].FRAG_LOADING))}return r(t,e),o(t,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),h["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;this.frag=t,this.frag.loaded=0;var i=this.hls.config;t.loader=this.loader="undefined"!=typeof i.fLoader?new i.fLoader(i):new i.loader(i),this.loader.load(t.url,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),i.fragLoadingTimeOut,0,0,this.loadprogress.bind(this),t)}},{key:"loadsuccess",value:function(e,t){var i=e.currentTarget.response;t.length=i.byteLength,this.frag.loader=void 0,this.hls.trigger(d["default"].FRAG_LOADED,{payload:i,frag:this.frag,stats:t})}},{key:"loaderror",value:function(e){this.loader&&this.loader.abort(),this.hls.trigger(d["default"].ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:this.frag,response:e})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(d["default"].ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(e,t){this.frag.loaded=t.loaded,this.hls.trigger(d["default"].FRAG_LOAD_PROGRESS,{frag:this.frag,stats:t})}}]),t}(h["default"]);i["default"]=p},{"../errors":21,"../event-handler":22,"../events":23}],29:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=e("../events"),d=n(l),u=e("../event-handler"),h=n(u),c=e("../errors"),p=function(e){function t(e){s(this,t);var i=a(this,Object.getPrototypeOf(t).call(this,e,d["default"].KEY_LOADING));return i.decryptkey=null,i.decrypturl=null,i}return r(t,e),o(t,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),h["default"].prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=this.frag=e.frag,i=t.decryptdata,n=i.uri;if(n!==this.decrypturl||null===this.decryptkey){var s=this.hls.config;t.loader=this.loader=new s.loader(s),this.decrypturl=n,this.decryptkey=null,t.loader.load(n,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),s.fragLoadingTimeOut,s.fragLoadingMaxRetry,s.fragLoadingRetryDelay,this.loadprogress.bind(this),t)}else this.decryptkey&&(i.key=this.decryptkey,this.hls.trigger(d["default"].KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e){var t=this.frag;this.decryptkey=t.decryptdata.key=new Uint8Array(e.currentTarget.response),t.loader=void 0,this.hls.trigger(d["default"].KEY_LOADED,{frag:t})}},{key:"loaderror",value:function(e){this.loader&&this.loader.abort(),this.hls.trigger(d["default"].ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:this.frag,response:e})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(d["default"].ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(){}}]),t}(h["default"]);i["default"]=p},{"../errors":21,"../event-handler":22,"../events":23}],30:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=e("../events"),d=n(l),u=e("../event-handler"),h=n(u),c=e("../errors"),p=e("../utils/url"),g=n(p),v=e("../utils/attr-list"),f=n(v),m=e("../utils/logger"),_=function(e){function t(e){return s(this,t),a(this,Object.getPrototypeOf(t).call(this,e,d["default"].MANIFEST_LOADING,d["default"].LEVEL_LOADING))}return r(t,e),o(t,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),this.url=this.id=null,h["default"].prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,null)}},{key:"onLevelLoading",value:function(e){this.load(e.url,e.level,e.id)}},{key:"load",value:function(e,t,i){var n,s,a,r=this.hls.config;if(this.loading&&this.loader){if(this.url===e&&this.id===t&&this.id2===i)return;this.loader.abort()}this.url=e,this.id=t,this.id2=i,null===this.id?(n=r.manifestLoadingMaxRetry,s=r.manifestLoadingTimeOut,a=r.manifestLoadingRetryDelay):(n=r.levelLoadingMaxRetry,s=r.levelLoadingTimeOut,a=r.levelLoadingRetryDelay),this.loader="undefined"!=typeof r.pLoader?new r.pLoader(r):new r.loader(r),this.loading=!0,this.loader.load(e,"",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),s,n,a)}},{key:"resolve",value:function(e,t){return g["default"].buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){for(var i=[],n=void 0,s=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;null!=(n=s.exec(e));){var a={},r=a.attrs=new f["default"](n[1]);a.url=this.resolve(n[2],t);var o=r.decimalResolution("RESOLUTION");o&&(a.width=o.width,a.height=o.height),a.bitrate=r.decimalInteger("AVERAGE-BANDWIDTH")||r.decimalInteger("BANDWIDTH"),a.name=r.NAME;var l=r.CODECS;if(l){l=l.split(",");for(var d=0;d<l.length;d++){var u=l[d];-1!==u.indexOf("avc1")?a.videoCodec=this.avc1toavcoti(u):a.audioCodec=u}}i.push(a)}return i}},{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),i=12;16>i;i++)t[i]=e>>8*(15-i)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&(i=this.cloneObj(e),i.iv=this.createInitializationVector(t)),i}},{key:"avc1toavcoti",value:function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"parseLevelPlaylist",value:function(e,t,i){var n,s,a,r=0,o=0,l={version:null,type:null,url:t,fragments:[],live:!0,startSN:0},d={method:null,key:null,iv:null,uri:null},u=0,h=null,c=null,p=null,g=null,v=null,_=null;for(a=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT(INF):(\d+(?:\.\d+)?)(?:,(.*))?)|(?:(?!#)()(\S.+))|(?:#EXT-X-(BYTERANGE):(\d+(?:@\d+(?:\.\d+)?))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.+))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*)))(?:.*)\r?\n?/g;null!==(s=a.exec(e));)switch(s.shift(),s=s.filter(function(e){return void 0!==e}),s[0]){case"VERSION":l.version=parseInt(s[1]);break;case"PLAYLIST-TYPE":l.type=s[1].toUpperCase();break;case"MEDIA-SEQUENCE":r=l.startSN=parseInt(s[1]);break;case"TARGETDURATION":l.targetduration=parseFloat(s[1]);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":u++;break;case"BYTERANGE":var E=s[1].split("@");_=1===E.length?v:parseInt(E[1]),v=parseInt(E[0])+_;break;case"INF":p=parseFloat(s[1]),g=s[2]?s[2]:null;break;case"":if(!isNaN(p)){var y=r++;n=this.fragmentDecryptdataFromLevelkey(d,y);var b=s[1]?this.resolve(s[1],t):null;c={url:b,duration:p,title:g,start:o,sn:y,level:i,cc:u,decryptdata:n,programDateTime:h},null!==_&&(c.byteRangeStartOffset=_,c.byteRangeEndOffset=v),l.fragments.push(c),o+=p,p=null,g=null,_=null,h=null}break;case"KEY":var A=s[1],S=new f["default"](A),I=S.enumeratedString("METHOD"),D=S.URI,C=S.hexadecimalInteger("IV");I&&(d={method:null,key:null,iv:null,uri:null},D&&"AES-128"===I&&(d.method=I,d.uri=this.resolve(D,t),d.key=null,d.iv=C));break;case"START":var R=s[1],T=new f["default"](R),P=T.decimalFloatingPoint("TIME-OFFSET");P&&(l.startTimeOffset=P);break;case"PROGRAM-DATE-TIME":h=new Date(Date.parse(s[1]));break;case"#":s.shift();break;default:m.logger.warn("line parsed but not handled: "+s)}return c&&!c.url&&(l.fragments.pop(),o-=c.duration),l.totalduration=o,l.endSN=r-1,l}},{key:"loadsuccess",value:function(e,t){var i,n=e.currentTarget,s=n.responseText,a=n.responseURL,r=this.id,o=this.id2,l=this.hls;if(this.loading=!1,void 0===a&&(a=this.url),t.tload=performance.now(),t.mtime=new Date(n.getResponseHeader("Last-Modified")),0===s.indexOf("#EXTM3U"))if(s.indexOf("#EXTINF:")>0){var u=this.parseLevelPlaylist(s,a,r||0);null===r?l.trigger(d["default"].MANIFEST_LOADED,{levels:[{url:a,details:u}],url:a,stats:t}):(t.tparsed=performance.now(),l.trigger(d["default"].LEVEL_LOADED,{details:u,level:r,id:o,stats:t}))}else i=this.parseMasterPlaylist(s,a),i.length?l.trigger(d["default"].MANIFEST_LOADED,{levels:i,url:a,stats:t}):l.trigger(d["default"].ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no level found in manifest"});else l.trigger(d["default"].ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e){var t,i;null===this.id?(t=c.ErrorDetails.MANIFEST_LOAD_ERROR,
i=!0):(t=c.ErrorDetails.LEVEL_LOAD_ERROR,i=!1),this.loader&&this.loader.abort(),this.loading=!1,this.hls.trigger(d["default"].ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:t,fatal:i,url:this.url,loader:this.loader,response:e.currentTarget,level:this.id,id:this.id2})}},{key:"loadtimeout",value:function(){var e,t;null===this.id?(e=c.ErrorDetails.MANIFEST_LOAD_TIMEOUT,t=!0):(e=c.ErrorDetails.LEVEL_LOAD_TIMEOUT,t=!1),this.loader&&this.loader.abort(),this.loading=!1,this.hls.trigger(d["default"].ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:e,fatal:t,url:this.url,loader:this.loader,level:this.id,id:this.id2})}}]),t}(h["default"]);i["default"]=_},{"../errors":21,"../event-handler":22,"../events":23,"../utils/attr-list":34,"../utils/logger":38,"../utils/url":39}],31:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return s(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:n};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var r=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,r,l,r,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,s))}},{key:"box",value:function(e){for(var t,i=Array.prototype.slice.call(arguments,1),n=8,s=i.length,a=s;s--;)n+=i[s].byteLength;for(t=new Uint8Array(n),t[0]=n>>24&255,t[1]=n>>16&255,t[2]=n>>8&255,t[3]=255&n,t.set(e,4),s=0,n=8;a>s;s++)t.set(i[s],n),n+=i[s].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,i){return i*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,i,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,i))}},{key:"moov",value:function(t){for(var i=t.length,n=[];i--;)n[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var i=t.length,n=[];i--;)n[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(n))}},{key:"mvhd",value:function(t,i){i*=t;var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24&255,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,n)}},{key:"sdtp",value:function(t){var i,n,s=t.samples||[],a=new Uint8Array(4+s.length);for(n=0;n<s.length;n++)i=s[n].flags,a[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var i,n,s,a=[],r=[];for(i=0;i<t.sps.length;i++)n=t.sps[i],s=n.byteLength,a.push(s>>>8&255),a.push(255&s),a=a.concat(Array.prototype.slice.call(n));for(i=0;i<t.pps.length;i++)n=t.pps[i],s=n.byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(n));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(r))),l=t.width,d=t.height;return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var i=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var i=t.id,n=t.duration*t.timescale,s=t.width,a=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,i){var n=e.sdtp(t),s=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.trun(t,n.length+16+16+8+16+8+8),n)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,i){var n,s,a,r,o,l,d=t.samples||[],u=d.length,h=12+16*u,c=new Uint8Array(h);for(i+=8+h,c.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),n=0;u>n;n++)s=d[n],a=s.duration,r=s.size,o=s.flags,l=s.cts,c.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,r>>>24&255,r>>>16&255,r>>>8&255,255&r,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*n);return e.box(e.types.trun,c)}},{key:"initSegment",value:function(t){e.types||e.init();var i,n=e.moov(t);return i=new Uint8Array(e.FTYP.byteLength+n.byteLength),i.set(e.FTYP),i.set(n,e.FTYP.byteLength),i}}]),e}();i["default"]=a},{}],32:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("../events"),o=n(r),l=e("../utils/logger"),d=e("../remux/mp4-generator"),u=n(d),h=e("../errors"),c=function(){function e(t){s(this,e),this.observer=t,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return a(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,i,n,s,a){this.ISGenerated||this.generateIS(e,t,s),this.ISGenerated&&(t.samples.length&&this.remuxVideo(t,s,a),e.samples.length&&this.remuxAudio(e,s,a)),i.samples.length&&this.remuxID3(i,s),n.samples.length&&this.remuxText(n,s),this.observer.trigger(o["default"].FRAG_PARSED)}},{key:"generateIS",value:function(e,t,i){var n,s,a=this.observer,r=e.samples,d=t.samples,c=this.PES_TIMESCALE,p={},g={tracks:p,unique:!1},v=void 0===this._initPTS;v&&(n=s=1/0),e.config&&r.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&!function(){var t=function i(e,t){return t?i(t,e%t):e};e.timescale=e.audiosamplerate/t(e.audiosamplerate,1024)}(),l.logger.log("audio mp4 timescale :"+e.timescale),p.audio={container:"audio/mp4",codec:e.codec,initSegment:u["default"].initSegment([e]),metadata:{channelCount:e.channelCount}},v&&(n=s=r[0].pts-c*i)),t.sps&&t.pps&&d.length&&(t.timescale=this.MP4_TIMESCALE,p.video={container:"video/mp4",codec:t.codec,initSegment:u["default"].initSegment([t]),metadata:{width:t.width,height:t.height}},v&&(n=Math.min(n,d[0].pts-c*i),s=Math.min(s,d[0].dts-c*i))),Object.keys(p).length?(a.trigger(o["default"].FRAG_PARSING_INIT_SEGMENT,g),this.ISGenerated=!0,v&&(this._initPTS=n,this._initDTS=s)):a.trigger(o["default"].ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,i){var n,s,a,r,d,h,c,p,g,v,f,m,_,E,y,b=8,A=this.PES_TIMESCALE,S=this.PES2MP4SCALEFACTOR,I=[],D=e.samples.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);for(0>D&&l.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(D/90)+" ms to overcome this issue"),h=new Uint8Array(e.len+4*e.nbNalu+8),n=new DataView(h.buffer),n.setUint32(0,h.byteLength),h.set(u["default"].types.mdat,4);e.samples.length;){for(s=e.samples.shift(),r=0;s.units.units.length;)d=s.units.units.shift(),n.setUint32(b,d.data.byteLength),b+=4,h.set(d.data,b),b+=d.data.byteLength,r+=4+d.data.byteLength;if(f=s.pts-this._initDTS,m=s.dts-this._initDTS+D,m=Math.min(f,m),void 0!==v){_=this._PTSNormalize(f,v),E=this._PTSNormalize(m,v);var C=(E-v)/S;0>=C&&(l.logger.log("invalid sample duration at PTS/DTS: "+s.pts+"/"+s.dts+":"+C),C=1),a.duration=C}else{var R=void 0,T=void 0;R=i?this.nextAvcDts:t*A,_=this._PTSNormalize(f,R),E=this._PTSNormalize(m,R),T=Math.round((E-R)/90),i&&T&&(T>1?l.logger.log("AVC:"+T+" ms hole between fragments detected,filling it"):-1>T&&l.logger.log("AVC:"+-T+" ms overlapping between fragments detected"),E=R,_=Math.max(_-T,E),l.logger.log("Video/PTS/DTS adjusted: "+_+"/"+E+",delta:"+T)),p=Math.max(0,_),g=Math.max(0,E)}a={size:r,duration:0,cts:(_-E)/S,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}},y=a.flags,s.key===!0?(y.dependsOn=2,y.isNonSync=0):(y.dependsOn=1,y.isNonSync=1),I.push(a),v=E}var P=0;I.length>=2&&(P=I[I.length-2].duration,a.duration=P),this.nextAvcDts=E+P*S;var M=e.dropped;e.len=0,e.nbNalu=0,e.dropped=0,I.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(y=I[0].flags,y.dependsOn=2,y.isNonSync=0),e.samples=I,c=u["default"].moof(e.sequenceNumber++,g/S,e),e.samples=[],this.observer.trigger(o["default"].FRAG_PARSING_DATA,{data1:c,data2:h,startPTS:p/A,endPTS:(_+S*P)/A,startDTS:g/A,endDTS:this.nextAvcDts/A,type:"video",nb:I.length,dropped:M})}},{key:"remuxAudio",value:function(e,t,i){var n,s,a,r,d,h,c,p,g,v,f,m,_,E=8,y=this.PES_TIMESCALE,b=e.timescale,A=y/b,S=1024*e.timescale/e.audiosamplerate,I=[],D=[];for(e.samples.sort(function(e,t){return e.pts-t.pts}),D=e.samples;D.length;){if(s=D.shift(),r=s.unit,v=s.pts-this._initDTS,f=s.dts-this._initDTS,void 0!==g)m=this._PTSNormalize(v,g),_=this._PTSNormalize(f,g),a.duration=(_-g)/A,Math.abs(a.duration-S)>S/10&&l.logger.log("invalid AAC sample duration at PTS "+Math.round(v/90)+",should be 1024,found :"+Math.round(a.duration*e.audiosamplerate/e.timescale)),a.duration=S,m=_=S*A+g;else{var C=void 0,R=void 0;if(C=i?this.nextAacPts:t*y,m=this._PTSNormalize(v,C),_=this._PTSNormalize(f,C),R=Math.round(1e3*(m-C)/y),i&&R){if(R>0)l.logger.log(R+" ms hole between AAC samples detected,filling it");else if(-12>R){l.logger.log(-R+" ms overlapping between AAC samples detected, drop frame"),e.len-=r.byteLength;continue}m=_=C}if(c=Math.max(0,m),p=Math.max(0,_),!(e.len>0))return;d=new Uint8Array(e.len+8),n=new DataView(d.buffer),n.setUint32(0,d.byteLength),d.set(u["default"].types.mdat,4)}d.set(r,E),E+=r.byteLength,a={size:r.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},I.push(a),g=_}var T=0,P=I.length;P>=2&&(T=I[P-2].duration,a.duration=T),P&&(this.nextAacPts=m+A*T,e.len=0,e.samples=I,h=u["default"].moof(e.sequenceNumber++,p/A,e),e.samples=[],this.observer.trigger(o["default"].FRAG_PARSING_DATA,{data1:h,data2:d,startPTS:c/y,endPTS:this.nextAacPts/y,startDTS:p/y,endDTS:(_+A*T)/y,type:"audio",nb:P}))}},{key:"remuxID3",value:function(e,t){var i,n=e.samples.length;if(n){for(var s=0;n>s;s++)i=e.samples[s],i.pts=(i.pts-this._initPTS)/this.PES_TIMESCALE,i.dts=(i.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(o["default"].FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var i,n=e.samples.length;if(n){for(var s=0;n>s;s++)i=e.samples[s],i.pts=(i.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(o["default"].FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var i;if(void 0===t)return e;for(i=e>t?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}},{key:"passthrough",get:function(){return!1}}]),e}();i["default"]=c},{"../errors":21,"../events":23,"../remux/mp4-generator":31,"../utils/logger":38}],33:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("../events"),o=n(r),l=function(){function e(t){s(this,e),this.observer=t,this.ISGenerated=!1}return a(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,i,n,s,a){var r=this.observer;if(!this.ISGenerated){var l={},d={tracks:l,unique:!0},u=t,h=u.codec;h&&(d.tracks.video={container:u.container,codec:h,metadata:{width:u.width,height:u.height}}),u=e,h=u.codec,h&&(d.tracks.audio={container:u.container,codec:h,metadata:{channelCount:u.channelCount}}),this.ISGenerated=!0,r.trigger(o["default"].FRAG_PARSING_INIT_SEGMENT,d)}r.trigger(o["default"].FRAG_PARSING_DATA,{data1:a,startPTS:s,startDTS:s,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();i["default"]=l},{"../events":23}],34:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){n(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])}return s(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=/^(\d+)x(\d+)$/.exec(this[e]);return null!==t?{width:parseInt(t[1],10),height:parseInt(t[2],10)}:void 0}}],[{key:"parseAttrList",value:function(e){for(var t,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,n={};null!==(t=i.exec(e));){var s=t[2],a='"';0===s.indexOf(a)&&s.lastIndexOf(a)===s.length-1&&(s=s.slice(1,-1)),n[t[1]]=s}return n}}]),e}();i["default"]=a},{}],35:[function(e,t,i){"use strict";var n={search:function(e,t){for(var i=0,n=e.length-1,s=null,a=null;n>=i;){s=(i+n)/2|0,a=e[s];var r=t(a);if(r>0)i=s+1;else{if(!(0>r))return a;n=s-1}}return null}};t.exports=n},{}],36:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return s(e,[{key:"attach",value:function(e){this.media=e,this.display=[],this.memory=[]}},{key:"detach",value:function(){this.clear()}},{key:"destroy",value:function(){}},{key:"_createCue",value:function(){var e=window.VTTCue||window.TextTrackCue,t=this.cue=new e(-1,-1,"");t.text="",t.pauseOnExit=!1,t.startTime=Number.MAX_VALUE,t.endTime=Number.MAX_VALUE,this.memory.push(t)}},{key:"clear",value:function(){var e=this._textTrack;if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"push",value:function(e,t){this.cue||this._createCue();for(var i,n,s,a,r,o=31&t[0],l=2,d=0;o>d;d++)if(i=t[l++],n=127&t[l++],s=127&t[l++],a=0!==(4&i),r=3&i,(0!==n||0!==s)&&a&&0===r){if(32&n||64&n)this.cue.text+=this._fromCharCode(n)+this._fromCharCode(s);else if((17===n||25===n)&&s>=48&&63>=s)switch(s){case 48:this.cue.text+="®";break;case 49:this.cue.text+="°";break;case 50:this.cue.text+="½";break;case 51:this.cue.text+="¿";break;case 52:this.cue.text+="™";break;case 53:this.cue.text+="¢";break;case 54:this.cue.text+="";break;case 55:this.cue.text+="£";break;case 56:this.cue.text+="♪";break;case 57:this.cue.text+=" ";break;case 58:this.cue.text+="è";break;case 59:this.cue.text+="â";break;case 60:this.cue.text+="ê";break;case 61:this.cue.text+="î";break;case 62:this.cue.text+="ô";break;case 63:this.cue.text+="û"}if((17===n||25===n)&&s>=32&&47>=s)switch(s){case 32:break;case 33:break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:break;case 42:break;case 43:break;case 44:break;case 45:break;case 46:break;case 47:}if((20===n||28===n)&&s>=32&&47>=s)switch(s){case 32:this._clearActiveCues(e);break;case 33:this.cue.text=this.cue.text.substr(0,this.cue.text.length-1);break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:this._clearActiveCues(e);break;case 42:break;case 43:break;case 44:this._clearActiveCues(e);break;case 45:break;case 46:this._text="";break;case 47:this._flipMemory(e)}if((23===n||31===n)&&s>=33&&35>=s)switch(s){case 33:break;case 34:break;case 35:}}}},{key:"_fromCharCode",value:function(e){switch(e){case 42:return"á";case 2:return"á";case 2:return"é";case 4:return"í";case 5:return"ó";case 6:return"ú";case 3:return"ç";case 4:return"÷";case 5:return"Ñ";case 6:return"ñ";case 7:return"█";default:return String.fromCharCode(e)}}},{key:"_flipMemory",value:function(e){this._clearActiveCues(e),this._flushCaptions(e)}},{key:"_flushCaptions",value:function(e){this._has708||(this._textTrack=this.media.addTextTrack("captions","English","en"),this._has708=!0);var t=!0,i=!1,n=void 0;try{for(var s,a=this.memory[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var r=s.value;r.startTime=e,this._textTrack.addCue(r),this.display.push(r)}}catch(t){i=!0,n=t}finally{try{!t&&a["return"]&&a["return"]()}finally{if(i)throw n}}this.memory=[],this.cue=null}},{key:"_clearActiveCues",value:function(e){var t=!0,i=!1,n=void 0;try{for(var s,a=this.display[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var r=s.value;r.endTime=e}}catch(t){i=!0,n=t}finally{try{!t&&a["return"]&&a["return"]()}finally{if(i)throw n}}this.display=[]}},{key:"_clearBufferedCues",value:function(){}}]),e}();i["default"]=a},{}],37:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){n(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return s(e,[{key:"sample",value:function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();i["default"]=a},{}],38:[function(e,t,i){"use strict";function n(){}function s(e,t){return t="["+e+"] > "+t}function a(e){var t=window.console[e];return t?function(){for(var i=arguments.length,n=Array(i),a=0;i>a;a++)n[a]=arguments[a];n[0]&&(n[0]=s(e,n[0])),t.apply(window.console,n)}:n}function r(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];i.forEach(function(t){d[t]=e[t]?e[t].bind(e):a(t)})}Object.defineProperty(i,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},l={trace:n,debug:n,log:n,warn:n,info:n,error:n},d=l;i.enableLogs=function(e){if(e===!0||"object"===("undefined"==typeof e?"undefined":o(e))){r(e,"debug","log","info","warn","error");try{d.log()}catch(e){d=l}}else d=l},i.logger=d},{}],39:[function(e,t,i){"use strict";var n={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var i=null,s=null,a=/^([^#]*)(.*)$/.exec(t);a&&(s=a[2],t=a[1]);var r=/^([^\?]*)(.*)$/.exec(t);r&&(i=r[2],t=r[1]);var o=/^([^#]*)(.*)$/.exec(e);o&&(e=o[1]);var l=/^([^\?]*)(.*)$/.exec(e);l&&(e=l[1]);var d=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(e);if(!d)throw new Error("Error trying to parse base URL.");var u=d[2]||"",h=d[1]||"",c=d[4],p=null;return p=/^\/\//.test(t)?u+"//"+n.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?h+"/"+n.buildAbsolutePath("",t.substring(1)):n.buildAbsolutePath(h+c,t),i&&(p+=i),s&&(p+=s),p},buildAbsolutePath:function(e,t){for(var i,n,s=t,a="",r=e.replace(/[^\/]*$/,s.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),o=0;n=r.indexOf("/../",o),n>-1;o=n+i)i=/^\/(?:\.\.\/)*/.exec(r.slice(n))[0].length,a=(a+r.substring(o,n)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(i-1)/3+"}$"),"/");return a+r.substr(o)}};t.exports=n},{}],40:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=e("../utils/logger"),r=function(){function e(t){n(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return s(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader,t=this.timeoutHandle;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),t&&window.clearTimeout(t)}},{key:"load",value:function(e,t,i,n,s,a,r,o){var l=arguments.length<=8||void 0===arguments[8]?null:arguments[8],d=arguments.length<=9||void 0===arguments[9]?null:arguments[9];this.url=e,!d||isNaN(d.byteRangeStartOffset)||isNaN(d.byteRangeEndOffset)||(this.byteRange=d.byteRangeStartOffset+"-"+(d.byteRangeEndOffset-1)),this.responseType=t,this.onSuccess=i,this.onProgress=l,this.onTimeout=s,this.onError=n,this.stats={trequest:performance.now(),retry:0},this.timeout=a,this.maxRetry=r,this.retryDelay=o,this.loadInternal()}},{key:"loadInternal",value:function(){var e;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onloadend=this.loadend.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",this.url,!0),this.byteRange&&e.setRequestHeader("Range","bytes="+this.byteRange),e.responseType=this.responseType;var t=this.stats;t.tfirst=0,t.loaded=0,this.xhrSetup&&this.xhrSetup(e,this.url),this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),this.timeout),e.send()}},{key:"loadend",value:function(e){var t=e.currentTarget,i=t.status,n=this.stats;n.aborted||(i>=200&&300>i?(window.clearTimeout(this.timeoutHandle),n.tload=Math.max(n.tfirst,performance.now()),this.onSuccess(e,n)):n.retry>=this.maxRetry||i>=400&&499>i?(window.clearTimeout(this.timeoutHandle),a.logger.error(i+" while loading "+this.url),this.onError(e)):(a.logger.warn(i+" while loading "+this.url+", retrying in "+this.retryDelay+"..."),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),n.retry++))}},{key:"loadtimeout",value:function(e){a.logger.warn("timeout while loading "+this.url),this.onTimeout(e,this.stats)}},{key:"loadprogress",value:function(e){var t=this.stats;0===t.tfirst&&(t.tfirst=Math.max(performance.now(),t.trequest)),t.loaded=e.loaded,this.onProgress&&this.onProgress(e,t)}}]),e}();i["default"]=r},{"../utils/logger":38}]},{},[27])(27)})}()}(),define("mpx/libs/uvp-1.3.1",function(){}),"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var i=arguments[t];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}),define("polyfill/object.assign",function(){}),define("components/video/video-uvpjs",["version!mpx/libs/uvp","polyfill/object.assign","tealium","ima"],function(){function e(e){this.options={autoplay:!0,device:CBSNEWS.device,element:"cbsNewsVideoPlayerJS",internalNS:".cbsnews",live:!1,pagePlaylist:!1,pageType:"Video",partner:"cbsnews",skin:!0,uvpc:{},viewability:!1},this.config=Object.assign(this.options,e),this.videoManager,this.videoPlayer,this.videoState,this.currentVideo,this.videosource,this.cbsnewsVODAdCall="//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/8264/vaw-can/"+this.config.partner+"&ciu_szs=300x60,300x250,728x90&impl=s&gdfp_req=1&env=vp&output=xml_vmap1&unviewed_position_start=1&url=[referrer_url]&correlator=[timestamp]&cust_params=vid%3D{mediaReferenceId}%26partner%3D"+this.config.partner+"&vid={mediaReferenceId}&cmsid=2289","facebook_instant"==CBSNEWS.tracking.siteType&&(this.cbsnewsVODAdCall="https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/8264/vaw-can/mobile_web/cbsnews_facebook&impl=s&gdfp_req=1&env=vp&output=vxml_vmap1&unviewed_position_start=1&url=[referrer_url]&description_url=[description_url]&correlator=[timestamp]&cmsid=2289&vid={mediaReferenceId}")}CBSNEWS.ad;return e.prototype.useSeparateTagsForIMAAds=function(){},e.prototype.loadPlayer=function(){var e={modules:[{category:"model",name:"AdSettings",enabled:!0,params:[{name:"adCallOverride",value:this.cbsnewsVODAdCall}]}]};if(void 0==this.config.video)var t="";else var t=this.config.video.thumbnail;var i={cms:uvpjs.mediaCapabilities.PLATFORM,netwk:"CBSNEWS",partner:this.config.partner,uvpc:[e,this.config.uvpc],usesIMA:!0,usesTealium:!0,skinConfig:{autoPlay:this.config.autoplay,customCSS:this.config.customCSS,previewImage:t,skin:this.config.skin}};this.currentVideo=this.config.video||this.config,this.videoManager=new uvpjs.VideoManager,this.videoManager.initialize(i,this.onVideoManagerReady.bind(this),this.onVideoManagerError.bind(this))},e.prototype.playFlash=function(e){console.log("FLASH")},e.prototype.loadVideoUrl=function(e){void 0!=e&&(this.currentVideo=e),this.videoPlayer.setPageContextMetadata(om.getHbParams());var t={videoTitle:this.currentVideo.videotitle,vidContId:this.config.element,type:uvpjs.mediaCapabilities.RP_URL,assetURL:this.videosource};this.videoPlayer.loadAndPlayResource(t),"CBSNPromo"==this.config.pageType&&this.videoPlayer.mute()},e.prototype.loadVideoUrlAds=function(e){void 0!=e&&(this.currentVideo=e),this.videoPlayer.setPageContextMetadata(om.getHbParams()),rcoArray=[],rcoArray.push({type:uvpjs.mediaCapabilities.RP_IMA,adCall:this.cbsnewsVODAdCall,vidContId:this.config.element}),rcoArray.push({type:uvpjs.mediaCapabilities.RP_URL,assetURL:this.videosource,videoTitle:this.currentVideo.videotitle,vidContId:this.config.element}),this.videoPlayer.addResourcesToPlaylist(rcoArray)},e.prototype.loadVideoPid=function(e){void 0!=e&&(this.currentVideo=e),this.videoPlayer.setPageContextMetadata(om.getHbParams());var t=[];t.push({type:uvpjs.mediaCapabilities.RP_IMA,vidContId:this.config.element,partner:this.config.partner,selectorCall:"https://link.theplatform.com/s/dJ5BDC/"+this.videosource+"?format=SMIL&manifest=m3u&Tracking=true&mbr=true&callback=uvpHandleJsonpResult&callback=uvpHandleJsonpResult"}),this.videoPlayer.addResourcesToPlaylist(t)},e.prototype.loadNextVideo=function(e){this.currentVideo=e,this.determinePlaybackType(),(this.config.loadingMethod="URL")?(this.loadVideoUrl(),this.config.loadingMethod=""):(this.config.loadingMethod="URL-ads")?(this.loadVideoUrlAds(),this.config.loadingMethod=""):this.verify60AA()},e.prototype.determinePlaybackType=function(){if("desktop"==this.config.device?null!=this.currentVideo.src.hls_variant_tablet.pid?this.videosource=this.currentVideo.src.hls_variant_tablet.pid:null!=this.currentVideo.src.wifi.pid?this.videosource=this.currentVideo.src.wifi.pid:null!=this.currentVideo.src.hls.pid?this.videosource=this.currentVideo.src.hls.pid:null!=this.currentVideo.src.rtmp.pid?this.videosource=this.currentVideo.src.rtmp.pid:this.videosource=this.currentVideo.src.rtmp.url:"tablet"==this.config.device?this.videosource=this.currentVideo.src.hls_variant_tablet.url:null!=this.currentVideo.src.hls_variant_phone.pid?this.videosource=this.currentVideo.src.hls_variant_phone.pid:null!=this.currentVideo.src["3g"].pid?this.videosource=this.currentVideo.src["3g"].pid:null!=this.currentVideo.src.hls.pid&&(this.videosource=this.currentVideo.src.hls.pid),"URL"==this.config.loadingMethod||"URL-ads"==this.config.loadingMethod)for(var e in this.currentVideo.src)for(var t in this.currentVideo.src[e])"url"==t&&null!=this.currentVideo.src[e][t]&&(this.videosource=this.currentVideo.src[e][t])},e.prototype.show60MinBlock=function(e){document.getElementById("errorVideoId");if("app"==style);else;var t=document.createElement("div");t.setAttribute("id","videoerrorId");var i=document.createElement("div");i.setAttribute("id","video-error-IconId"),
i.setAttribute("class","video-error-icon");var n=document.createElement("div");n.setAttribute("id","video-error-textId"),n.setAttribute("class","video-error-text");var s=document.createElement("div");s.setAttribute("id","video-error-buttonId"),s.setAttribute("class","video-error-button");var a=document.createTextNode("Learn More");s.appendChild(a);var r=this.config.element;r.parentNode;r.appendChild(t),t.insertBefore(i,t.nextSibling),t.insertBefore(n,i.nextSibling),t.insertBefore(s,n.nextSibling)},e.prototype.verify60AA=function(){if("desktop"==this.config.device)0==this.currentVideo.subscribedContent.subscriber||"false"==this.currentVideo.subscribedContent.subscriber?this.show60MinBlock():1==this.currentVideo.subscribedContent.is60minfranchise||"true"==this.currentVideo.subscribedContent.is60minfranchise?1==this.currentVideo.subscribedContent.viewable||"true"==this.currentVideo.subscribedContent.viewable?1==this.currentVideo.subscribedContent.subscriber||"true"==this.currentVideo.subscribedContent.subscriber?this.loadVideoUrl():this.loadVideoPid():1==this.currentVideo.subscribedContent.is60minfranchise&&"Previews"==this.currentVideo.topicname?1==this.currentVideo.subscribedContent.subscriber||"true"==this.currentVideo.subscribedContent.subscriber?this.loadVideoUrl():this.loadVideoPid():1==this.currentVideo.subscribedContent.subscriber||"true"==this.currentVideo.subscribedContent.subscriber?this.loadVideoUrl():this.show60MinBlock():"60 Minutes Overtime"!=this.currentVideo.topicname||1!=this.currentVideo.subscribedContent.subscriber&&"true"!=this.currentVideo.subscribedContent.subscriber?this.loadVideoPid():this.loadVideoUrl();else if(1==this.currentVideo.subscribedContent.is60minfranchise||"true"==this.currentVideo.subscribedContent.is60minfranchise)if(1==this.currentVideo.subscribedContent.viewable||"true"==this.currentVideo.subscribedContent.viewable){if(1!=this.currentVideo.subscribedContent.is6048Preview&&1!=this.currentVideo.subscribedContent.is60Extra&&"true"!=this.currentVideo.subscribedContent.is6048Preview&&"true"!=this.currentVideo.subscribedContent.is60Extra)return void this.show60MinBlock("app");(1==this.currentVideo.subscribedContent.subscriber||"true"==this.currentVideo.subscribedContent.subscriber)&&this.loadVideoUrl()}else if(1==this.currentVideo.subscribedContent.is6048Preview||"true"==this.currentVideo.subscribedContent.is6048Preview);else{if(1==this.currentVideo.subscribedContent.subscriber||"false"==this.currentVideo.subscribedContent.subscriber)return void this.show60MinBlock("subscribe");if(0==this.options.is60Extra||"false"==this.options.is60Extra)return void this.show60MinBlock("app");this.loadVideoUrl()}},e.prototype.onVideoManagerReady=function(){this.videoManager.createVideoPlayer(this.config.element,this.onVideoPlayerReady.bind(this))},e.prototype.onVideoManagerError=function(e){},e.prototype.onVideoPlayerReady=function(e){var t=this.config.internalNS,i=uvpjs.EventType;this.videoPlayer=e,"facebook_instant"==CBSNEWS.tracking.siteType&&this.videoPlayer.disableButton(uvpjs.Type.Button.FULLSCREEN),this.videoPlayer.enableButton(uvpjs.Type.Button.CLOSED_CAPTION),e.addEventListener(i.PLAYER_LOADED+t,this.onPlayerLoaded.bind(this)),e.addEventListener(i.CONTENT_DATA_LOADED+t,this.onContentDataLoaded.bind(this)),e.addEventListener(i.AD_START+t,this.onAdStart.bind(this)),e.addEventListener(i.AD_END+t,this.onAdEnd.bind(this)),e.addEventListener(i.NO_AD_CONTENT+t,this.onNoAdContent.bind(this)),e.addEventListener(i.RESOURCE_START+t,this.onResourceStart.bind(this)),e.addEventListener(i.RESOURCE_END+t,this.onResourceEnd.bind(this)),e.addEventListener(i.CONTENT_START+t,this.onContentStart.bind(this)),e.addEventListener(i.CONTENT_END+t,this.onContentEnd.bind(this)),e.addEventListener(i.VIDEO_ERROR+t,this.onVideoError.bind(this)),e.addEventListener(i.VIDEO_DONE+t,this.onVideoDone.bind(this)),this.determinePlaybackType(),"URL"==this.config.loadingMethod?(this.loadVideoUrl(),""==this.config.loadingMethod):"URL-ads"==this.config.loadingMethod?(this.loadVideoUrlAds(),""==this.config.loadingMethod):this.loadVideoPid()},e.prototype.onPlayerLoaded=function(e){},e.prototype.onContentDataLoaded=function(e){},e.prototype.onAdStart=function(e){this.videoState="AD"},e.prototype.onAdEnd=function(e){this.videoState=""},e.prototype.onNoAdContent=function(e){},e.prototype.onResourceStart=function(e){},e.prototype.onResourceEnd=function(e){this.videoState=""},e.prototype.onContentStart=function(e){this.videoState="CONTENT"},e.prototype.onContentEnd=function(e){this.videoState=""},e.prototype.onVideoError=function(e){},e.prototype.onVideoDone=function(e){},e}),require(["common"]),require(["jquery"],function(e){e(function(){e("#article-entry a:not([data-open])").attr("target","_blank"),e(".module-homepage")&&(navigator.userAgent.toLowerCase().indexOf("opr")>-1||navigator.userAgent.match(/iPad/i)&&-1==document.location.href.indexOf("&qwr=1335191960"))&&e(".module-homepage").css("display","none"),e(".popup-link").on("click",function(){function t(){loginWindow.closed?location.reload():window.setTimeout(t,1e3)}var i=e(this).attr("data-pop-path");w=960,h=551,left=screen.width/2-w/2,top=screen.height/2-h/2,loginWindow=window.open(i,"securePopup","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=no, width="+w+", height="+h+", top="+top+", left="+left);var n=-1!=navigator.userAgent.indexOf("Edge")||-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Trident");if(n)window.setTimeout(t,1e3);else{var s=window.addEventListener?"addEventListener":"attachEvent",a=window[s],r="attachEvent"==s?"onmessage":"message";a(r,function(e){e.origin.indexOf("cbsnews")<-1||"loginWindow"!==e.data||location.reload()},!1)}return loginWindow});var t=window.addEventListener?"addEventListener":"attachEvent",i=window[t],n="attachEvent"==t?"onmessage":"message";i(n,function(e){e.origin.indexOf("cbsnews")<-1||"loginWindow"!==e.data||location.reload()},!1),e(".leaderboard-ads").length&&e(window).scroll(function(){e(".leaderboard-ads").toggleClass("sponsored-ad-fixed",e(window).scrollTop()>128)}),e('[data-component="imageGallery"], [data-component="mediaPost"]').on("imagegallerycreate imagegalleryshown imagegallerynext imagegalleryprevious mediapostcreate mediapostnext mediapostprevious",function(){var t=e(this).find(".selected");t.add(t.prev()).add(t.next()).find(".lazyload").addClass("lazypreload")});var s=e("#relatedVideoContainer");(navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/android/i))&&(s.removeAttr("data-open"),s.removeAttr("data-modal-options"),s.removeAttr("data-modal-async-url"),s.attr("target","_blank"))})}),require(["version!fly/components/scrollbar"]),require(["components/comments"]),require(["components/video/generic-playlist"]),require(["components/video/video-player"]),require(["components/video/video-uvpjs"],function(e){video=new e(CBSNEWS.uvpConfig),video.loadPlayer()}),define("main.desktop",function(){});