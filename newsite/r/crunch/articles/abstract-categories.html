<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Abstract Categories • Crunch</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Abstract Categories">
<meta property="og:description" content="The Crunch package has a number of abstractions for categories and other category-like things. This vignette explains the Internals and reasoning behind them.">
<meta property="og:image" content="http://crunch.io/r/crunch/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-50332119-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-50332119-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Crunch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.30.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/crunch.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Getting started</li>
    <li>
      <a href="../articles/variables.html">Crunch Variables</a>
    </li>
    <li>
      <a href="../articles/array-variables.html">Array Variables</a>
    </li>
    <li>
      <a href="../articles/variable-order.html">Variable Folders and Organization</a>
    </li>
    <li>
      <a href="../articles/projects.html">Organizing Datasets in Projects</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Exploring and analyzing</li>
    <li>
      <a href="../articles/derive.html">Adding Variables</a>
    </li>
    <li>
      <a href="../articles/analyze.html">Analyzing Crunch Data</a>
    </li>
    <li>
      <a href="../articles/filters.html">Filtering Data</a>
    </li>
    <li>
      <a href="../articles/subtotals.html">Subtotals and Headings</a>
    </li>
    <li>
      <a href="../articles/export.html">Exporting Data</a>
    </li>
    <li>
      <a href="../articles/fork-and-merge.html">Fork and Merge a Dataset</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Going deeper</li>
    <li>
      <a href="../articles/crunch-internals.html">Crunch Internals</a>
    </li>
    <li>
      <a href="../articles/abstract-categories.html">Abstract Categories</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Cookbooks</li>
    <li>
      <a href="../articles/deck-cookbook.html">Crunch Deck Cookbook</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Crunch-io/rcrunch/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="abstract-categories_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Abstract Categories</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Crunch-io/rcrunch/blob/HEAD/vignettes/abstract-categories.Rmd" class="external-link"><code>vignettes/abstract-categories.Rmd</code></a></small>
      <div class="hidden name"><code>abstract-categories.Rmd</code></div>

    </div>

    
    
<p><a href="crunch-internals.html">Previous: Crunch internals</a></p>
<p>There are number of areas where Crunch needs to represent an object as belonging to one of many categories. The simplest and most common example of this is the categories of a categorical variable. For a categorical variable, the values of the variable can be one of a limited set of categories and those categories are specified in the Crunch API as metadata about the variable. These categoricals are similar to R’s <code>factor</code>s but are richer because Crunch categoricals can have any number of missing values (compared to just <code>NA</code> for <code>factor</code>s), as well as a numeric representation that is separate from the category ids (which is useful for things like income bins, where you might put the middle of the bin as the value).</p>
<p>Moving beyond just categorical variables, we have a need to be able to represent a number of different properties, transformations, etc. in a category-like way. One concrete example is used heavily in order to add subtotals and headings to representations of categorical variables. In order to do this, we have two families of <a href="http://adv-r.had.co.nz/S4.html" class="external-link">S4 classes</a>: <code>AbstractCategory</code> and <code>AbstractCategories</code> Although subtotals and headings was the initial motivation for the new classes, they will allow for other types of representations and manipulations in the future.</p>
<div class="section level2">
<h2 id="abstractcategories">AbstractCategories<a class="anchor" aria-label="anchor" href="#abstractcategories"></a>
</h2>
<p>The core classes that all other classes inherit from are <code>AbstractCategory</code> and <code>AbstractCategories</code>. The first, <code>AbstractCategory</code>, is designed to represent a single category, which might have a number of properties about it (what those are will be explained in more detail below). The second, <code>AbstractCategories</code> is designed to hold more than one <code>AbstractCategory</code> together to form a coherent group. As a simple, example: an <code>AbstractCategories</code> for binned income could have 5 <code>AbstractCategory</code>s: &lt;$25,000, $25,000-$49,999, $50,000-$99,999, $100,000-$199,999, &gt;$200,000. This could be represented in R as:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">income</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AbstractCategory.html">AbstractCategories</a></span><span class="op">(</span><span class="fu"><a href="../reference/AbstractCategory.html">AbstractCategory</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"&lt;$25,000"</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="../reference/AbstractCategory.html">AbstractCategory</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"$25,000-$49,999"</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="../reference/AbstractCategory.html">AbstractCategory</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"$50,000-$99,999"</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="../reference/AbstractCategory.html">AbstractCategory</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"$100,000-$199,999"</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="../reference/AbstractCategory.html">AbstractCategory</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"&gt;$200,000"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>An alternate (and less typing) way to instantiate this same <code>AbstractCategories</code> is to send lists, and the constructor takes care of calling the <code>AbstractCategory</code> class on each (as below). Each of the child-classes of <code>AbstractCategories</code> (described in the sections below) have their own mapping of plural container to singular entity constructor in the same way, so passing <code>Categories</code> a list will result in a <code>Categories</code> object full of <code>Category</code> objects.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">income</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AbstractCategory.html">AbstractCategories</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"&lt;$25,000"</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"$25,000-$49,999"</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"$50,000-$99,999"</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"$100,000-$199,999"</span><span class="op">)</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"&gt;$200,000"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally, there’s a <code>data</code> argument, if you already have a list of <code>AbstractCategory</code>s (or simply named lists!) you want to pass in (the same thing could also be accomplished with <code>do.call</code>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">income_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"&lt;$25,000"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"$25,000-$49,999"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"$50,000-$99,999"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"$100,000-$199,999"</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"&gt;$200,000"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">income</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AbstractCategory.html">AbstractCategories</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">income_list</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h3>
<p>Any methods that are defined for the abstract classes will function on the subclasses as well. Child classes might have special over-ride methods defined for them, but for the most part, if a method can be used on <code>AbstractCategories</code> or <code>AbstractCategory</code> it can be used on the child classes as well.</p>
<p><code>AbstractCategories</code> inherits from <code>list</code> and <code>AbstractCategory</code> inherits from <code>namedList</code> so many of the same methods will be work with both of them. This includes using <code>[</code>, <code>[[</code>, <code>[&lt;-</code>, and <code>[[&lt;-</code> to get and set subsets of <code>AbstractCategories</code> and <code>$</code>, and <code>[[</code> to get the properties in an <code>AbstractCategory</code>.</p>
<p><code>lapply</code> has also been defined for <code>AbstractCategories</code> for easily iterating over all members. <code>modifyCats</code> also allows for modifying one <code>AbstractCategories</code> object by updating with new information from a second <code>AbstractCategories</code> object in the same way that <code>modifyList</code> works, but crucially it does not recurse into the <code>AbstractCategory</code> objects themselves.</p>
<p>Finally, there are a few custom methods that return the values of the properties as either a vector of that property for each member (when using the plural versions against <code>AbstractCategories</code>) or a vector (typically of length one) for a single member (when using the singular versions against <code>AbstractCategory</code>).</p>
<p><code>names</code> returns the names associated with each <code>AbstractCategory</code> in an <code>AbstractCategories</code> object. And <code>name</code> returns the names associated with an <code>AbstractCategory</code> object. <code>ids</code> and <code>id</code> patterns the exact same way.</p>
</div>
</div>
<div class="section level2">
<h2 id="categories">Categories<a class="anchor" aria-label="anchor" href="#categories"></a>
</h2>
<p>Categories from a categorical variable are represented by the <code>Categories</code> and <code>Category</code> classes. They inherit directly from <code>AbstractCategories</code> and <code>Category</code> respectively. For these, each <code>Category</code> must have a <code>name</code> and an <code>id</code>, they optionally can have a <code>numeric_value</code>, <code>missing</code>, and <code>selected</code> property.</p>
<div class="section level3">
<h3 id="methods-1">Methods<a class="anchor" aria-label="anchor" href="#methods-1"></a>
</h3>
<ul>
<li>
<code>values</code> and <code>value</code> return the <code>numeric_value</code>s property from <code>Categories</code> or a single <code>Category</code> respectively.</li>
<li>
<code>is.na</code> and <code>is.na</code> returns the <code>missing</code> property from <code>Categories</code> or a single <code>Category</code> respectively.</li>
<li>
<code>is.selected</code> and <code>is.selected</code> returns the <code>selected</code> property from <code>Categories</code> or a single <code>Category</code> respectively.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="insertions">Insertions<a class="anchor" aria-label="anchor" href="#insertions"></a>
</h2>
<p>Insertions allow users to insert new categories into a variable or a CrunchCube for display purposes. This is useful when the user would like to show things like aggregates (e.g. subtotals) without manipulating the underlying data (or creating a new variable). Insertions are defined as part of the Crunch API (see the Transforms section below for an explanation about where Insertions live). The <code>Insertion</code>s class is designed to mirror the Crunch API for insertions as closely as possible. <code>Insertions</code> and <code>Insertion</code> inherit directly from <code>AbstractCategories</code> and <code>Category</code> respectively.</p>
<p><code>Insertion</code>s must have a <code>name</code> and an <code>anchor</code>. The <code>name</code> is just like <code>Category</code> names, and is used as the label to display. The <code>anchor</code> is the id of the category after which the insertion should be placed.</p>
<p>Since insertions can represent a number of different aggregations, they also can have <code>function</code> and <code>args</code> properties. The <code>function</code> property is a character describing the aggregation to use (e.g. <code>"subtotal"</code>) and the <code>args</code> property is a vector of the category <code>id</code>s to use as operands for the <code>function</code>.</p>
<p>The <code>Insertion</code> class has two child classes: <code>Subtotal</code> and <code>Heading</code>. The <code>Insertions</code> class can contain anything that inherits from <code>Insertion</code>. Therefor an <code>Insertions</code> object might include <code>Insertion</code>s, <code>Subtotal</code>s, and <code>Heading</code>s.</p>
<div class="section level3">
<h3 id="methods-2">Methods<a class="anchor" aria-label="anchor" href="#methods-2"></a>
</h3>
<ul>
<li>
<code>anchors</code> and <code>anchor</code> return the anchor property from <code>Insertions</code> or a single <code>Insertion</code> respectively.</li>
<li>
<code>funcs</code> and <code>func</code> return the function property from <code>Insertions</code> or a single <code>Insertion</code> respectively.</li>
<li>
<code>arguments</code> returns the <code>args</code> property from a single <code>Insertion</code>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="subtotals-and-headings">Subtotals and Headings<a class="anchor" aria-label="anchor" href="#subtotals-and-headings"></a>
</h2>
<p>Subtotals and headings are both <em>types</em> of insertions. Because of this <code>Subtotal</code> and <code>Heading</code> classes inherit from <code>Insertion</code> rather than directly from <code>AbstractCategory</code>. These classes are designed to hold known types of Insertions to make it easier to work with Insertions (for example: testing which insertion to style in what way when using <code>prettyPrint</code> functions). Additionally, these classes have slightly more user-friendly names (e.g. <code>after</code> instead of <code>anchor</code>), and they accept either <code>id</code>s or <code>name</code>s to refer to specific <code>Category</code>s.</p>
<div class="section level3">
<h3 id="subtotal">Subtotal<a class="anchor" aria-label="anchor" href="#subtotal"></a>
</h3>
<p>A <code>Subtotal</code> must have <code>name</code>, <code>after</code>, and <code>categories</code> properties. <code>name</code> is the same as other abstract categories. <code>after</code> is similar to <code>anchor</code> but can be either a category <code>id</code> or a category <code>name</code> after which the subtotal should be placed. <code>categories</code> is either the category <code>id</code>s or a category <code>name</code>s to subtotal.</p>
<div class="section level4">
<h4 id="methods-3">Methods<a class="anchor" aria-label="anchor" href="#methods-3"></a>
</h4>
<p>The same as <code>Insertion</code>, however some have customizations: * <code>func</code> always returns the string <code>"subtotal"</code> (because by definition a <code>Subtotal</code> object is an <code>Insertion</code> with <code>function="subtotal"</code>) * <code>anchor</code> and <code>arguments</code> both have an option <code>var_items</code> which is required if the <code>Subtotal</code> is using category names instead of ids in the <code>after</code> or <code>categories</code> properties. Supplying the categories is required in order to translate from category <code>name</code>s to <code>id</code>s which are required to be a well-formed <code>Insertion</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="heading">Heading<a class="anchor" aria-label="anchor" href="#heading"></a>
</h3>
<p>A <code>Heading</code> must have <code>name</code> and <code>after</code> properties. Both of which have the same interpretation as <code>Subtotal</code> above.</p>
<div class="section level4">
<h4 id="methods-4">Methods<a class="anchor" aria-label="anchor" href="#methods-4"></a>
</h4>
<p>The same as <code>Subtotal</code> for <code>anchor</code>. <code>func</code> and <code>arguments</code> return <code>NA</code></p>
<p>As a concrete example, let’s take the following categories:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_cats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Categories.html">Categories</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Very Happy"</span>, id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Somewhat Happy"</span>, id <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Neither Happy nor Unhappy"</span>, id <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Somewhat Unhappy"</span>, id <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Very Unhappy"</span>, id <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">feeling_cats</span></span></code></pre></div>
<pre><code><span><span class="co">##   id                      name value missing</span></span>
<span><span class="co">## 1  1                Very Happy    NA   FALSE</span></span>
<span><span class="co">## 2  2            Somewhat Happy    NA   FALSE</span></span>
<span><span class="co">## 3  3 Neither Happy nor Unhappy    NA   FALSE</span></span>
<span><span class="co">## 4  4          Somewhat Unhappy    NA   FALSE</span></span>
<span><span class="co">## 5  5              Very Unhappy    NA   FALSE</span></span></code></pre>
<p>And make some subtotals and headings to use as insertions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_subtotals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Insertions.html">Insertions</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/SubtotalsHeadings.html">Heading</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"How I feel about cheese"</span>, position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/SubtotalsHeadings.html">Subtotal</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Generally Happy"</span>, after <span class="op">=</span> <span class="st">"Somewhat Happy"</span>, </span>
<span>        categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Very Happy"</span>, <span class="st">"Somewhat Happy"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/SubtotalsHeadings.html">Subtotal</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Generally Unhappy"</span>, after <span class="op">=</span> <span class="fl">5</span>, </span>
<span>        categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Notice that the “Generally Happy” subtotal is made specifying category <code>name</code>s for <code>after</code> and <code>categories</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_subtotals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">after</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Somewhat Happy"</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_subtotals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">categories</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Very Happy"     "Somewhat Happy"</span></span></code></pre>
<p>Where as the “Generally Unhappy” subtotal uses <code>id</code>s:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_subtotals</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">after</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 5</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_subtotals</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">categories</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4 5</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="converting-from-subtotalheading-to-insertion">Converting from Subtotal/Heading to Insertion<a class="anchor" aria-label="anchor" href="#converting-from-subtotalheading-to-insertion"></a>
</h3>
<p>Since the Crunch API does not have a distinction between <code>Subtotal</code>s <code>Heading</code>s, and other <code>Insertion</code>s, we sometimes need to convert from <code>Subtotal</code>s or <code>Heading</code>s to <code>Insertion</code>s. This is accomplished with the method <code><a href="../reference/makeInsertion.html">makeInsertion()</a></code>. This method takes a <code>Subtotal</code> or <code>Heading</code> and returns a valid <code>Insertion</code>. If the <code>Subtotal</code> or <code>Heading</code> has category <code>name</code> references instead of <code>id</code>s, then you must include a <code>Categories</code> object as the <code>var_items</code> argument. In general, this is only needed before sending a heterogeneous set of <code>Insertions</code> to the Crunch API.</p>
<p>Using the examples we used before, we can see how this works:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_insertions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Insertions.html">Insertions</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">feeling_subtotals</span>, <span class="va">makeInsertion</span>, var_items <span class="op">=</span> <span class="va">feeling_cats</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, all of the <code>Subtotal</code>s and <code>Heading</code> from <code>feeling_subtotals</code> are proper <code>Insertion</code>s:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">feeling_insertions</span>, <span class="va">class</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Insertion" "Insertion" "Insertion"</span></span></code></pre>
<p>This means that the <code>after</code> property has been translated into <code>anchor</code>, and the <code>function</code> and <code>args</code> properties have been filled in appropriately:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_insertions</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">anchor</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 5</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_insertions</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`function`</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "subtotal"</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_insertions</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">args</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4 5</span></span></code></pre>
<p>Because <code>Insertion</code>s are required to use category <code>id</code>s only, the new all-<code>Insertion</code>s <code>feeling_insertions</code> has translated the “Generally Happy” subtotal’s category <code>name</code>s to <code>id</code>s:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_insertions</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">anchor</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_insertions</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">args</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="converting-from-insertion-to-subtotalheading">Converting from Insertion to Subtotal/Heading<a class="anchor" aria-label="anchor" href="#converting-from-insertion-to-subtotalheading"></a>
</h3>
<p>Since the Crunch API does not have a distinction between <code>Subtotal</code>s <code>Heading</code>s, and other <code>Insertion</code>s when we get data about <code>Insertion</code>s from the API, we need to change the classes for the <code>Insertion</code>s that the <code>crunch</code> package knows about. To do this, we can use either <code>subtypeInsertions</code> to change the types of all of the members of an <code>Insertions</code> object, or <code>subtypeInsertion</code> to change the type of a single <code>Insertion</code> object.</p>
<p>These functions work by inspecting the <code>Insertion</code> and determining if it can be identified as one of the known child classes of <code>Insertion</code> (namely: <code>Subtotal</code> or <code>Heading</code>).</p>
<p>Using the same example above, we can convert back from all <code>Insertion</code>s to the subtypes:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feeling_subtotals_again</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subtypeInsertion.html">subtypeInsertions</a></span><span class="op">(</span><span class="va">feeling_insertions</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">feeling_subtotals_again</span>, <span class="va">class</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Heading"  "Subtotal" "Subtotal"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="inheritance">Inheritance<a class="anchor" aria-label="anchor" href="#inheritance"></a>
</h2>
<p>There are two sets of inheritance: one for containers and one for members: Classes inherit from those immediately to their left</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th>top-level classes</th>
<th>1st children</th>
<th>2nd children</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>containers</td>
<td><code>AnstractCategories</code></td>
<td><code>Categories</code></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><code>AnstractCategories</code></td>
<td><code>Insertions</code></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>members</td>
<td><code>AbstractCategory</code></td>
<td><code>Category</code></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td><code>AbstractCategory</code></td>
<td><code>Insertion</code></td>
<td><code>Subtotal</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>AbstractCategory</code></td>
<td><code>Insertion</code></td>
<td><code>Heading</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="shared-methods-chart">Shared methods chart<a class="anchor" aria-label="anchor" href="#shared-methods-chart"></a>
</h2>
<p>The methods are listed as row labels and the classes are column labels. If a method is implemented, it is marked “impl.”.</p>
<div class="section level3">
<h3 id="containers">Containers<a class="anchor" aria-label="anchor" href="#containers"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th></th>
<th>AbstractCategories</th>
<th>Categories</th>
<th>Insertions</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>names</code></td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
</tr>
<tr class="even">
<td><code>ids</code></td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
</tr>
<tr class="odd">
<td><code>values</code></td>
<td></td>
<td>impl.</td>
<td></td>
</tr>
<tr class="even">
<td><code>is.na</code></td>
<td></td>
<td>impl.</td>
<td></td>
</tr>
<tr class="odd">
<td><code>is.selected</code></td>
<td></td>
<td>impl.</td>
<td></td>
</tr>
<tr class="even">
<td><code>anchors</code></td>
<td></td>
<td></td>
<td>impl.</td>
</tr>
<tr class="odd">
<td><code>funcs</code></td>
<td></td>
<td></td>
<td>impl.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="members">Members<a class="anchor" aria-label="anchor" href="#members"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th></th>
<th>AbstractCategory</th>
<th>Category</th>
<th>Insertion</th>
<th>Subtotal</th>
<th>Heading</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
</tr>
<tr class="even">
<td><code>id</code></td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
</tr>
<tr class="odd">
<td><code>value</code></td>
<td></td>
<td>impl.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>is.na</code></td>
<td></td>
<td>impl.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>is.selected</code></td>
<td></td>
<td>impl.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>anchor</code></td>
<td></td>
<td></td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
</tr>
<tr class="odd">
<td><code>func</code></td>
<td></td>
<td></td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
</tr>
<tr class="even">
<td><code>arguments</code></td>
<td></td>
<td></td>
<td>impl.</td>
<td>impl.</td>
<td>impl.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="transforms">Transforms<a class="anchor" aria-label="anchor" href="#transforms"></a>
</h2>
<p>The <code>Transforms</code> class and set of functions is not an abstract category at all, but rather it mirrors the Crunch API’s set of transformations that are allowed on a variable or CrunchCube. One of the possible transformations are insertions (which is where <code>Insertions</code> are stored). Currently the <code>crunch</code> package doesn’t support other transformations.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Greg Freedman Ellis, Jonathan Keane, Mike Malecki, Neal Richardson, Gordon Shotwell.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '9fbcb3ae4d05600402e31f66b9b9501e',
    indexName: 'crunch',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
