<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subtotals and Headings • Crunch</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Subtotals and Headings">
<meta property="og:description" content="Modify subtotals and headings from R">
<meta property="og:image" content="http://crunch.io/r/crunch/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50332119-2', 'auto');
  ga('send', 'pageview');

</script><!-- docsearch --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">crunch</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.21.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getting-started.html">Intro</a>
</li>
<li>
  <a href="../reference/">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/datasets.html">Datasets</a>
    </li>
    <li>
      <a href="../articles/variables.html">Variables</a>
    </li>
    <li>
      <a href="../articles/array-variables.html">Array Variables</a>
    </li>
    <li>
      <a href="../articles/variable-order.html">Organize Variables</a>
    </li>
    <li>
      <a href="../articles/derive.html">Derive Variables</a>
    </li>
    <li>
      <a href="../articles/filters.html">Filter Data</a>
    </li>
    <li>
      <a href="../articles/export.html">Export Data</a>
    </li>
    <li>
      <a href="../articles/subtotals.html">Subtotals and Headings</a>
    </li>
    <li>
      <a href="../articles/crunch-internals.html">Crunch Internals</a>
    </li>
    <li>
      <a href="../articles/abstract-categories.html">Abstract Categories</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Crunch-io/rcrunch">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Subtotals and Headings</h1>
            
      
      <small>Source: <a href="https://github.com/Crunch-io/rcrunch/blob/master/vignettes/subtotals.Rmd"><code>vignettes/subtotals.Rmd</code></a></small>
      <div class="hidden name"><code>subtotals.Rmd</code></div>

    </div>

    
    
<p><a href="export.html">Previous: exporting data</a></p>
<p>A common task in the market research world is to collapse two or more categories together to see how the collapsed categories compare to one another. For example, if you asked people to rate their preference on a scale of 1 to 10, you might want to see how the people who provide a rating between 1 and 5 compare to those who rated it between 6 and 10. This goes by a number of names, including “<em>Top Box</em>” or “<em>Nets</em>”, depending on the use case. In Crunch, we call this family of features <em>Subtotals</em>. This vignette shows how to define, manage, and analyze variables with subtotals.</p>
<div id="getting-and-setting-subtotals" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-and-setting-subtotals" class="anchor"></a>Getting and setting subtotals</h1>
<p>Subtotals can be applied to any Categorical or Categorical Array variable. In R, we can view and set subtotal definitions with the <code><a href="../reference/SubtotalsHeadings.html">subtotals()</a></code> function. If there are no subtotals, the function will return <code>NULL</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>obamaapp)</code></pre></div>
<pre><code>## NULL</code></pre>
<p>To add subtotals, we can assign a list of <code>Subtotal</code> objects. Each <code>Subtotal</code> object has three things: a <code>name</code> to identify it; a set of <code>categories</code> to pool together, referenced either by category name or id; and a location to show it, either <code>after</code> a given category or with <code>position="top"</code> or <code>"bottom"</code> to pin it first or last in the list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>DiversityImportant) &lt;-<span class="st"> </span><span class="kw">list</span>(
    <span class="kw">Subtotal</span>(<span class="dt">name =</span> <span class="st">"Follows closely"</span>,
             <span class="dt">categories =</span> <span class="kw">c</span>(<span class="st">"Strongly closely"</span>, <span class="st">"Very closely"</span>),
             <span class="dt">after =</span> <span class="st">"Somewhat closely"</span>),
    <span class="kw">Subtotal</span>(<span class="dt">name =</span> <span class="st">"Generally disagree"</span>,
             <span class="dt">categories =</span> <span class="kw">c</span>(<span class="st">"Not very closely"</span>, <span class="st">"Not at all"</span>),
             <span class="dt">after =</span> <span class="st">"Not at all"</span>)
)</code></pre></div>
<p>Now, if we check <code><a href="../reference/SubtotalsHeadings.html">subtotals()</a></code>, we can see that we have saved them. In this output we see a few different aspects of subtotals: the <code>anchor</code> is the id of the category to put the subtotal after (matching the <code>after</code> or <code>position</code> argument in <code>Subtotal()</code>), name, aggregation functions and <code>args</code>, which in the this case are the category ids to include in the subtotal.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>manningknowledge)</code></pre></div>
<pre><code>##   anchor                   name     func    args
## 1      2        Follows closely subtotal 2 and 1
## 2      4 Doesn't Follow Closely subtotal 3 and 4</code></pre>
<p>This shows up in the Categorical variable card on the web app like this:</p>
<p><img src="images/manning_knowledge_subtotals.png"><!-- --></p>
<p>We can also add <em>headings</em>, which are similar to subtotals in that they are additions to categorical variables that will be displayed in the app, but they don’t sum up any categories. For a variable with many categories, they can help group variables visually. Here we add some guides to Obama’s approval rating.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>obamaapp) &lt;-<span class="st"> </span><span class="kw">list</span>(
    <span class="kw">Heading</span>(<span class="dt">name =</span> <span class="st">"Approves"</span>,
            <span class="dt">after =</span> <span class="dv">0</span>),
    <span class="kw">Heading</span>(<span class="dt">name =</span> <span class="st">"Disapprove"</span>,
            <span class="dt">after =</span> <span class="st">"Somewhat Approve"</span>),
    <span class="kw">Heading</span>(<span class="dt">name =</span> <span class="st">"No Answer"</span>,
            <span class="dt">after =</span> <span class="st">"Strongly Disapprove"</span>)
)

<span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>obamaapp)</code></pre></div>
<pre><code>##   anchor       name func args
## 1      0   Approves   NA   NA
## 2      2 Disapprove   NA   NA
## 3      4  No Answer   NA   NA</code></pre>
<p>Again, this shows up in the Categorical variable card on the web app:</p>
<p><img src="images/obama_headings.png"><!-- --></p>
</div>
<div id="removing-subtotals" class="section level1">
<h1 class="hasAnchor">
<a href="#removing-subtotals" class="anchor"></a>Removing subtotals</h1>
<p>Subtotals and headings can be removed by assigning a <code>NULL</code> value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>YearsCodedJob) &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="setting-many-subtotals" class="section level1">
<h1 class="hasAnchor">
<a href="#setting-many-subtotals" class="anchor"></a>Setting many subtotals</h1>
<p>In the <em>Economist</em> survey, there are a number of questions that have the same response categories. If the category names (or ids, if we’re using those) are the same, we can use the same set of subtotals across multiple variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">approve_subtotals &lt;-<span class="st"> </span><span class="kw">list</span>(
    <span class="kw">Subtotal</span>(<span class="dt">name =</span> <span class="st">"Approves"</span>,
            <span class="dt">categories =</span> <span class="kw">c</span>(<span class="st">"Somewhat approve"</span>, <span class="st">"Strongly approve"</span>),
            <span class="dt">after =</span> <span class="st">"Somewhat approve"</span>),
    <span class="kw">Subtotal</span>(<span class="dt">name =</span> <span class="st">"Disapprove"</span>,
            <span class="dt">categories =</span> <span class="kw">c</span>(<span class="st">"Somewhat disapprove"</span>, <span class="st">"Strongly disapprove"</span>),
            <span class="dt">after =</span> <span class="st">"Strongly disapprove"</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>snowdenleakapp) &lt;-<span class="st"> </span>approve_subtotals
<span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>congapp) &lt;-<span class="st"> </span>approve_subtotals</code></pre></div>
<p>Notice here, because each of the categories for these variables has slightly different ids, the <code>args</code> in the output differs slightly. But, because we used category names when we were constructing our list of subtotals, when we store them on the variable itself, Crunch does the right thing and converts them over to the correct ids.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>snowdenleakapp)
<span class="kw"><a href="../reference/SubtotalsHeadings.html">subtotals</a></span>(ds<span class="op">$</span>congapp)</code></pre></div>
<pre><code>##   anchor       name     func    args
## 1      2   Approves subtotal 2 and 1
## 2      4 Disapprove subtotal 3 and 4</code></pre>
<pre><code>##   anchor       name     func    args
## 1      2   Approves subtotal 2 and 1
## 2      5 Disapprove subtotal 4 and 5</code></pre>
</div>
<div id="computing-with-subtotals" class="section level1">
<h1 class="hasAnchor">
<a href="#computing-with-subtotals" class="anchor"></a>Computing with subtotals</h1>
<p>Now that we have defined subtotals on the congressional approval question, if we use it in a crosstab, we can see the subtotals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/crtabs.html">crtabs</a></span>(<span class="op">~</span>congapp <span class="op">+</span><span class="st"> </span>gender, <span class="dt">data =</span> ds)</code></pre></div>
<pre><code>##                               gender          
## congapp                                    Male           Female
##               Strongly approve                0                0
##               Somewhat approve 2.51012984049177 5.46240518719819
##                       Approves 2.51012984049177 5.46240518719819
## Neither approve nor disapprove 11.2916608660399 18.8687169535911
##            Somewhat disapprove 12.2769754589437 24.3223013661526
##            Strongly disapprove 62.6898938858094 38.2775564880149
##                     Disapprove 74.9668693447531 62.5998578541675
##                       Not sure 15.2265010614957 25.8714100226452</code></pre>
<p>We can even get just the subtotals as an array from the result if we want to ignore the constituent groups:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/applyTransforms.html">subtotalArray</a></span>(<span class="kw"><a href="../reference/crtabs.html">crtabs</a></span>(<span class="op">~</span>congapp <span class="op">+</span><span class="st"> </span>gender, <span class="dt">data =</span> ds))</code></pre></div>
<pre><code>##             gender
## congapp          Male    Female
##   Approves    2.51013  5.462405
##   Disapprove 74.96687 62.599858</code></pre>
<p>If you don’t want to see the subtotals as part of these summaries, you can suppress them from display with the <code><a href="../reference/noTransforms.html">noTransforms()</a></code> function around <code><a href="../reference/crtabs.html">crtabs()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/noTransforms.html">noTransforms</a></span>(<span class="kw"><a href="../reference/crtabs.html">crtabs</a></span>(<span class="op">~</span>congapp <span class="op">+</span><span class="st"> </span>gender, <span class="dt">data =</span> ds))</code></pre></div>
<pre><code>##                                 gender
## congapp                              Male    Female
##   Strongly approve                0.00000  0.000000
##   Somewhat approve                2.51013  5.462405
##   Neither approve nor disapprove 11.29166 18.868717
##   Somewhat disapprove            12.27698 24.322301
##   Strongly disapprove            62.68989 38.277556
##   Not sure                       15.22650 25.871410</code></pre>
<p>This does not modify the variable—the subtotals are still defined and visible in the web app—but they are removed from the current analysis.</p>
<p><a href="crunch-internals.html">Next: Crunch internals</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#getting-and-setting-subtotals">Getting and setting subtotals</a></li>
      <li><a href="#removing-subtotals">Removing subtotals</a></li>
      <li><a href="#setting-many-subtotals">Setting many subtotals</a></li>
      <li><a href="#computing-with-subtotals">Computing with subtotals</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Neal Richardson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script>
  docsearch({
    
    apiKey: '9fbcb3ae4d05600402e31f66b9b9501e',
    indexName: 'crunch',
    inputSelector: 'input#search-input.form-control',
    debug: false // Set debug to true if you want to inspect the dropdown
  });
</script>
</body>
</html>
