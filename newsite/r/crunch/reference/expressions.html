<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Construct Crunch Expressions from Crunch Database Functions — expressions • Crunch</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Construct Crunch Expressions from Crunch Database Functions — expressions" />
<meta property="og:description" content="Crunch Expressions, i.e. CrunchExpr and CrunchLogicalExpr,
encapsulate derivations of Crunch variables, possibly composed of other functions
which are only evaluated when sent to the server when creating a variable using VarDef()
or using as.vector() to get data. The crunch database functions can be found in the
Help Center,
and can be called directly via crunchdbFunc()m but many have also been wrapped
in native R functions, and are described in the details section below." />
<meta property="og:image" content="http://crunch.io/r/crunch/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-50332119-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-50332119-2');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Crunch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.27.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/crunch.html">Intro</a>
</li>
<li>
  <a href="../reference/">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/crunch.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/variables.html">Variables</a>
    </li>
    <li>
      <a href="../articles/array-variables.html">Array Variables</a>
    </li>
    <li>
      <a href="../articles/variable-order.html">Organize Variables</a>
    </li>
    <li>
      <a href="../articles/derive.html">Derive Variables</a>
    </li>
    <li>
      <a href="../articles/analyze.html">Analyze Data</a>
    </li>
    <li>
      <a href="../articles/filters.html">Filter Data</a>
    </li>
    <li>
      <a href="../articles/export.html">Export Data</a>
    </li>
    <li>
      <a href="../articles/projects.html">Projects</a>
    </li>
    <li>
      <a href="../articles/fork-and-merge.html">Fork and Merge</a>
    </li>
    <li>
      <a href="../articles/subtotals.html">Subtotals and Headings</a>
    </li>
    <li>
      <a href="../articles/crunch-internals.html">Crunch Internals</a>
    </li>
    <li>
      <a href="../articles/abstract-categories.html">Abstract Categories</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Crunch-io/rcrunch/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Construct Crunch Expressions from Crunch Database Functions</h1>
    <small class="dont-index">Source: <a href='https://github.com/Crunch-io/rcrunch/blob/master/R/expressions.R'><code>R/expressions.R</code></a></small>
    <div class="hidden name"><code>expressions.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Crunch Expressions, i.e. <code>CrunchExpr</code> and <code>CrunchLogicalExpr</code>,
encapsulate derivations of Crunch variables, possibly composed of other functions
which are only evaluated when sent to the server when creating a variable using <code><a href='VariableDefinition.html'>VarDef()</a></code>
or using <code><a href='as-vector.html'>as.vector()</a></code> to get data. The crunch database functions can be found in the
<a href='https://help.crunch.io/hc/en-us/articles/360042411792-Expressions'>Help Center</a>,
and can be called directly via <code>crunchdbFunc()</code>m but many have also been wrapped
in native R functions, and are described in the details section below.</p>
    </div>

    <pre class="usage"><span class='fu'>crunchdbFunc</span><span class='op'>(</span><span class='va'>fun</span>, <span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>fun</th>
      <td><p>The name of the crunch database function to call</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>An input, a crunch variable, expression or R object</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments passed to the database function</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Logical expressions</p><ul>
<li><p>These logical operators <code><a href='expressions-internal.html'>==</a></code>, <code><a href='expressions-internal.html'>!=</a></code>, <code>&amp;</code>, <code><a href='https://rdrr.io/r/base/Logic.html'>|</a></code>, <code><a href='expressions-internal.html'>!</a></code>,<code><a href='expressions-internal.html'>%in%</a></code>  work the same way as their
base R counterparts</p></li>
<li><p><code><a href='dichotomize.html'>is.selected(x)</a></code> return <code>CrunchLogicalExpr</code> whether a value is in a selected category</p></li>
<li><p><code><a href='expressions-internal.html'>rowAny(x)</a></code> and <code><a href='expressions-internal.html'>rowAll(x)</a></code> work row-wise on <code>MultipleResponse</code> Variables (and expressions),
though <code>na.rm</code> is not implemented for <code><a href='https://rdrr.io/r/base/all.html'>all(x)</a></code>.
<code>%ornm%</code> is similar to <code><a href='https://rdrr.io/r/base/Logic.html'>|</a></code>, but where "not selected" beats "missing" (so <code>FALSE %ornm% NA</code>
is <code>FALSE</code> instead of <code>NA</code> as it would be with <code>FALSE | NA</code>)</p></li>
</ul>

<p>Comparisons</p><ul>
<li><p>Comparison operators <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code> work the same way as their base R counterparts.</p></li>
<li><p><code><a href='expressions-internal.html'>crunchBetween(x, lower, upper, inclusive)</a></code> to provide lower and upper bounds in a single
expression.</p></li>
</ul>

<p>Missing data expressions</p><ul>
<li><p><code><a href='https://rdrr.io/r/base/NA.html'>is.na(x)</a></code>, <code><a href='expressions-internal.html'>is.valid(x)</a></code> return <code>CrunchLogicalExpr</code> whether a single variable (or expression
that creates one) is missing (or not missing).</p></li>
<li><p><code><a href='expressions-internal.html'>rowAnyNA(x)</a></code>, <code><a href='expressions-internal.html'>rowAllNA(x)</a></code> return <code>CrunchLogicalExpr</code> whether any/all values in an
array variable (or expression that creates one) are missing.</p></li>
<li><p><code><a href='https://rdrr.io/r/stats/complete.cases.html'>complete.cases(x)</a></code> returns an expression that is "selected" if all cases are non-missing,
"missing" if they are all missing, and "other" otherwise.</p></li>
</ul>

<p>Selection expressions</p><ul>
<li><p><code><a href='expressions-internal.html'>selectCategories(x, selections, collapse = TRUE)</a></code> takes a categorical variable (or array)
and marks categories as selected. <code>selections</code> should be a list of category names or
values. If <code>collapse</code> is <code>TRUE</code>, (the default), it collapses the categories to "selected",
"other" and "missing", but it is <code>FALSE</code>, then the old categories are preserved.</p></li>
<li><p><code><a href='expressions-internal.html'>asSelected(x)</a></code> returns an expression that condenses a categorical into 3 categories
("selected", "other" or "missing")</p></li>
<li><p><code><a href='expressions-internal.html'>selectedDepth(x)</a></code> returns an expression that creates a numeric variable that counts the
number of selections across rows of an array variable (or expression that creates one)</p></li>
<li><p><code><a href='expressions-internal.html'>arraySelections(x)</a></code> returns an expression that takes an array and creates an array with
each variable condensed to "selected", "other" or "missing" and an extra subvariable
"<strong>any</strong>" that indicates whether any is selected.</p></li>
<li><p><code><a href='expressions-internal.html'>alterCategoriesExpr(x, categories = NULL, category_order = NULL, subvariables = NULL)</a></code>
Change the category names, order, or subvariable names of categorical or Array variables
(can only modify existing ones, not add or remove categories or subvariables).
<code>categories</code> is a <code>Categories</code> object or a list of lists, each with a <code>name</code> indicating
the new name, as well as an <code>id</code> or <code>old_name</code> to identify which category to modify.
<code>category_order</code> is either a numeric vector indicating category ids or a character vector
indicating the names of the categories in the order they should be displayed
(note that all categories must be specified). <code>subvariables</code> is  a list of lists, each with
a <code>name</code> to rename the subvariable and an <code>alias</code>, <code>old_nam</code> or <code>id</code> to identify the
subvariable. When <code>x</code> is an expression, all categories and subvariables must be identified
by <code>id</code>.</p></li>
</ul>

<p>Array expressions</p><ul>
<li><p><code><a href='expressions-internal.html'>makeFrame(x, numeric = NULL)</a></code> an expression that creates an array from existing
variables or expressions, see <code><a href='deriveArray.html'>deriveArray()</a></code> for more details</p></li>
<li><p><code><a href='expressions-internal.html'>arraySubsetExpr(x, subvars, subvar_id = c("alias", "name", "id"))</a></code> Take a subset of an
existing array variable, identifying the subvariables by alias, name, or id (if <code>x</code> is
an expression, you must use id).</p></li>
<li><p></p><pre> <span class='fu'><a href='expressions-internal.html'>alterArrayExpr</a></span><span class='op'>(</span>
   <span class='va'>x</span>,
   add <span class='op'>=</span> <span class='cn'>NULL</span>,
   order <span class='op'>=</span> <span class='cn'>NULL</span>,
   order_id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"alias"</span>, <span class='st'>"name"</span>, <span class='st'>"id"</span><span class='op'>)</span>,
   remove <span class='op'>=</span> <span class='cn'>NULL</span>,
   remove_id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"alias"</span>, <span class='st'>"name"</span>, <span class='st'>"id"</span><span class='op'>)</span>,
   subreferences <span class='op'>=</span> <span class='cn'>NULL</span>,
   subreferences_id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"alias"</span>, <span class='st'>"name"</span>, <span class='st'>"id"</span><span class='op'>)</span>
<span class='op'>)</span>
</pre>

<p>Add, reorder, remove or rename subvariables on an an array variable <code>x</code>. The <code>add</code> argument is
a list of variables or expressions, optionally named with the id they should have. <code>order</code>
and <code>remove</code> are vectors of aliases, names or ids (specify which with <code>order_id</code>/<code>remove_id</code>).
The <code>subreferences</code> object is a list of lists that are named the alias, name, or id (again
specify which with <code>subreferences_id</code>) with metadata information like name and alias in the
list.</p></li>
</ul>

<p>Miscellaneous expressions</p><ul>
<li><p><code><a href='makeCaseVariable.html'>caseExpr(..., cases)</a></code> Create a categorical variable from
a set of logical expressions that when met are assigned to a category. See
<code><a href='makeCaseVariable.html'>makeCaseVariable()</a></code> for more details.</p></li>
<li><p><code><a href='expressions-internal.html'>bin(x)</a></code> returns a column's values binned into equidistant bins.</p></li>
<li><p><code><a href='https://rdrr.io/r/base/nchar.html'>nchar(x)</a></code> returns a numeric value indicating the length of a string (or missing reason)
in a <code>TextVariable</code> (or expression that creates one)</p></li>
<li><p><code>unmissing(x)</code> for a <code>NumericVariable</code> (or expression that creates one) return the values of
the data, ignoring the ones set to missing.</p></li>
<li><p><code><a href='expressions-internal.html'>trim(x, min, max)</a></code> for a <code>NumericVariable</code> (or expression that creates one) return values
that where all values less than <code>min</code> have been replaced with <code>min</code> and all values greater
than <code>max</code> have been</p></li>
<li><p><code><a href='expressions-internal.html'>crunchDifftime(e1, e2, resolution)</a></code> Gets the difference between two datetimes as a number
with specified resolution units (one of <code><a href='https://rdrr.io/r/base/c.html'>c("Y", "Q", "M", "W", "D", "h", "m", "s", "ms")</a></code>).</p></li>
<li><p><code><a href='expressions-internal.html'>datetimeFromCols(year, month, day, hours, minutes, seconds)</a></code> create a <code>Datetime</code> variable
from numeric variables or expressions (<code>year</code>, <code>month</code>, and <code>day</code> are required, but <code>hours</code>,
<code>minutes</code>, and <code>seconds</code> are optional)</p></li>
<li><p><code><a href='resolution.html'>rollup(x, resolution)</a></code> sets the resolution of a datetime variable or expression, see
<code><a href='resolution.html'>resolution()</a></code></p></li>
</ul>


  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Greg Freedman Ellis, Jonathan Keane, Mike Malecki, Neal Richardson, Gordon Shotwell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '9fbcb3ae4d05600402e31f66b9b9501e',
    indexName: 'crunch',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


