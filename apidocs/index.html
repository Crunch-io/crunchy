<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Crunch.io API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["http","shell","python","r"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="http">HTTP</a>
              <a href="#" data-language-name="shell">cURL</a>
              <a href="#" data-language-name="python">Python</a>
              <a href="#" data-language-name="r">R</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://crunch.io/'>Sign Up</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Crunch exposes a REST API for third parties, and indeed its own UI, to manage datasets. This API is also used by the <a href="https://github.com/Crunch-io/pycrunch">Python</a> and <a href="https://github.com/Crunch-io/rcrunch">R</a> libraries. This User Guide is for developers who are writing applications on top of the Crunch REST API, with or without those language bindings. It describes the existing interfaces for the current version and attempts to provide context and examples to guide development.</p>

<p>The documents are organized in three overlapping scopes: a <a href="#feature-guide">feature guide</a>, which provide higher-level vignettes that illustrate key features; an <a href="#endpoint-reference">endpoint reference</a>, which describes individual URIs in detail; and an <a href="#object-reference">object reference</a>, which defines the building blocks of the Crunch platform, such as values, columns, types, variables, and datasets.</p>

<h1 id="feature-guide">Feature Guide</h1>

          <h2 id="authentication">Authentication</h2>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/public/login/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">67</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fake.user@example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
<span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">token=dac20c82c79a514d572b4f5d7e11cb53; Domain=.crunch.io; Max-Age=31536000; Path=/</span>
<span class="na">Vary</span><span class="p">:</span> <span class="s">Cookie, Accept-Encoding</span>

</code></pre>
<pre class="highlight r"><code><span class="n">library</span><span class="p">(</span><span class="n">crunch</span><span class="p">)</span>
<span class="n">login</span><span class="p">(</span><span class="s2">"fake.user@example.com"</span><span class="p">,</span> <span class="s2">"password"</span><span class="p">)</span>
<span class="c1"># See ?login for options, including how to store your credentials
# in your .Rprofile
</span></code></pre>
<pre class="highlight python"><code><span class="kn">import</span> <span class="nn">pycrunch</span>
</code></pre>
<pre class="highlight shell"><code>curl -c cookie-jar
    -X POST
    -d <span class="s1">'{"email": "fake.user@example.com", "password": "password"}'</span>
    -H <span class="s2">"Content-type: application/json"</span>
    https://app.crunch.io/api/public/login/

<span class="c"># The above command will perform a login and save the login cookie to a file called 'cookie-jar'.</span>
<span class="c"># After this, you can access the endpoint via `curl' commands (POST, GET, PATCH), as long as the '-b cookie-jar' flag is present.  Note, -b not -c.  -c saves cookies, -b submits cookies from the existing file. It is good practice to delete this file when you are done.</span>
</code></pre>

<blockquote>
<p>Replace &ldquo;fake.user@example.com&rdquo; and &ldquo;password&rdquo; with your email and password, respectively.</p>
</blockquote>

<p>Nearly all interactions with the Crunch API need to be authenticated. The standard password authentication method involves POSTing credentials and receiving a cookie back, which should be included in subsequent requests.</p>

<p>The client should then store the Cookie and pass it along with each subsequent request.</p>

<p>Failure will return 401 Unauthorized.</p>

<aside class="notice">
    Replace &ldquo;fake.user@example.com&rdquo; and &ldquo;password&rdquo; with your email and password, respectively. Refer to the password policy below for more information.
</aside>

<p>Crunch also supports OAuth 2.0/OpenID Connect. See <a href="#public">the public endpoint reference</a> for more on how to authenticate with OAuth.</p>

<p>If you&rsquo;d like to add your auth provider to the set of supported providers, contact <a href="mailto:support@crunch.io">support@crunch.io</a></p>

          <h2 id="password-policy">Password policy</h2>

<p>Password policy is as follows:</p>

<ul>
<li>Password must be 8 characters or longer</li>
<li>Password must contain at least 4 unique characters</li>
</ul>

<p>Examples:</p>

<ul>
<li>Secure 8 character password: 4B3a8f4$</li>
<li>Secure passphrase: correct horse battery staple</li>
</ul>

<p>We highly recommend that users use long pass phrases instead of passwords for
security and for ease of remembering the credentials for accessing the service.</p>

          <h2 id="importing-data">Importing Data</h2>

<p>There are several ways to build a Crunch dataset. The most appropriate method for you to create a dataset depends primarily on the format in which the data is currently stored.</p>

<h3 id="import-from-a-data-file">Import from a data file</h3>

<p>In some cases, you already have a file sitting on your computer which has source data, in CSV or SPSS
format (or a Zip file containing a single file in CSV or SPSS format). You can upload these to Crunch and
then attach them to datasets by following these steps.</p>

<h4 id="1-create-a-dataset-entity">1. Create a Dataset entity</h4>
<pre class="highlight http"><code><span class="err">
</span><span class="nf">POST</span> <span class="nn">/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">974</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "my survey",</span>
<span class="s">        ...</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/</span>
</code></pre>
<pre class="highlight r"><code><span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">newDatasetFromFile</span><span class="p">(</span><span class="s2">"my.csv"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"my survey"</span><span class="p">)</span>
<span class="c1"># All three steps are handled within newDatasetFromFile
</span></code></pre>

<p>POST a Dataset Entity to the datasets catalog. See the documentation for <a href="#post">POST /datasets/</a> for details on valid attributes to include in the POST.</p>

<h4 id="2-upload-the-file">2. Upload the file</h4>
<pre class="highlight http"><code><span class="err">
</span><span class="nf">POST</span> <span class="nn">/sources/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">8874357</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">multipart/form-data; boundary=df5b17ff463a4cb3aa61cf02224c7303</span>

--df5b17ff463a4cb3aa61cf02224c7303
Content-Disposition: form-data; name="uploaded_file"; filename="my.csv"
Content-Type: text/csv

"case_id","q1","q2"
234375,3,"sometimes"
234376,2,"always"
...
--------
201 Created
Location: /sources/{source_id}/
</code></pre>

<p>POST the file to the sources catalog.</p>

<h4 id="3-add-the-source-to-the-dataset">3. Add the Source to the Dataset</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/{dataset_id}/batches/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "source": "/sources/{source_id}/"</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">202 Continue</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/batches/{batch_id}/</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:view",</span>
<span class="s">    "value": "/progress/{progress_id}/"</span>
<span class="s">}</span>
</code></pre>

<p>POST the URL of the just-created source entity (the Location in the 201 response from the previous step) to the batches catalog of the dataset entity created in step 1.</p>

<p>The POST to the batches catalog will return 202 Continue status, and the response body contains a progress URL. Poll that URL to monitor the completion of the batch addition. See &ldquo;<a href="#progress">Progress</a>&rdquo; for more. The 202 response will also contain a Location header with the URL of the newly created batch.</p>

<h3 id="metadata-document-csv">Metadata document + CSV</h3>

<p>This approach may be most natural for importing data from databases that store
data by rows. You can dump or export your database to Crunch&rsquo;s JSON metadata
format, plus a CSV of data, and upload those to Crunch, without requiring much
 back-and-forth with the API.</p>

<h4 id="1-create-a-dataset-entity-with-variable-definitions">1. Create a Dataset entity with variable definitions</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">974</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "my survey",</span>
<span class="s">        ...,</span>
<span class="s">        "table": {</span>
<span class="s">            "element": "crunch:table",</span>
<span class="s">            "metadata": {</span>
<span class="s">                "educ": {"name": "Education", "alias": "educ", "type": "categorical", "categories": [...], ...},</span>
<span class="s">                "color": {"name": "Favorite color", "alias": "color", "type": "text", ...},</span>
<span class="s">                "state": {"name": "State", "alias": "state", "view": {"geodata": [{"geodatum": &lt;uri&gt;, "feature_key": "properties.postal-code"}]}}</span>
<span class="s">            },</span>
<span class="s">            "order": ["educ", {'my group": "color"}]</span>
<span class="s">        },</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/</span>
</code></pre>

<p>POST a Dataset Entity to the datasets catalog, and in the &ldquo;body&rdquo;, include a
Crunch Table object with variable definitions and order.</p>

<p>The &ldquo;metadata&rdquo; member in the table is an object containing all variable
definitions, keyed by variable alias. See the Object Reference: Variable
Definitions discussion for specific requirements for defining variables of
various types, as well as the example below.</p>

<p>The &ldquo;order&rdquo; member is a Shoji Order object specifying the order, potentially
hierarchically nested, of the variables in the dataset. The example below
illustrates how this can be used. Shoji is JSON, which means the &ldquo;metadata&rdquo;
object is explicitly unordered. If you wish the variables to have an order,
you must supply an order object rather than relying on any order of the
&ldquo;metadata&rdquo; object.</p>

<p>It is possible to create derived variables using any of the 
<a href="#Deriving-Variables">derivation functions available</a> simulaneously in one 
request when creating the dataset along its metadata. The variable references 
inside the derivation expressions must point to declared aliases of variables 
or subvariables. </p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">3294</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">      "name": "Dataset with derived arrays",</span>
<span class="s">      "settings": {</span>
<span class="s">        "viewers_can_export": true,</span>
<span class="s">        "viewers_can_change_weight": false,</span>
<span class="s">        "min_base_size": 3,</span>
<span class="s">        "weight": "weight_variable",</span>
<span class="s">        "dashboard_deck": null</span>
<span class="s">      },</span>
<span class="s">      "table": {</span>
<span class="s">        "metadata": {</span>
<span class="s">           "element": "crunch:table"</span>
<span class="s">           "weight_variable": {</span>
<span class="s">                "name": "weight variable",</span>
<span class="s">                "alias": "weight_variable",</span>
<span class="s">                "type": "numeric"</span>
<span class="s">           },</span>
<span class="s">           "combined": {</span>
<span class="s">              "name": "combined CA", </span>
<span class="s">              "derivation": {</span>
<span class="s">                "function": "combine_categories", </span>
<span class="s">                "args": [</span>
<span class="s">                  {</span>
<span class="s">                    "variable": "CA1"</span>
<span class="s">                  }, </span>
<span class="s">                  {</span>
<span class="s">                    "value": [</span>
<span class="s">                      {</span>
<span class="s">                        "combined_ids": [2], </span>
<span class="s">                        "numeric_value": 2, </span>
<span class="s">                        "missing": false, </span>
<span class="s">                        "name": "even", </span>
<span class="s">                        "id": 1</span>
<span class="s">                      }, </span>
<span class="s">                      {</span>
<span class="s">                        "combined_ids": [1], </span>
<span class="s">                        "numeric_value": 1, </span>
<span class="s">                        "missing": false, </span>
<span class="s">                        "name": "odd", </span>
<span class="s">                        "id": 2</span>
<span class="s">                      }</span>
<span class="s">                    ]</span>
<span class="s">                  }</span>
<span class="s">                ]</span>
<span class="s">              }</span>
<span class="s">            },</span>
<span class="s">          "numeric": {</span>
<span class="s">            "name": "numeric variable",</span>
<span class="s">            "type": "numeric"</span>
<span class="s">          },</span>
<span class="s">          "numeric_copy": {</span>
<span class="s">            "name": "Copy of numeric",</span>
<span class="s">            "derivation": {</span>
<span class="s">                "function": "copy_variable",</span>
<span class="s">                "args": [{"variable": "numeric"}]</span>
<span class="s">            }</span>
<span class="s">          },</span>
<span class="s">          "MR1": {</span>
<span class="s">              "name": "multiple response", </span>
<span class="s">              "derivation": {</span>
<span class="s">                "function": "select_categories", </span>
<span class="s">                "args": [</span>
<span class="s">                  {</span>
<span class="s">                    "variable": "CA3"</span>
<span class="s">                  }, </span>
<span class="s">                  {</span>
<span class="s">                    "value": [</span>
<span class="s">                      1</span>
<span class="s">                    ]</span>
<span class="s">                  }</span>
<span class="s">                ]</span>
<span class="s">              }</span>
<span class="s">            },</span>
<span class="s">          "CA3": {</span>
<span class="s">            "name": "cat array 3", </span>
<span class="s">            "derivation": {</span>
<span class="s">              "function": "array", </span>
<span class="s">              "args": [</span>
<span class="s">                {</span>
<span class="s">                  "function": "select", </span>
<span class="s">                  "args": [</span>
<span class="s">                    {</span>
<span class="s">                      "map": {</span>
<span class="s">                        "var1": {</span>
<span class="s">                          "variable": "ca2-subvar-2", </span>
<span class="s">                          "references": {</span>
<span class="s">                            "alias": "subvar2", </span>
<span class="s">                            "name": "Subvar 2"</span>
<span class="s">                          }</span>
<span class="s">                        }, </span>
<span class="s">                        "var0": {</span>
<span class="s">                          "variable": "ca1-subvar-1", </span>
<span class="s">                          "references": {</span>
<span class="s">                            "alias": "subvar1", </span>
<span class="s">                            "name": "Subvar 1"</span>
<span class="s">                          }</span>
<span class="s">                        }</span>
<span class="s">                      }</span>
<span class="s">                    }, </span>
<span class="s">                    {</span>
<span class="s">                      "value": ["var1", "var0"]</span>
<span class="s">                    }</span>
<span class="s">                  ]</span>
<span class="s">                }</span>
<span class="s">              ]</span>
<span class="s">            }</span>
<span class="s">          }, </span>
<span class="s">          "CA2": {</span>
<span class="s">            "subvariables": [</span>
<span class="s">              {</span>
<span class="s">                "alias": "ca2-subvar-1", </span>
<span class="s">                "name": "ca2-subvar-1"</span>
<span class="s">              }, </span>
<span class="s">              {</span>
<span class="s">                "alias": "ca2-subvar-2", </span>
<span class="s">                "name": "ca2-subvar-2"</span>
<span class="s">              }</span>
<span class="s">            ], </span>
<span class="s">            "type": "categorical_array", </span>
<span class="s">            "name": "cat array 2", </span>
<span class="s">            "categories": [</span>
<span class="s">              {</span>
<span class="s">                "numeric_value": null, </span>
<span class="s">                "missing": false, </span>
<span class="s">                "id": 1, </span>
<span class="s">                "name": "yes"</span>
<span class="s">              }, </span>
<span class="s">              {</span>
<span class="s">                "numeric_value": null, </span>
<span class="s">                "missing": false, </span>
<span class="s">                "id": 2, </span>
<span class="s">                "name": "no"</span>
<span class="s">              }, </span>
<span class="s">              {</span>
<span class="s">                "numeric_value": null, </span>
<span class="s">                "missing": true, </span>
<span class="s">                "id": -1, </span>
<span class="s">                "name": "No Data"</span>
<span class="s">              }</span>
<span class="s">            ]</span>
<span class="s">          }, </span>
<span class="s">          "CA1": {</span>
<span class="s">            "subvariables": [</span>
<span class="s">              {</span>
<span class="s">                "alias": "ca1-subvar-1", </span>
<span class="s">                "name": "ca1-subvar-1"</span>
<span class="s">              }, </span>
<span class="s">              {</span>
<span class="s">                "alias": "ca1-subvar-2", </span>
<span class="s">                "name": "ca1-subvar-2"</span>
<span class="s">              }, </span>
<span class="s">              {</span>
<span class="s">                "alias": "ca1-subvar-3", </span>
<span class="s">                "name": "ca1-subvar-3"</span>
<span class="s">              }</span>
<span class="s">            ], </span>
<span class="s">            "type": "categorical_array", </span>
<span class="s">            "name": "cat array 1", </span>
<span class="s">            "categories": [</span>
<span class="s">              {</span>
<span class="s">                "numeric_value": null, </span>
<span class="s">                "missing": false, </span>
<span class="s">                "id": 1, </span>
<span class="s">                "name": "yes"</span>
<span class="s">              }, </span>
<span class="s">              {</span>
<span class="s">                "numeric_value": null, </span>
<span class="s">                "missing": false, </span>
<span class="s">                "id": 2, </span>
<span class="s">                "name": "no"</span>
<span class="s">              }, </span>
<span class="s">              {</span>
<span class="s">                "numeric_value": null, </span>
<span class="s">                "missing": true, </span>
<span class="s">                "id": -1, </span>
<span class="s">                "name": "No Data"</span>
<span class="s">              }</span>
<span class="s">            ]</span>
<span class="s">          }</span>
<span class="s">        }</span>
<span class="s">      }</span>
<span class="s">    }</span>
<span class="s"> }</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/</span>
</code></pre>

<p>The example above does a number of things:</p>

<ul>
<li>Creates variables <code class="prettyprint">numeric</code> and arrays <code class="prettyprint">CA1</code> and <code class="prettyprint">CA2</code>.</li>
<li>Makes a shallow copy of variable <code class="prettyprint">numeric</code> as <code class="prettyprint">numeric_copy</code>.</li>
<li>Makes an ad hoc array <code class="prettyprint">CA3</code> reusing subvariables from <code class="prettyprint">CA1</code> and <code class="prettyprint">CA2</code>.</li>
<li>Makes a multiple response view <code class="prettyprint">MR1</code> selecting category 1 from categorical array <code class="prettyprint">CA3</code>.</li>
</ul>

<h5 id="validation-rules">Validation rules</h5>

<p>All variables mentioned in the metadata must contain a valid variable definition
with a matching alias.</p>

<p>Array variables definitions should contain valid subvariable or subreferences members.</p>

<p>Any attribute that contains a <code class="prettyprint">null</code> value will be ignored and get the attribute&rsquo;s
default value instead.</p>

<p>An empty <code class="prettyprint">order</code> for the dataset will be handled as if no order was passed in.</p>

<h4 id="2-add-row-data">2. Add row data</h4>

<blockquote>
<p>By file:</p>
</blockquote>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/{dataset_id}/batches/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/csv</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">8874357</span>
<span class="na">Content-Disposition</span><span class="p">:</span> <span class="s">form-data; name="file"; filename="thedata.csv"</span>
<span class="s">...</span>
<span class="s">"educ","color"</span>
<span class="s">3,"red"</span>
<span class="s">2,"yellow"</span>
<span class="s">...</span>
<span class="s">--------</span>
<span class="s">202 Continue</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/batches/{batch_id}/</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:view",</span>
<span class="s">    "value": "/progress/{progress_id}/"</span>
<span class="s">}</span>
</code></pre>

<blockquote>
<p>By S3 URL:</p>
</blockquote>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/{dataset_id}/batches/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">341</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "url": "s3://bucket_name/dir/subdir/?accessKey=ASILC6CBA&amp;secretKey=KdJy7ZRK8fDIBQ&amp;token=AQoDYXdzECAa%3D%3D"</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">202 Continue</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/batches/{batch_id}/</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:view",</span>
<span class="s">    "value": "/progress/{progress_id}/"</span>
<span class="s">}</span>
</code></pre>

<p>POST a CSV file or URL to the new dataset&rsquo;s batches catalog. The CSV must include a header row of variable identifiers, which should be the aliases of the variables (and array subvariables) defined in step (1).</p>

<aside class="success">The CSV may be gzipped. In fact, you are encouraged to gzip it.</aside>

<p>The values in the CSV MUST be the same format as the values you get out of Crunch, and it must match the metadata specified in the previous step. This includes:</p>

<ul>
<li>Categorical variables should have data identified by the integer category ids, not strings, and all values must be defined in the &ldquo;categories&rdquo; metadata for each variable.</li>
<li>Datetimes must all be valid ISO 8601 strings</li>
<li>Numeric variables must have only (unquoted) numeric values</li>
<li>The only special value allowed is an empty &ldquo;cell&rdquo; in the CSV, which will be read as the system-missing value &ldquo;No Data&rdquo;</li>
</ul>

<p>Violation of any of these validation criteria will result in a 409 Conflict response status. To resolve, you can either (1) fix your CSV locally and re-POST it, or (2) PATCH the variable metadata that is invalid and then re-POST the CSV.</p>

<p>Imports are done in &ldquo;strict&rdquo; mode by default. Strict imports are faster, and using strict mode will alert you if there is any mismatch between data and metadata. However, in some cases, it may be convenient to be more flexible and silently ignore or resolve inconsistencies. For example, you may have a large CSV dumped out of a database, and the data format isn&rsquo;t exactly Crunch&rsquo;s format, but it would be costly to read-munge-write the whole file for minor changes. In cases like this, you may append <code class="prettyprint">?strict=0</code> to the URL of the POST request to loosen that strictness.</p>

<p>With non-strict imports:</p>

<ul>
<li>The CSV may contain columns not described by the metadata; these columns will be ignored, rather than returning an error response</li>
<li>The metadata may describe variables not contained in the CSV; these variables will be filled with missing values, rather than returning an error response</li>
<li>And more things to come</li>
</ul>

<p>The CSV can be sent in one of two ways:</p>

<ol>
<li>Upload a file by POSTing a multipart form</li>
<li>POST a Shoji entity with a &ldquo;url&rdquo; in the body, containing all necessary auth keys as query parameters. If the URL points to a single file, it should be a CSV or gzipped CSV, as described above. If the URL points to a directory, the contents will be assumed to be (potentially zipped) batches of a CSV and will be concatenated for appending. In the latter case, only the first CSV in the directory listing should contain a header row.</li>
</ol>

<p>A 201 response to the POST request indicates success. All rows added in a single request become part of a new Batch, whose URL is returned in the response Location. You may inspect the new rows in isolation by following its batch/ link.</p>

<h4 id="example">Example</h4>

<p>Here&rsquo;s an example <a href="examples/dataset.json">dataset metadata</a> and corresponding <a href="examples/dataset.csv">csv</a>.</p>

<p>Several things to note:</p>

<ul>
<li>Everything–metadata, order, and data–is keyed by variable &ldquo;alias&rdquo;, not &ldquo;name&rdquo;, because Crunch believes that names are for people, not computers, to understand. Aliases must be unique across the whole dataset, while variable &ldquo;names&rdquo; must only be unique within their group or array variable.</li>
<li>For categorical variables, all values in the CSV correspond to category ids, not category names, and also not &ldquo;numeric_values&rdquo;, which need not be unique or present for all categories in a variable.</li>
<li>The array variables defined in the metadata (&ldquo;allpets&rdquo; and &ldquo;petloc&rdquo;) don&rsquo;t themselves have columns in the CSV, but all of their &ldquo;subvariables&rdquo; do, keyed by their aliases.</li>
<li>With the exception of those array variable definitions, all variables and subvariables defined in the metadata have columns in the CSV, and there are no columns in the CSV that are not defined in the metadata.</li>
<li>For internal variables, such as a case identifier in this example, that you don&rsquo;t want to be visible in the UI, you can add them as &ldquo;hidden&rdquo; from the beginning by including <code class="prettyprint">&quot;discarded&quot;: &quot;true&quot;</code> in their definition, as in the example of &ldquo;caseid&rdquo;.</li>
<li>Missing values

<ul>
<li>Variables with categories (categorical, multiple_response, categorical_array) have missing values defined as categories with <code class="prettyprint">&quot;missing&quot;: &quot;true&quot;</code></li>
<li>Text, numeric, and datetime variables have missing variables defined as &ldquo;missing_rules&rdquo;, which can be &ldquo;value&rdquo;, &ldquo;set&rdquo;, or &ldquo;range&rdquo;. See, for example, &ldquo;q3&rdquo; and &ldquo;ndogs&rdquo;.</li>
<li>Empty cells in the CSV, if present, will automatically be translated as the &ldquo;No Data&rdquo; system missing value in Crunch. See, for example, &ldquo;ndogs_b&rdquo;.</li>
</ul></li>
<li>Order

<ul>
<li>All variables should be referenced by alias in the &ldquo;order&rdquo; object, inside a group&rsquo;s &ldquo;entities&rdquo; key. Any omitted variables (in this case, the hidden variable &ldquo;caseid&rdquo;) will automatically be added to a group named &ldquo;ungrouped&rdquo;.</li>
<li>Variables may appear in multiple groups.</li>
<li>Groups may be nested within each other.</li>
</ul></li>
</ul>

<h3 id="column-by-column">Column-by-column</h3>

<p>Crunch stores data by column internally, so if your data are stored in a column-major format as well, importing by column may be the most efficient way to import data.</p>

<h4 id="1-create-a-dataset-entity">1. Create a Dataset entity</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">974</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "my survey",</span>
<span class="s">        ...</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/</span>
</code></pre>
<pre class="highlight r"><code><span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">createDataset</span><span class="p">(</span><span class="s2">"my suryey"</span><span class="p">)</span>
</code></pre>

<p>POST a Dataset Entity to the datasets catalog, just as in the first import method.</p>

<h4 id="2-add-variable-definitions-and-column-data">2. Add Variable definitions and column data</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/{dataset_id}/variables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">38475</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "Gender",</span>
<span class="s">        "alias": "gender",</span>
<span class="s">        "type": "categorical",</span>
<span class="s">        "categories": [</span>
<span class="s">            {</span>
<span class="s">                "name": "Male",</span>
<span class="s">                "id": 1,</span>
<span class="s">                "numeric_value": null,</span>
<span class="s">                "missing": false</span>
<span class="s">            },</span>
<span class="s">            {</span>
<span class="s">                "name": "Female",</span>
<span class="s">                "id": 2,</span>
<span class="s">                "numeric_value": null,</span>
<span class="s">                "missing": false</span>
<span class="s">            },</span>
<span class="s">            {</span>
<span class="s">                "name": "Skipped",</span>
<span class="s">                "id": 9,</span>
<span class="s">                "numeric_value": null,</span>
<span class="s">                "missing": true</span>
<span class="s">            }</span>
<span class="s">        ],</span>
<span class="s">        "values": [1, 9, 1, 2, 2, 1, 1, 1, 1, 2, 9, 1]</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/datasets/{dataset_id}/variables/{variable_id}/</span>
</code></pre>
<pre class="highlight r"><code><span class="c1"># Here's a similar example. R's factor type becomes "categorical".
</span><span class="n">gender.names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Male"</span><span class="p">,</span> <span class="s2">"Female"</span><span class="p">,</span> <span class="s2">"Skipped"</span><span class="p">)</span>
<span class="n">gen</span> <span class="o">&lt;-</span> <span class="n">factor</span><span class="p">(</span><span class="n">gender.names</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">)],</span>
    <span class="n">levels</span><span class="o">=</span><span class="n">gender.names</span><span class="p">)</span>
<span class="c1"># Assigning an R vector into a dataset will create a variable entity.
</span><span class="n">ds</span><span class="o">$</span><span class="n">gender</span> <span class="o">&lt;-</span> <span class="n">gen</span>
</code></pre>

<p>POST a Variable Entity to the newly created dataset&rsquo;s variables catalog, and 
include with that Entity definition a &ldquo;values&rdquo; key that contains the column of 
data. Do this for all columns in your dataset.</p>

<p>If the <code class="prettyprint">values</code> attribute is not present, the new column will be filled with
&ldquo;No Data&rdquo; in all rows.</p>

<p>The data passed in <code class="prettyprint">values</code> can correspond to either the full data column for
the new variable or a single value, in which case it will be used to fill
up the column.</p>

<p>In the case of arrays, the single value should be a list containing the correct
categorical values.</p>

<p>If the type of the values passed in does not correspond with the variable&rsquo;s
type, the server will return a 400 response indicating the error and the
variable will not be created.</p>

<aside class="notice">
Note that the lengths of the columns of data you include in the &ldquo;values&rdquo; key 
must be the same for all variables, though if you&rsquo;re importing from a normal, 
rectangular data store, this should already be the case.
</aside>

          <h2 id="appending-data">Appending Data</h2>

<p>Appending data to an existing Dataset is not much different from uploading the initial data; both use a &ldquo;Batch&rdquo; resource which represents the process of importing the data from the source into the dataset. Once you have created a Source for your data, POST its URL to datasets/{id}/batches/ to start the import process. That process may take some time, depending on the size of the dataset. The returned Location is the URI of the new Batch; GET the batches catalog and look up the Batch URI in the catalog&rsquo;s index and inspect its status attribute until it moves from &ldquo;analyzing&rdquo; to &ldquo;appended&rdquo;. User interfaces may choose here to show a progress meter or some other widget.</p>

<p>During the &ldquo;analyzing&rdquo; stage, the Crunch system imports the data into a temporary table, and matches its variables with any existing variables. During the &ldquo;importing&rdquo; stage, the new rows will move to the target Dataset, and once &ldquo;appended&rdquo;, the new rows will be included in all queries against that Dataset.</p>

<h3 id="adding-a-subsequent-source">Adding a subsequent Source</h3>

<p>Once you have created a Dataset, you can upload new files and append rows to the same Dataset as often as you like. If the structure of each file is the same as that of the first uploaded file, Crunch should automatically pass your new rows through exactly the same process as the old rows. If there are any derived variables in your Dataset, new data will be derived in the new rows following the same rules as the old data. You can follow the progress as above via the batch&rsquo;s status attribute.</p>

<p>Let&rsquo;s look at an example: you had uploaded an initial CSV of 3 columns, A, B and C. Then:</p>

<ul>
<li>The Crunch system automatically converted column A from the few strings that were found in it to a Categorical type.</li>
<li>You derived a new column D that consisted of B * C.</li>
</ul>

<p>Then you decide to upload another CSV of new rows. What will happen?</p>

<p>When you POST to create the second Batch, the service will: 1) match up the new A with the old A and cast the new strings to existing categories by name, and 2) fill column D for you with B * C for each new row.</p>

<p>However, from time to time, the new source has significant differences: a new variable, a renamed variable, and other changes. When you append the first Source to a Dataset, there is nothing with which to conflict. But a subsequent POST to batches/ may result in a conflict if the new source cannot be confidently reconciled with the existing data. Even though you get a 201 Created response for the new batch resource, it will have a status of &ldquo;conflict&rdquo;.</p>

<h3 id="reporting-and-resolving-conflicts">Reporting and Resolving Conflicts</h3>

<p>When you append a Source to an existing Dataset, the system attempts to match up the new data with the old. If the source&rsquo;s schema can be automatically aligned with the target Dataset, the new rows from the Batch are appended. When things go wrong, however, the Batch can be inspected to see what conflicted with the target (or vice-versa, in some cases!).</p>

<p>GET the new Batch:</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/api/datasets/{dataset_id}/batches/{batch_id}/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">...</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/shoji</span>

{
    "element": "shoji:entity",
    "body": {
        "conflicts": {
          "cdbd11/": {
            "metadata": {},
            "conflicts": [{
              "message": "Types do not match and cannot be converted",
            }]
          }
        }
    }
}
</code></pre>

<p>If any variable conflicts, it will possess one or more &ldquo;conflicts&rdquo; members. For
example, if the new variable &ldquo;cdbd11&rdquo; had a different type that could not be
converted compared to the existing variable &ldquo;cdbd11&rdquo;, the Batch resource would
contain the above message.  Only unresolvable conflicts will be shown; if a
variable is not reported in the conflicts object, it appended cleanly.</p>

<p>See <a href="#batches">Batches</a> for more details on batch entities and conflicts.</p>

<h3 id="streaming-rows">Streaming rows</h3>

<p>Existing datasets are best sent to Crunch as a single Source, or a handful of
subsequent Sources if gathered monthly or on some other schedule. Sometimes
however you want to &ldquo;stream&rdquo; data to Crunch as it is being gathered, even one
row at a time, rather than in a single post-processing phase. You do <em>not</em> want
to make each row its own batch (it&rsquo;s simply not worth the overhead). Instead,
you should make a Stream and send rows to it, then periodically create a Source
and Batch from it.</p>

<h4 id="send-rows-to-a-stream">Send rows to a stream</h4>

<p>To send one or more rows to a dataset stream, simply POST one or more lines of
<a href="https://en.wikipedia.org/wiki/Line_Delimited_JSON">line-delimited JSON</a> to the
dataset&rsquo;s <code class="prettyprint">stream</code> endpoint:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"var_id_1"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"var_id_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a"</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight python"><code><span class="n">by_alias</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="s">'alias'</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">my_system</span><span class="o">.</span><span class="n">read_a_row</span><span class="p">()</span>
    <span class="n">importing</span><span class="o">.</span><span class="n">importer</span><span class="o">.</span><span class="n">stream_rows</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="p">{</span>
        <span class="s">'gender'</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s">'gender'</span><span class="p">],</span>
        <span class="s">'age'</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s">'age'</span><span class="p">]</span>
    <span class="p">})</span>
</code></pre>

<p>Streamed values must be keyed either by id or by alias. The variable ids/aliases
must correspond to existing variables in the dataset. The Python code shows how
to efficiently map aliases to ids. The data must match the target variable types
so that we can process the row as quickly as possible. We want no casting or
other guesswork slowing us down here. Among other things, this means that
categorical values must be represented as Crunch&rsquo;s assigned category ids, not
names or numeric values.</p>

<p>You may also send more than one row at a time if you prefer. For example, your
data collection system may already post-process row data in, say, 5 minute
increments. The more rows you can send together, the less overhead spent
processing each one and the more you can send in a given time. Send multiple
lines of line-delimited JSON, or if using pycrunch, a list of dicts rather than
a single dict.</p>

<p>Each time you send a POST, all of the rows in that POST are assembled into a new
message which is added to the stream. Each message can contain one or more rows
of data.</p>

<p>As when creating a new source, don&rsquo;t worry about sending values for derived
variables; Crunch will fill these out for you for each row using the data you
send.</p>

<h4 id="append-the-new-rows-to-the-dataset">Append the new rows to the dataset</h4>

<p>The above added new rows to the Stream resource so that you can be confident
that your data is completely safe with Crunch. To append those rows to the
dataset requires another step. You could stream rows and then, once they are all
assembled, append them all as a single Source to the dataset. However, if
you&rsquo;re streaming rows at intervals it&rsquo;s likely you want to append them to the
dataset at intervals, too. But doing so one row at a time is usually
counter-productive; it slows the rate at which you can send rows, balloons
metadata, and interrupts users who are analyzing the data.</p>

<p>Instead, you control how often you want the streamed rows to be appended to the
dataset. When you&rsquo;re ready, POST to <code class="prettyprint">/datasets/{id}/batches/</code> and provide the
&ldquo;stream&rdquo; member, plus any extra metadata the new Source should possess:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"stream"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ldjson"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My streamed rows"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Yet Another batch from the stream"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight python"><code><span class="n">ds</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s">"body"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">"stream"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
    <span class="s">"type"</span><span class="p">:</span> <span class="s">"ldjson"</span><span class="p">,</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"My streamed rows"</span><span class="p">,</span>
    <span class="s">"description"</span><span class="p">:</span> <span class="s">"Yet Another batch from the stream"</span>
<span class="p">}})</span>
</code></pre>

<p>The &ldquo;stream&rdquo; member tells Crunch to acquire the data from the stream to form this
Batch. The &ldquo;stream&rdquo; member must be <code class="prettyprint">null</code>, then the system will acquire all 
currently pending messages (any new messages which arrive during the formation of
this Batch will be queued and not fetched). If there are no pending messages,
<code class="prettyprint">409 Conflict</code> is returned instead of 201/202 for the new Batch.</p>

<h5 id="pending-rows-will-be-added-automatically">Pending rows will be added automatically</h5>

<p>Every hour, the Crunch system goes through all datasets, and for each that has pending streamed data, it batches up the pending rows and adds them to the dataset automatically, as long as the dataset is not currently in use by someone. That way, streamed data will magically appear in the dataset for the next time a user loads it, but if a user is actively working with the dataset, the system won&rsquo;t update their view of the data and disrupt their session.</p>

<p>See <a href="#stream">Stream</a> for more details on streams.</p>

<h2 id="combining-datasets">Combining datasets</h2>

<p>Combining datasets consists on creating a new dataset formed by stacking a list 
of datasets together. It works under the same rules as a normal append.</p>

<p>To create a new dataset combined from others, it is necessary to POST to the
datasets catalog indicating a <code class="prettyprint">combine_datasets</code> expression:</p>
<pre class="highlight plaintext"><code>POST /api/datasets/
</code></pre>
<pre class="highlight json"><code><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My combined dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Consists on dsA and dsB"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"derivation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"combine_datasets"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/dsabc/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/ds123/"</span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The server will verify that the authenticated user has view permission to all
datasets, else will raise a 400 error.</p>

<p>The resulting dataset will consist on the matched union of all included datasets
with the rows in the same order. Private/public variable visibility and exclusion
filters will be honored in the result.</p>

<h3 id="transformations-during-combination">Transformations during combination</h3>

<p>The combine procedures will perform normal append matching rules which means 
that any mismatch on aliases or types will not proceed, as well limiting the
existing union of variables from the present datasets as the result.</p>

<p>It is possible to provide transformations on the datasets to ensure that
they line up on the combination phase and to add extra columns with constant
dataset metadata per dataset on the resulting combined result.</p>

<p>Each <code class="prettyprint">{&quot;dataset&quot;}</code> argument allows for an extra <code class="prettyprint">frame</code> key that can contain
a function expression on the desired dataset transformation, for example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;dataset_url&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frame"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
            </span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"*"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">},</span><span class="w">
                </span><span class="nt">"dataset_id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;dataset_id&gt;"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dataset ID"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dataset_id"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="selecting-a-subset-of-variables-to-combine">Selecting a subset of variables to combine</h3>

<p>In the same fashion that it is possible to add extra variables to the dataset
transforms, it is possible to select which variables only to include.</p>

<p>Note in the example above, we use the <code class="prettyprint">&quot;*&quot;: {&quot;variable&quot;: &quot;*&quot;}</code> expressions
which instructs the server to include all variables. Omitting that would cause
to only include the selected variables, for example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;dataset_url&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frame"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
            </span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"A"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A"</span><span class="p">},</span><span class="w">
                </span><span class="nt">"B"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B"</span><span class="p">},</span><span class="w">
                </span><span class="nt">"C"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C"</span><span class="p">},</span><span class="w">
                </span><span class="nt">"dataset_id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;dataset_id&gt;"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dataset ID"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dataset_id"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>On this example, the expression indicates to only include variables with IDs 
<code class="prettyprint">A</code>, <code class="prettyprint">B</code> and <code class="prettyprint">C</code> from the referenced dataset as well as add the new extra 
variable <code class="prettyprint">dataset_id</code>. This would effectively append only these 4 variables 
instead of the full dataset&rsquo;s variables.</p>

          <h2 id="merging-and-joining-datasets">Merging and Joining Datasets</h2>

<p>Crunch supports joining variables from one dataset to another by a key variable that maps rows from one to the other. To add a snapshot of those variables to the dataset, POST an <code class="prettyprint">adapt</code>
function expression to its variables catalog.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/{dataset_id}/variables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"adapt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_key_id}/"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{dataset_id}/variables/{left_key_id}/"</span><span class="w">
    </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">-----</span><span class="w">
</span><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">202</span><span class="w"> </span><span class="err">Accepted</span><span class="w">


</span><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{dataset_id}/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/progress/5be82a/"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>

<p>A successful request returns 202 Continue status with a progress resource in the response body; poll that to track the status of the asynchronous job that adds the data to your dataset.</p>

<p>Currently Crunch only supports left joins: all rows of the left (current) dataset will be kept, and only rows from the right (incoming) dataset that have a key value present in the left dataset will be brought in. Rows in the left dataset that do not have a corresponding row in the right dataset will be filled with missing values for the incoming variables.</p>

<p>The join key must be of type &ldquo;numeric&rdquo; or &ldquo;text&rdquo;, must be the same type in both datasets, and must have unique values within each dataset.</p>

<h3 id="joining-a-subset-of-variables">Joining a subset of variables</h3>

<p>To select certain variables to bring over from the right dataset, include <code class="prettyprint">select</code>
function expression around the <code class="prettyprint">adapt</code> function described above:</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/{dataset_id}/variables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"{right_var1_id}/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_var1_id}/"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"{right_var2_id}/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_var2_id}/"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"{right_var3_id}/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_var3_id}/"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}],</span><span class="w">
    </span><span class="nt">"frame"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"adapt"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
            </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/"</span><span class="w">
        </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_key_id}/"</span><span class="w">
        </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{dataset_id}/variables/{left_key_id}/"</span><span class="w">
        </span><span class="p">}]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">-----</span><span class="w">
</span><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">202</span><span class="w"> </span><span class="err">Accepted</span><span class="w">


</span><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{dataset_id}/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/progress/5be82a/"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>

<h3 id="joining-a-subset-of-rows">Joining a subset of rows</h3>

<p>Rows to consider from the right dataset can also be filtered.
To do so, include a <code class="prettyprint">filter</code> attribute on the payload, containing either a filter expression, wrapped under <code class="prettyprint">{&quot;expression&quot;: &lt;expr&gt;}</code>, or
an existing filter entity URL (from the right-side dataset), wrapped as <code class="prettyprint">{&quot;filter&quot;: &lt;url&gt;}</code>.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/{dataset_id}/variables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"adapt"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_key_id}/"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{dataset_id}/variables/{left_key_id}/"</span><span class="w">
    </span><span class="p">}],</span><span class="w">
    </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"expression"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"=="</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{variable_id}/"</span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;value&gt;"</span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>You can filter both rows and variables in the same request. Note that the &ldquo;filter&rdquo; parameter remains at the top-level function in the expression, which when specifying a variable subset is &ldquo;select&rdquo; instead of &ldquo;adapt&rdquo;:</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/{dataset_id}/variables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"{right_var1_id}/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_var1_id}/"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"{right_var2_id}/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_var2_id}/"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"{right_var3_id}/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_var3_id}/"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}],</span><span class="w">
    </span><span class="nt">"frame"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"adapt"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
            </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/"</span><span class="w">
        </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/variables/{right_key_id}/"</span><span class="w">
        </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{dataset_id}/variables/{left_key_id}/"</span><span class="w">
        </span><span class="p">}]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/{other_id}/filters/{filter_id}/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h2 id="deriving-variables">Deriving Variables</h2>

<p>Derived variables are variables that, instead of having a column of values backing them, are functionally dependent on other variables. In Crunch, users with view-only permissions on a dataset can still make derived variables of their own–just as they can make filters. Dataset editors can also derive other types of variables as permanent additions to the dataset, available for all viewers.</p>

<aside class="notice">
    In this section, sample variable documents have been trimmed to the attributes essential to the derivation examples. Actual variable documents in the wild will have more attributes than those shown here.
</aside>

<h3 id="combining-categories">Combining categories</h3>

<p>The &ldquo;combine_categories&rdquo; function takes two arguments:</p>

<ul>
<li>A reference to the categorical or categorical_array variable to be combined</li>
<li>A definition of the categories of the new variable, including all members found in categories, plus a &ldquo;combined_ids&rdquo; key that maps the derived category to one or more categories (by id) in the input variable.</li>
</ul>

<p>Given a variable such as:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/3ad42c/variables/0000f5/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Education"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"educ"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No HS"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"High school graduate"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some college"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2-year"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4-year"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Post-grad"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Skipped"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Asked"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Education"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>POST&#39;ing to the private variables catalog a Shoji Entity containing a ZCL function like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Education (3 category)"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Combined from six-category education"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"educ3"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"derivation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"combine_categories"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/3ad42c/variables/0000f5/"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"High school or less"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some college"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4-year college or more"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Missing"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No data"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-1</span><span class="p">]</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>results in a private categorical variable with three valid categories.</p>

<p>Combining the categories of a categorical array is the same as it is for categorical variables. The resulting variable is also of type &ldquo;categorical_array&rdquo;. This variable type also has a &ldquo;subvariables_catalog&rdquo;, like the variable from which it is derived, and the subvariables contained in it are derived &ldquo;combine_categories&rdquo; categorical variables.</p>

<h3 id="combining-responses">Combining responses</h3>

<p>For multiple response variables, you may combine responses rather than categories.</p>

<p>Given a variable such as:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/455288/variables/3c2e57/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Aided awareness"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aided"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"../870a2d/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../a8b0eb/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../dc444f/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../8e6279/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../f775ab/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"../6405c2/"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"multiple_response"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Selected"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not selected"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Skipped"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not asked"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No data"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Which of the following coffee brands do you recognize? Check all that apply."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>POSTing to the variables catalog a Shoji Entity containing a ZCL function like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Aided awareness by region"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Combined from aided brand awareness"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aided_region"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"derivation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"combine_responses"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/455288/variables/3c2e57/"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"San Francisco"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="s2">"../870a2d/"</span><span class="p">,</span><span class="w">
                                </span><span class="s2">"../a8b0eb/"</span><span class="p">,</span><span class="w">
                                </span><span class="s2">"../dc444f/"</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Portland"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="s2">"../8e6279/"</span><span class="p">,</span><span class="w">
                                </span><span class="s2">"../f775ab/"</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Chicago"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"combined_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="s2">"../6405c2/"</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>results in a multiple response variable with three responses. The &ldquo;selected&rdquo; state of the responses in the derived variable is an &ldquo;OR&rdquo; of the combined subvariables.</p>

<h3 id="case-statements">Case statements</h3>

<p>The &ldquo;case&rdquo; function derives a variable using values from the first argument. Each of the remaining arguments contains a boolean expression. These are evaluated in order in an IF, ELSE IF, ELSE IF, &hellip;, ELSE fashion; the first one that matches selects the corresponding value from the first argument. For example, if the first two boolean expressions do not match (return False) but the third one matches, then the third value in the first argument is placed into that row in the output. You may include an extra value for the case when none of the boolean expressions match; if not provided, it defaults to the system &ldquo;No Data&rdquo; missing value.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Market segmentation"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Super-scientific classification of people"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"segments"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"derivation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"case"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"column"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">],</span><span class="w">
                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hipsters"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Techies"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Yuppies"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Other"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"and"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"55fc29/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]}]},</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;="</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"673dde/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">}]}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"and"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"889dc3/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]}]},</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&gt;"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"673dde/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="p">}]}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"=="</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"13cbf4/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}]}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="making-ad-hoc-arrays">Making ad hoc arrays</h3>

<p>It is possible to create derived arrays reusing subvariables from other arrays 
using the <code class="prettyprint">array</code> function and indicating the reference for each of its 
subvariables. </p>

<p>The subvariables of an array are specified using the <code class="prettyprint">select</code> function, with its
first <code class="prettyprint">map</code> argument indicating the IDs for each of these virtual subvariables.
These IDs are user defined and can be any string. They remain unique inside the
parent variable so they can be reused between different arrays.
The second argument of the <code class="prettyprint">select</code> function indicates the order of the 
subvariables in the array. They are referenced by the user defined IDs.</p>

<p>Each of its variables must point to a variable expression, which can take an
optional (but recommended) <code class="prettyprint">references</code> attribute to specify a particular name and alias for
the subvariable, if not specified, the same name from the original will be used
and the alias will be padded to ensure uniqueness.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"CA3"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cat array 3"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"derivation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w"> 
      </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w"> 
          </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"var1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca2-subvar-2"</span><span class="p">,</span><span class="w"> 
                  </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvar2"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Subvar 2"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w"> 
                </span><span class="nt">"var0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca1-subvar-1"</span><span class="p">,</span><span class="w"> 
                  </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvar1"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Subvar 1"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w"> 
            </span><span class="p">{</span><span class="w">
              </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"var1"</span><span class="p">,</span><span class="w"> 
                </span><span class="s2">"var0"</span><span class="w">
              </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> 
  </span><span class="nt">"CA2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca2-subvar-1"</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca2-subvar-1"</span><span class="w">
      </span><span class="p">},</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca2-subvar-2"</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca2-subvar-2"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w"> 
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cat array 2"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yes"</span><span class="w">
      </span><span class="p">},</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="w">
      </span><span class="p">},</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w"> 
  </span><span class="nt">"CA1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca1-subvar-1"</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca1-subvar-1"</span><span class="w">
      </span><span class="p">},</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca1-subvar-2"</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca1-subvar-2"</span><span class="w">
      </span><span class="p">},</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca1-subvar-3"</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca1-subvar-3"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w"> 
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cat array 1"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yes"</span><span class="w">
      </span><span class="p">},</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="w">
      </span><span class="p">},</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> 
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>On the above example, the array <code class="prettyprint">CA3</code> uses the array function and uses 
subvariables <code class="prettyprint">ca1-subvar-1</code> and <code class="prettyprint">ca2-subvar-2</code> from <code class="prettyprint">CA1</code> and <code class="prettyprint">CA2</code> respectively.
The <code class="prettyprint">references</code> attribute is used to indicate specific name/alias for these
subvariables.</p>

<aside class="warning">
Note that when making an array with this method its subvariables catalog
and subvariables will return 405 on PATCH attempts. The correct way to make
modifications to them (add/remove subvariable, edit subvariable attributes) is
to update the new array variable&rsquo;s entity `derivation` attribute with the 
updated expression indicating the desired subvariable modifications.
</aside>

<h3 id="weights">Weights</h3>

<p>A numeric variable suitable for use as row weights can be constructed from one 
or more categorical variables and target proportions of their categories. The 
sample distribution is “raked” iteratively to each categorical marginal target 
to produce a set of joint values that can be used as weights. Note that 
available weight variables are shared by all; you may not create private 
weights. To create a weight variable, POST a JSON variable definition to the 
variables catalog describing the properties of the weight variable, with an 
&ldquo;derivation&rdquo; member indicating to use the &ldquo;rake&rdquo; function, which takes arguments
 containing an array of variable targets:</p>
<pre class="highlight shell"><code>POST /api/datasets/<span class="o">{</span>datasetid<span class="o">}</span>/variables/ HTTP/1.1
Content-Type: application/shoji
Content-Length: 739
<span class="o">{</span>
    <span class="s2">"name"</span>: <span class="s2">"weight"</span>,
    <span class="s2">"description"</span>: <span class="s2">"my raked weight"</span>,
    <span class="s2">"derivation"</span>: <span class="o">{</span>
        <span class="s2">"function"</span>: <span class="s2">"rake"</span>,
        <span class="s2">"args"</span>: <span class="o">[{</span>
            <span class="s2">"variable"</span>: variabl1.id,
            <span class="s2">"targets"</span>: <span class="o">[[</span>1, 0.491], <span class="o">[</span>2, 0.509]]
        <span class="o">}]</span>
    <span class="o">}</span>
<span class="o">}</span>
---------
201 Created
Location: /api/datasets/<span class="o">{</span>datasetid<span class="o">}</span>/variables/<span class="o">{</span>variableid<span class="o">}</span>/
</code></pre>

<h3 id="multiple-response-views">Multiple Response Views</h3>

<p>The &ldquo;select_categories&rdquo; function allows you to form a multiple response array from a categorical array, or alter the &ldquo;selected&rdquo; categories in an existing multiple response array. It takes two arguments:</p>

<ul>
<li>A reference to a categorical or categorical_array variable</li>
<li>A list of the category ids or category names to mark as &ldquo;selected&rdquo;</li>
</ul>

<p>Given a variable such as:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/3ad42c/variables/0000f5/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cola"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cola"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Never"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sometimes"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Frequently"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Always"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"0001"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0002"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0003"</span><span class="p">],</span><span class="w">
        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"subreferences"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"0003"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Coke"</span><span class="p">},</span><span class="w">
                </span><span class="nt">"0002"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pepsi"</span><span class="p">},</span><span class="w">
                </span><span class="nt">"0001"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RC"</span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>POST&#39;ing to the private variables catalog a Shoji Entity containing a ZCL function like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cola likes"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cola preferences"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cola_likes"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"derivation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select_categories"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/3ad42c/variables/0000f5/"</span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>&hellip;results in a private multiple_response variable where the &ldquo;Frequently&rdquo; and &ldquo;Always&rdquo; categories are selected.</p>

<h3 id="text-analysis">Text Analysis</h3>

<h4 id="sentiment-analysis">Sentiment Analysis</h4>

<p>The &ldquo;sentiment&rdquo; function allows you to derive a categorical variable from text variable data, which is classified and accumulated in three categories (positive, negative, and neutral).  It takes one parameter: </p>

<ul>
<li>A reference to a text variable</li>
</ul>

<p>Given a variable such as:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/3ad42c/variables/0000f5/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Zest"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zest"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"Zest is best"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Zest I can take it or leave it"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Zest is the worst"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">POST</code>ing to the private variables catalog a Shoji Entity containing a ZCL function like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Zesty Sentiment"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Customer sentiment about Zest"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zest_sentiment"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"derivation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sentiment"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/3ad42c/variables/0000f5/"</span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Will result in a new categorical variable, where for each row the text variable is classified as “Negative”, “Neutral”, or “Positive” using the <a href="https://github.com/cjhutto/vaderSentiment">VADER</a> English social-media-tuned lexicon.</p>

<h3 id="other-transformations">Other transformations</h3>

<h4 id="arithmetic-operations">Arithmetic operations</h4>

<p>It is possible to create new numeric variables out of pairs of other
 numeric variables. The following arithmetic operations are available
 and will take two numeric variables as their arguments.</p>

<ul>
<li>&ldquo;+&rdquo; for adding up two numeric variables.</li>
<li>&ldquo;-&rdquo; returns the difference between two numeric variables.</li>
<li>&ldquo;*&rdquo; for the product of two numeric variables.</li>
<li>&ldquo;/&rdquo; Real division.</li>
<li>&ldquo;//&rdquo; Floor division; Returns always an integer.</li>
<li>&ldquo;^&rdquo; Raises the first argument to the power of the second argument</li>
<li>&ldquo;%&rdquo; Modulo operation; Accepts floats</li>
</ul>

<p>The usage is as follows for all operators:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/variables/abc/"</span><span class="p">}</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/variables/def/"</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="bin">bin</h4>

<p>Receives a numeric variable and returns a categorical one where each
category represents a bin of the numeric values.</p>

<p>Each category on the new variable is annotated with a &ldquo;boundaries&rdquo; 
member that contains the lower/upper bound of each bin.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bin"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/variables/abc/"</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Optionally it is possible to pass a second argument indicating the desired
bin size to use instead of allowing the API to decide them.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bin"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/variables/abc/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">'value':</span><span class="w"> </span><span class="err">100</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="case">case</h4>

<p>Returns a categorical variable with its categories following the specified
conditions from different variables on the dataset. <a href="#Case-statements">View Case Statements</a></p>

<h4 id="cast">cast</h4>

<p>Returns a new variable with its type and values casted. Not applicable
on arrays or date variable; use <a href="#Date-Functions">Date Functions</a> to
work with date variables.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cast"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/variables/abc/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The allowed output variable types are:</p>

<ul>
<li>numeric</li>
<li>text</li>
<li>categorical</li>
</ul>

<p>For categorical types it is necessary to indicate the categories as a type
definition instead of a string name:</p>

<p>To cast to categorical type, the second argument <code class="prettyprint">value</code> should not be
 a name string (<code class="prettyprint">numeric</code>, <code class="prettyprint">text</code>) but a type definition indicating a 
 <code class="prettyprint">class</code> and <code class="prettyprint">categories</code> as follow:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cast"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/variables/abc/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"one"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"two"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">},</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To change the type of a variable a client should POST to the <code class="prettyprint">/variable/:id/cast/</code>
endpoint. See <a href="#Convert-type">Convert type</a> for API examples.</p>

<h4 id="char_length">char_length</h4>

<p>Returns a numeric variable containing the text length of each value. Only
applicable on text variables.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"char_length"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/variables/abc/"</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="copy_variable">copy_variable</h4>

<p>Returns a shallow copy of the indicated variable maintaining type and data.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"copy_variable"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/variables/abc/"</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Changes on the data of the original variable will be reflected on this copy.</p>

<h4 id="combine_categories">combine_categories</h4>

<p>Returns a categorical variable with values combined following the specified
combination rules. See <a href="#Combining-categories">Combining categories</a></p>

<h4 id="combine_responses">combine_responses</h4>

<p>Given a list of categorical variables, return the selected value out
of them. See <a href="#Combining-responses">Combining responses</a></p>

<h4 id="row">row</h4>

<p>Returns a numeric variable with row 0 based indices. It takes no arguments.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="remap_missing">remap_missing</h4>

<p>Given a text, numeric or datetime variable. return a new variable of the
same type with its missing values mapped to new codes</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"remap_missing"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"varid"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Combined 1 and 2"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"mapped_codes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Only 3"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
            </span><span class="nt">"mapped_codes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"mapped_codes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-1</span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The example above will return a copy of the variable with id <code class="prettyprint">varid</code> with the
new <code class="prettyprint">missing_reasons</code> grouping and mapping following the original codes.</p>

<h3 id="integrating-variables">Integrating variables</h3>

<p>&ldquo;Integrating&rdquo; a variable means to remove its derived properties and turn it into
a regular <em>base</em> variable. Doing so will make this variable stop reflecting
the expression if new data is added to its original parent variable and new rows
will be filled with No Data <code class="prettyprint">{&quot;?&quot;: -1}</code>.</p>

<p>To integrate a variable it is necessary to PATCH to the variable entity with
the <code class="prettyprint">derived</code> attribute set to <code class="prettyprint">false</code> as so:</p>
<pre class="highlight http"><code><span class="err">PATCH /api/dataset/abc/variables/123/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Will effectively integrate the variable and make its <code class="prettyprint">derivation</code> attribute 
contain <code class="prettyprint">null</code> from now in. Note that it is only possible to set the <code class="prettyprint">derived</code>
attribute to <code class="prettyprint">false</code> and never to <code class="prettyprint">true</code>.</p>

          <h2 id="array-variables">Array Variables</h2>

<p>Simple variables have only one value per row; sometimes, however, it is convenient to consider multiple values (of the same type) as a single Variable. The Crunch system implements the data as a 2-dimensional array, but the array variable includes two additional attributes: &ldquo;subvariables&rdquo;, which is a list of subvariable URLs, and &ldquo;subreferences&rdquo;, which is an object of {name, alias, description, &hellip;} objects keyed by subvariable URL. There are two types of array variable: categorical array and multiple response.</p>

<h3 id="categorical-arrays">Categorical arrays</h3>

<p>For the &ldquo;categorical_array&rdquo; type, a row has multiple values, and may have a different value for each subvariable. For example, you might field a survey where you ask respondents to rate soft drinks by filling in a grid of a set of brands versus a set of ratings:</p>
<pre class="highlight plaintext"><code>72. How much do you like each soft drink?
       Not at all   Not much   OK   A bit   A lot
 Coke       o           o      o      o       o
Pepsi       o           o      o      o       o
   RC       o           o      o      o       o
</code></pre>

<p>The respondent may only select one rating in each row. To represent that answer data in Crunch, you would define an array. For example, you might POST a Variable Entity with the payload:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Soft Drinks"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"./subvariables/001/"</span><span class="p">,</span><span class="w"> 
            </span><span class="s2">"./subvariables/002/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"./subvariables/003/"</span><span class="w">
         </span><span class="p">],</span><span class="w">
        </span><span class="nt">"subreferences"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"./subvariables/002/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Coke"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coke"</span><span class="p">},</span><span class="w">
            </span><span class="nt">"./subvariables/003/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pepsi"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pepsi"</span><span class="p">},</span><span class="w">
            </span><span class="nt">"./subvariables/001/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RC"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rc"</span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w">    </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not at all"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not much"</span><span class="p">,</span><span class="w">   </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="p">,</span><span class="w">         </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A bit"</span><span class="p">,</span><span class="w">      </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A lot"</span><span class="p">,</span><span class="w">      </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Skipped"</span><span class="p">,</span><span class="w">    </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"?"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">}],</span><span class="w">
            </span><span class="p">[{</span><span class="nt">"?"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"?"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">}],</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The &ldquo;Soft Drinks&rdquo; categorical array variable may now be included in analyses like any other variable, but has 2 dimensions instead of the typical 1. For example, a crosstab of a 1-dimensional &ldquo;Gender&rdquo; variable with a 1-dimensional &ldquo;Education&rdquo; variable yields a 2-D cube. A crosstab of 1-D &ldquo;Gender&rdquo; by 2-D &ldquo;Soft Drinks&rdquo; yields a 3-D cube.</p>

<p>In rare cases, you may have already added a separate Variable for &ldquo;Coke&rdquo;, one for &ldquo;Pepsi&rdquo;, and one for &ldquo;RC&rdquo;. You may move them to a single array variable by POSTing a Variable Entity for the array that instead of a &ldquo;subreferences&rdquo; attribute has a &ldquo;subvariables&rdquo; attribute, a list of URL&rsquo;s of the variables you&rsquo;d like to bind together:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Soft Drinks"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"Coke"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"Pepsi"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"RC"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The existing variables are removed from the normal order and become virtual subvariables of the new array. This approach will cast all subvariables to a common set of categories if they differ. The existing name and alias of each subvariable will be moved to the array&rsquo;s &ldquo;subreferences&rdquo; attribute.</p>

<p>If you wish to analyze a set of categorical variables as an array <em>without</em> moving them, you need to build a derived array instead.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Soft Drinks"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"derivation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"000000"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"Coke"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">},</span><span class="w">
                    </span><span class="nt">"000001"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"Pepsi"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">},</span><span class="w">
                    </span><span class="nt">"000002"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;URI</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="s2">"RC"</span><span class="w"> </span><span class="err">variable&gt;</span><span class="p">}</span><span class="w">
                </span><span class="p">}}]</span><span class="w">
            </span><span class="p">}]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Your client library may have helper functions to construct the above more easily. This is a bit more advanced, but consequently more powerful: you can grab subvariables from other existing arrays, use more powerful subsetting functions like &ldquo;deselect&rdquo; and &ldquo;subvariables&rdquo;, cast, combine, what-have-you.</p>

<h3 id="multiple-response">Multiple response</h3>

<p>The second type of array is &ldquo;multiple_response&rdquo;. These arrays look very similar to categorical_array variables in their data representations, but are usually gathered very differently and behave differently in analyses. For example, you might field a survey where you ask respondents to select countries they have visited:</p>
<pre class="highlight plaintext"><code>38. Which countries have you visited?

[] USA
[] Germany
[] Japan
[] None of the above 
</code></pre>

<p>The respondent may check the box or not for each row. To represent that answer data in Crunch, you would define an array Variable with separate subreferences for &ldquo;USA&rdquo;, &ldquo;Germany&rdquo;, &ldquo;Japan&rdquo;, and &ldquo;None of the above&rdquo;:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Countries Visited"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"multiple_response"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"./subvariables/001/"</span><span class="p">,</span><span class="w"> 
            </span><span class="s2">"./subvariables/002/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"./subvariables/003/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"./subvariables/004/"</span><span class="w">
         </span><span class="p">],</span><span class="w">
        </span><span class="nt">"subreferences"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"./subvariables/002/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USA"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"visited_usa"</span><span class="p">},</span><span class="w">
            </span><span class="nt">"./subvariables/004/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Germany"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"visited_germany"</span><span class="p">},</span><span class="w">
            </span><span class="nt">"./subvariables/001/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Japan"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"visited_japan"</span><span class="p">},</span><span class="w">
            </span><span class="nt">"./subvariables/003/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"None of the above"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"visited_none_of_the_above"</span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w">     </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Checked"</span><span class="p">,</span><span class="w">     </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not checked"</span><span class="p">,</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">98</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not shown"</span><span class="p">,</span><span class="w">   </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Skipped"</span><span class="p">,</span><span class="w">     </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Aside from the new type name, the primary difference from the basic categorical array is that one or more categories are marked as &ldquo;selected&rdquo;. These are then used to dichotomize the categories such that any subvariable response is treated more as if it were true or false (selected or unselected) than maintaining the difference between each category. If POSTing to create &ldquo;multiple_response&rdquo;, you may include a &ldquo;selected_categories&rdquo; key in the body, containing an array of category names that indicate the dichotomous selection. If you do not include &ldquo;selected_categories&rdquo;, there must be at least one &ldquo;selected&rdquo;: true category in the subvariables you are binding into the multiple-response variable to indicate the dichotomous selection–see Object Reference#categories. If neither are true, the request will return 400 status.</p>

<p>The &ldquo;Countries Visited&rdquo; multiple response variable may now be included in analyses like any other variable, but with a noticeable difference. Rather than contributing a dimension of distinct categories, it instead contributes a dimension of distinct subvariables. For example, a crosstab of a 1-dimensional &ldquo;Gender&rdquo; variable with a 1-dimensional &ldquo;Education&rdquo; variable yields a 2-D cube: one dimension of the categories of Gender and one dimension of the categories of Education. A crosstab of 1-D &ldquo;Gender&rdquo; by the multiple response &ldquo;Countries Visited&rdquo; also yields a 2-D cube: one dimension of the categories of Gender but the other dimension has one entry for &ldquo;USA&rdquo;, one for &ldquo;Germany&rdquo;, one for &ldquo;Japan&rdquo;, and one for &ldquo;None of the above&rdquo;.</p>

<p>A quirk of multiple response variables is that analyses of them often require knowledge across subvariables: which rows had any subvariable selected, which rows had no subvariable selected, and which rows had all subvariables marked as &ldquo;missing&rdquo;. The Crunch system calculates these ancillary &ldquo;subvariables&rdquo; for you, and includes them in analysis output. Including an explicit &ldquo;None of the above&rdquo; subvariable in the example above complicates this, since Crunch has no way of knowing to treat such subvariables specially; it will faithfully consider the &ldquo;None of the above&rdquo; subvariable like any other subvariable when calculating the any/none/missing views. Depending on your application, you may wish to 1) not even include that option in your survey, 2) skip adding that variable to your Crunch dataset, 3) add it but do not bind it into the parent array variable, or 4) include it and have it be treated like any other multiple response subvariable in your analyses.</p>

<h3 id="non-uniform-basis">Non-uniform basis</h3>

<p>As presented above, multiple response variables assume that subvariables have a consistent, uniform basis or number of rows in each subvariable. In some cases, the number of valid and missing entries may be wildly different from one subvariable to the next. In a survey example, a new response may be added to a longer-running series, or different responses may be presented to subsets of respondents in the context of an experiment. The boolean field <code class="prettyprint">uniform_basis</code>, if <code class="prettyprint">false</code>, provides a hint to users that, rather than using the <code class="prettyprint">__any__</code> column (from the <code class="prettyprint">selections</code> function output) in an analysis query, they should instead calculate the basis per subvariable by summing the ‘selected’ and ‘not selected’ categories. The field’s default is <code class="prettyprint">true</code>.</p>

<h3 id="adding-new-subvariables">Adding new subvariables</h3>

<p>In the scenario that a variable was left out when creating an array variable, it is possible to modify the array variable so that new subvariables get added (always on the last position).</p>

<p>To do so, the subvariable-to-be should currently be a variable of the dataset and have the same type as the subvariables (&ldquo;categorical&rdquo;).</p>

<p>Send a PATCH request containing the url of the new subvariable with an empty object as its tuple:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="err">...</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"http://.../url/new/subvariable/"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A 204 response will indicate that the catalog was updated, and the new subvariable now is part of the array variable.</p>

          <h2 id="multidimensional-analysis">Multidimensional analysis</h2>

<p>In the Crunch system, any analysis is also referred to as a &ldquo;cube&rdquo;. Cubes are the mechanical means of representing analyses to and from the Crunch system; you can think of them as spreadsheets that might have other than two dimensions. A cube consists of two primary parts: &ldquo;dimensions&rdquo; which supply the cube axes, and &ldquo;measures&rdquo; which populate the cells. Although both the request and response include dimensions and measures, it is important to distinguish between them. The request supplies expressions for each, while the response has data (and metadata) for each. The request declares what variables to use and what to do with them, while the response includes and describes the results. See Object Reference:Cube for complete details.</p>

<h3 id="dimensions">Dimensions</h3>

<p>Each dimension of an analysis can be simply one variable, a function over it, a traversal of its subvariables (for array variables), or even a combination of multiple variables (e.g. A + B). Any expression you can use in a &ldquo;select&rdquo; command can be used as a dimension. The big difference is that the system will consider the distinct values rather than all values of the result. Variables which are already &ldquo;categorical&rdquo; or &ldquo;enumerated&rdquo; will simply use their &ldquo;categories&rdquo; or &ldquo;elements&rdquo; as the extent. Other variables form their extents from their distinct values.</p>

<p>For example, if &ldquo;3ffd45&rdquo; is a categorical variable with three categories (one of which is &ldquo;No Data&rdquo;: -1), then the following dimension expressions:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/ab8832/variables/3ffd45/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/ab8832/variables/2098f1/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}]}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>&hellip;would form a result cube with two dimensions: one using the categories of variable &ldquo;3ffd45&rdquo;, and one using the distinct values of (variable &ldquo;2098f1&rdquo; + 5). If variable &ldquo;2098f1&rdquo; has the distinct values [5, 15, 25, 35], then we would obtain a cube with the following extents:</p>

<table><thead>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>-1</th>
</tr>
</thead><tbody>
<tr>
<td>5</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>15</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>25</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>35</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>

<p>Each dimension used in a cube query needs to be reduced to distinct values. For categorical or enumerated variables, we only need to refer to the variable, and the system will automatically use the &ldquo;categories&rdquo; or &ldquo;elements&rdquo; metadata to determine the distinct values. For other types, the default is to scan the variable&rsquo;s data to find the unique values present and use those. Often, however, we want a more sophisticated approach: numeric variables, for example, are usually more useful when binned into a handful of ranges, like &ldquo;0 to 10, 10 to 20, &hellip;90 to 100&rdquo; rather than 100 distinct points (or many more when dealing with non-integers). The available dimensioning functions vary from type to type; the most common are:</p>

<ul>
<li>categorical: {&ldquo;variable&rdquo;: url}</li>
<li>text: {&ldquo;variable&rdquo;: url}</li>
<li>numeric:  Group the distinct values into a smaller number of bins via:

<ul>
<li>{&ldquo;function&rdquo;: &ldquo;bin&rdquo;, &ldquo;args&rdquo;: [{&ldquo;variable&rdquo;: url}]}</li>
</ul></li>
<li>datetime: Roll up seconds into hours, days into months, or any other grouping via:

<ul>
<li>{&ldquo;function&rdquo;: &ldquo;rollup&rdquo;, &ldquo;args&rdquo;: [{&ldquo;variable&rdquo;: url}, {&ldquo;value&rdquo;: variable.rollup_resolution}]}</li>
</ul></li>
<li>categorical_array:

<ul>
<li>One dimension for the subvariables: {&ldquo;each&rdquo;: url}</li>
<li>One dimension for the categories: {&ldquo;variable&rdquo;: url}</li>
</ul></li>
<li>multiple response:

<ul>
<li>One dimension for the subvariables: {&ldquo;each&rdquo;: url}</li>
<li>One dimension for the selected-ness, which means transforming the array from a set of arbitrary categories to a standard &ldquo;selected&rdquo; set of categories (1, 0, -1) via:

<ul>
<li>{&ldquo;function&rdquo;: &ldquo;selections&rdquo;, &ldquo;args&rdquo;: [{&ldquo;variable&rdquo;: url}]}</li>
</ul></li>
</ul></li>
</ul>

<h3 id="measures">Measures</h3>

<p>A set of named functions to populate each cell of the cube. You can request multiple functions over the same dimensions (such as “cube_mean” and “cube_stddev”) or more commonly just one (like “cube_count”). For example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}}</span><span class="w">
</span></code></pre>

<p>or:</p>
<pre class="highlight json"><code><span class="w">    </span><span class="p">{</span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"mean"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_mean"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/1/variables/3"</span><span class="p">}]},</span><span class="w">
        </span><span class="nt">"stddev"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_stddev"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/1/variables/3/"</span><span class="p">}]}</span><span class="w">
    </span><span class="p">}}</span><span class="w">
</span></code></pre>

<p>When applied to the dimensions we defined above, this second example might fill the table thusly for the &ldquo;mean&rdquo; measure:</p>

<table><thead>
<tr>
<th>mean</th>
<th>1</th>
<th>2</th>
<th>-1</th>
</tr>
</thead><tbody>
<tr>
<td>5</td>
<td>4.3</td>
<td>12.3</td>
<td>8.1</td>
</tr>
<tr>
<td>15</td>
<td>13.1</td>
<td>0.0</td>
<td>9.2</td>
</tr>
<tr>
<td>25</td>
<td>72.4</td>
<td>4.2</td>
<td>55.5</td>
</tr>
<tr>
<td>35</td>
<td>8.9</td>
<td>9.1</td>
<td>0.4</td>
</tr>
</tbody></table>

<p>&hellip;and produce a similar one for the &ldquo;stddev&rdquo; measure. You can think of multiple measures as producing &ldquo;overlays&rdquo; over the same dimensions. However, the actual output format (in JSON) is more compact in that the dimensions are not repeated; see Object Reference:Cube output for details.</p>

<p>ZCL expressions are composable. If you need, for example, to find the mean of a categorical variable&rsquo;s &ldquo;numeric_value&rdquo; attributes, cast the variable to the &ldquo;numeric&rdquo; type class before including it as the cube argument:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"mean"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_mean"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cast"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/1/variables/3"</span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}}</span><span class="w">
</span></code></pre>

<h3 id="comparisons">Comparisons</h3>

<p>Occasionally, it is useful to compare analyses from different sources. A common example is to define &ldquo;benchmarks&rdquo; for a given analysis, so that you can quickly compare an analysis to an established target. These are, in effect, one analysis laid over another in such a way that at least one of their dimensions lines up (and typically, using the same measures). These are also therefore defined in terms of cubes: one set which defines the base analyses, and another which defines the overlay.</p>

<p>For example, if we have an analysis over two categorical variables &ldquo;88dd88&rdquo; and &ldquo;ee4455&rdquo;:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/88dd88/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/ee4455/"</span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>then we might obtain a cube with the following output:</p>

<table><thead>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>-1</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>15</td>
<td>12</td>
<td>9</td>
</tr>
<tr>
<td>2</td>
<td>72</td>
<td>8</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>23</td>
<td>4</td>
<td>17</td>
</tr>
</tbody></table>

<p>Let&rsquo;s say we then want to overlay a comparison showing benchmarks for 88dd88 as follows:</p>

<table><thead>
<tr>
<th></th>
<th>1</th>
<th>2</th>
<th>-1</th>
<th>benchmarks</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>15</td>
<td>12</td>
<td>9</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>72</td>
<td>8</td>
<td>3</td>
<td>70</td>
</tr>
<tr>
<td>3</td>
<td>23</td>
<td>4</td>
<td>17</td>
<td>10</td>
</tr>
</tbody></table>

<p>Our first pass at this might be to generate the benchmark targets in some other system, and hand-enter them into Crunch. To accomplish this, we need to define a comparison. First, we need to define the &ldquo;bases&rdquo;: the cube(s) to which our comparison applies, which in our case is just the above cube:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My benchmark"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"bases"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"88dd88"</span><span class="p">}],</span><span class="w">
        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}</span><span class="w">
    </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Notice, however, that we&rsquo;ve left out the second dimension. This means that this comparison will be available for any analysis where &ldquo;88dd88&rdquo; is the row dimension. The base cube here is a sort of &ldquo;supercube&rdquo;: a superset of the cubes to which we might apply the comparison. We include the measure to indicate that this comparison should apply to a &ldquo;cube_count&rdquo; (frequency count) involving variable &ldquo;88dd88&rdquo;.</p>

<p>Then, we need to define target data. We are supplying these in a hand-generated way, so our measure is simply a static column instead of a function:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"overlay"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"88dd88"</span><span class="p">}],</span><span class="w">
        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"column"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">],</span><span class="w">
                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"typeof"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"88dd88"</span><span class="p">}]}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Note that our overlay has to have a dimension, too. In this case, we simply re-use variable &ldquo;88dd88&rdquo; as the dimension. This ensures that our target data is interpreted with the same category metadata as our base analysis.</p>

<p>We POST the above to datasets/{id}/comparisons/ and can obtain the overlay output at datasets/{id}/comparisons/{comparison_id}/cube/. See the Endpoint Reference for details.</p>

<h3 id="multitables">Multitables</h3>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">datasets/{id}/multitables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>

200 OK
{
    "element": "shoji:catalog",
    "index": {
        "1/": {"name": "Major demographics"},
        "2/": {"name": "Political tendencies"}
    }
}
</code></pre>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">datasets/{id}/multitables/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    "element": "shoji:entity",
    "body": {
        "name": "Geographical indicators",
        "template": [
            {
                "query": [
                    {
                        "variable": "../variables/de85b32/"
                    }
                ]
            },
            {
                "query": [
                    {
                        "variable": "../variables/398620f/"
                    }
                ]
            },
            {
                "query": [
                    {
                        "function": "bin",
                        "args": [
                            {
                                "variable": "../variables/398620f/"
                            }
                        ]
                    }
                ]
            }
        ],
        "is_public": false
    }
}

201 Created
Location: datasets/{id}/multitables/3/
</code></pre>

<p>Analyses as described above are truly multidimensional; when you add another variable, the resulting cube obtains another dimension. Sometimes, however, you want to compare analyses side by side, typically looking at several (even <em>all</em>) variables against a common set of conditioning variables. For example, you might nominate &ldquo;Gender&rdquo;, &ldquo;Age&rdquo;, and &ldquo;Race&rdquo; as the conditioning variables and cross every other variable with those, in order to quickly discover common correlations.</p>

<p>Multi-table definitions mainly provide a <code class="prettyprint">template</code> member that clients can use to construct a valid query with the variable(s) of interest.</p>

<p>Crunch provides a separate catalog where you can define and manage these common sets of variables. Like most catalogs, you can <a href="#multitables162">GET it</a> to see which multitables are defined.</p>

<h4 id="template-query">Template query</h4>

<p>A multitable is a set of queries that form groups of ‘columns’ for different later chosen ‘row’ variables.
It is defined by a <strong>name</strong> and a <strong>template</strong>. At minimum the template must contain a <code class="prettyprint">query</code> fragment:
this will be later inserted after some function of a row variable to form the <a href="#dimensions">dimension</a>
of a result. Each template dimension can currently only be a function of one variable.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">datasets/{id}/multitable/3/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
    "element": "shoji:entity",
    "body": {
        "name": "Geographical indicators",
        "template": [
            {
                "query": [
                    {
                        "variable": "../variables/de85b32/"
                    }
                ]
            },
            {
                "query": [
                    {
                        "variable": "../variables/398620f/"
                    }
                ]
            },
            {
                "query": [
                    {
                        "function": "bin",
                        "args": [
                            {
                                "variable": "../variables/398620f/"
                            }
                        ]
                    }
                ]
            }
        ]
    }
}
</code></pre>

<p>Each multi-table template may be a list of variable references and other information used to construct the dimension and transform its output.</p>

<h3 id="transforming-analyses-for-presentation">Transforming analyses for presentation</h3>

<p>The <code class="prettyprint">transform</code> member of an analysis specification (or multitable definition)
is a declarative definition of what the dimension should look like after
computation. The cube result dimension itself will always be derived from the
<code class="prettyprint">query</code> part of the request
(<code class="prettyprint">{variable: $variableId})</code>, <code class="prettyprint">{function: f, args: [$variableId, …]}</code>, &amp;c.,
after which clients should do what is necessary to arrive at the transformed
result — changing element names, orders, etc.</p>

<h4 id="structure">Structure</h4>

<p>A <code class="prettyprint">transform</code> can contain <code class="prettyprint">elements</code> or <code class="prettyprint">categoriees</code>, which is an array of
target transforms for output-dimension elements. Therefore to create a valid
element/category <code class="prettyprint">transform</code> it is generally necessary to make a cube query, inspect
the result dimension, and proceed from there. For categorical and multiple response
variables, elements may also be obtained from the variable entity.</p>

<p>Transforms are designed for variables that are more stable than not, with element ids
that inhere in the underlying elements, such as category or subvariable ids. Dynamic
elements such as results of <code class="prettyprint">bin</code>ning a numeric variable, may not be transformed.</p>

<p>Transformations stored on a variable’s <code class="prettyprint">view</code> are the default transforms for
that variable. They may be shorter, alternate versions of category names, or
contain insertions, described below.</p>

<h4 id="insertions">Insertions</h4>

<p>In addition to transforming the categories or elements already defined on
a cube ‘dimension’, it is possible to insert headings and subtotals to the
result. These <code class="prettyprint">insertions</code> are attached after an <code class="prettyprint">anchor</code> element/category id.</p>

<p>Insertions are processed <strong>last</strong>, after renaming, reordering, or sorting
elements according to the elements/categories transform specification. They
are “attached” to their anchor, always following it in the result; or, simply
appended to the end of the result. If the result is sorted by some column’s
value, it may make the most sense to choose to display insertions last, rather
than inserting them into a result table because their values will not be
considered when sorting the non-inserted elements themselves.</p>

<p>An insertion is defined by an anchor and a name, which will be displayed
alongside the names of categories/elements. It may also contain
<code class="prettyprint">&quot;function&quot;: { &quot;combine&quot;: []}</code>, where array arguments are the <code class="prettyprint">id</code>s of elements
to combine as “subtotals”.</p>

<p>Use an anchor of <code class="prettyprint">0</code> to indicate an insertion before other results. Any anchor
other than <code class="prettyprint">0</code> that does not match an id in the elements/categories will be
included at the end of results.</p>

<h4 id="examples">Examples</h4>

<p>Consider the following example result dimension:</p>

<table><thead>
<tr>
<th>Name</th>
<th>missing</th>
<th>id</th>
</tr>
</thead><tbody>
<tr>
<td>Element A</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>Element B</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>Element C</td>
<td></td>
<td>2</td>
</tr>
<tr>
<td>Don’t know</td>
<td></td>
<td>3</td>
</tr>
<tr>
<td>Not asked</td>
<td>true</td>
<td>4</td>
</tr>
</tbody></table>

<p>An element transform can specify a new order of output elements, new names,
and in the future, bases for hypothesis testing, result sorting, and
aggregation of results. A <code class="prettyprint">transform</code> has elements that look generally like
the dimension&rsquo;s extent, with some optional properties:</p>

<ul>
<li><strong>id</strong>: (required) id of the target element/category</li>
<li><strong>name</strong>: name of new target element/category</li>
<li><strong>sort</strong>: <code class="prettyprint">-1</code> or <code class="prettyprint">1</code> indicating to sort results descending or ascending by this element</li>
<li><strong>compare</strong>: <code class="prettyprint">neq</code>, <code class="prettyprint">leq</code>, <code class="prettyprint">geq</code> indicating to test other rows/columns against
the hypothesis that they are ≠, ≤, or ≥ to the present element</li>
<li><strong>hide</strong>: suppress this element&rsquo;s row/column from displaying at all. Defaults to false for valid elements, true for missing, so that if an element is added, it will be present until a transform with <code class="prettyprint">hide: true</code> is added to suppress it.</li>
</ul>

<p>A <code class="prettyprint">transform</code> with object members can do lots of things. Suppose we want to put <em>Element C</em> first,
hide the <em>Don’t know</em>, and more compactly represent the result as just <em>C, A, B</em>:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"hide"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span><span class="w">
    </span><span class="p">]}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="example-transform-in-a-saved-analysis">Example transform in a saved analysis</h4>

<p>In a saved analysis the transforms are an array in <code class="prettyprint">display_settings</code> with the same extents output dimensions (as well as, of course, the query used to generate them). This syntax makes a univariate table of a multiple response variable and re-orders the result.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"selections"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/398620f/"</span><span class="p">}]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/398620f/"</span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"display_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"f007"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My preferred first item"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fee7"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The zeroth response"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c001"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Third response"</span><span class="w">
            </span><span class="p">}],</span><span class="w">
            </span><span class="nt">"insertions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="nt">"anchor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fee7"</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Feet"</span><span class="p">,</span><span class="w"> </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"combine"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"f00t"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fee7"</span><span class="p">]}}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="example-transform-in-a-multitable-template">Example transform in a multitable template</h4>

<p>In a multitable, the <code class="prettyprint">transform</code> is part of each dimension definition object in the <code class="prettyprint">template</code> array.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A"</span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[{},</span><span class="w"> </span><span class="p">{}]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rollup"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B"</span><span class="p">}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="more-complex-multitable-templates">More complex multitable templates</h3>

<p>The template may contain in addition to variable references and their query arguments, an optional <code class="prettyprint">transform</code>:
To obtain their multiple output cubes, you <code class="prettyprint">GET datasets/{id}/cube?query=&lt;q&gt;</code> where <code class="prettyprint">&lt;q&gt;</code> is a ZCL object in JSON format (which must then be URI encoded for inclusion in the querystring). Use the &ldquo;each&rdquo; function to iterate over the overview variables’ <code class="prettyprint">query</code>, producing one output cube for each one as &ldquo;variable x&rdquo;. For example, to cross each of the above 3 variables against another variable &ldquo;449b421&rdquo;:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"each"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"de85b32"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"398620f"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c116a77"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"block"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"449b421"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The result will be an array of output cubes:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:cube"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"449b421"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"de85b32"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:cube"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"449b421"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"398620f"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:cube"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"449b421"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c116a77"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h2 id="versioning-datasets">Versioning Datasets</h2>

<aside class="notice">Experimental</aside>

<p>All Crunch datasets keep track of the changes you make to them, from the initial import, through name changes and deriving new variables, to appending new rows. You can review the changes to see who did what and when, revert to a previous version, &ldquo;fork&rdquo; a dataset to make a copy of it, make changes to the copy, and merge those changes back into the original dataset.</p>

<h3 id="actions">Actions</h3>

<p>The list of changes are available in the <code class="prettyprint">dataset/{id}/actions/</code> catalog. GET it and sort/filter by the &ldquo;datetime&rdquo; and/or &ldquo;user&rdquo; members as desired. Follow the links to an individual action entity to get exact details about what changed.</p>

<h4 id="viewing-changes-diff">Viewing Changes Diff</h4>

<p>Through the actions catalog it&rsquo;s possible to retrieve the differences of a &ldquo;fork&rdquo; dataset from its &ldquo;upstream&rdquo; dataset.</p>

<p>Two endpoints are provided to do so, the <code class="prettyprint">dataset/{id}/actions/since_forking</code> and the <code class="prettyprint">dataset/{id}/actions/upstream_delta</code> endpoints.</p>

<p>The <code class="prettyprint">dataset/{id}/actions/since_forking</code> endpoint will return the state of the fork and the upstream and the
the list of actions that were performed on the fork since the two diverged.</p>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">forkds</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">since_forking</span>
<span class="n">pycrunch</span><span class="o">.</span><span class="n">shoji</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
    <span class="s">"self"</span><span class="p">:</span> <span class="s">"https://app.crunch.io/api/datasets/051ebb979db44523822ffe29236a6670/actions/since_forking/"</span><span class="p">,</span>
    <span class="s">"value"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"dataset"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"modification_time"</span><span class="p">:</span> <span class="s">"2017-02-16T11:01:41.807000+00:00"</span><span class="p">,</span>
            <span class="s">"revision"</span><span class="p">:</span> <span class="s">"58a586950183667486130f0c"</span><span class="p">,</span>
            <span class="s">"id"</span><span class="p">:</span> <span class="s">"051ebb979db44523822ffe29236a6670"</span><span class="p">,</span>
            <span class="s">"name"</span><span class="p">:</span> <span class="s">"My fork"</span>
        <span class="p">},</span>
        <span class="s">"actions"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"hash"</span><span class="p">:</span> <span class="s">"2a863871-c809-4cad-a20c-9fea86b9e763"</span><span class="p">,</span>
                <span class="s">"state"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">"failed"</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                    <span class="s">"completed"</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                    <span class="s">"played"</span><span class="p">:</span> <span class="n">true</span>
                <span class="p">},</span>
                <span class="s">"params"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">"variable"</span><span class="p">:</span> <span class="s">"fab0c81d16b442089cc50019cf610961"</span><span class="p">,</span>
                    <span class="s">"definition"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s">"alias"</span><span class="p">:</span> <span class="s">"var1"</span><span class="p">,</span>
                        <span class="s">"type"</span><span class="p">:</span> <span class="s">"text"</span><span class="p">,</span>
                        <span class="s">"name"</span><span class="p">:</span> <span class="s">"var1"</span><span class="p">,</span>
                        <span class="s">"id"</span><span class="p">:</span> <span class="s">"fab0c81d16b442089cc50019cf610961"</span>
                    <span class="p">},</span>
                    <span class="s">"dataset"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s">"id"</span><span class="p">:</span> <span class="s">"051ebb979db44523822ffe29236a6670"</span><span class="p">,</span>
                        <span class="s">"branch"</span><span class="p">:</span> <span class="s">"master"</span>
                    <span class="p">},</span>
                    <span class="s">"values"</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s">"sample sentence"</span><span class="p">,</span>
                        <span class="s">"sample sentence"</span><span class="p">,</span>
                        <span class="s">"sample sentence"</span><span class="p">,</span>
                        <span class="s">"sample sentence"</span><span class="p">,</span>
                        <span class="s">"sample sentence"</span><span class="p">,</span>
                        <span class="s">"sample sentence"</span><span class="p">,</span>
                        <span class="s">"sample sentence"</span>
                    <span class="p">],</span>
                    <span class="s">"owner_id"</span><span class="p">:</span> <span class="n">null</span>
                <span class="p">},</span>
                <span class="s">"key"</span><span class="p">:</span> <span class="s">"Variable.create"</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s">"upstream"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"modification_time"</span><span class="p">:</span> <span class="s">"2017-02-16T11:01:40.131000+00:00"</span><span class="p">,</span>
            <span class="s">"revision"</span><span class="p">:</span> <span class="s">"58a586940183667486130efc"</span><span class="p">,</span>
            <span class="s">"id"</span><span class="p">:</span> <span class="s">"2730c0744cba4d7c9acc9f3551380e49"</span><span class="p">,</span>
            <span class="s">"name"</span><span class="p">:</span> <span class="s">"My Dataset"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">"element"</span><span class="p">:</span> <span class="s">"shoji:view"</span>
<span class="p">})</span>
</code></pre>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/api/datasets/5de96a/actions/since_forking</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">1769</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-02-16T11:01:41.807000+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"revision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"58a586950183667486130f0c"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"051ebb979db44523822ffe29236a6670"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My fork"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"hash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2a863871-c809-4cad-a20c-9fea86b9e763"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"failed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"completed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"played"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fab0c81d16b442089cc50019cf610961"</span><span class="p">,</span><span class="w">
                    </span><span class="nt">"definition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"var1"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"var1"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fab0c81d16b442089cc50019cf610961"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"051ebb979db44523822ffe29236a6670"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"branch"</span><span class="p">:</span><span class="w"> </span><span class="s2">"master"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="s2">"sample sentence"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"sample sentence"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"sample sentence"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"sample sentence"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"sample sentence"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"sample sentence"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"sample sentence"</span><span class="w">
                    </span><span class="p">],</span><span class="w">
                    </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Variable.create"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"upstream"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-02-16T11:01:40.131000+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"revision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"58a586940183667486130efc"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2730c0744cba4d7c9acc9f3551380e49"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My Dataset"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The <code class="prettyprint">dataset/{id}/actions/upstream_delta</code> endpoint usage and response matches the one of
the other endpoint, but the returned actions are instead the ones that were performed
on the upstream since the two diverged.</p>

<h3 id="savepoints">Savepoints</h3>

<p>You can snapshot the current state of the dataset at any time with a POST to
<code class="prettyprint">datasets/{id}/savepoints/</code>. This marks the current point in the actions
history, allowing you to provide a description of your progress.</p>

<p>The response will contain a Location header that will lead to the new version created.</p>

<p>In case creating the new version can be created fast enough a 201 response will be issued,
when the new version takes too long a 202 response will be issued and the creation will proceed in background.
In case of a 202 response the body will be a Shoji:view containing a progress URL 
where you may query the progress.</p>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">svp</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">savepoints</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s">"body"</span><span class="p">:</span> <span class="p">{</span><span class="s">"description"</span><span class="p">:</span> <span class="s">"TestSVP"</span><span class="p">}})</span>
<span class="n">pycrunch</span><span class="o">.</span><span class="n">shoji</span><span class="o">.</span><span class="n">Entity</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
    <span class="s">"body"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"creation_time"</span><span class="p">:</span> <span class="s">"2017-05-09T14:18:07.761000+00:00"</span><span class="p">,</span> 
        <span class="s">"version"</span><span class="p">:</span> <span class="s">"master__000003"</span><span class="p">,</span> 
        <span class="s">"user_name"</span><span class="p">:</span> <span class="s">"captain-68305620"</span><span class="p">,</span> 
        <span class="s">"description"</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> 
        <span class="s">"last_update"</span><span class="p">:</span> <span class="s">"2017-05-09T14:18:07.761000+00:00"</span>
    <span class="p">},</span> 
    <span class="s">"self"</span><span class="p">:</span> <span class="s">"http://local.crunch.io:19404/api/datasets/5283e3f4e3d645c0a750c09e854bdcb1/savepoints/6fbe47c97d8e4290a0c09227d6d6b63a/"</span><span class="p">,</span> 
    <span class="s">"views"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"revert"</span><span class="p">:</span> <span class="s">"http://local.crunch.io:19404/api/datasets/5283e3f4e3d645c0a750c09e854bdcb1/savepoints/6fbe47c97d8e4290a0c09227d6d6b63a/revert/"</span>
    <span class="p">},</span> 
    <span class="s">"element"</span><span class="p">:</span> <span class="s">"shoji:entity"</span>
<span class="p">})</span>
</code></pre>

<p>There is no guarantee that creating a savepoint will lead to a savepoint that points
to the exact revision the dataset was when the POST was issued. This is because
the dataset might have moved forward in the meanwhile. For this reason instead
of reponding with a <code class="prettyprint">Location</code> header that points to an exact savepoint, the
POST savepoints endpoint will respond with <code class="prettyprint">Location</code> header that points to 
<code class="prettyprint">/progress/{operation_id}/result</code> URL, which when accessed will
redirect to the nearest savepoint for that revision.</p>

<h4 id="reverting-savepoints">Reverting savepoints</h4>

<p>You can revert to any savepoint version (throwing away any changes since that
time) with a POST to <code class="prettyprint">/datasets/{dataset_id}/savepoints/{version_id}/revert/</code>.</p>

<p>It will return a 202 response with a Shoji:view containing a progress URL on
its value where the asynchronous job&rsquo;s status can be observed.</p>

<h3 id="forking-and-merging">Forking and Merging</h3>

<p>A common pattern when collaborating on a dataset is for one person to make changes on their own and then, when all is ready, share the whole set of changes back to the other collaborators. Crunch implements this with two mechanisms: the ability to &ldquo;fork&rdquo; a dataset to make a copy, and then &ldquo;merge&rdquo; any changes made to it back to the original dataset.</p>

<p>To fork a dataset, POST a new fork entity to the dataset&rsquo;s forks catalog.</p>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">forks</span><span class="o">.</span><span class="n">index</span>
<span class="p">{}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">forked_ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">forks</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s">"body"</span><span class="p">:</span> <span class="p">{</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"My fork"</span><span class="p">}})</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">forks</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="n">forked_ds</span><span class="o">.</span><span class="bp">self</span><span class="p">]</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">forks</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">forked_ds</span><span class="o">.</span><span class="bp">self</span><span class="p">][</span><span class="s">"name"</span><span class="p">]</span>
<span class="s">"My fork"</span>
</code></pre>

<p>The response will be a 201 response if the fork could happen in the allotted time limit for the request or a 202 if the fork requires too much time and is going to continue in background.
Both cases will include a Location header with the URL of the new dataset that has been forked from the current one.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/{id}/forks/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">231</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My fork"</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">----</span><span class="w">

</span><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">201</span><span class="w"> </span><span class="err">Created</span><span class="w">
</span><span class="err">Location:</span><span class="w"> </span><span class="err">https://app.crunch.io/api/datasets/</span><span class="p">{</span><span class="err">forked_id</span><span class="p">}</span><span class="err">/</span><span class="w">
</span></code></pre>

<p>In case of a 202, in addition to the Location headers with the URL of the fork that is going to be created, the response will contain a Shoji view with the url of the endpoint that can be polled
to track fork completion</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/{id}/forks/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">231</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My fork"</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">----</span><span class="w">

</span><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">202</span><span class="w"> </span><span class="err">Accepted</span><span class="w">
</span><span class="err">Location:</span><span class="w"> </span><span class="err">https://app.crunch.io/api/datasets/</span><span class="p">{</span><span class="err">forked_id</span><span class="p">}</span><span class="err">/</span><span class="w">
</span><span class="err">...</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/progress/{progress_id}/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The forked dataset can then be viewed and altered like the original; however, those changes do not alter the original until you merge them back with a POST to <code class="prettyprint">datasets/{id}/actions/</code>.</p>
<pre class="highlight python"><code><span class="n">ds</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">post</span><span class="p">({</span>
    <span class="s">"element"</span><span class="p">:</span> <span class="s">"shoji:entity"</span><span class="p">,</span>
    <span class="s">"body"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dataset"</span><span class="p">:</span> <span class="n">forked_ds</span><span class="o">.</span><span class="bp">self</span><span class="p">,</span> <span class="s">"autorollback"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="p">})</span>
</code></pre>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/5de96a/actions/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">231</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">forked</span><span class="w"> </span><span class="err">ds</span><span class="w"> </span><span class="err">URL</span><span class="p">},</span><span class="w">
        </span><span class="nt">"autorollback"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">----</span><span class="w">

</span><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">204</span><span class="w"> </span><span class="err">No</span><span class="w"> </span><span class="err">Content</span><span class="w">

</span><span class="err">*or*</span><span class="w">

</span><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">202</span><span class="w"> </span><span class="err">Accepted</span><span class="w">
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5de96a/actions/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/progress/912ab3/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The POST to the actions catalog tells the original dataset to replay a set of
actions; since we specify a &ldquo;dataset&rdquo; url, we are telling it to replay all
actions from the forked dataset. Crunch keeps track of which actions are
already common between the two datasets, and won&rsquo;t try to replay those. You can
even make further changes to the forked dataset and merge again and again.</p>

<p>Use the &ldquo;autorollback&rdquo; member to tell Crunch how to handle merge conflicts. If
an action cannot be replayed on the original dataset (typically because it 
had conflicting changes or has been rolled back), then if &ldquo;autorollback&rdquo; is 
true (the default), the original dataset will be reverted to the previous 
state before any of the new changes were applied. If &ldquo;autorollback&rdquo; is false, 
the dataset is left to the last action that it could successfully play, 
which allows you to investigate the problem, repair it if possible (in either dataset as needed), 
and then POST again to continue the merge from that point.</p>

<p>Per-user settings (filters, decks and slides, variable permissions etc) are copied to the new dataset when you fork. However, changes to them are not merged back at this time. Please reach out to us as you experiment so we can fine-tune which details to fork and merge as we discover use cases.</p>

<p>Merging actions may take a few seconds, in which case the POST to actions/ will return 204 when finished. Merging many or large actions, however, may take longer, in which case the POST will return 202 with a Location header containing the URL of a <a href="#progress">progress resource</a>.</p>

<h4 id="filtered-merges">Filtered Merges</h4>

<p>When merging actions it is possible to provide a filter to select which actions should
be replayed from the other dataset. It is currently possible to filter them by <code class="prettyprint">key</code> and by <code class="prettyprint">hash</code>.</p>

<p>When filtering by <code class="prettyprint">hash</code>, only the provided actions will be merged:</p>
<pre class="highlight python"><code><span class="n">ds</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">post</span><span class="p">({</span>
    <span class="s">"element"</span><span class="p">:</span> <span class="s">"shoji:entity"</span><span class="p">,</span>
    <span class="s">"body"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dataset"</span><span class="p">:</span> <span class="n">forked_ds</span><span class="o">.</span><span class="bp">self</span><span class="p">,</span>
             <span class="s">"filter"</span><span class="p">:</span> <span class="p">{</span><span class="s">"hash"</span><span class="p">:</span> <span class="p">[</span><span class="s">"000003"</span><span class="p">]}}</span>
<span class="p">})</span>
</code></pre>

<p>When filtering by <code class="prettyprint">key</code>, only the actions that are part of that category will be merged:</p>
<pre class="highlight python"><code><span class="n">ds</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">post</span><span class="p">({</span>
    <span class="s">"element"</span><span class="p">:</span> <span class="s">"shoji:entity"</span><span class="p">,</span>
    <span class="s">"body"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dataset"</span><span class="p">:</span> <span class="n">forked_ds</span><span class="o">.</span><span class="bp">self</span><span class="p">,</span>
             <span class="s">"filter"</span><span class="p">:</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Variable.create"</span><span class="p">]}}</span>
<span class="p">})</span>
</code></pre>

<h5 id="recording-the-filtered-actions">Recording the filtered actions</h5>

<p>If you know that you are going to merge from the same two datasets multiple times
it is possible to tell crunch to remember the filtered actions so that a subsequent
merge to the same target won&rsquo;t try to apply them again if they were skipped in a previous merge.</p>

<p>This behaviour can be changed by providing <code class="prettyprint">remember: True</code> option to the filter,
which means that the filtered actions will be recorded and a subsequent merge won&rsquo;t
try to apply them to the target if they are not explicitly filtered again.</p>
<pre class="highlight python"><code><span class="n">ds</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">post</span><span class="p">({</span>
    <span class="s">"element"</span><span class="p">:</span> <span class="s">"shoji:entity"</span><span class="p">,</span>
    <span class="s">"body"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dataset"</span><span class="p">:</span> <span class="n">forked_ds</span><span class="o">.</span><span class="bp">self</span><span class="p">,</span>
             <span class="s">"remember"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
             <span class="s">"filter"</span><span class="p">:</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Variable.create"</span><span class="p">]}}</span>
<span class="p">})</span>
</code></pre>

<p>Note that only the actions skipped during this merge are recorded, so the previous example
won&rsquo;t skipp all the <code class="prettyprint">Variable.create</code> actions forever, but will only remember the action
that was skipped at that time.</p>

          <h1 id="endpoint-reference">Endpoint Reference</h1>

          <h2 id="public">Public</h2>

<p><code class="prettyprint">/</code></p>

<p><code class="prettyprint">/public/</code></p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"signup_resend"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/public/signup_resend/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"inquire"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/public/inquire/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"password_reset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/public/password_reset/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"signup"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/public/signup/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"oauth2redirect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/public/oauth2redirect/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"change_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/public/change_email/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"login"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/public/login/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"config"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/public/config/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"password_change"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/public/password_change/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="application-configuration">Application configuration</h3>

<p><code class="prettyprint">GET /public/config/</code></p>

<p>When accessing Crunch from a configured application via its subdomain:</p>

<ul>
<li>https://mycompany.crunch.io/api/public/config/</li>
</ul>

<p>A GET request on <code class="prettyprint">/public/config/</code> return a Shoji Entity with the
subdomain&rsquo;s available configurations, if any; if none exists, the body will be empty.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Your Company"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"logo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"small"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://s.crunch.io/logos/yours_small.png"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"large"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://s.crunch.io/logos/yours_large.png"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"palette"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"brand"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"primary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#FFAABB"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"secondary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#G4EEBB"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#BAA5E7"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"manifest"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="crunchbox">Crunchbox</h3>

<p>A CrunchBox represents a snapshot of a crunch dataset. These snapshots are
intended for public proliferation and therefore the endpoints for interacting with
this data is housed under the unauthed API path.</p>

<h4 id="share">Share</h4>

<p>The share endpoint is for retrieving the HTML code for rendering the share page, complete
with the meta data utilized by social sharing platform crawlers in constructing
a share-preview. Among this metadata is a url to a preview image of the rendered crunchbox.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/crunchbox/share/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<p>Required parameters for this endpoint:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>data</td>
<td>string</td>
<td>crunchbox widget url (URL encoded)<br>e.g. &ldquo;https%3A%2F%2Fs.crunch.io%2Fwidget%2Findex.html%23%2Fds%2Fa1b2c3d4e5f6g7h8%2Frow%2F000001%2Fcolumn%2F000000&rdquo; (the encoded string of &ldquo;https://s.crunch.io/widget/index.html#/ds/a1b2c3d4e5f6g7h8/row/000001/column/000000&rdquo;)</td>
</tr>
</tbody></table>

<p>Optional parameters for this endpoint:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ref</td>
<td>string</td>
<td>referring url (URL encoded) to pull content from the referring page for inclusion on the crunchbox share page and provide a link back to the referrer<br>e.g. &ldquo;http%3A%2F%2Fcrunch.io%2Fcrunching-the-data-of-politics&rdquo; (the encoded string of &ldquo;http://crunch.io/crunching-the-data-of-politics&rdquo;)</td>
</tr>
</tbody></table>

<h4 id="preview">Preview</h4>

<p>The preview endpoint is used to preemptively initiate rendering a given crunchbox configuration to a raster image. This image will be requested by social network platform crawlers during construction of the post share preview. The preview-rendering process can be time-consuming. Therefore, it is preferable to initiate it as soon as is reasonable before a request for the image data.</p>

<p>This endpoint returns no data.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/crunchbox/preview/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>data</td>
<td>string</td>
<td>crunchbox widget url (URL encoded)<br>e.g. &ldquo;https%3A%2F%2Fs.crunch.io%2Fwidget%2Findex.html%23%2Fds%2Fa1b2c3d4e5f6g7h8%2Frow%2F000001%2Fcolumn%2F000000&rdquo; (the encoded string of &ldquo;https://s.crunch.io/widget/index.html#/ds/a1b2c3d4e5f6g7h8/row/000001/column/000000&rdquo;)</td>
</tr>
</tbody></table>

          <h2 id="accounts">Accounts</h2>

<p>Accounts provide an organization-level scope for Crunch.io customers. All Users
belong to one and only one Account. Account managers can administer their
various users and entities and have visibility on them.</p>

<h3 id="permissions">Permissions</h3>

<p>A user is an &ldquo;account manager&rdquo; if their <code class="prettyprint">account_permissions</code> have
<code class="prettyprint">alter_users</code> set to <code class="prettyprint">True</code>.</p>

<h3 id="account-entity">Account entity</h3>

<p>The account entity is available on the API root following the Shoji
<code class="prettyprint">views.account</code> path, which will point to the authenticated user&rsquo;s account.</p>

<p>If the account has a name, it will be available here, as well as the path to the
account&rsquo;s users.</p>

<p>If the authenticated user is an account manager, the response will include
paths to these additional catalogs:
 * Account projects
 * Account teams
 * Account datasets</p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="err">GET /account/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Account's name"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abcd"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"oauth_providers"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"provider"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Service auth"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"provider"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Service auth"</span><span class="w">
    </span><span class="p">}]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"catalogs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"teams"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/account/teams/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"projects"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/account/projects/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"users"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/account/users/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"datasets"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/account/datasets/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"applications"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/account/applications/"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="applications">Applications</h4>
<pre class="highlight http"><code><span class="err">GET /account/applications/
</span></code></pre>

<p>GET returns a Shoji Catalog with the list of all the configured subdomains an account has.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"./mycompany/"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>POST a Shoji Entity here to make a new application. The <code class="prettyprint">subdomain</code>:</p>

<ul>
<li>must be unique system-wide, case insensitive</li>
<li>can only contain letters, numbers, and <code class="prettyprint">-</code> (dash)</li>
<li>must be between 3 and 32 characters in length</li>
<li>cannot start with <code class="prettyprint">-</code> or a number</li>
</ul>

<p>If the requested subdomain is unavailable or invalid, the server will return a 400 response.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my company"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"subdomain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mycompany"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"palette"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"brand"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"primary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#FFAABB"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Color</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">links,</span><span class="w"> </span><span class="err">interactable</span><span class="w"> </span><span class="err">things</span><span class="w">
                </span><span class="nt">"secondary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#G4EEBB"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Titles</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">such</span><span class="w">
                </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#BAA5E7"</span><span class="w">
            </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"manifest"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Attributes <code class="prettyprint">name</code> and <code class="prettyprint">subdomain</code> are required; <code class="prettyprint">palette</code> and <code class="prettyprint">manifest</code> are optional. Note that you cannot specify logos in the POST request. Use the created entity&rsquo;s <code class="prettyprint">logo/</code> resource to upload the image files to the
app (see below).</p>

<h5 id="application-entity">Application entity</h5>
<pre class="highlight http"><code><span class="err">GET /account/applications/app_id/
</span></code></pre>

<p>GET this endpoint for a Shoji Entity containing all details about
the configured application.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Application name"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"subdomain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mycompany"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"logos"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"small"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;URL&gt;"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"large"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;URL&gt;"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"favicon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;URL&gt;"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"palette"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"brand"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"primary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#FFAABB"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Color</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">links,</span><span class="w"> </span><span class="err">interactable</span><span class="w"> </span><span class="err">things</span><span class="w">
                </span><span class="nt">"secondary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#G4EEBB"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Titles</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">such</span><span class="w">
                </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#BAA5E7"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"manifest"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"logo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/account/applications/mycompany/logo/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>PATCH this endpoint to change the name, palette, or manifest. Logos are controlled by the logo subresource.</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the configured application on the given subdomain</td>
</tr>
<tr>
<td>logo</td>
<td>object</td>
<td>Contains two attributes, <code class="prettyprint">large</code>, <code class="prettyprint">small</code> and <code class="prettyprint">favicon</code>, with different resolution company logos</td>
</tr>
<tr>
<td>palette</td>
<td>object</td>
<td>Contains three colors, <code class="prettyprint">primary</code>, <code class="prettyprint">secondary</code> and <code class="prettyprint">message</code>, under the <code class="prettyprint">brand</code> attribute to theme the web app</td>
</tr>
<tr>
<td>manifest</td>
<td>object</td>
<td>Optional, contains further client configurations</td>
</tr>
</tbody></table>

<h5 id="change-application-logo">Change application logo</h5>
<pre class="highlight http"><code><span class="err">POST /account/applications/app_id/logo/
</span></code></pre>

<p>To set/change an application&rsquo;s logo the client needs to make a <code class="prettyprint">multipart/form-data</code>
request containing either or both <code class="prettyprint">large</code> and <code class="prettyprint">small</code> fields containing the desired
image files to use. Only account admins are authorized to change this resource.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/account/applications/app_id/logo/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">multipart/form-data; boundary=----------123456789</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">500326</span>

----------123456789
Content-Disposition: form-data; name="large"; filename="newlogo.jpg"
Content-Type: image/jpeg

xxxxxxxxxx
----------123456789
Content-Disposition: form-data; name="small"; filename="newlogo_small.jpg"
Content-Type: image/jpeg

xxxxxxxxxx
----------123456789--
</code></pre>
<pre class="highlight http"><code><span class="err">HTTP/1.1 204
</span></code></pre>

<p>The server will update the images accordingly. The only valid file extensions 
are GIF, JPEG and PNG image files.</p>

<h3 id="account-users">Account users</h3>

<p>Provides a catalog of all the users that belong to this account. Any account
member can GET, but only account managers can POST/PATCH on it.</p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="err">GET /account/users/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/123/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id_method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pwhash"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id_provider"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email@example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Steve Austin"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"account_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alter_users"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"create_datasets"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/234/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id_method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pwhash"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id_provider"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email1@example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shawn Michaels"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"account_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alter_users"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"create_datasets"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/345/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id_method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oauth"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id_provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"google"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email2@example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rocky Maivia"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"account_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alter_users"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"create_datasets"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="post">POST</h4>

<p>Account members can POST to the account&rsquo;s users catalog to create new users.
If the a user with the provided email address already exists in the application
(on another account), the server will return a 400 response.</p>
<pre class="highlight http"><code><span class="err">POST /account/users/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new_email@example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Initial name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"account_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alter_users"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"create_datasets"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"teams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"&lt;list of team urls&gt;"</span><span class="p">],</span><span class="w">
      </span><span class="nt">"projects"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"&lt;list of project urls&gt;"</span><span class="p">],</span><span class="w">
      </span><span class="nt">"id_method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pwhash/oauth"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id_provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"send_invite"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"url_base"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>It is possible to create a user to belong to different teams or projects by 
including those teams or projects&rsquo; urls in the payload, for example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new_email@example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Initial name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"account_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alter_users"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"create_datasets"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"teams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://app.crunch.io/api/teams/abc/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/teams/123/"</span><span class="p">],</span><span class="w">
      </span><span class="nt">"projects"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://app.crunch.io/api/projects/def/"</span><span class="p">],</span><span class="w">
      </span><span class="nt">"id_method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pwhash"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The <code class="prettyprint">teams</code> and <code class="prettyprint">projects</code> attributes are optional and can be omited or empty
lists. </p>

<h4 id="patch">PATCH</h4>

<p>PATCH to the users&rsquo; catalog allows account admins to edit users&rsquo; permissions
in batch. It is only possible to change the <code class="prettyprint">account_permissions</code> attribute.
Additionally, it is possible to delete users from the account by sending <code class="prettyprint">null</code>
as their tuple.</p>
<pre class="highlight http"><code><span class="err">PATCH /account/users/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/123/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"account_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"alter_users"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"create_datasets"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/234/"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="account-datasets">Account datasets</h3>

<p>Only account managers have access to this catalog. It is a read only shoji
catalog containing all the datasets that users of this account have
created (potentially very large catalog).</p>

<p>Account managers have implicit editor access to all the account datasets.</p>
<pre class="highlight http"><code><span class="err">GET /account/datasets/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/cc9161/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"James T. Kirk"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Voyage Home"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stardate 8390"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"archived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span><span class="w">
                </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">67</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"is_published"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cc9161"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/685722/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2286"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"streaming"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1986-11-26T12:05:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1986-11-26T12:05:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/ff9443/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Leonard Nimoy"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/a598c7/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Spock"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Wrath of Khan"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nt">"archived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"is_published"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a598c7"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/af432c/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2285-10-03"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2285-10-20"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"streaming"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-06-04T09:16:23.231045"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-06-04T09:16:23.231045"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor_name"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="account-projects">Account projects</h3>

<p>This catalog is available for account managers and lists all the projects
that the users have created. Account managers have implicit edit access on all
projects.</p>
<pre class="highlight http"><code><span class="err">GET /account/projects/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/projects/cc9161/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Project 1"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cc9161"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/users/abcdef/"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/projects/a598c7/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Project 2"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a598c7"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/users/123456/"</span><span class="w">
        </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="account-teams">Account teams</h3>

<p>This catalog is available for account managers and lists all the teams
that the users have created. Account managers have implicit edit access on all
teams.</p>
<pre class="highlight http"><code><span class="err">GET /account/teams/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/teams/cc9161/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Team 1"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cc9161"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/users/123456/"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/teams/a598c7/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Team 2"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a598c7"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/users/123456/"</span><span class="w">
        </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="account-collaborators">Account Collaborators</h3>

<p>An account collaborator is a Crunch.io user that is not a member of your account
and has access to some/any of your account&rsquo;s datasets.</p>

<p>Account admins can visit the account&rsquo;s collaborators catalog to view the list
of all collaborators for all datasets of the account.</p>
<pre class="highlight http"><code><span class="err">GET /account/collaborators/
</span></code></pre>

<p>This catalog lists all the users that are not members of the account that have
access to any of the account&rsquo;s datasets, projects or teams.</p>

<p>Each element in the catalog tuple links to the user&rsquo;s entity endpoint and 
has the name and email attribute.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/cc9161/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John doe"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user1@example.com"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="p">,</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/a598c7/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John notdoe"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user2@example.com"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="err">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="collaborators-order">Collaborators order</h4>
<pre class="highlight http"><code><span class="err">GET /account/collaborators/order/
</span></code></pre>

<p>It is possible to group collaborators using a Shoji order.</p>

<p>It is possible to PATCH the <code class="prettyprint">graph</code> attribute with a standard shoji order payload
indicating the groups and collaborators (user URLs) for each group.</p>

<h4 id="collaborators-datasets">Collaborators datasets</h4>

<p>The full list of datasets a collaborator has access to is available through
its user&rsquo;s entity endpoint by following the <code class="prettyprint">visible_datasets</code> catalog.</p>

          <h2 id="batches">Batches</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/batches/</code></p>

<h4 id="get">GET</h4>

<p>A GET request on this resource returns a Shoji Catalog enumerating the batches present in the Dataset. Each tuple in the index includes a &ldquo;status&rdquo; member, which may be one of &ldquo;analyzing&rdquo;, &ldquo;conflict&rdquo;, &ldquo;error&rdquo;, &ldquo;importing&rdquo;, &ldquo;imported&rdquo;, or &ldquo;appended&rdquo;.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"...datasets/837498a/batches/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"0/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"appended"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"2/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"3/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"importing"</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="post">POST</h4>

<p>A POST to this resource adds a new batch. The request payload can contain (1) the URL of another Dataset, (2) the URL of a Source object, or (3) a Crunch Table definition with variable metadata, row data, or both.</p>

<p>A successful request will return either 201 status, if sufficiently fast, or 202, if the task is large enough to require processing outside of the request cycle. In both cases, the newly created batch entity&rsquo;s URL is returned in the Location header. The 202 response contains a body with a Progress resource in it; poll that URL for updates on the completion of the append. See <a href="#progress">Progress</a>.</p>

<p>Batches are created in <code class="prettyprint">analyzing</code> state and will be advanced through <code class="prettyprint">importing</code>, <code class="prettyprint">imported</code>, and <code class="prettyprint">appended</code> states if there are no problems. If there was a problem in processing it, its status will be <code class="prettyprint">conflict</code> or <code class="prettyprint">error</code>. Note that the response status code will always be 202 for asynchronous or 201 for synchronous creation of the batch whether there were conflicts or not. So you need to GET the new batch&rsquo;s URL to see if the data is good to go (status <code class="prettyprint">appended</code>).</p>

<p>If an append is already in process on the dataset, the POST request will return 409 status.</p>

<h5 id="appending-a-dataset">Appending a dataset</h5>

<p>To append a Dataset, POST a Shoji Entity with a dataset URL. You must have at least view (read) permissions on this dataset. Internally, this action will create a Source entity pointing to that dataset.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The variables from the incoming dataset to be included by default will depend
on the current user&rsquo;s permissions. Those with edit permissions on the incoming dataset will
append all public and hidden (<code class="prettyprint">discarded = true</code>) variables. Those with only view permissions will
 just include public variables that aren&rsquo;t hidden.</p>

<p>To append only certain variables from the incoming dataset, include an <code class="prettyprint">where</code> attribute in the entity body. See <a href="#frame-functions">Frame functions</a> for how to compose the <code class="prettyprint">where</code> expression.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"function"</span><span class="p">:</span><span class="s2">"select"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="nt">"map"</span><span class="p">:</span><span class="w">
                    </span><span class="p">{</span><span class="nt">"000001"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">},</span><span class="w">
                     </span><span class="nt">"000002"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">}}</span><span class="w">
                </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Users with edit permissions on the incoming dataset can select hidden variables to be included, but viewers cannot. Editors and viewers can however both specify their personal variables to be included.</p>

<p>To select a subset of rows to append, include an <code class="prettyprint">filter</code> attribute in the entity body, containing a Crunch filter expression.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"function"</span><span class="p">:</span><span class="s2">"select"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="nt">"map"</span><span class="p">:</span><span class="w">
                    </span><span class="p">{</span><span class="nt">"000001"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">},</span><span class="w">
                     </span><span class="nt">"000002"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">}}</span><span class="w">
                </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"function"</span><span class="p">:</span><span class="s2">"&lt;"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;value&gt;"</span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">  
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="appending-a-source">Appending a source</h5>

<p>POST a Shoji Entity with a Source URL. The user must have permission to view the Source entity. Use Source appending to send data in CSV format that matches the schema of the Dataset.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="appending-a-crunch-table">Appending a Crunch Table</h5>

<p>The variables IDs must match those of the target dataset since their types will be matched based on ID. The data is expected to match the target dataset&rsquo;s variable types. This action will create a new Source entity, its name and description will match those provided on the JSON response, if not provided they&rsquo;ll default to empty string.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:table"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;optional string&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;optional string&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"var_url_1"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">],</span><span class="w">
      </span><span class="nt">"var_url_2"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="append-failures">Append Failures</h5>

<p>For single appends, if a batch fails, the dataset will be automatically reverted
back to the state it was before the append; the batch is automatically deleted.</p>

<p>When multiple appends are performed in immediate succession, it&rsquo;s not efficient
to checkpoint the state of each one. In this case, only the first append is
rolled back on failure.</p>

<h4 id="checking-if-an-append-will-cause-problems">Checking if an append will cause problems</h4>

<p><code class="prettyprint">/datasets/{id}/batches/compare/</code></p>

<p>An append cannot proceed if there are any conditions in the involved datasets
that will cause ambiguous situations. If such datasets were to be appended
the server will return a 409 response.</p>

<p>It is possible to verify these conditions before trying the append using
the batches compare endpoint.</p>
<pre class="highlight plaintext"><code>GET /datasets/4bc6af/batches/compare/?dataset=http://app.crunch.io/api/datasets/3e2cfb/
</code></pre>

<p>The response will contain a conflicts key that can contain either <code class="prettyprint">current</code>,
<code class="prettyprint">incoming</code> or <code class="prettyprint">union</code> depending on the type and location of the problem. The response status
will always be 200, with conflicts, described below, or an empty body.</p>

<ul>
<li><code class="prettyprint">current</code> refers to issues find on the dataset where new data would be added</li>
<li><code class="prettyprint">incoming</code> has issues on the far dataset that contains the new data to add</li>
<li><code class="prettyprint">union</code> expresses problems on the combined variables(metadata) of the final dataset after append.</li>
</ul>
<pre class="highlight json"><code><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nt">"union"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
    </span><span class="nt">"current"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
    </span><span class="nt">"incoming"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>

<p>A successful response will not contain any of the keys returning an empty object.</p>
<pre class="highlight json"><code><span class="w">
</span><span class="p">{}</span><span class="w">

</span></code></pre>

<p>The possible keys in the conflicts and verifications made are:</p>

<ul>
<li><strong>Variables missing alias</strong>: All variables should have a valid alias string. This will indicate the IDs of those that don’t.</li>
<li><strong>Variables missing name</strong>:  All variables should have a valid name string. This will indicate the IDs of those that don’t.</li>
<li><strong>Variables with duplicate alias</strong>: In the event of two or more variables sharing an alias, they will be reported here. When this occurs as a <em>union</em> conflict, it is likely that names and aliases of a variable or subvariable in <em>current</em> and <em>incoming</em> are swapped (e.g., VariantOne:AliasOne, Variant1:Alias1 in current but VariantOne:Alias1, Variant1:AliasOne in incoming).</li>
<li><strong>Variables with duplicate name</strong>: Variable names should be unique across non subvariables.</li>
<li><strong>Subvariable in different arrays per dataset</strong>: If a subvariable is used for different arrays that are impossible to match, it will be reported here. User action will be needed to fix this.</li>
</ul>

<p>For each of these, a list of variable IDs will be made available indicating the
conflicting entities. <em>Union</em> conflicting ids generally refer to variables in
the <em>current</em> dataset and may be referenced by alias in <em>incoming</em>.</p>

<h4 id="lining-up-datasets-for-append-combine">Lining up datasets for append/combine</h4>

<p><code class="prettyprint">/datasets/align/</code></p>

<p>Given that some datasets may be close to being fit for appending but could need
some work before proceeding, the <code class="prettyprint">align</code> endpoint provides API expressions
that can be used directly on the append steps as <code class="prettyprint">where</code> parameter in order
to avoid such conflicts.</p>

<p>Currently, this endpoint will provide an expression that will exclude the 
troubling variables from the append.</p>

<ul>
<li>Exclude different arrays that may share subvariables by alias. </li>
<li>Exclude variables with matching aliases but different types.</li>
</ul>

<p>Those are currently not allowed and would reject the append operation.</p>

<p>To use this endpoint, the client needs to provide a list of variables they wish
to line up together as a list of lists.</p>
<pre class="highlight json"><code><span class="w">
</span><span class="p">[</span><span class="w">
  </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/abc/variables/123/"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/def/variables/234/"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/hij/variables/345/"</span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/abc/variables/678/"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/def/variables/789/"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/hij/variables/890/"</span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/abc/variables/1ab/"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/def/variables/ab2/"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/hij/variables/b23/"</span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">]</span><span class="w">

</span></code></pre>

<p>The example above indicates that the client wishes to line up three variables
from three datasets as indicated by the groups. </p>

<p>From the input, the endpoint wil analyze the groups and return an expression 
which will only include those variables that can be appended without conflict
among all of them. This expression is ready to be used as a <code class="prettyprint">where</code> parameter
on the append <code class="prettyprint">/batches/</code> endpoint.</p>

<p>The payload needs to be sent as JSON encoded <code class="prettyprint">variables</code> POST parameter:</p>
<pre class="highlight http"><code><span class="err">POST /datasets/align/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
</span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
</span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"variables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/abc/variables/123/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/def/variables/234/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/hij/variables/345/"</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/abc/variables/678/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/def/variables/789/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/hij/variables/890/"</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/abc/variables/1ab/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/def/variables/ab2/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/hij/variables/b23/"</span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">]}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The response will be a 202 with a Progress resource in it; 
poll that URL for updates on the completion and follow <code class="prettyprint">Location</code> once it completed.
See <a href="#progress">Progress</a>.</p>

<p>On completion the align response will be a <code class="prettyprint">shoji:view</code> containing the
<code class="prettyprint">where</code> expression used for each dataset:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"abc"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"678"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"678"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"1ab"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1ab"</span><span class="p">}</span><span class="w">
    </span><span class="p">}}]},</span><span class="w">
    </span><span class="nt">"def"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"789"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"789"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"ab2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ab2"</span><span class="p">}</span><span class="w">
    </span><span class="p">}}]},</span><span class="w">
    </span><span class="nt">"hij"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"890"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"890"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"b23"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b23"</span><span class="p">}</span><span class="w">
    </span><span class="p">}}]}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Following the example above, in the case that the first group could not be
appended because conflicts between their variables, it will be excluded
from the final expressions.</p>

<p>Later, using the expressions obtained, it is possible to append all the datasets
to a new one without conflicts.</p>
<pre class="highlight http"><code><span class="err">POST /datasets/abd/batches/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/abc/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"678"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"678"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"1ab"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1ab"</span><span class="p">}</span><span class="w">
        </span><span class="p">}}]}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<pre class="highlight http"><code><span class="err">POST /datasets/abd/batches/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/def/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"789"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"789"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"ab2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ab2"</span><span class="p">}</span><span class="w">
        </span><span class="p">}}]}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<pre class="highlight http"><code><span class="err">POST /datasets/abd/batches/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/hij/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"890"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"890"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"b23"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b23"</span><span class="p">}</span><span class="w">
        </span><span class="p">}}]}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/batches/{id}/</code></p>

<p>A GET on this resource returns a Shoji Entity describing the batch, and a link to its Crunch Table (see next).</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"conflicts"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"source_children"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"target_children"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"source_columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">3500</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source_rows"</span><span class="p">:</span><span class="w"> </span><span class="mi">235490</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target_columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">3499</span><span class="p">,</span><span class="w">
    </span><span class="nt">"target_rows"</span><span class="p">:</span><span class="w"> </span><span class="mi">120000</span><span class="p">,</span><span class="w">
    </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"progress"</span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"appended"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="the-conflicts-object">The conflicts object</h4>

<p>Each batch has a &ldquo;conflicts&rdquo; member describing any unresolvable differences found between variables in the two datasets. On a successful append, this object will be empty; if the batch status is &ldquo;conflict&rdquo;, the object will contain conflict information keyed by id of the variable in the target dataset. The conflict data for each variable follows this shape:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[{}]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"source_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;id of the matching variable in the source frame"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"source_metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name, etc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"as above"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"conflicts"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span><span class="w">
    </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Each conflict has four attributes: <code class="prettyprint">metadata</code> about the variable on the target dataset (unless it is a variable that only exists on the source dataset), <code class="prettyprint">source_id</code> and <code class="prettyprint">source_metadata</code>, which describe the corresponding variable in the source frame (if any), and a <code class="prettyprint">conflicts</code> member. The <code class="prettyprint">conflicts</code> member contains an array with a list of individual conflicts that indicate what situations were found during batch preparation.</p>

<p>If there are conflicts in your batch, address the conflicting issues in your datasets, DELETE the batch entity from the failed append attempt, and POST a new one.</p>

<h4 id="table">Table</h4>

<p><code class="prettyprint">/datasets/{id}/batches/{id}/table/{?offset,limit}</code></p>

<p>A GET returns the rows of data from the Dataset for the identified batch as a Crunch Table.</p>

          <h2 id="boxdata">Boxdata</h2>

<p>Boxdata is the data that Crunch provides to the CrunchBox for rendering
web components that are made publicly available.  This endpoint provides
a catalog of data that has been precomputed to provide visualizations
cubes of json data.  Metadata associated with this raw computed data is accessed
and manipulated through this endpoint.</p>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/boxdata/</code></p>

<p>A Shoji Catalog of boxdata for a given dataset.</p>

<h4 id="get-catalog">GET catalog</h4>

<p>When authenticated and authorized to view the given dataset, GET returns 200
status with a Shoji Catalog of boxdata associated with the dataset. If authorization is
lacking, response will instead be 404.</p>

<p>Catalog tuples contain the following keys:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>title</td>
<td>string</td>
<td>Human friendly identifier</td>
</tr>
<tr>
<td>notes</td>
<td>string</td>
<td>Other information relevent for this CrunchBox</td>
</tr>
<tr>
<td>header</td>
<td>string</td>
<td>header information for the CrunchBox</td>
</tr>
<tr>
<td>footer</td>
<td>string</td>
<td>footer information for the CrunchBox</td>
</tr>
<tr>
<td>dataset</td>
<td>string</td>
<td>URL of the dataset associated with the CrunchBox</td>
</tr>
<tr>
<td>filters</td>
<td>object</td>
<td>A Crunch expression indicating which filters to include in the CrunchBox</td>
</tr>
<tr>
<td>where</td>
<td>object</td>
<td>A Crunch expression indicating which variables to include in the CrunchBox. An undefined value is equavilent to specifying all dataset variables.</td>
</tr>
<tr>
<td>creation_time</td>
<td>string</td>
<td>A timestamp of the date when this CrunchBox was created</td>
</tr>
</tbody></table>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/boxdata/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/boxdata/44a4d477d70c85da4b8298677e527ad8/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00002"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"footer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is for the footer"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"just a couple of variables"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"z and str"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"header"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is for the header"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-03-14T00:13:42.024000+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"filters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"identify"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/filters/da9d86e43381443d9d708dc29c0c6308/"</span><span class="p">,</span><span class="w">
                            </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/filters/80638457c8bd4731990eebdc3baee839/"</span><span class="w">
                        </span><span class="p">]</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"identify"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/variables/000002/"</span><span class="p">,</span><span class="w">
                            </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/variables/000003/"</span><span class="w">
                        </span><span class="p">]</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"44a4d477d70c85da4b8298677e527ad8"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/boxdata/75ff1d67ed698e0986f1c1c3daebf9a2/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00002"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xz"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"filters"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-03-14T00:13:42.024000+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"identify"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/variables/000000/"</span><span class="w">
                        </span><span class="p">]</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"75ff1d67ed698e0986f1c1c3daebf9a2"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="post-catalog">POST catalog</h4>

<p>Use POST to create a new datasource for crunchbox.  Note that new boxdata is only created when there is a new
 combination of where and filter data.  If the same variables and filteres are indicated by the POST data,
 the existing combination will result in a modification of metadata associated with the cube data.  This is to keep
 avoid recomputing analysis needlessly.</p>

<p>A POST to this resource must be a Shoji Entity with the following &ldquo;body&rdquo; attributes:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>title</td>
<td>Human friendly identifier</td>
</tr>
<tr>
<td>notes</td>
<td>Other information relevent for this CrunchBox</td>
</tr>
<tr>
<td>header</td>
<td>header information for the CrunchBox</td>
</tr>
<tr>
<td>footer</td>
<td>footer information for the CrunchBox</td>
</tr>
<tr>
<td>dataset</td>
<td>URL of the dataset associated with the CrunchBox</td>
</tr>
<tr>
<td>filters</td>
<td>A Crunch expression indicating which <strong>filters</strong> to include</td>
</tr>
<tr>
<td>where</td>
<td>A Crunch expression indicating which <strong>variables</strong> to include</td>
</tr>
<tr>
<td>display_settings</td>
<td>Options to customize how it looks and behaves</td>
</tr>
</tbody></table>
<pre class="highlight json"><code><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nt">"000002"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/variables/000002/"</span><span class="p">},</span><span class="w">
                  </span><span class="nt">"000003"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/variables/000003/"</span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"filters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/filters/da9d86e43381443d9d708dc29c0c6308/"</span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/filters/80638457c8bd4731990eebdc3baee839/"</span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"force"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"z and str"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"just a couple of variables"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"header"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is for the header"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"footer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is for the footer"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="display-settings">Display Settings</h4>

<p>The <code class="prettyprint">display_settings</code> member of a CrunchBox payload allows you to customize several aspects of how it will be displayed.</p>

<p>A <code class="prettyprint">minBaseSize</code> member will suppress display of values in tables or graphs where the sample size is below a given threshold.</p>

<p>To customize a CrunchBox’s color scheme, you may include an optional <code class="prettyprint">palette</code> member in the <code class="prettyprint">display_settings</code> of the body of the request to create or edit the boxdata. There are four types of customization available.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"display_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"minBaseSize"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">},</span><span class="w">
    </span><span class="nt">"palette"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"brand"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"primary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#111111"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"secondary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#222222"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"messages"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#333333"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"static_colors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"#444444"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#555555"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#666666"</span><span class="p">],</span><span class="w">
        </span><span class="nt">"category_lookup"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"category name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#aaaaaa"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"another category:"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bbbbbb"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}}</span><span class="w">
</span></code></pre>

<h5 id="brand">Brand</h5>

<p>The CrunchBox interface uses three colors, named Primary, Secondary, and Messages. By default, these are Crunch brand colors of green, blue, and purple. These are used, for example, as the background colors at the top of the interface and the color of the filter selector.</p>

<h5 id="static-colors">Static colors</h5>

<p>Include an array of <code class="prettyprint">static_colors</code> and every categorical color will be taken from the list in order. If none of your variables have more categories than colors provided here, the generator (below) will never be used, but category lookup will be performed.</p>

<h5 id="base">Base</h5>

<p>If the number of categories exceeds the number of static colors, or no static colors are specified, “base” colors are used to generate a categorical palette. By default, these are also the Crunch green, blue, and purple, and are not overridden by <code class="prettyprint">brand</code>. Each color is interpolated in HCL space from itself to Hue + 100, Lightness + 20; and then colors are ordered to maximize sequential absolute distance in L*a*b* space so adjacent colors can be easily distinguished.</p>

<h5 id="category-lookup">Category Lookup</h5>

<p>Finally, you may include an object where keys are exact category names that should always be assigned a specific color. Using semantically resonant colors in this manner is a boon for interpretation and is highly recommended when possible. For example, to ensure that the Green Party is a verdant shade, include a member such as <code class="prettyprint">&quot;Green&quot;: &quot;#00dd00&quot;</code>. Building a category lookup list requires some attention to the specific categories in a dataset; they must match exactly, and not partially; to ensure that “Green Party” is also green, include an additional <code class="prettyprint">&quot;Green Party&quot;</code> key with the same value. Lookup values are processed <strong>last</strong>, replacing erstwhile static or generated colors.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/boxdata/{id}/</code></p>

<p>This endpoint represents each of the boxdata entities listed in the catalog.</p>

<p>The body of any of the entities is the same as the catalog&rsquo;s tuple:</p>

<h4 id="get">GET</h4>

<p>Returns the body of the boxdata entity</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00002"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"footer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is for the footer"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"just a couple of variables"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"z and str"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"header"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is for the header"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"filters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"identify"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/filters/da9d86e43381443d9d708dc29c0c6308/"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/filters/80638457c8bd4731990eebdc3baee839/"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"identify"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/variables/000002/"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"https://beta.crunch.io/api/datasets/e7834a8b5aa84c50bcb868fc3b44fd22/variables/000003/"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"44a4d477d70c85da4b8298677e527ad8"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="delete">DELETE</h4>

<p>Deletes the boxdata entity. Returns 204.</p>

          <h2 id="comparisons">Comparisons</h2>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/comparisons/{id}/</code></p>

<p>A Shoji Entity with the following &ldquo;body&rdquo; attributes:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>bases</td>
<td>array of cube input objects</td>
<td>one for each analysis to which the comparison applies</td>
</tr>
<tr>
<td>overlay</td>
<td>cube</td>
<td>input object defining the comparison data</td>
</tr>
</tbody></table>

<p>See the Feature Guide for a discussion of the cube objects. POST one to the catalog (see below) to create a new comparison. GET to retrieve the complete Entity. PUT a new one to replace it. PATCH a subset of the attributes as desired. DELETE to remove the comparison.</p>

<p>The Entity also includes a &ldquo;cube&rdquo; link in its &ldquo;catalogs&rdquo; object; a GET on this link returns the output of the overlay cube. See &ldquo;Cube&rdquo; next.</p>

<h4 id="cube">Cube</h4>

<p><code class="prettyprint">/datasets/{id}/comparisons/{id}/cube/</code></p>

<p>A GET on this endpoint returns the output of the &ldquo;overlay&rdquo; cube query for the given comparison. The response will be a Crunch Cube with &ldquo;dimensions&rdquo; and &ldquo;measures&rdquo; members.</p>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/comparisons/</code></p>

<p>A Shoji Catalog of comparison entities associated to the specified dataset.</p>

<h4 id="get-catalog">GET catalog</h4>

<p>When authenticated and authorized to view the given dataset, GET returns 200 status with a Shoji Catalog of the dataset&rsquo;s comparisons. If authorization is lacking, response will instead be 404.</p>

<p>Catalog tuples contain the following keys:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>bases</td>
<td>array of cube input objects</td>
<td>References to the dimensions and measures for which the comparison is valid</td>
</tr>
<tr>
<td>cube</td>
<td>URL</td>
<td>Link to generate the comparison data</td>
</tr>
</tbody></table>

<p>The catalog looks something like this:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5ee0a0/comparisons/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/specifications/comparisons/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of the comparisons for this dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"491fe3/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"All actors"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"bases"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/0f7378/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/8451cb/"</span><span class="p">}],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}</span><span class="w">
            </span><span class="p">}],</span><span class="w">
            </span><span class="nt">"cube"</span><span class="p">:</span><span class="w"> </span><span class="s2">"491fe3/cube/"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"9942ce/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Awareness: sector average"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"bases"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../variables/bf31fc/"</span><span class="p">}],</span><span class="w">
                </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}}</span><span class="w">
            </span><span class="p">}],</span><span class="w">
            </span><span class="nt">"cube"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9942ce/cube/"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="patch-catalog">PATCH catalog</h4>

<p>Use PATCH to edit the &ldquo;name&rdquo; and/or &ldquo;bases&rdquo; of one or more comparisons. A successful request returns a 204 response. </p>

<p>Authorization is required: you must have &ldquo;edit&rdquo; privileges on the dataset, as shown in the &ldquo;permissions&rdquo; object in the dataset&rsquo;s catalog tuple. If you try to PATCH and are not authorized, you will receive a 403 response and no changes will be made.</p>

<p>Because this catalog contains its entities rather than collecting them, do not PATCH to add or delete comparisons. POST to the catalog to create new comparisons, and DELETE individual comparison entities.</p>

<h4 id="post-catalog">POST catalog</h4>

<p>Use POST to add a new comparison entity to the catalog. A 201 indicates success and includes the URL of the newly-created comparison in the Location header.</p>

          <h2 id="datasets">Datasets</h2>

<p>Datasets are the primary containers of statistical data in Crunch. Datasets
contain a collection of <a href="#variables">variables</a>, with which analyses can be
composed, saved, and exported. These analyses may include filters, which users
can define and persist. Users can also share datasets with each other.</p>

<p>Datasets are comprised of one or more batches of data uploaded to Crunch, and
additional batches can be appended to datasets. Similarly, variables from other
datasets can be joined onto a dataset.</p>

<p>As with other objects in Crunch, references to the set of dataset entities are
exposed in a catalog. This catalog can be organized and ordered.</p>

<h3 id="catalog">Catalog</h3>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight shell"><code></code></pre>
<pre class="highlight r"><code><span class="n">library</span><span class="p">(</span><span class="n">crunch</span><span class="p">)</span>
<span class="n">login</span><span class="p">()</span>

<span class="c1"># Upon logging in, a GET /datasets/ is done automatically, to populate:
</span><span class="n">listDatasets</span><span class="p">()</span> <span class="c1"># Shows the names of all datasets you have
</span><span class="n">listDatasets</span><span class="p">(</span><span class="n">refresh</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span> <span class="c1"># Refreshes that list (and does GET /datasets/)
</span>
<span class="c1"># To get the raw Shoji object, should you need it,
</span><span class="n">crGET</span><span class="p">(</span><span class="s2">"https://app.crunch.io/api/datasets/"</span><span class="p">)</span>
</code></pre>
<pre class="highlight python"><code></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"catalogs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"by_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/by_name/{name}/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"search"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/search/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/order/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/specifications/datasets/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Catalog of Datasets that belong to this user. POST a Dataset representation (serialized JSON) here to create a new one; a 201 response indicates success and returns the location of the new object. GET that URL to retrieve the object."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/cc9161/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"James T. Kirk"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Voyage Home"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stardate 8390"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"archived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span><span class="w">
                </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">67</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"is_published"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cc9161"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/685722/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2286"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"streaming"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1986-11-26T12:05:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1986-11-26T12:05:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/ff9443/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Leonard Nimoy"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/a598c7/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Spock"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Wrath of Khan"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nt">"archived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"is_published"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a598c7"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/af432c/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2285-10-03"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2285-10-20"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"streaming"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-06-04T09:16:23.231045"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-06-04T09:16:23.231045"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"current_editor_name"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{\"name\": \"Awesome Dataset\", \"description\": \"(optional) This dataset is awesome because I made it, and you can do it too.\"}"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">GET /datasets/</code></p>

<p>When authenticated, GET returns 200 status with a Shoji Catalog of datasets to
which the authenticated user has access. Catalog tuples contain the following
attributes:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td></td>
<td>Required. The name of the dataset</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>A longer description of the dataset</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td></td>
<td>The dataset&rsquo;s id</td>
</tr>
<tr>
<td>archived</td>
<td>bool</td>
<td>false</td>
<td>Whether the dataset is &ldquo;archived&rdquo; or active</td>
</tr>
<tr>
<td>permissions</td>
<td>object</td>
<td><code class="prettyprint">{&quot;edit&quot;: false}</code></td>
<td>Authorizations on this dataset; see <a href="#permissions">Permissions</a></td>
</tr>
<tr>
<td>owner_id</td>
<td>URL</td>
<td></td>
<td>URL of the user entity of the dataset&rsquo;s owner</td>
</tr>
<tr>
<td>owner_name</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>That user&rsquo;s name, for display</td>
</tr>
<tr>
<td>size</td>
<td>object</td>
<td><code class="prettyprint">{&quot;rows&quot;: 0, &quot;columns&quot;: 0, &quot;unfiltered_rows&quot;: 0}</code></td>
<td>Dimensions of the dataset</td>
</tr>
<tr>
<td>creation_time</td>
<td>ISO-8601 string</td>
<td></td>
<td>Datetime at which the dataset was created in Crunch</td>
</tr>
<tr>
<td>modification_time</td>
<td>ISO-8601 string</td>
<td></td>
<td>Datetime of the last modification for this dataset globally</td>
</tr>
<tr>
<td>start_date</td>
<td>ISO-8601 string</td>
<td></td>
<td>Date/time for which the data in the dataset corresponds</td>
</tr>
<tr>
<td>end_date</td>
<td>ISO-8601 string</td>
<td></td>
<td>End date/time of the dataset&rsquo;s data, defining a start_date:end_date range</td>
</tr>
<tr>
<td>streaming</td>
<td>string</td>
<td>Possible values &ldquo;no&rdquo;, &ldquo;finished&rdquo; and &ldquo;streaming&rdquo; to enable/disable streaming</td>
<td></td>
</tr>
<tr>
<td>current_editor</td>
<td>URL or null</td>
<td></td>
<td>URL of the user entity that is currently editing the dataset, or <code class="prettyprint">null</code> if there is no current editor</td>
</tr>
<tr>
<td>current_editor_name</td>
<td>string or null</td>
<td></td>
<td>That user&rsquo;s name, for display</td>
</tr>
<tr>
<td>is_published</td>
<td>boolean</td>
<td>true</td>
<td>Indicates if the dataset is published to viewers or not</td>
</tr>
</tbody></table>

<aside class="notice">
    A user may have access to a dataset because someone has shared it directly
    with him, or because someone has shared it with a team of which he is a
    member. If a user has access to a dataset from different sources, be it by
    multiple teams or by direct sharing, the final permissions they have on the
    dataset will be the maximum of all the permissions granted.
</aside>

<h4 id="drafts">Drafts</h4>

<p>A dataset marked as <code class="prettyprint">is_published: false</code> can only be accessed by dataset editors.
They will still be available on the catalog for all shared users but API clients
should know to display these to the appropriate users.</p>

<p>The <code class="prettyprint">is_published</code> flag of a dataset can be changed by editors from the catalog or
directly on the dataset entity.</p>

<h4 id="patch">PATCH</h4>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/api/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">231</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/a598c7/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stardate 8130.4"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</code></pre>
<pre class="highlight r"><code><span class="n">library</span><span class="p">(</span><span class="n">crunch</span><span class="p">)</span>
<span class="n">login</span><span class="p">()</span>

<span class="c1"># Dataset objects contain information from
# the catalog tuple and the dataset entity.
# Editing attributes by &lt;- assignment will
# PATCH or PUT the right payload to the
# right place--you don't have to think about
# catalogs and entities.
</span><span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">loadDataset</span><span class="p">(</span><span class="s2">"The Wrath of Khan"</span><span class="p">)</span>
<span class="n">description</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="c1">## [1] ""
</span><span class="n">description</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="s2">"Stardate 8130.4"</span>
<span class="n">description</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="c1">## [1] "Stardate 8130.4"
</span>
<span class="c1"># If you needed to touch HTTP more directly,
# you could:
</span><span class="n">payload</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="p">(</span>
    <span class="sb">`https://app.crunch.io/api/datasets/a598c7/`</span><span class="o">=</span><span class="n">list</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Stardate 8130.4"</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">crPATCH</span><span class="p">(</span><span class="s2">"https://app.crunch.io/api/datasets/"</span><span class="p">,</span>
    <span class="n">body</span><span class="o">=</span><span class="n">toJSON</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
</code></pre>
<pre class="highlight shell"><code></code></pre>
<pre class="highlight python"><code></code></pre>

<p><code class="prettyprint">PATCH /datasets/</code></p>

<p>Use PATCH to edit the &ldquo;name&rdquo;, &ldquo;description&rdquo;, &ldquo;start_date&rdquo;, &ldquo;end_date&rdquo;, or
&ldquo;archived&rdquo; state of one or more datasets. A successful request returns a 204
response. The attributes changed will be seen by all users with access to this
dataset; i.e., names, descriptions, and archived state are not merely attributes
 of your view of the data but of the datasets themselves.</p>

<p>Authorization is required: you must have &ldquo;edit&rdquo; privileges on the dataset(s)
being modified, as shown in the &ldquo;permissions&rdquo; object in the catalog tuples. If
you try to PATCH and are not authorized, you will receive a 403 response and no
changes will be made.</p>

<p>The tuple attributes other than &ldquo;name&rdquo;, &ldquo;description&rdquo;, and &ldquo;archived&rdquo; cannot be
modified here by PATCH. Attempting to modify other attributes, or including new
attributes, will return a 400 response. Changing permissions is accomplished by
PATCH on the permissions catalog, and changing the owner is a PATCH on the
dataset entity. The &ldquo;owner_name&rdquo; and &ldquo;current_editor_name&rdquo; attributes are
modifiable, assuming authorization, by PATCH on the associated user entity.
Dataset &ldquo;size&rdquo; is a cached property of the data, changing only if the number of
rows or columns in the dataset change. Dataset &ldquo;id&rdquo;, &ldquo;modification_time&rdquo;
and &ldquo;creation_time&rdquo; are immutable/system generated.</p>

<p>When PATCHing, you may include only the keys in each tuple that are being
modified, or you may send the complete tuple. As long as the keys that cannot
be modified via PATCH here are not modified, the request will succeed.</p>

<p>Note that, unlike other Shoji Catalog resources, you cannot PATCH to add new
datasets, nor can you PATCH a null tuple to delete them. Attempting either will
return a 400 response. Creating datasets is allowed only by POST to the catalog,
 while deleting datasets is accomplished via a DELETE on the dataset entity.</p>

<h5 id="changing-ownership">Changing ownership</h5>

<p>Any changes to the ownership of a dataset need to be done by the current editor.</p>

<p>Only the dataset owner can change the ownership to another user. This can be done
by PATCH request with the new owners&rsquo; email of API URL. The new owner must have
advanced permissions on Crunch.</p>

<p>Other editors of the dataset can change the ownership of a dataset only to a
Project as long as they andthe current owner of the dataset are both editors
on such project.</p>

<h4 id="post">POST</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">88</span>

<span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Trouble with Tribbles"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stardate 4523.3"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://app.crunch.io/api/datasets/223fd4/</span>

</code></pre>
<pre class="highlight r"><code><span class="n">library</span><span class="p">(</span><span class="n">crunch</span><span class="p">)</span>
<span class="n">login</span><span class="p">()</span>

<span class="c1"># To create just the dataset entity, you can
</span><span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">createDataset</span><span class="p">(</span><span class="s2">"Trouble with Tribbles"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"Stardate 4523.3"</span><span class="p">)</span>

<span class="c1"># More likely, you'll have a data.frame or
# similar object in R, and you'll want to send
# it to Crunch. To do that,
</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">read.csv</span><span class="p">(</span><span class="s2">"~/tribbles.csv"</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">&lt;-</span> <span class="n">newDataset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Trouble with Tribbles"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"Stardate 4523.3"</span><span class="p">)</span>
</code></pre>
<pre class="highlight shell"><code></code></pre>
<pre class="highlight python"><code></code></pre>

<p><code class="prettyprint">POST /datasets/</code></p>

<p>POST a JSON object to create a new Dataset; a 201 indicates success, and the
returned Location header refers to the new Dataset resource.</p>

<p>The body must contain a &ldquo;name&rdquo;. You can also include a Crunch Table in a &ldquo;table&rdquo; key,
as discussed in the <a href="#metadata-document-csv">Feature Guide</a>. The full set of possible attributes to include when POSTing to create a new dataset entity are:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Optional longer string</td>
</tr>
<tr>
<td>archived</td>
<td>boolean</td>
<td>Whether the variable should be hidden from most views; default: false</td>
</tr>
<tr>
<td>owner</td>
<td>URL</td>
<td>Provide a project URL to set the owner to that project; if omitted, the authenticated user will be the owner</td>
</tr>
<tr>
<td>notes</td>
<td>string</td>
<td>Blank if omitted. Optional notes for the dataset</td>
</tr>
<tr>
<td>start_date</td>
<td>date</td>
<td>ISO-8601 formatted date with day resolution</td>
</tr>
<tr>
<td>end_date</td>
<td>date</td>
<td>ISO-8601 formatted date with day resolution</td>
</tr>
<tr>
<td>streaming</td>
<td>string</td>
<td>Only &ldquo;streaming&rdquo;, &ldquo;finished&rdquo; and &ldquo;no&rdquo; available values to define if a dataset will accept streaming data or not</td>
</tr>
<tr>
<td>is_published</td>
<td>boolean</td>
<td>If false, only project editors will have access to this dataset</td>
</tr>
<tr>
<td>weight_variables</td>
<td>array</td>
<td>Contains aliases of weight variables to start this dataset with; variables must be numeric type.</td>
</tr>
<tr>
<td>table</td>
<td>object</td>
<td>Metadata definition for the variables in the dataset</td>
</tr>
<tr>
<td>maintainer</td>
<td>URL</td>
<td>User URL that will be the maintainer of this dataset in case of system notifications; if omitted, the authenticated user will be the maintainer</td>
</tr>
<tr>
<td>settings</td>
<td>object</td>
<td><a href="#settings">Settings object</a> containing <code class="prettyprint">weight</code>, <code class="prettyprint">viewers_can_export</code>, <code class="prettyprint">viewers_can_change_weight</code>, <code class="prettyprint">viewers_can_share</code>, <code class="prettyprint">dashboard_deck</code>, and/or <code class="prettyprint">min_base_size</code> attributes. If a &ldquo;weight&rdquo; is specified, it will be automatically added to &ldquo;weight_variables&rdquo; if not already specified there.</td>
</tr>
</tbody></table>

<h3 id="other-catalogs">Other catalogs</h3>

<p>In addition to <code class="prettyprint">/datasets/</code>, there are a few other catalogs of datasets in the API:</p>

<h4 id="team-datasets">Team datasets</h4>

<p><code class="prettyprint">/teams/{team_id}/datasets/</code></p>

<p>A Shoji Catalog of datasets that have been shared with this team. These datasets
are not included in the primary dataset catalog. See <a href="#teams">teams</a> for more.</p>

<h4 id="project-datasets">Project datasets</h4>

<p><code class="prettyprint">/projects/{project_id}/datasets/</code></p>

<p>A Shoji Catalog of datasets that belong to this project. These datasets
are not included in the primary dataset catalog. See <a href="#projects">projects</a> for more.</p>

<h4 id="filter-datasets-by-name">Filter datasets by name</h4>

<p><code class="prettyprint">/datasets/by_name/{dataset_name}/</code></p>

<p>The <code class="prettyprint">by_name</code> catalog returns (on GET) a Shoji Catalog that is a subset of
<code class="prettyprint">/datasets/</code> where the dataset name matches the &ldquo;dataset_name&rdquo; value. Matches
are case sensitive.</p>

<p>Verbs other than GET are not supported on this subcatalog. PATCH and POST at
 the primary dataset catalog.</p>

<h3 id="dataset-order">Dataset order</h3>

<p>The dataset order allows each user to organize the order in which their datasets
are presented.</p>

<p>This endpoint returns a <code class="prettyprint">shoji:order</code>. Like all shoji orders, it may not contain
all available datasets. The catalog should always be the authoritative source
of available datasets.</p>

<p>Any dataset not present on the order graph should be considered to be at the
bottom of the root list in arbitrary order.</p>

<h4 id="get">GET</h4>

<p><code class="prettyprint">GET /datasets/{dataset_id}/order/</code></p>
<pre class="highlight json"><code><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/datasets/{dataset_id}/order/"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"dataset_url"</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"dataset_url"</span><span class="w">
        </span><span class="p">]}</span><span class="w">
     </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="put">PUT</h4>

<p>Receives a complete <code class="prettyprint">shoji:order</code> payload and replaces the existing graph
with the new one.</p>

<p>It cannot contain dataset references that are not in the dataset catalog, else
the API will return a 400 response.</p>

<p>Standard <code class="prettyprint">shoji:order</code> graph validation will apply.</p>

<h4 id="patch">PATCH</h4>

<p>Same semantics as PUT</p>

<h3 id="entity">Entity</h3>

<h4 id="get">GET</h4>

<p><code class="prettyprint">GET /datasets/{dataset_id}/</code></p>

<h5 id="url-parameters">URL Parameters</h5>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dataset_id</td>
<td>The id of the dataset</td>
</tr>
</tbody></table>

<h5 id="dataset-attributes">Dataset attributes</h5>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td></td>
<td>Required. The name of the dataset</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>A longer description of the dataset</td>
</tr>
<tr>
<td>notes</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>Additional information you want to associate with this dataset</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td></td>
<td>The dataset&rsquo;s id</td>
</tr>
<tr>
<td>archived</td>
<td>bool</td>
<td>false</td>
<td>Whether the dataset is &ldquo;archived&rdquo; or active</td>
</tr>
<tr>
<td>permissions</td>
<td>object</td>
<td><code class="prettyprint">{&quot;edit&quot;: false}</code></td>
<td>Authorizations on this dataset; see <a href="#permissions">Permissions</a></td>
</tr>
<tr>
<td>owner_id</td>
<td>URL</td>
<td></td>
<td>URL of the user entity of the dataset&rsquo;s owner</td>
</tr>
<tr>
<td>owner_name</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>That user&rsquo;s name, for display</td>
</tr>
<tr>
<td>size</td>
<td>object</td>
<td><code class="prettyprint">{&quot;rows&quot;: 0, &quot;unfiltered_rows&quot;, &quot;columns&quot;: 0}</code></td>
<td>Dimensions of the dataset</td>
</tr>
<tr>
<td>creation_time</td>
<td>ISO-8601 string</td>
<td></td>
<td>Datetime at which the dataset was created in Crunch</td>
</tr>
<tr>
<td>start_date</td>
<td>ISO-8601 string</td>
<td></td>
<td>Date/time for which the data in the dataset corresponds</td>
</tr>
<tr>
<td>end_date</td>
<td>ISO-8601 string</td>
<td></td>
<td>End date/time of the dataset&rsquo;s data, defining a start_date:end_date range</td>
</tr>
<tr>
<td>streaming</td>
<td>string</td>
<td>Possible values are &ldquo;no&rdquo;, &ldquo;finished&rdquo; and &ldquo;streaming&rdquo; to determine if a dataset is streamed or not</td>
<td></td>
</tr>
<tr>
<td>current_editor</td>
<td>URL or null</td>
<td></td>
<td>URL of the user entity that is currently editing the dataset, or <code class="prettyprint">null</code> if there is no current editor</td>
</tr>
<tr>
<td>current_editor_name</td>
<td>string or null</td>
<td></td>
<td>That user&rsquo;s name, for display</td>
</tr>
<tr>
<td>maintainer</td>
<td>URL</td>
<td>The URL of the dataset maintainer. Will always point to a user</td>
<td></td>
</tr>
<tr>
<td>app_settings</td>
<td>object</td>
<td><code class="prettyprint">{}</code></td>
<td>A place for API clients to store values they need per dataset; It is recommended that clients namespace their keys to avoid collisions</td>
</tr>
</tbody></table>

<h5 id="dataset-catalogs">Dataset catalogs</h5>

<p>A dataset contains a number of catalog resources that contain collections of
related objects. They are available under the <code class="prettyprint">catalogs</code> attribute of the
dataset Shoji entity.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"batches"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/batches/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"joins"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/joins/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"parent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"variables"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/variables/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"actions"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/actions/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"savepoints"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/savepoints/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"filters"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/filters/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"multitables"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/multitables/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"comparisons"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/comparisons/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"forks"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/forks/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"decks"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/decks/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/c5d751/permissions/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<table><thead>
<tr>
<th>Catalog name</th>
<th>Resource</th>
</tr>
</thead><tbody>
<tr>
<td>batches</td>
<td>Returns all the batches (successful and failed) used for this dataset. See <a href="#batches">Batches</a>.</td>
</tr>
<tr>
<td>joins</td>
<td>Contains the list of all datasets joined to the current dataset. See <a href="#joins">Joins</a>.</td>
</tr>
<tr>
<td>parent</td>
<td>Indicates the catalog where this dataset is found (project or main dataset catalog)</td>
</tr>
<tr>
<td>variables</td>
<td>Catalog of all public variables of this dataset. See <a href="#variables">Variables</a>.</td>
</tr>
<tr>
<td>actions</td>
<td>All actions executed on this dataset</td>
</tr>
<tr>
<td>savepoints</td>
<td>Lists the saved versions for this dataset. See <a href="#versions">Versions</a>.</td>
</tr>
<tr>
<td>filters</td>
<td>Makes available the public and user-created filters. See <a href="#filters">Filters</a>.</td>
</tr>
<tr>
<td>multitables</td>
<td>Similar to filters, displays all available multitables. See <a href="#mulitables">Multitables</a></td>
</tr>
<tr>
<td>comparisons</td>
<td>Contains all available comparisons. See <a href="#comparisons">Comparisons</a>.</td>
</tr>
<tr>
<td>forks</td>
<td>Returns all the forks created from this dataset</td>
</tr>
<tr>
<td>decks</td>
<td>The list of all decks on this dataset for the authenticated user</td>
</tr>
<tr>
<td>permissions</td>
<td>Returns the list of all users and teams with access to this dataset. See <a href="#permissions">Permissions</a>.</td>
</tr>
</tbody></table>

<h4 id="patch">PATCH</h4>

<p><code class="prettyprint">PATCH /datasets/{dataset_id}/</code></p>

<p>See above about PATCHing the dataset catalog for all attributes duplicated on
the entity and the catalog. You may PATCH those attributes on the entity, but you
are encouraged to PATCH the catalog instead. The two attributes appearing on the
entity and not the catalog, &ldquo;notes&rdquo; is modifiable by PATCH here.</p>

<p>A successful PATCH request returns a 204 response. The attributes changed will be seen
by all users with access to this dataset; i.e., names, descriptions, and archived
state are not merely attributes of your view of the data but of the datasets themselves.</p>

<p>Authorization is required: you must have &ldquo;edit&rdquo; privileges on this dataset.
 If you try to PATCH and are not authorized, you will receive a 403 response
 and no changes will be made. If you have edit permissions but are not the
 current editor of this dataset, PATCH requests of anything other than
 &ldquo;current_editor&rdquo; will respond with 409 status. You will need first to PATCH to
 make yourself
  the current editor and then proceed to make the desired changes.</p>

<p>When PATCHing, you may include only the keys that are being
modified, or you may send the complete entity. As long as the keys that cannot be
modified via PATCH here are not modified, the request will succeed.</p>

<h5 id="changing-dataset-ownership">Changing dataset ownership</h5>

<p>If you are the current editor of a dataset you can change its owner by PATCHing
the <code class="prettyprint">owner</code> attribute witht he URL of the new owner.</p>

<p>Only Users, Teams or Projects can be set as owners of a dataset.</p>

<ul>
<li>Users: New owner needs to be advanced users to be owner of a dataset.</li>
<li>Teams: Authenticated user needs to be a member of the team.</li>
<li>Projects: Authenticated user needs to have edit permissions on the project.</li>
</ul>

<h5 id="copying-over-from-another-dataset">Copying over from another dataset</h5>

<p>In the needed case to copy over the work from another dataset to the
current one, it is possible to issue a PATCH request with the <code class="prettyprint">copy_from</code>
attribute pointing to the URL of the source dataset to use.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"copy_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/1234/"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>All dataset attributes, permissions, derivations, private variables, etc
will be brought over to the current dataset:</p>

<ul>
<li>Decks</li>
<li>Filters</li>
<li>Multitables</li>
<li>Comparisons</li>
<li>Personal variable order</li>
<li>Derived variables</li>
<li>Personal variables</li>
<li>Permissions</li>
</ul>

<p>The response will be a <code class="prettyprint">shoji:entity</code> containing as a body an object with
keys for each entity type that uas not been copied. In the case of variables
these entities will display their name, alias and owner (if personal).</p>

<p>All the URLs will refer to entities on the source dataset.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"variables"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"https://app.crunch.io/dataset/1234/variables/abc/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Variable name"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Variable alias"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"owner_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/users/qwe/"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Angus MacGyver"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"https://app.crunch.io/dataset/1234/variables/cde/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Variable name"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Variable alias"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"owner_url"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"filters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"https://app.crunch.io/filters/abcd/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"filter name"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"owner_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/users/qwe/"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"http://app.crunch.io/filters/cdef/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"filter name"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"owner_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/users/qwe/"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>It is possible to copy information only for one user from another dataset,
the payload will need the extra <code class="prettyprint">user</code> key. It can contain either a user URL
or a user email:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"copy_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/1234/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/abcd/"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="delete">DELETE</h4>

<p><code class="prettyprint">DELETE /datasets/{dataset_id}/</code></p>

<p>With sufficient authorization, a successful DELETE request removes the dataset
from the Crunch system and responds with 204 status.</p>

<h4 id="views">Views</h4>

<h5 id="applied-filters">Applied filters</h5>

<h5 id="cube">Cube</h5>

<p><code class="prettyprint">/datasets/{id}/cube/?q</code></p>

<p>See <a href="#multidimensional-analysis">Multidimensional Analysis</a>.</p>

<h5 id="export">Export</h5>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">`/datasets/{id}/export/`</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
</code></pre>

<p>GET returns a Shoji View of available dataset export formats.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/export/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"spss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/export/spss/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"csv"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/export/csv/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A POST request on any of the export views will return 202 status with a Progress response in the body and a Location header pointing to the location of the exported file to be downloaded. Poll the progress URL for status on the completion of the export. When complete, GET the Location URL from the original response to download the file.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">`/api/datasets/f2364cc66e604d63a3be3e8811fc902f/export/spss/`</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="w">    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"select"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"map"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"https://app.crunch.io/api/datasets/f2364cc66e604d63a3be3e8811fc902f/variables/000000/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/f2364cc66e604d63a3be3e8811fc902f/variables/000000/"</span><span class="p">},</span><span class="w">
              </span><span class="nt">"https://app.crunch.io/api/datasets/f2364cc66e604d63a3be3e8811fc902f/variables/000001/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/f2364cc66e604d63a3be3e8811fc902f/variables/000001/"</span><span class="p">},</span><span class="w">
              </span><span class="nt">"https://app.crunch.io/api/datasets/f2364cc66e604d63a3be3e8811fc902f/variables/000002/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/f2364cc66e604d63a3be3e8811fc902f/variables/000002/"</span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">202</span> <span class="ne">Accepted</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">176</span>
<span class="na">Access-Control-Allow-Methods</span><span class="p">:</span> <span class="s">OPTIONS, AUTH, POST, GET, HEAD, PUT, PATCH, DELETE</span>
<span class="na">Access-Control-Expose-Headers</span><span class="p">:</span> <span class="s">Allow, Location, Expires</span>
<span class="na">Content-Encoding</span><span class="p">:</span> <span class="s">gzip</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://crunch-io.s3.amazonaws.com/exports/dataset_exports/f2364cc66e604d63a3be3e8811fc902f/My_Dataset.sav?Signature=sOmeSigNaTurE%3D&amp;Expires=1470265052&amp;AWSAccessKeyId=SOMEKEY</span>
</code></pre>

<p>To export a subset of the dataset, instead perform a POST request and include a JSON body with an optional
 &ldquo;filter&rdquo; expression for the rows and a &ldquo;where&rdquo; attribute to specify variables to include.</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td>filter</td>
<td>A Crunch filter expression defining a filter for the given export</td>
<td><code class="prettyprint">{&quot;function&quot;: &quot;==&quot;, &quot;args&quot;: [{&quot;variable&quot;: &quot;000000&quot;}, {&quot;value&quot;: 1}]}</code></td>
</tr>
<tr>
<td>where</td>
<td>A Crunch expression defining which variables to export. Refer to <a href="#frame-functions">Frame functions</a> for the available functions to here.</td>
<td><code class="prettyprint">{&quot;function&quot;: &quot;select&quot;, &quot;args&quot;: [{&quot;map&quot;: {&quot;000000&quot;: {&quot;variable&quot;: 000000&quot;}}}]}</code></td>
</tr>
<tr>
<td>options</td>
<td>An object of extra settings, which may be format-specific. See below.</td>
<td><code class="prettyprint">{&quot;use_category_ids&quot;: true}</code></td>
</tr>
</tbody></table>

<p>See <a href="#expressions">&ldquo;Expressions&rdquo;</a> for more on Crunch expressions.</p>

<p>The following rules apply for all formats:</p>

<ul>
<li>The dataset&rsquo;s exclusion filter will be applied; however, any of the user&rsquo;s personal &ldquo;applied filters&rdquo; are not, unless they are explicitly included in the request.</li>
<li>Hidden/discarded variables are not exported unless editors use a <code class="prettyprint">where</code> clause, then it will be evaluated over all non hidden variables.</li>
<li>Personal (private) variables are not exported unless indicated, then only the current user&rsquo;s personal variables will be exported</li>
<li>Variables (columns) will be ordered in a flattened version of the dataset&rsquo;s hierarchical order.</li>
<li>Derived variables will be exported with their values, without their functional links.</li>
</ul>

<p>Some format-specific properties and options:</p>

<table><thead>
<tr>
<th>Format</th>
<th>Attribute</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>csv</td>
<td>use_category_ids</td>
<td>Export categorical data as its numeric IDs instead of category names?</td>
<td>false</td>
</tr>
<tr>
<td>csv</td>
<td>missing_values</td>
<td>If present, will use the specified string to indicate missing values. If omitted, will use the missing reason strings</td>
<td><em>omitted</em></td>
</tr>
<tr>
<td>csv</td>
<td>header_field</td>
<td>Use the variable&rsquo;s alias/name/description in the CSV header row,  or <code class="prettyprint">null</code> for no header row</td>
<td>&ldquo;alias&rdquo;</td>
</tr>
<tr>
<td>spss</td>
<td>var_label_field</td>
<td>Use the variable&rsquo;s name/description as SPSS variable label</td>
<td>&ldquo;description&rdquo;</td>
</tr>
<tr>
<td>spss</td>
<td>prefix_subvariables</td>
<td>Prefix subvariable labels with the parent array variable&rsquo;s label?</td>
<td>false</td>
</tr>
<tr>
<td>all</td>
<td>include_personal</td>
<td>Include the user&rsquo;s personal variables in the exported file?</td>
<td>false</td>
</tr>
</tbody></table>

<h6 id="spss">SPSS</h6>

<p>Categorical-array and multiple-response variables will be exported as &ldquo;mrsets&rdquo;, as supported by SPSS. If
the <code class="prettyprint">prefix_subvariables</code> option is set to <code class="prettyprint">true</code>, then the subvariables&rsquo; labels will be prefixed with the 
parent&rsquo;s label.</p>

<p>To pick which variable field to use on the <code class="prettyprint">label</code> field on the SPSS variables, use the <code class="prettyprint">var_label_field</code> in the
<code class="prettyprint">options</code> attribute in the POST body. The only valid fields are <code class="prettyprint">description</code> and <code class="prettyprint">name</code>.</p>

<h6 id="csv">CSV</h6>

<p>By default, categorical variable values will be exported using the category name 
and missing values will use their corresponding reason string for all variables.</p>

<p>The missing values will be exported with their configured missing reason in
the CSV file. If specified on the <code class="prettyprint">missing_values</code> export option, then all
missing values on all columns will use such string instead of the reason.</p>

<p>To control the output of the header row, use the <code class="prettyprint">header_field</code> option. Valid values for this option are:</p>

<ul>
<li>alias (default)</li>
<li>name</li>
<li>description</li>
<li><code class="prettyprint">null</code> - Sending <code class="prettyprint">null</code> will make the resulting CSV without a header row.</li>
</ul>

<p>Refer to the options described on the table above for the <code class="prettyprint">csv</code> format to change this behavior.</p>

<h5 id="match">Match</h5>

<p>The match endpoint provides a list of matches indicating which variables match amongst the datasets provided.  To use it,
send a post request representing an ordered list of datasets you would like to match. Include the &ldquo;minimum_matches&rdquo;
parameter in your graph if you would like to limit the output of the matches based on the number of datasets matching.
The default minim_matches is 2. Currently, only alias is utilized to match the variables to one another. </p>

<p>The result of a match endpoint request can be one of two things. If the same match has been completed previously, the
api with return a 201 status code and a Location header to the existing results. Otherwise, the endpoint will return 
a 202 status code, with a Progress result that provides status information as the match is completed. Either request will 
result in the location header being set to the URI for staticly generated comparison result that can be accessed with the 
match is completed.</p>

<p>The results are a Shoji Entity with an attribute <code class="prettyprint">matches</code>. The matches are listed by order of the
number of variables matched. Each variable inside the matches will contain the dataset, the variable id and the confidence
that the variable matches the others in the list. The order of the variables inside the matches returned will match
 the order of the datasets provided. The first variable will also contain some additional information
to allow previewing a match. To retrieve complete details about all the matching variables the endpoints
listed in <code class="prettyprint">metadata</code> field can be called, those provide all the matching metadata chunked by groups of matches.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/datasets/match/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w">
        </span><span class="nt">"datasets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"http://app.crunch.io/api/datasets/8274bf/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"http://app.crunch.io/api/datasets/699a33/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"http://app.crunch.io/api/datasets/8274bf/"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"http://app.crunch.io/api/datasets/699a33/"</span><span class="w">                   
        </span><span class="p">],</span><span class="w">
         </span><span class="nt">"minimum_matches"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Response:</p>
<pre class="highlight http"><code><span class="err">201 Created
Host: app.crunch.io
Location: http://app.crunch.io/api/datasets/matches/394d9e/
</span></code></pre>
<pre class="highlight http"><code><span class="err">GET /api/datasets/matches/394d9e/
</span></code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">

    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io:50976/api/datasets/match/3c7df5/"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"matches"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SomeVariable"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"confidence"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some Variable"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"521b5c014e1e474fa5173d95000bd6e9"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is some variable"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8274bfb842d645728a49634414b999c4"</span><span class="w">
                </span><span class="p">},</span><span class="w"> 
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3fa1d3358888474eb949ae586e80f9a4"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"confidence"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"699a3315c3f347d4923257380938f9b9"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AnotherVariableThatHasMatches"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"confidence"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Another Variable"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"234e8e76d0e1a32667ab33bc30a9900"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is another variable"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8274bfb842d645728a49634414b999c4"</span><span class="w">
                </span><span class="p">},</span><span class="w"> 
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9373729ac990b009e0a90dca99092789"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"confidence"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> 
                    </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"699a3315c3f347d4923257380938f9b9"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="err">...</span><span class="w">
        </span><span class="p">],</span><span class="w"> 
        </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"http://app.crunch.io/api/datasets/match/3c7df5/0-500/"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>

<h5 id="summary">Summary</h5>

<p><code class="prettyprint">/datasets/{id}/summary/{?filter}</code></p>

<h6 id="query-parameters">Query Parameters</h6>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>filter</td>
<td>A Crunch filter expression</td>
</tr>
</tbody></table>

<p>GET returns a Shoji View with summary information about this dataset containing
 its number of rows (weighted and unweighted, with and without your applied
 filters), as well as the number of variables and columns. The column count
 will differ from the variable count when derived and array variables are
 present&ndash;these variable types don&rsquo;t necessarily have their own columns of d
 ata behind them. The column count is useful for estimating load time and
 file size when exporting.</p>

<p>If a <code class="prettyprint">filter</code> is included, the &ldquo;filtered&rdquo; counts will be with respect to that
expression. If omitted, your applied filters will be used.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/summary/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"unweighted"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"filtered"</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w">
            </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"weighted"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"filtered"</span><span class="p">:</span><span class="w"> </span><span class="mf">2000.0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mf">2000.0</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"variables"</span><span class="p">:</span><span class="w"> </span><span class="mi">529</span><span class="p">,</span><span class="w">
        </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">530</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="fragments">Fragments</h4>

<h5 id="table">Table</h5>

<h5 id="state">State</h5>

<h5 id="exclusion">Exclusion</h5>

<p><code class="prettyprint">/datasets/{id}/exclusion/</code></p>

<p>Exclusion filters allow you to drop rows of data without permanently deleting them.</p>

<p>GET on this resource returns a Shoji Entity with a filter &ldquo;expression&rdquo; attribute
in its body. Rows that match the filter expression will be excluded from all views of the data.</p>

<p>PATCH the &ldquo;expression&rdquo; attribute to modify. An empty &ldquo;expression&rdquo; object, like
 <code class="prettyprint">{&quot;body&quot;: {&quot;expression&quot;: {}}}</code>, is equivalent to &ldquo;no exclusion&rdquo;, i.e. no rows
 are dropped.</p>

<h5 id="stream">Stream</h5>

<h6 id="stream-lock">Stream lock</h6>

<p>When a dataset is configured to receive streaming data, the /stream/ endpoint
will accept POST requests to append new rows to the streaming queue.</p>

<p>A dataset is able to receive streaming data while its <code class="prettyprint">streaming</code> attribute is 
set to <code class="prettyprint">streaming</code>.</p>

<p>While a dataset is receiving streams, any other kind of append is disabled 
returning 409 if attempted. Only streaming data is allowed.</p>

<p>The following operations are forbidden on a dataset while it is accepting
streaming rows in order to protect the schema.</p>

<ul>
<li>Deleting public non derived variables</li>
<li>Casting variables (Includes changing resolution on datetime variables)</li>
<li>Changing variable aliases</li>
<li>Deleting categories from categorical variables</li>
<li>Changing ID of category IDs</li>
<li>Removing subvariables from arrays</li>
<li>Merging forks</li>
<li>Reverting to savepoints</li>
<li>Modifying the Primary Key, once it has been set</li>
</ul>

<p>To change the streaming configuration of the dataset, PATCH the entity&rsquo;s 
<code class="prettyprint">streaming</code> attribute to either <code class="prettyprint">streaming</code>, <code class="prettyprint">finished</code> or <code class="prettyprint">no</code> according
to the following table:</p>

<table><thead>
<tr>
<th>Value</th>
<th>Allows schema changes</th>
<th>Accepts streaming rows</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">streaming</code></td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td><code class="prettyprint">finished</code></td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td><code class="prettyprint">no</code></td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody></table>

<p>Note that only the <strong>dataset maintainer</strong> is allowed to modify the <code class="prettyprint">streaming</code>
attribute.</p>

<h6 id="sending-rows">Sending rows</h6>

<p><code class="prettyprint">/datasets/{id}/stream/</code></p>

<p>Stream allows for sending data to a dataset as it is gathered.</p>

<p>GET on this resource returns a Shoji Entity with two attributes in its body:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/stream/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A stream for this Dataset. Each stream acts as a write buffer, from which Sources are periodically made and appended as Batches to the owning Dataset."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"pending_messages"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"received_messages"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<table><thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>pending_messages</td>
<td>The number of messages the stream has that have yet to be appended to the dataset (note: a message might contain more than one row, each POST that is made to <code class="prettyprint">/datasets/{id}/stream/</code> will result in a single message).</td>
</tr>
<tr>
<td>received_messages</td>
<td>The total number of messages that this stream has received.</td>
</tr>
</tbody></table>

<p>POST to this endpoint to add rows. The payload should be a multi line string
where each line contains a json representation of objects indicating the
value for each variable keyed by <strong>alias</strong>.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"alias1"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias3"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nt">"alias1"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"other"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias3"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nt">"alias1"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"empty"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias3"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="settings">Settings</h5>

<p><code class="prettyprint">/datasets/{id}/settings/</code></p>

<p>The dataset settings allow editors to store dataset wide permissions and
configurations for it.</p>

<p>Will always return all the available settings with default values a dataset
can have.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/settings/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"viewers_can_export"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"viewers_can_change_weight"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"viewers_can_share"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"weight"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/variables/123456/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To make changes, clients should PATCH the settings they wish to change with new
values. Additional settings are not allowed, the server will return a 400
response.</p>

<table><thead>
<tr>
<th>Setting</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>viewers_can_export</td>
<td>When false, only editor can export; else, all users with view access can export the data</td>
</tr>
<tr>
<td>viewers_can_change_weight</td>
<td>When true, all users with access can set their own personal weight; else, the editor configured <code class="prettyprint">weight</code> will be applied to all without option to change</td>
</tr>
<tr>
<td>viewers_can_share</td>
<td>When true, all users with access can share the dataset with other users or teams; Defaults to <code class="prettyprint">True</code></td>
</tr>
<tr>
<td>weight</td>
<td>Default initial weight for all new users on this dataset, and when <code class="prettyprint">viewers_can_change_weight</code> is false, this variable will be the always-applied weight for all viewers of the dataset.</td>
</tr>
<tr>
<td>dashboard_deck</td>
<td>When set, points to a deck that will become publicly visible and be used as dashboard by the web client</td>
</tr>
</tbody></table>

<h5 id="preferences">Preferences</h5>

<p><code class="prettyprint">/datasets/{id}/preferences/</code></p>

<p>The dataset preferences provide API clients with a key/value store for settings
or customizations each would need for each user.</p>

<p>By default, all dataset preferences start out with only a <code class="prettyprint">weight</code> key
 set to <code class="prettyprint">null</code>, unless otherwise set. Clients can PATCH to add additional attributes.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/preferences/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"weight"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To delete attributes from the preferences resources, PATCH them with <code class="prettyprint">null</code>.</p>

<p>Preferences are unordered; clients should not assume that they are ordered.</p>

<h6 id="weight">Weight</h6>

<p>If the dataset has <code class="prettyprint">viewers_can_change_weight</code> setting set to false, then
all users&rsquo; preferences <code class="prettyprint">weight</code> will be set to the dataset wide configured
weight without option to change it. Attempts to modify it will return a 403
response.</p>

<h5 id="primary-key">Primary key</h5>

<p><code class="prettyprint">/datasets/{dataset_id}/pk/</code></p>

<h6 id="url-parameters">URL Parameters</h6>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dataset_id</td>
<td>The id of the dataset</td>
</tr>
</tbody></table>

<p>Setting a primary key on a dataset causes updates (particularly streamed
updates) mentioning existing rows to be updated instead of new rows being
inserted.  A primary key can only be set on a variable that is type &ldquo;numeric&rdquo; or &ldquo;text&rdquo; and that has no duplicate or missing values,
and it can only be set after that variable has been added to the dataset.</p>

<h6 id="get">GET</h6>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/api/datasets/{dataset_id}/pk/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>

--------
200 OK
Content-Type:application/json;charset=utf-8

{
    "element": "shoji:entity",
    "body": {
        "pk": ["https://app.crunch.io/api/datasets/{dataset_id}/variables/000001/"],
    }
}
</code></pre>
<pre class="highlight shell"><code></code></pre>
<pre class="highlight r"><code></code></pre>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="c"># "ds" is dataset via pycrunch</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">pk</span>
<span class="p">[</span><span class="s">'https://app.crunch.io/api/datasets/{dataset_id}/variables/000001/'</span><span class="p">]</span>
</code></pre>

<p><code class="prettyprint">GET /datasets/{dataset_id}/pk/</code></p>

<p>GET on this resource returns a Shoji Entity.  It contains one body key: <code class="prettyprint">pk</code>,
which is an array. The &ldquo;pk&rdquo; member indicates the URLs of the variables
in the dataset which comprise the primary key.  If there is no primary key for
this dataset, the <code class="prettyprint">pk</code> value will be <code class="prettyprint">[]</code>.</p>

<h6 id="post">POST</h6>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/{dataset_id}/pk/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">15</span>

<span class="p">{</span><span class="nt">"pk"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://app.crunch.io/api/datasets/{dataset_id}/variables/000001/"</span><span class="p">]}</span><span class="w">

</span><span class="err">--------</span><span class="w">
</span><span class="mi">204</span><span class="w"> </span><span class="err">No</span><span class="w"> </span><span class="err">Content</span><span class="w">
</span></code></pre>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="c"># "ds" is dataset via pycrunch</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">post</span><span class="p">({</span><span class="s">'pk'</span><span class="p">:[</span><span class="s">'https://app.crunch.io/api/datasets/{dataset_id}/variables/000001/'</span><span class="p">]})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">pk</span>
<span class="p">[</span><span class="s">'000001'</span><span class="p">]</span>
</code></pre>

<p><code class="prettyprint">POST /datasets/{dataset_id}/pk/</code></p>

<p>When POSTing, set the body to a JSON object containing the key &ldquo;pk&rdquo; to modify
the primary key. The &ldquo;pk&rdquo; key should be a list containing zero or more variable URLs.
The variables referenced must be either text or numeric type
and must have no duplicate or missing values.  Setting pk to <code class="prettyprint">[]</code> is
equivalent to deleting the primary key for a dataset.</p>

<aside class="notice">
    We currently support only a single primary key variable, so the POST payload
    array should be of length zero or one.
</aside>

<h6 id="delete">DELETE</h6>
<pre class="highlight http"><code><span class="nf">DELETE</span> <span class="nn">/api/datasets/{dataset_id}/pk/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>

--------
204 No Content
</code></pre>
<pre class="highlight shell"><code></code></pre>
<pre class="highlight r"><code></code></pre>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="c"># "ds" is dataset via pycrunch</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">pk</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">pk</span>
<span class="p">[]</span>
</code></pre>

<p><code class="prettyprint">DELETE /datasets/{dataset_id}/pk/</code></p>

<p>DELETE the &ldquo;pk&rdquo; resource to delete the primary key for this dataset.  Upon
success, this method returns no body and a 204 response code.</p>

<h4 id="catalogs">Catalogs</h4>

<h5 id="users">Users</h5>

<p><code class="prettyprint">/datasets/{dataset_id}/users/</code></p>

<p>This catalog exposes the full list of users that have access to the dataset
via the different sources:</p>

<ul>
<li>When the dataset belongs to a project, as project members</li>
<li>Members of teams that are shared with the dataset</li>
<li>Direct shares to specific users</li>
</ul>

<p>This endpoint only supports GET, the response will be a catalog with each user
as member with the tuple indicating the coalesced permissions and information
about the type of access:</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>Name of the user</td>
</tr>
<tr>
<td>email</td>
<td>Email of the user</td>
</tr>
<tr>
<td>teams</td>
<td>URLs of teams with dataset access this user belongs to</td>
</tr>
<tr>
<td>last_accessed</td>
<td>Timestamp of last access to dataset via web app</td>
</tr>
<tr>
<td>project_member</td>
<td>If dataset is part of a project and this user too</td>
</tr>
<tr>
<td>coalesced_permissions</td>
<td>Permissions this user has to this access, combining all sources</td>
</tr>
</tbody></table>
<pre class="highlight json"><code><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nt">"https://app.crunch.io/api/users/411aa32a075b4b57bf25a4ace1baf920/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jean-Luc Picard"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"last_accessed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-02-25T00:00:00+00:00"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"teams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"https://app.crunch.io/api/teams/c6dbeb7c57e34dd08ab2316f3363e895/"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"https://app.crunch.io/api/teams/d0abf4e933fc44e38190247ae4d593f9/"</span><span class="w">
    </span><span class="p">],</span><span class="w"> 
    </span><span class="nt">"project_member"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jeanluc@crunch.io"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"coalesced_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
      </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
      </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> 
  </span><span class="nt">"https://app.crunch.io/api/users/60f18c51699b4ba992721197743286a4/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"William Riker"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"last_accessed"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"teams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"https://app.crunch.io/api/teams/d0abf4e933fc44e38190247ae4d593f9/"</span><span class="w">
    </span><span class="p">],</span><span class="w"> 
    </span><span class="nt">"project_member"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"number1@crunch.io"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"coalesced_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> 
      </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> 
      </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w"> 
  </span><span class="nt">"https://app.crunch.io/api/users/80d89e4e876344ecb46c528a910e3877/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Geordi La Forge"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"last_accessed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-01-31T00:00:00+00:00"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"teams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"https://app.crunch.io/api/teams/c6dbeb7c57e34dd08ab2316f3363e895/"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"https://app.crunch.io/api/teams/d0abf4e933fc44e38190247ae4d593f9/"</span><span class="w">
    </span><span class="p">],</span><span class="w"> 
    </span><span class="nt">"project_member"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"geordilf@crunch.io"</span><span class="p">,</span><span class="w"> 
    </span><span class="nt">"coalesced_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
      </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
      </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>

<h5 id="actions">Actions</h5>

<h5 id="batches">Batches</h5>

<p><code class="prettyprint">/datasets/{dataset_id}/batches/</code></p>

<p>See <a href="#batches">Batches</a> and the feature guides for <a href="#importing-data">importing</a> and <a href="#appending-data">appending</a>.</p>

<h5 id="decks">Decks</h5>

<p><code class="prettyprint">/datasets/{dataset_id}/decks/</code></p>

<p>See <a href="#decks">Decks</a>.</p>

<h5 id="comparisons">Comparisons</h5>

<h5 id="filters">Filters</h5>

<p><code class="prettyprint">/datasets/{dataset_id}/filters/</code></p>

<p>See <a href="#filters">Filters</a>.</p>

<h5 id="forks">Forks</h5>

<h5 id="joins">Joins</h5>

<h5 id="multitables">Multitables</h5>

<h5 id="permissions">Permissions</h5>

<p><code class="prettyprint">/datasets/{dataset_id}/permissions/</code></p>

<p>See <a href="#permissions">Permissions</a>.</p>

<h5 id="savepoints">Savepoints</h5>

<p><code class="prettyprint">/datasets/{dataset_id}/savepoints/</code></p>

<p>See <a href="#versions">Versions</a>.</p>

<h5 id="variables">Variables</h5>

<p><code class="prettyprint">/datasets/{dataset_id}/variables/</code></p>

<p>See <a href="#variables">Variables</a>.</p>

<h5 id="weight-variables">Weight variables</h5>

          <h2 id="decks">Decks</h2>

<p>Decks allow you to store <a href="#analysis">analyses</a> for future reference or for export.
Decks correspond to a single dataset, and they are personal to each user unless they have been set as &ldquo;public&rdquo;. Each deck contains a list of slides, and each slide contains analyses.</p>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/decks/</code></p>

<h4 id="get">GET</h4>

<p>A GET request on the catalog endpoint will return all the decks available for
this dataset for the current user. This includes decks created by
the user, as well as public decks shared with all users of the dataset.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/cc9161/decks/4fa25/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my new deck"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1986-11-26T12:05:00"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4fa25"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
          </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/abcd3/"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Real Person"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/cc9161/decks/2b53e/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Default deck"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1987-10-15T11:45:00"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2b53e"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/4cba5/"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Other Person"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/order/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The decks catalog tuples contain the following keys:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>creation_time</td>
<td>timestamp</td>
<td>Time when this deck was created</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>Global unique identifier for this deck</td>
</tr>
<tr>
<td>is_public</td>
<td>boolean</td>
<td>Indicates whether this is a public deck or not</td>
</tr>
<tr>
<td>owner_id</td>
<td>url</td>
<td>Points to the owner of this deck</td>
</tr>
<tr>
<td>owner_name</td>
<td>string</td>
<td>Name of the owner of the deck (referred by <code class="prettyprint">owner_id</code>)</td>
</tr>
</tbody></table>

<p>To determine if a deck belongs to the current user, check the <code class="prettyprint">owner_id</code> attribute.</p>

<h4 id="post">POST</h4>

<p>POST a shoji:entity to create a new deck for this dataset. The only required body attribute is &ldquo;name&rdquo;; other attributes are optional.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my new deck"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This deck will contain analyses for a variable"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://app.crunch.io/api/datasets/223fd4/decks/2b3c5e/</span>

</code></pre>

<p>The <code class="prettyprint">shoji:entity</code> POSTed accepts the following keys</p>

<p>Name | Type | required | Description
&mdash;- | &mdash;- | &mdash;&mdash;&mdash;&ndash;
name | string | Yes | Human-friendly string identifier
description | string | No | Optional longer string with additional notes
is_public | boolean | No | If <code class="prettyprint">true</code>, all users with view access to this dataset will be able to read and export this deck and its analyses; if <code class="prettyprint">false</code>, the default value, the deck remains private for the current user only.</p>

<h4 id="patch">PATCH</h4>

<p>It is possible to bulk-edit many decks at once by PATCHing a shoji:catalog to
the decks&rsquo; catalog.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/cc9161/decks/4fa25/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Renamed deck"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/order/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The following attributes are editable via PATCHing this resource:</p>

<ul>
<li>name</li>
<li>description</li>
<li>is_public</li>
</ul>

<p>For decks that the current user owns, &ldquo;name&rdquo;, &ldquo;description&rdquo;, and &ldquo;is_public&rdquo; are editable. Users with edit permissions on the dataset may edit &ldquo;name&rdquo; and &ldquo;description&rdquo; of public decks, but they cannot edit &ldquo;is_public&rdquo; unless they own the deck. Other deck attributes are not editable and will respond with 400 status if the request tries to change them.</p>

<p>On success, the server will reply with a 204 response.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/decks/{id}/</code></p>

<h4 id="get">GET</h4>

<p>GET a deck entity resource to return a shoji:entity with all of its attributes:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/223fd4/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Presentation deck"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"223fd4"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1987-10-15T11:45:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Explanation about the deck"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/abcd3/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Real Person"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>Global unique identifier for this deck</td>
</tr>
<tr>
<td>creation_time</td>
<td>timestamp</td>
<td>Time when this deck was created</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Longer annotations for this deck</td>
</tr>
<tr>
<td>is_public</td>
<td>boolean</td>
<td>Indicates whether this is a public deck or not</td>
</tr>
<tr>
<td>owner_id</td>
<td>url</td>
<td>Points to the owner of this deck</td>
</tr>
<tr>
<td>owner_name</td>
<td>string</td>
<td>Name of the owner of the deck (referred by <code class="prettyprint">owner_id</code>)</td>
</tr>
</tbody></table>

<h4 id="patch">PATCH</h4>

<p>To edit a deck, PATCH it with a
shoji:entity. The server will return a 204 response on success or 400
if the request is invalid.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/223fd4/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Presentation deck"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"223fd4"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1987-10-15T11:45:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Explanation about the deck"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</code></pre>

<p>As with the catalog, for decks that the current user owns, &ldquo;name&rdquo;, &ldquo;description&rdquo;, and &ldquo;is_public&rdquo; are editable. Users with edit permissions on the dataset may edit &ldquo;name&rdquo; and &ldquo;description&rdquo; of public decks, but they cannot edit &ldquo;is_public&rdquo; unless they own the deck. Other deck attributes are not editable.</p>

<h4 id="delete">DELETE</h4>

<p>To delete a deck, DELETE the deck&rsquo;s entity URL. On success, the server returns
a 204 response.</p>

<h3 id="order">Order</h3>

<p><code class="prettyprint">/datasets/{id}/decks/order/</code></p>

<p>The deck order resource allows the user to arrange how API clients, such as the web application, will present the deck catalog. The deck order contains all decks that are visible to the current user, both personal and public. Unlike many other
<code class="prettyprint">shoji:order</code> resources, this order does not allow grouping or nesting: it
will always be a flat list of slide URLs.</p>

<h4 id="get">GET</h4>

<p>Returns a <a href="#shoji-order">Shoji Order</a> response.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/order/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/1/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/2/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/3/"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>

<h4 id="patch">PATCH</h4>

<p>PATCH the order resource to change the order of the decks. A 204 response indicates success.</p>

<p>If the PATCH payload contains only a subset of available decks, those
decks not referenced will be appended at the bottom of the top level graph in arbitrary
order.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/order/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/1/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/datasets/223fd4/decks/3/"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Including invalid URLs, such as URLs of decks that are not present in the catalog, will
 return a 400 response from the server.</p>

<p>The deck order should always be a flat list of URLs. Nesting or grouping is not
supported by the web application. Server will return a 400 response if the order supplied in the PATCH request has nesting.</p>

<h2 id="slides">Slides</h2>

<p>Each deck contains a catalog of slides into which analyses are saved.</p>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/decks/{deck_id}/slides/</code></p>

<h4 id="get">GET</h4>

<p>Returns a <code class="prettyprint">shoji:catalog</code> with the slides for this deck.</p>
<pre class="highlight json"><code><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/decks/123/slides/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"flat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/decks/123/slides/flat/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/specifications/slides/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A catalog of the Slides in this Deck"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/123/decks/123/slides/123/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"analysis_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/decks/123/slides/123/analyses/123/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"subtitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">"z"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"slide 1"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/123/decks/123/slides/456/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"analysis_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/123/decks/123/slides/456/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"subtitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"slide 2"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>

<p>Each tuple on the slides catalog contains the following keys:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>analysis_url</td>
<td>url</td>
<td>Points to the first (and typically only) analysis contained on this slide</td>
</tr>
<tr>
<td>title</td>
<td>string</td>
<td>Optional title for the slide</td>
</tr>
<tr>
<td>subtitle</td>
<td>string</td>
<td>Optional subtitle for the slide</td>
</tr>
<tr>
<td>display</td>
<td>object</td>
<td>Stores settings used to load the analysis</td>
</tr>
</tbody></table>

<h4 id="post">POST</h4>

<p>To create a new slide, POST a slide body to the slides catalog. It is necessary
to include at least one analysis on the new slide.</p>

<p>The body should contain an <code class="prettyprint">analyses</code> attribute that contains an array with
one or many analyses bodies as described in the <a href="#analyses">below</a> section,
should be wrapped as a shoji:entity.</p>

<p>On success, the server returns a 201 response with a Location header containing
the URL of the newly created slide entity with its first analysis.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New slide"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"subtitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Variable A and B"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"analyses"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
      </span><span class="nt">"query_environment"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
      </span><span class="nt">"display_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
      </span><span class="nt">"query_environment"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
      </span><span class="nt">"display_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>On each analysis, only a <code class="prettyprint">query</code> field is required to create a new slide; other attributes are optional.</p>

<p>Slide attributes:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>title</td>
<td>string</td>
<td>Optional title for the slide</td>
</tr>
<tr>
<td>subtitle</td>
<td>string</td>
<td>Optional subtitle for the slide</td>
</tr>
</tbody></table>

<p>Analysis attributes:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>query</td>
<td>object</td>
<td>Contains a valid analysis query, required</td>
</tr>
<tr>
<td>subtitle</td>
<td>string</td>
<td>Optional subtitle for the slide</td>
</tr>
<tr>
<td>display_settings</td>
<td>object</td>
<td>Contains a set of attribtues to be interpreted by the client to render and export the analysis</td>
</tr>
<tr>
<td>query_environment</td>
<td>object</td>
<td>Contains the <code class="prettyprint">weight</code> and <code class="prettyprint">filter</code> applied during the analysis, they will be applied up on future evaluation/render/export</td>
</tr>
</tbody></table>

<h5 id="old-format">Old format</h5>

<p>It is possible to create slides with one single initial analysis by POSTing an
analysis body directly to the slides catalog. It will create a slide automatically
with the new analysis on it:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New slide"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"subtitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Variable A and B"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="nt">"query_environment"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="nt">"display_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="patch">PATCH</h4>

<p>It is possible to bulk-edit several slides at once by PATCHing a shoji:catalog
to this endpoint.</p>

<p>The only editable attributes with this method are:</p>

<ul>
<li>title</li>
<li>subtitle</li>
</ul>

<p>Other attributes should be considered read-only.</p>

<p>Submitting invalid attributes or references to other slides results in a 400
error response.</p>

<p>To edit the first or any of the slide&rsquo;s analyses query attributes it is necessary
to PATCH the individual analysis entity.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/223fd4/decks/slides/a126ce/</code></p>

<p>Each slide in the Slide Catalog contains reference to its first analysis.</p>

<h4 id="get">GET</h4>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/datasets/123/decks/123/slides/123/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"catalogs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"analyses"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/datasets/123/decks/123/slides/123/analyses/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Returns the detail information for a given slide"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"deck_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"subtitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">"z"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"slide 1"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"analysis_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/datasets/123/decks/123/slides/123/analyses/123/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="delete">DELETE</h4>

<p>Perform a DELETE request on the Slide entity resource to delete the slide and its analyses.</p>

<h4 id="patch">PATCH</h4>

<p>It is possible to edit a slide entity by PATCHing with a shoji:entity.</p>

<p>The editable attributes are:</p>

<ul>
<li>title</li>
<li>subtitle</li>
</ul>

<p>The other attributes are considered read-only.</p>

<h3 id="order">Order</h3>

<p><code class="prettyprint">/datasets/223fd4/decks/slides/flat/</code></p>

<p>The owner of the deck can specify the order of its slides. As with deck order, the slide order must be a flat list of slide URLs.</p>

<h4 id="get">GET</h4>

<p>Returns the list of all the slides in the deck.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/datasets/123/decks/123/slides/flat/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Order of the slides on this deck"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"/api/datasets/123/decks/123/slides/123/"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"/api/datasets/123/decks/123/slides/456/"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="patch">PATCH</h4>

<p>To make changes to the order, a client should PATCH the full <code class="prettyprint">shoji:order</code>
resource to the endpoint with the new order on its <code class="prettyprint">graph</code> attribute.</p>

<p>Any slide not mentioned on the payload will be added at the end of the graph
in arbitrary order.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/datasets/123/decks/123/slides/flat/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Order of the slides on this deck"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"/api/datasets/123/decks/123/slides/123/"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"/api/datasets/123/decks/123/slides/456/"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This is a flat order: grouping or nesting is not allowed. PATCHing with a nested order will generate a 400 response.</p>

<h2 id="analysis">Analysis</h2>

<p>Each slide contains one or more analyses. An analysis &ndash; a table or graph with some specific combination of variables
defining measures, rows, columns, and tabs; settings such as percentage
direction and decimal places &ndash; can be saved to a <em>deck</em>, which can then be
exported, or the analysis can be reloaded in whole in the application or even
exported as a standalone embeddable result.</p>

<h3 id="catalog">Catalog</h3>
<pre class="highlight plaintext"><code>/api/datasets/123/decks/123/slides/123/analyses/
</code></pre>

<h4 id="post">POST</h4>

<p>To create multiple analyses on a slide, clients should POST analyses
to the slide&rsquo;s analyses catalog.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dimensions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"query_environment"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"expression"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(Optional)"</span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"weight"</span><span class="p">:</span><span class="w"> </span><span class="s2">"url"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"display_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"decimalPlaces"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"percentageDirection"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"colPct"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"vizType"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"countsOrPercents"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"percent"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"uiView"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"expanded"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The server will return a 201 response with the new slide created.
In case of invalid analysis attributes, a 400 response will be returned
indicating the problems.</p>

<h4 id="patch">PATCH</h4>

<p>It is possible to delete many analyses at once from the catalog sending
<code class="prettyprint">null</code> as their tuple. It is not possible to delete all the analysis
from a slide. For that it is necessary to delete the slide itself.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"/api/datasets/123/decks/123/slides/123/analyses/1/"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"/api/datasets/123/decks/123/slides/123/analyses/2/"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A 204 response will be returned on success.</p>

<h3 id="order">Order</h3>

<p>As analyses get added to a slide, they will be stored on a
<code class="prettyprint">shoji:order</code> resource.</p>

<p>Like other order resources, it will expose a <code class="prettyprint">graph</code> attribute that contains
the list of created analyses having new ones added at the end.</p>

<p>If an incomplete set of analyses is sent to the graph, the missing analyses
will be added in arbitrary order.</p>

<p>This is a flat order and does not allow nesting.</p>

<h3 id="entity">Entity</h3>

<p>An analysis is defined by a <em>query</em>, <em>query environment</em>, and <em>display settings</em>.
To save an analysis, <code class="prettyprint">POST</code> these to a deck as a new slide.</p>

<aside class="notice">
Analysis queries are described in detail in the
[feature guide](#multidimensional-analysis). [Filters](#filters) may contain a
mix of stored filters or expressions. Expressions may contain an optional
`name` which may be used to label results.
</aside>

<p>Display settings can be anything a client may need to reproduce the view of the
data returned from the query. The settings the Crunch web client uses are shown
here, but other clients are free to store other attributes as they see fit.
Display settings should be objects with a <code class="prettyprint">value</code> member.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dimensions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"query_environment"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"expression"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(Optional)"</span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"weight"</span><span class="p">:</span><span class="w"> </span><span class="s2">"url"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"display_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"decimalPlaces"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"percentageDirection"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"colPct"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"vizType"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"countsOrPercents"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"percent"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"uiView"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"expanded"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>query</td>
<td>Includes the query body for this analysis</td>
</tr>
<tr>
<td>query_environment</td>
<td>An object with a <code class="prettyprint">weight</code> and <code class="prettyprint">filters</code> to be used for rendering/evaluating this analysis</td>
</tr>
<tr>
<td>display_settings</td>
<td>An object containing client specific instructions on how to recreate the analysis</td>
</tr>
</tbody></table>

<h4 id="patch">PATCH</h4>

<p>To edit an analysis, PATCH its URL with a shoji:entity.</p>

<p>The editable attributes are:</p>

<ul>
<li>query</li>
<li>query_environment</li>
<li>display_settings</li>
</ul>

<p>Providing invalid values for those attributes or extra attributes will be rejected with a 400 response from the server.</p>

<h4 id="delete">DELETE</h4>

<p>It is possible to delete analyses from a slide as long as there is always
one analysis left.</p>

<p>Attempting to delete the last analysis of a slide will cause a 409 response
from the server indicating the problem.</p>

          <h2 id="filters">Filters</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/filters/</code></p>

<p>GET on this resource returns a Shoji Catalog with the list of Filters that the
current user can use on this Dataset.</p>

<p>This index contains two kinds of filters: public and private, denoted by the <code class="prettyprint">is_public</code> tuple attribute. Private filters are those created by the authenticated user, and they cannot be accessed by other users. Public filters are available to all users who are authorized to view the dataset.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My filter"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1442ea"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/4152de/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The only tuple attribute editable via PATCHing the catalog is the &ldquo;name&rdquo;. A 204 response indicates a successful PATCH. Attempting to PATCH any other attribute will
return a 400 response.</p>

<p>POST a Shoji Entity to this catalog to create a new filter. Entities must include a <code class="prettyprint">name</code> and an
<code class="prettyprint">expression</code>. If omitted, <code class="prettyprint">is_public</code> defaults to False. A successful POST yields a 201 response
that will contain a Location header with the URL of the newly created filter.</p>

<p>All users with access to the dataset can create private filters; however, only the current dataset editor can create public filters (<code class="prettyprint">is_public: true</code>). Attempting to create a public filter when not the current dataset editor results in a 403 response.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/filters/{id}/</code></p>

<p>GET this resource to return a Shoji Entity containing the requested filter.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/ac64ef/filters/1442ea/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1442ea"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My filter"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"expression"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
        </span><span class="nt">"last_update"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-12-31"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-11-12T12:34:56"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>PATCH an entity to edit its <code class="prettyprint">expression</code>, <code class="prettyprint">name</code>, or <code class="prettyprint">is_public</code> attributes. Successful PATCH requests return 204 status. As with the POSTing new entities to the catalog, only the dataset&rsquo;s current editor can alter <code class="prettyprint">is_public</code>.</p>

<p>The <code class="prettyprint">expression</code> attribute must contain a valid Crunch filter expression.</p>

<!-- Discuss valid crunch filter expressions -->

<p>See <a href="#expressions">expressions</a> in the Object Reference for more details.</p>

<h3 id="applied-filters">Applied filters</h3>

<p><code class="prettyprint">/datasets/{id}/filters/applied/</code></p>

<p>A Shoji order containing the filters applied by the current user.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/filters/applied/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/filters/28ef72/"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/filters/0ac6e1/"</span><span class="p">,</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>PUT the applied endpoint to change the which filters are applied for other operations.
The graph parameter indicates which filters are applied.  Successful PUT requests return 204 status.</p>

<h3 id="filter-order">Filter Order</h3>

<p><code class="prettyprint">GET /datasets/{id}/filters/order/</code></p>

<p>A Shoji order containing the persisted filter order.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/filters/order/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/filters/28ef72/"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/filters/0ac6e1/"</span><span class="p">,</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>PATCH the order to change the order of the filters.  The graph parameter indicates the order.  Private filters
are not included in the order.  Any filters that are missing are appended to the end of the order. Successful
PATCH requests return 204 status.</p>

<h3 id="filtering-endpoints">Filtering endpoints</h3>

<p>Some endpoints will support filtering, they will accept a <code class="prettyprint">filter</code> GET parameter
that can be a JSON encoded object that can contain either the URL of a filter
(available through the Filters catalog) or a filter expression or a filter URL.</p>

<p>To filter using a filter URL using JSON pass in an object as the <code class="prettyprint">filter</code>
parameter:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/filters/28ef72/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/id/summary/?filter=%7B%22filter%22%3A%22http%3A%2F%2Fapp.crunch.io%2Fapi%2Fdatasets%2Fac64ef%2Ffilters%2F28ef72%2F%22%7D</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<p>It is also possible to send straight filter URLs without a JSON wrapping:</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/id/summary/?filter=http%3A%2F%2Fapp.crunch.io%2Fapi%2Fdatasets%2Fac64ef%2Ffilters%2F28ef72%2F</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<p>Or multiple filters that will be ANDed together</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/id/summary/?filter=http%3A%2F%2Fapp.crunch.io%2Fapi%2Fdatasets%2Fac64ef%2Ffilters%2F28ef72%2F&amp;filter=http%3A%2F%2Fapp.crunch.io%2Fapi%2Fdatasets%2Fac64ef%2Ffilters%2F28ef72%2F</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<p>To filter using a filter expression, pass a Crunch filter expression as the
<code class="prettyprint">filter</code> parameter, like:</p>
<pre class="highlight json"><code><span class="w">    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"=="</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/variables/aae3c2/"</span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/id/summary/?filter=%7B%22function%22%3A%22%3D%3D%22%2C%22args%22%3A%5B%7B%22variable%22%3A%22http%3A%2F%2Fapp.crunch.io%2Fapi%2Fdatasets%2Fac64ef%2Fvariables%2Faae3c2%2F%22%7D%2C%7B%22value%22%3A1%7D%5D%7D</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<p>Filter expressions can be combined with filter URLs to make reference to other filters, like so:</p>
<pre class="highlight json"><code><span class="w">    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"and"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/filters/28ef72/"</span><span class="w">
            </span><span class="p">},</span><span class="w">
           </span><span class="p">{</span><span class="w">
                </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"=="</span><span class="p">,</span><span class="w">
                </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/datasets/ac64ef/variables/aae3c2/"</span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">    
</span></code></pre>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/id/summary/?filter=%7B%22function%22%3A+%22and%22%2C+%22args%22%3A+%5B%7B%22filter%22%3A+%22http%3A%2F%2Fapp.crunch.io%2Fapi%2Fdatasets%2Fac64ef%2Ffilters%2F28ef72%2F%22%7D%2C+%7B%22function%22%3A+%22%3D%3D%22%2C+%22args%22%3A+%5B%7B%22variable%22%3A+%22http%3A%2F%2Fapp.crunch.io%2Fapi%2Fdatasets%2Fac64ef%2Fvariables%2Faae3c2%2F%22%7D%2C+%7B%22value%22%3A+1%7D%5D%7D%5D%7D</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

          <h2 id="geodata">Geodata</h2>

<p>Geodata allow you to associate a variable with features in a FeatureCollection
of geojson or topojson.</p>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/geodata/</code></p>

<h4 id="get">GET</h4>

<p>Crunch maintains a few geojson/topojson resources and publishes them on CDN.
GET the catalog <a href="https://app.crunch.io/api/geodata/">https://app.crunch.io/api/geodata/</a> for an index of available
geographies, each of which then includes a location to download the actual
geojson or topojson.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/geodata/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/geodata/7ae898e210b04a9a8992314452c6677b/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"use properties.name or properties.postal-code"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-07-08T16:33:44.601000+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US States GeoJSON Name + Postal Code"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://s.crunch.io/geodata/leafletjs/us-states.geojson"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7ae898e210b04a9a8992314452c6677b"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The geodata catalog tuples contain the following keys:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>created</td>
<td>timestamp</td>
<td>Time when the item was created</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>Global unique identifier for this deck</td>
</tr>
<tr>
<td>location</td>
<td>uri</td>
<td>Location of crunch-curated geojson/topojson file. Users may need to inspect this actual file to learn about details of the FeatureCollection and individual Features.</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Any additional information about the geodatum</td>
</tr>
<tr>
<td>metadata</td>
<td>object</td>
<td>Information regarding the actual data provided by the location.  For now, the properties in the geodata features are extracted for the purpose of matching geodata to variable categories.</td>
</tr>
</tbody></table>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/geodata/id/</code></p>

<h4 id="get">GET</h4>

<p>Crunch maintains a few geojson/topojson resources and publishes them on CDN.
Most of their properties, with the exception of <code class="prettyprint">metadata</code>, are present on the catalog
tuple, described above; metadata is an open field but may be populated at creation time
by a Crunch utility that extracts and aggregates across features of geojson and topojson
resources. For other formats, users may supply relevant metadata for the geodatum resource.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/geodata/7ae898e210b04a9a8992314452c6677b/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"use properties.name or properties.postal-code"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-07-08T16:33:44.601000+00:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US States GeoJSON Name + Postal Code"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://s.crunch.io/geodata/leafletjs/us-states.geojson"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7ae898e210b04a9a8992314452c6677b"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"postal-code"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"AL"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"AK"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"AZ"</span><span class="p">,</span><span class="w"> </span><span class="s2">"etc."</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"Alabama"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"Arkansas"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"Alaska"</span><span class="p">,</span><span class="w"> </span><span class="s2">"etcetera"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="geodata-for-common-applications">Geodata for common applications</h3>

<ul>
<li><a href="https://app.crunch.io/api/geodata/7ae898e210b04a9a8992314452c6677b/">https://app.crunch.io/api/geodata/7ae898e210b04a9a8992314452c6677b/</a>
<strong>US States</strong> –
Use <code class="prettyprint">properties.name</code> or <code class="prettyprint">properties.postal-code</code> as your <code class="prettyprint">feature_key</code> depending on the variable (state name or abbreviation), or <code class="prettyprint">id</code> is FIPS code.</li>
<li><a href="https://app.crunch.io/api/geodata/8f9f5fed101042c4815d2dd1fd248cec/">https://app.crunch.io/api/geodata/8f9f5fed101042c4815d2dd1fd248cec/</a>
<strong>World</strong> –
<code class="prettyprint">properties</code> include ISO3166 <code class="prettyprint">name</code> as well as ISO3166-1 Alpha-3 <code class="prettyprint">abbrev</code></li>
<li><a href="https://app.crunch.io/api/geodata/d878d8471090417fa361536733e5f176/">https://app.crunch.io/api/geodata/d878d8471090417fa361536733e5f176/</a>
<strong>UK Regions</strong> –
<code class="prettyprint">properties.EER13NM</code> matches a YouGov stylization of United Kingdom region names.</li>
</ul>

<h3 id="creating-new-public-geodatum">Creating new public Geodatum</h3>

<p>Users with permission to create datasets can also create geodata, although in practice Crunch curates and makes available 
many common geographies, listed in the geodata catalog. Note that geodata created outside of the Crunch domain
(ie without a .crunch.io domain in the URL) will not be available in whaam due to browser constraints.
If you would like to make your geodatum public and have Crunch serve it, please contact us!</p>

<p>Adding a new geodatum is as easy as POSTing it to the geodata catalog, most easily via pycrunch. Crunch will attempt to download
the geodata file and analyze the properties present on the features (generally polygons), which can then be associated
with Crunch variables. The metadata extraction and summary can help you align variables and select the right property to 
associate with your Crunch geographic variable by category name.</p>

<p>Include a <code class="prettyprint">format</code> member in the payload (on post or patch) to trigger automatic metadata extraction. The server will
fetch and aggregate properties from FeatureCollections in order to provide hints for eventual consumers of the Crunch 
geodatum. The automatic feature extractor supports GeoJSON and TopoJSON formats; you may register a Shapefile (shp) or
other resource as a Crunch geodatum, but will have to supply <code class="prettyprint">metadata</code> hints yourself and are advised to indicate its
non-json format.</p>

<p>The lists of properties returned in the metadata are correlated, such that if a feature in your geodata is missing a
 given property, it will return null.</p>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pycrunch</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">site</span> <span class="o">=</span> <span class="n">pycrunch</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"me@mycompany.com"</span><span class="p">,</span> <span class="s">"yourpassword"</span><span class="p">,</span> <span class="s">"https://app.crunch.io/api/"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">geodata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">as_entity</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'test_geojson'</span><span class="p">,</span>
                                                  <span class="s">'location'</span><span class="p">:</span> <span class="s">'https://s.crunch.io/geodata/leafletjs/us-states.geojson'</span><span class="p">,</span>
                                                  <span class="s">'description'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span>
                                                  <span class="s">'format'</span><span class="p">:</span> <span class="s">'geojson'</span><span class="p">}))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">geodata</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">metadata</span>
<span class="n">pycrunch</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">JSONObject</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
    <span class="s">"postal-code"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">"AL"</span><span class="p">,</span> 
        <span class="s">"AK"</span><span class="p">,</span> 
        <span class="s">"AZ"</span><span class="p">,</span> 
        <span class="s">"AK"</span><span class="p">,</span> 
        <span class="s">"CA"</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">"Alabama"</span><span class="p">,</span> 
        <span class="s">"Alaska"</span><span class="p">,</span> 
        <span class="s">"Arizona"</span><span class="p">,</span> 
        <span class="s">"Arkansas"</span><span class="p">,</span> 
        <span class="s">"California"</span><span class="p">,</span> <span class="o">...</span><span class="p">]})</span>

</code></pre>

<h3 id="modifying-your-public-geodata">Modifying your public Geodata</h3>

<p>You can modify any Geodatum that you own.  Note that you can transfer ownership to another user if you change the owner_id
of your geodatum.  You may also change the metadata of your geodatum, but keep in mind that if you do this you will override
any automated metadata extraction that Crunch provides. If you modify the location of the geodatum and do not provide
a metadata parameter in the patch, Crunch will automatically extract metadata as long as the location is publicly accessible.</p>
<pre class="highlight python"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pycrunch</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">site</span> <span class="o">=</span> <span class="n">pycrunch</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"me@mycompany.com"</span><span class="p">,</span> <span class="s">"yourpassword"</span><span class="p">,</span> <span class="s">"https://app.crunch.io/api/"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s">'&lt;geodatum_url&gt;'</span><span class="p">]</span><span class="o">.</span><span class="n">entity</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">entity</span><span class="o">.</span><span class="n">patch</span><span class="p">({</span><span class="s">'description'</span><span class="p">:</span> <span class="s">'US States'</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">entity</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">entity</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">description</span>
<span class="n">US</span> <span class="n">States</span>
</code></pre>

<h3 id="associating-variables-with-geodata">Associating Variables with Geodata</h3>

<p>To make maps with variables, update a variable’s <code class="prettyprint">view</code> (or include with metadata at creation) as follows, where
<code class="prettyprint">feature_key</code> is key defined for each Feature in the geojson/topojson that matches the relevant field on the
variable at hand (generally category <code class="prettyprint">name</code>s).</p>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"geodata"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"geodatum"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;uri&gt;"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"feature_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"properties.name"</span><span class="p">}</span><span class="w">
    </span><span class="p">]}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h2 id="joins">Joins</h2>

<aside class="warning">
Joins are an experimental feature. Beware when using it, and expect significant future changes. To instead add a snapshot of columns to a dataset, see the &ldquo;Extend&rdquo; feature guide. This feature is more stable than the dynamic join described here.
</aside>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/joins/</code></p>

<p>A GET on this resource returns a Shoji Catalog enumerating the joins present in the Dataset. Each tuple in the index includes a &ldquo;left_key&rdquo; and a &ldquo;right_key&rdquo; member, each of which MUST be a variable URI. The left_key MUST be a variable in the current dataset, and the right_key SHOULD be a variable in another dataset. Both variables MUST be unique, and should be values taken from the same domain. For example, you might have a principal dataset which is a survey, with a respondent_id variable as a unique key. If you join a separate demographic dataset that has a unique column of the same respondent ids, you might see:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/837498a/joins/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/datasets/837498a/joins/demo/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"left_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/837498a/variables/1ef71d/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"right_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/de3095/variables/19471d/"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A PATCH to this resource may add joins (by including new index members), alter existing joins (by replacing existing index members), or deleting joins (by setting existing members to null). A 204 indicates success. As with any Shoji Catalog, the URI of each entity in the index is the key.</p>

<p>Variables in joined datasets may then be used in analyses as if they were part of the principal dataset, simply by using their URI in this join&rsquo;s variables catalog (see below). The joined dataset includes one row for each row in the principal dataset, by taking the key in the principal and looking up the corresponding key and row in the subordinate dataset. Rows in the principal which have no corresponding row in the subordinate are filled with the &ldquo;No Data&rdquo; missing value.</p>

<p>In order to create or alter a new join, the authenticated user will need to have reading access to the right dataset otherwise the server will respond with a 400 error.</p>

<p>The variable url sent for the left key must be a valid url for the current dataset. It is not allowed to use a different dataset as a left table.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/joins/{id}/</code></p>

<p>A GET on this resource returns a Shoji Entity describing the join, and a link to its Crunch Table (see next). Currently, the Join entity only contains the batch_id for its frame, and therefore isn&rsquo;t very useful for clients. The entity resource is not editable; PATCH the joins catalog instead.</p>

<h3 id="joined-variables-catalog">Joined variables catalog</h3>

<p><code class="prettyprint">/datasets/{id}/joins/{id}/variables/</code></p>

<p>A variables catalog which describes variables in the subordinate dataset. See <a href="#variables">Variables</a> for more details.</p>

          <h2 id="multitables">Multitables</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{dataset_id}/multitables/</code></p>

<h4 id="get">GET</h4>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/datasets/123/multitables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/specifications/multitables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of multitable definitions for this dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"/api/datasets/123/multitables/7ab1e/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/users/b055/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Basic Demographics"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7ab1e"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>GET on this resource returns a Shoji Catalog with the list of Multitables that the
current user can use on this Dataset.</p>

<p>This index contains two kinds of multitables: those that belong to the dataset, denoted by the <code class="prettyprint">is_public</code> tuple attribute; and those that belong to the current user. Personal multitables are those created by the authenticated user, and they cannot be accessed by other users. Dataset multitables are available to all users who are authorized to view the dataset.</p>

<h4 id="post">POST</h4>

<p>POST a Shoji Entity to this catalog to create a new multitable definition. 
Entities must include a <code class="prettyprint">name</code> and <code class="prettyprint">template</code>; the <a href="#template-query">template</a> 
must contain a series of objects with a <code class="prettyprint">query</code> and optionally 
<a href="#transforming-analyses-for-presentation"><code class="prettyprint">transform</code></a>. If omitted, <code class="prettyprint">is_public</code> 
defaults to <code class="prettyprint">false</code>. A successful POST yields a 201 response
that will contain a Location header with the URL of the newly created multitable.</p>

<p>All users with access to the dataset can create personal multitable definitions; 
however, only the current dataset editor can create public multitables 
(<code class="prettyprint">is_public: true</code>) which everyone with access to the dataset can see. 
Attempting to create a public multitable when not the current dataset editor 
results in a 403 response.</p>

<h5 id="copying-multitables-between-datasets">Copying Multitables between datasets</h5>

<p>It is possible to copy over a multitables between datasets as long as the 
permissions allow it.</p>

<p>Multitable copying requires that all the variables present in the <code class="prettyprint">template</code>
of the origin multitable exist on the target dataset and that they all have
the same type.</p>

<p>POST a shoji entity to the catalog with indicating the URL of the multitable
to copy:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name of my copy"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"multitable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/datasets/123/multitables/7ab1e/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>As shown in the example, it is possible to assign a new name to the copy.
By default all copies will be private unless specified in the body.</p>

<h4 id="patch">PATCH</h4>

<p>There are no elements of the catalog that can be changed via PATCH.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{dataset_id}/multitables/{multitable_id}/</code></p>

<h4 id="get">GET</h4>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/123/multitables/7ab1e/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"tabbook"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/datasets/123/multitables/7ab1e/tabbook/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/specifications/multitables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Detail information for one multitable definition"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Basic Demographics"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/users/b055/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/datasets/123/variables/abc/"</span><span class="w">
            </span><span class="p">}]</span><span class="w">
        </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/datasets/123/variables/def/"</span><span class="w">
            </span><span class="p">}]</span><span class="w">
        </span><span class="p">}],</span><span class="w">
        </span><span class="nt">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7ab1e"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>GET on this resource returns a Shoji entity containing the requested multitable definition.</p>

<h4 id="patch">PATCH</h4>

<p>PATCH the entity to edit its <code class="prettyprint">name</code>, <code class="prettyprint">template</code>, or <code class="prettyprint">is_public</code> attributes. Successful PATCH requests
return 204 status. As with the POSTing new entities to the catalog, only the dataset&rsquo;s current editor can alter <code class="prettyprint">is_public</code>.</p>

<p>The <code class="prettyprint">template</code> attribute must contain a valid multitable definition.</p>

<h4 id="views">Views</h4>

<p>Multitable entities have a &ldquo;tabbook&rdquo; view. See below.</p>

          <h2 id="permissions">Permissions</h2>

<p>Authorization to view, edit, and manage a dataset is controlled by the dataset&rsquo;s permissions catalog:</p>

<p><code class="prettyprint">/datasets/{id}/permissions/</code></p>

<p>The permissions catalog is a Shoji Catalog that collects (not contains) Users. There are no permission &ldquo;entities&rdquo; to retrieve, create, or delete: all action is achieved directly on the permissions catalog.</p>

<h3 id="get-catalog">GET Catalog</h3>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/1/permissions/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lists all the users that have access to this dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/42/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"is_owner"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lauren Ipsum"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lipsum@crunch.io"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>If authorized to view the dataset, a successful GET returns a Shoji Catalog indicating the users who have access to this dataset and their respective permissions. This includes the current, authorized user making the request. Index tuples are keyed by User URL. </p>

<p>Tuple values include:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Display name of the user</td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Email address of the user</td>
</tr>
<tr>
<td>is_owner</td>
<td>boolean</td>
<td>Whether this user is the dataset&rsquo;s &ldquo;owner&rdquo;</td>
</tr>
<tr>
<td>dataset_permissions</td>
<td>object</td>
<td>Attributes governing the user&rsquo;s authorization; see below</td>
</tr>
</tbody></table>

<p>Supported <code class="prettyprint">dataset_permissions</code>, all boolean, are:</p>

<ul>
<li><strong>view</strong>: Whether the user can view the dataset. Note that &ldquo;viewing&rdquo; is not limited to just GET requests, for dataset viewers may create filters, private variables, and saved analyses, for example.</li>
<li><strong>edit</strong>: Whether the user can edit the dataset. When editing, users with this permission may modify the common data of a dataset, including things like public filters available to all viewers of the dataset.</li>
<li><strong>change_permissions</strong>: Whether the user may alter other users&rsquo; authorization on this dataset, i.e., PATCH tuples for users that already exist on the catalog.</li>
</ul>

<h3 id="patch-catalog">PATCH Catalog</h3>

<p>The PATCH verb is used to make all modifications to dataset authorization: modifying existing permissions, revoking permissions for users with access, and granting access to users. </p>

<h4 id="modify-existing">Modify existing</h4>

<p>To change the permissions a user has, PATCH new dataset_permissions, like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"https://app.crunch.io/api/users/42/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"send_notification"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"dataset_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/dataset/1"</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Only the &ldquo;dataset_permissions&rdquo; key in the tuple can be modified by PATCHing this catalog. Other keys, such as &ldquo;name&rdquo;, are included only for facilitating human-readable display of the catalog. If sent, these other keys will be ignored. To modify users&rsquo; names, see users.</p>

<p>If a subset of dataset_permissions are included in the payload, only the specified permissions will have their values updated. Omitted permissions will remain unchanged.</p>

<p>Multiple users&rsquo; permissions can be modified in a single request by including multiple tuples keyed by User URL. </p>

<p>The &ldquo;send_notification&rdquo; key in the payload is optional; if included and True, the server will send an email invitation to all newly added users (see below), as well as to users who are granted &ldquo;edit&rdquo; privileges. </p>

<p>If &ldquo;send_notification&rdquo; is included and true, you may also include a &ldquo;dataset_url&rdquo;, which is the URL that will be included in the email notifying the users that they now have access to the dataset. The web application will send the &ldquo;browse&rdquo; view URL, for example, so that when the user receives the email notification, the link they follow will take them to the relevant dataset. If &ldquo;send_notification&rdquo; is true and &ldquo;dataset_url&rdquo; is omitted, the email link will default to https://app.crunch.io/.</p>

<h4 id="add-new-user-from-within-account">Add new user from within account</h4>

<p>To add a user (i.e. share with them), there are two cases. First, if the user to be added is a member of the current user&rsquo;s account, PATCH similar to above, using this user&rsquo;s URL as key:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"/users/id/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"weight"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"applied_filters"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">

        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This payload may include a &ldquo;profile&rdquo; member, which are initial values with which to populate the sharee&rsquo;s user-dataset-profile. </p>

<p>Valid &ldquo;profile&rdquo; members include:</p>

<ul>
<li><strong>weight</strong>: a URL to one of the dataset&rsquo;s weight variables; if omitted, the sharer&rsquo;s current weight variable will be used</li>
<li><strong>applied_filters</strong>: an array of filter URLs which are shared with all dataset viewers. If any of the specified filters are private, the PATCH request will return 400 status. Default value for &ldquo;applied_filters&rdquo; is [].</li>
</ul>

<p>If the &ldquo;profile&rdquo; member is not included, the newly shared users will be created with their user dataset preferences matching the sharer&rsquo;s current weight.</p>

<h4 id="revoking-access">Revoking access</h4>

<p>To revoke users&rsquo; access to this dataset (aka &ldquo;unshare&rdquo; with them), PATCH a null tuple for their user URLs:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"/users/id/"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Note that all of these PATCHes for add/edit/remove access to the dataset can be done in a single request that combines them all. </p>

<h4 id="validation">Validation</h4>

<p>The server will insist, and clients should also validate, that</p>

<ul>
<li>There is one and only one user with edit: true privileges for a dataset; if not, the PATCH request will return 400.</li>
<li>The users who are receiving new authorization via PATCH must have corresponding dataset_permissions on their account authorization. For example, the user who is updated to have edit: true has a dataset_permission of edit: true on their account authorization. If not, the PATCH request will return 400.</li>
<li>The user that is PATCHing this catalog must have share: true for this dataset; if not, the PATCH request will return 403.</li>
</ul>

<h4 id="inviting-new-users">Inviting new users</h4>

<p>It is possible to share a dataset with people that are not users of Crunch yet. To do so, it is necessary to send in an email address instead of a user URL as a sharing key.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"somebody@email.com"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"weight"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"applied_filters"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"send_notifications"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url_base"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/password/change/${token}/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"dataset_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/dataset/1/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>A new user with such email address will be created and added to the account of the user that is making the request. The new user will receive an invitation email to Crunch.io with an activation link. In case the user exists on other or the same account, no changes to the user will be made.</p>

<p>If &ldquo;send_notification&rdquo; was included and true in the request, the user will receive a notification email informing her about the new shared dataset if requested so. New users, unless they have an OAuth provider specified, will need to set a password, and the client application should send a URL template that directs them to a place where they can set that password. To do so, include a &ldquo;url_base&rdquo; attribute in the payload, a URL template with a <code class="prettyprint">${token}</code> variable into which the server will insert the password-setting token. For the Crunch web application, this template is <code class="prettyprint">https://app.crunch.io/password/change/${token}/</code>.</p>

<aside class="success">
    You may not know whether the email address you&rsquo;re sharing with already has a Crunch account. To be safe, you can always include &ldquo;url_base&rdquo; whenever you include `&ldquo;send_notifications&rdquo;: true`. If it&rsquo;s needed, your invitees will thank you. If it&rsquo;s not needed, it will be ignored.
</aside>

<aside class="notice">
    If you share with a new user and don&rsquo;t include `&ldquo;send_notifications&rdquo;: true`, they won&rsquo;t receive an email inviting them to set a password for their new Crunch account. That&rsquo;s okay, though: they can always go to the web application and click &ldquo;Forgot password&rdquo; to send a new password reset token. 
</aside>

          <h2 id="progress">Progress</h2>

<p>Progress resources provide information about the current state of a long-running server process in Crunch. Some requests at certain endpoints may return 202 status containing a progress URL in the body, at which one can monitor the progress of the request that was accepted and not yet completed.</p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/progress/{id}/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:/app.crunch.io/api/progress/{id}/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"progress"</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w">
        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"exported 2 variables"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><code class="prettyprint">GET</code> on a Progress view returns a Shoji View containing information about the status of the indicated process. The &ldquo;progress&rdquo; attribute contains a integer between -1 and 100. Positive progress values indicate that the job is being processed, while a negative value indicates that an error occurred in processing. Zero entails that the job has not been started, while 100 indicated completion. Additionally, if the <code class="prettyprint">id</code> from the request URL does not exist, <code class="prettyprint">GET</code> will nevertheless return 200 status and indicate <code class="prettyprint">&quot;progress&quot;: 100</code>.</p>

<p>Optionally, the View will provide a message regarding current status.</p>

<p>You must be authenticated to <code class="prettyprint">GET</code> this resource.</p>

          <h2 id="projects">Projects</h2>

<p>Projects represent groups of users that share a common set of datasets. Any user
can belong to none or many projects.</p>

<p>They live under /projects/ and will list the projects that the authenticated user
is a member or owner of.</p>

<h3 id="catalog">Catalog</h3>

<p>The projects catalog will list all the projects the authenticated user is a member of.
Here you can create new projects via POST</p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/projects/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/projects/4643/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Project 1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4643"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"view"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/projects/6c01/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Project 2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6c01"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Description of project 2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"view"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td></td>
<td>Required when creating the project</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>Longer description pf tje [rpkect</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>autogenerated</td>
<td>The project&rsquo;s id</td>
</tr>
<tr>
<td>icon</td>
<td>url</td>
<td>&ldquo;&rdquo;</td>
<td>Url for the icon file for the project. Empty string if not set</td>
</tr>
<tr>
<td>permissions</td>
<td>object</td>
<td>{}</td>
<td>permissions possessed by querying user against project</td>
</tr>
</tbody></table>

<h4 id="post">POST</h4>

<p>New projects need a name (no uniqueness enforced) and will make the authenticated
user its initial member and editor.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/projects/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<p>Payload example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My new project"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"icon_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn.sample.com/project-icon.png"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="creating-a-project-with-an-icon">Creating a project with an icon</h5>

<p>To create one with a starting icon you can POST an <code class="prettyprint">icon_url</code> attribute 
indicating a url where to fetch that icon from (has to be a publicly accessible url).</p>

<p>If the server cannot read that URL the request will return a 409 error.</p>

<p>On success a copy of the file will be stored as the icon to be serve</p>

<p>If the <code class="prettyprint">icon_url</code> attribute is not provided the API will pick an available icon 
from the icons catalog.</p>

<h4 id="default-icon">Default icon</h4>

<p>The API can provide default icons to be used in new projects. Performing a GET
request will return a Shoji:catalog with a list of available icons for the client
to pick.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/icons/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/icons/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/icons/01/"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/icons/02/"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/icons/03/"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/icons/04/"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="entity">Entity</h3>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/projects/6c01/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"catalogs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"datasets"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/datasets/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"members"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/members/"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/icon/"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Project 2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Long description text"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"user_icon"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td></td>
<td>Required when creating the project</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>Longer description of the project</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>autogenerated</td>
<td>The project&rsquo;s id</td>
</tr>
<tr>
<td>icon</td>
<td>url</td>
<td>&ldquo;&rdquo;</td>
<td>Url for the icon file for the project; empty string if not set</td>
</tr>
<tr>
<td>user_icon</td>
<td>boolean</td>
<td>autogenerated</td>
<td>Will indicate false if the icon used on creation is from the provided catalog</td>
</tr>
</tbody></table>

<p>Note about the <code class="prettyprint">icon</code> attribute that points to the actual image file where the
configured icon is. This url does not point to the <code class="prettyprint">views.icon</code> Shoji view url.</p>

<p>The <code class="prettyprint">views.icon</code> Shoji view endpoint is used to PUT the icon as a file upload
for this project.</p>

<h4 id="patch">PATCH</h4>

<p>The attributes that are allowed to be edited for a projet are: </p>

<ul>
<li>name</li>
<li>description</li>
<li>icon_url</li>
</ul>

<p>Only project editors can make these changes.</p>

<h4 id="delete">DELETE</h4>

<p>Deleting a project will <em>NOT</em> delete its datasets. It will change their 
ownership to the authenticated user. Only the project current owner can delete 
a project.</p>
<pre class="highlight http"><code><span class="nf">DELETE</span> <span class="nn">/projects/6c01/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<h3 id="projects-order">Projects order</h3>

<p>Returns the <code class="prettyprint">shoji:order</code> in which the projects should be displayed for
 the user. This entity is independent for each user.</p>

<p>As the user is added to more projects, these will be added at the end of the
<code class="prettyprint">shoji:order</code>.</p>

<h4 id="get">GET</h4>

<p>Will return a <code class="prettyprint">shoji:order</code> containing a flat list of all the projects where
the current user belongs to.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/projects/order/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/order/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/projects/cc9161/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/projects/a598c7/"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="put">PUT</h4>

<p>In order to change the order of the projects, the client will need to PUT the
full payload back to the server.</p>

<p>The graph attribute should contain all projects included, else it will return
a 400 response.</p>

<p>After a successful PUT request, the server will reply with a 204 response.</p>
<pre class="highlight http"><code><span class="nf">PUT</span> <span class="nn">/projects/order/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/order/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/projects/cc9161/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/projects/a598c7/"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="members">Members</h3>

<p>Use this endpoint to manage the users that have access to this project.</p>

<h4 id="members-permissions">Members permissions</h4>

<p>Members of a project can be wither viewers or editors. By default all members
will be viewers and a selected group of them (at least one) will be editor.</p>

<p>These permissions are available on the members catalog under the <code class="prettyprint">permissions</code> 
attribute on each member&rsquo;s tuple.</p>

<p>The possible permissions are:</p>

<ul>
<li>edit</li>
<li>view</li>
</ul>

<p>That can have boolean values. Those with <code class="prettyprint">edit: true</code> are considered project 
editors.</p>

<p>Project editors have edit privileges on all datasets as well as permissions to
make changes on the project itself such as changing its name, icon, members 
management or change members&rsquo; permissions.</p>

<h4 id="get">GET</h4>

<p>Returns a catalog with all users that have access to this project and their 
project permissions in the following format:</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/projects/abcd/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/members/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/00002/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jean-Luc Picard"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"captain@crunch.io"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"allowed_dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/00005/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"William Riker"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"firstofficer@crunch.io"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"allowed_dataset_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The catalog will be indexed by each user&rsquo;s entity URL and its tuple will contain
basic information (name and email) as well as the permissions each user has
on the given project.</p>

<p>All project members have read access to this resource, but the 
<code class="prettyprint">allowed_dataset_permissions</code> is only present to project editors. It contains
the maximum dataset permissions each user can have. Assigning anything more
permissive will not have effect.</p>

<h4 id="patch">PATCH</h4>

<p>Use this method to add or remove members from the project. Only project editors 
have this capabilities, else you will get a 403 response.</p>

<p>To add a new user, PATCH a catalog keyed by the new user URL and an empty
object for its value or a permissions tuple to set specific permissions 
(only <code class="prettyprint">edit</code> allowed at this point).</p>

<p>To remove users, PATCH a catalog keyed by the user you want to remove and <code class="prettyprint">null</code>
for its value.</p>

<p>Note that you cannot remove yourself from the project, you will
get a 400 response.</p>

<p>It is possible to perform many additions/removals in one request, the 
following example adds users <code class="prettyprint">/users/001/</code> and deletes users <code class="prettyprint">/users/002/</code></p>

<p>It is allowed to invite/add users to the project by email address. If the email
is registered on the system the user will be invited to the project. If the email
is not part of Crunch.io a new user invitation will be sent to that email with
instructions to set up their account. They will be automatically part of this
project only.</p>

<p>Attempting to remove users also allows to do so by email. In the case that the
email does not exist, the server will return a 400 response.</p>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/projects/abcd/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/members/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/001/"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/002/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/users/003/"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"user@email.com"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"send_notification"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url_base"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/password/change/${token}/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"project_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/${project_id}/"</span><span class="p">,</span><span class="w">
  </span><span class="err">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="sending-notifications">Sending notifications</h5>

<p>The users invited to a project can be both existing Crunch.io users or new
users that don&rsquo;t have a user account associated with the email.</p>

<p>If desired, the API can send automated email notifications to the involved users
indicating that they now belong to the project.</p>

<p>It is necessary to add the <code class="prettyprint">send_notification</code> boolean key on the index PATCHed
to command the API to send these emails. Else, no notification will be sent.</p>

<p>When sending notifications, it is necessary for the client to include a 
<code class="prettyprint">url_base</code> key as well that includes a string template that should point to a
client location where the password resetting should happen for brand new users.</p>

<p>The server will replace the <code class="prettyprint">${token}</code> part of the string with the generated
token and will be included on the notification email as a link for the invited 
user to configure their account in order to use the app.</p>

<p>Additionally, to indicate the URL of the project, the client can provide a
<code class="prettyprint">project_url</code> key that should be formatted as a URL containing a <code class="prettyprint">${project_id}</code>
part that the server will replace with the project&rsquo;s ID.</p>

<p>This behavior is the same as described for <a href="#inviting-new-users">inviting new users when sharing a dataset</a></p>

<h3 id="datasets">Datasets</h3>

<p>Will list all the datasets that have this project as their owner.</p>

<h4 id="adding-datasets-to-projects">Adding datasets to projects</h4>

<p>The way to add a dataset to a project is by changing the dataset&rsquo;s owner to the
id of the project you want to take ownership.</p>

<p>You must have edit and be current editor on any given dataset to change its
owner and you must also have edit permissions on the target project.</p>

<h4 id="patch-to-dataset-entity">PATCH to dataset entity</h4>

<p>Send a PATCH request to the dataset entity that you want to make part of the
project.</p>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/datasets/cc9161/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"owner"</span><span class="p">:</span><span class="s2">"https://app.crunch.io/api/projects/abcd/"</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="get">GET</h4>

<p>Will show the list of all datasets where this project is their owner, the 
shape of the dataset tuple will be the same as in other dataset catalogs.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/projects/6c01/datasets/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/datasets/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/datasets/order/"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"https://app.crunch.io/api/datasets/cc9161/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"James T. Kirk"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Voyage Home"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stardate 8390"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"archived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span><span class="w">
            </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="mi">67</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cc9161"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/685722/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2286"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"streaming"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1986-11-26T12:05:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1986-11-26T12:05:00"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"current_editor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/ff9443/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"current_editor_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Leonard Nimoy"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"https://app.crunch.io/api/datasets/a598c7/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"owner_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Spock"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Wrath of Khan"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"archived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"columns"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a598c7"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"owner_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/af432c/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2285-10-03"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2285-10-20"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"streaming"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-06-04T09:16:23.231045"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1982-06-04T09:16:23.231045"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"current_editor"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nt">"current_editor_name"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="icon">Icon</h3>

<p>The icon endpoint for a project is a ShojiView that allows to change the
project&rsquo;s icon via file upload or URL.</p>

<h4 id="get">GET</h4>

<p>On GET, it will return a <code class="prettyprint">shoji:view</code> with its value containing a url to the
icon file or empty string in case there isn&rsquo;t an icon for this project yet.</p>

<p>By default all new projects have an empty icon URL.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/projects/6c01/icon/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/icon/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="put">PUT</h4>

<p>PUT to this endpoint to change a project&rsquo;s icon.</p>

<p>There are two ways to change the icon, either via file upload or via icon URL.</p>

<p>Only the project&rsquo;s editors can change the project&rsquo;s icon.</p>

<p>Valid image extensions: &lsquo;png&rsquo;, &#39;gif&rsquo;, &#39;jpg&rsquo;, &#39;jpeg&rsquo; - Others will 400</p>

<h5 id="file-upload">File upload</h5>

<p>The request should have be a standard <code class="prettyprint">multipart/form-data</code> file upload with
 the file field named <code class="prettyprint">icon</code>.
The file&rsquo;s contents will be stored and made available under the project&rsquo;s url.
The API will return a 201 response with the stored icon&rsquo;s URL on its Location 
header.</p>
<pre class="highlight http"><code><span class="nf">PUT</span> <span class="nn">/projects/6c01/icon/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Disposition</span><span class="p">:</span> <span class="s">form-data; name="icon"; filename="newicon.jpg"</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">image/jpeg</span>
</code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://app.crunch.io/api/datasets/223fd4/</span>
</code></pre>

<h5 id="icon-url">Icon URL</h5>

<p>Expects a <code class="prettyprint">Shoji:view</code> request with its value pointing to a publicly accessible
image resource that will be used as the project&rsquo;s icon. This image will be
copied to an API local location.</p>
<pre class="highlight http"><code><span class="nf">PUT</span> <span class="nn">/projects/6c01/datasets/icon/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/datasets/icon/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://public.domain.com/icon.png"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://app.crunch.io/api/datasets/223fd4/</span>
</code></pre>

<h4 id="post">POST</h4>

<p>Same as PUT</p>

<h3 id="datasets-order">Datasets order</h3>

<p>Contains the <code class="prettyprint">shoji:order</code> in which the datasets of this project are to be 
ordered.</p>

<p>This is endpoint available for all project members but can only be updated by 
the project&rsquo;s editors.</p>

<h4 id="get">GET</h4>

<p>Will return the <code class="prettyprint">shoji:order</code> response containing the datasets that belong
to the project.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/projects/6c01/datasets/order/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/datasets/order/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/datasets/cc9161/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/datasets/a598c7/"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="put">PUT</h4>

<p>Allow to make modifications to the <code class="prettyprint">shoji:order</code> for the contained datasets.
Only the project&rsquo;s editors can make these changes.</p>

<p>Trying to include an invalid dataset or an incomplete list will return a 
400 response.</p>
<pre class="highlight http"><code><span class="nf">PUT</span> <span class="nn">/projects/6c01/datasets/order/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/projects/6c01/datasets/order/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"https://app.crunch.io/api/datasets/cc9161/"</span><span class="p">,</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/a598c7/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h2 id="search">Search</h2>

<p>You can perform a cross-dataset search of dataset metadata (including variables) via the search endpoint.
This search will return associated variables and dataset metadata.  A query string, along with filtering
properties can be provided to the search endpoint in order to refine the results.  The query string provided is only
used in plain-text format, any non-text or numeric characters are ignored at this time.</p>

<p>Results are limited only to those
datasets the user has access to.  Offset and limit parameters are also provided in order to provide performance-chunking
options.  The limit and offset are returned in relationship to datasets related to the search.  You have reached
  the limit of available search entries when there are no longer records in the dataset field.</p>

<p>Here are the parameters that can be passed to the search endpoint.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>q</td>
<td>String</td>
<td>query string</td>
</tr>
<tr>
<td>f</td>
<td>Json Object</td>
<td>used to filter the output of the search (see below)</td>
</tr>
<tr>
<td>limit</td>
<td>Integer</td>
<td>limit the number of dataset results returned by the api to less than this amount (default: 10)</td>
</tr>
<tr>
<td>offset</td>
<td>Integer</td>
<td>offset into the search index to start gathering results from pre-filter</td>
</tr>
<tr>
<td>max_variables_per_dataset</td>
<td>Integer</td>
<td>limit the number of variables that match to this number (default: 100, max: 100) (deprecated, use variable_limit)</td>
</tr>
<tr>
<td>embedded_variables</td>
<td>Boolean</td>
<td>embed the results within the dataset results (this will become the default in the future)</td>
</tr>
<tr>
<td>projection</td>
<td>Json Object</td>
<td>used to limit the fields that should be returned in the search results. ID is always provided.</td>
</tr>
<tr>
<td>scope</td>
<td>Json Object</td>
<td>used to limit the fields that the search should look at.</td>
</tr>
<tr>
<td>grouping</td>
<td>String</td>
<td>One of <code class="prettyprint">datasets</code> or <code class="prettyprint">variables</code>. Tells if search results should be grouped by datasets or variables.</td>
</tr>
<tr>
<td>variable_limit</td>
<td>Integer</td>
<td>Limit the number of variables returned per dataset to this value, (default: 100, max: 100)</td>
</tr>
<tr>
<td>variable_offset</td>
<td>Integer</td>
<td>Offset into the variables returned per dataset, default 0</td>
</tr>
<tr>
<td>max_subfield_entries_per_variable</td>
<td>Integer</td>
<td>Number of items in the subfields of a variable (such as categories or subvariables), (default: 10, max: 100)</td>
</tr>
</tbody></table>

<aside class="notice">
By default there are only 10 datasets returned.  Inside the response you will find a `totals.datasets` that
indicates the total number of datasets that matched the search.  Use this to set offset and limit to appropriately
limit and compile your search results.  Note that `totals.variables` should not be used for pagination.
</aside>

<p>Providing a Projection:</p>

<p><code class="prettyprint">projection</code> argument must be a JSON array containing the name of the fields that should be projected for datasets and variables.
The fields are specified with the namespace they refer to, like <code class="prettyprint">&quot;variables.fieldname&quot;</code> and <code class="prettyprint">&quot;datasets.fieldname&quot;</code>. 
The namespace is the same as the key where the relevant search results are returned.
Performing a search with an invalid field will pinpoint the invalid one and provide the list of accepted values.</p>

<p>Providing a Scope:</p>

<p><code class="prettyprint">scope</code> parameter must be a JSON array containing the name of the fields that should be used to resolve the query. 
Much like <code class="prettyprint">projection</code> paramter this one accepts a list of fields with their namespace (<code class="prettyprint">datasets</code> or <code class="prettyprint">variables</code>). T
he provided query will be looked up only in the specified fields if a <code class="prettyprint">scope</code> is provided. A special field name <code class="prettyprint">*</code>
is accepted to specify that default fields should be looked for a specific namespace. 
A scope like <code class="prettyprint">datasets.name, variables.*</code> will search the query in the default variable fields and in dataset name.</p>

<p>Grouping:</p>

<p>Default grouping is <code class="prettyprint">datasets</code> which will enable searching in dataset data and its variables. The returned entries
in &ldquo;datasets&rdquo; are datasets that match the query or contain a variable that matches it. 
Search results are limited to 1000 variables per dataset when grouping per dataset.</p>

<p>Switching to <code class="prettyprint">variables</code> grouping makes the search only look in variables.
Note that a &ldquo;datasets&rdquo; field is still returned, the entries there are the datasets the matching variables are part of,
<em>not</em> datasets that match the query. This is done to allow providing dataset details for a variable without the need for 
a second call to fetch the dataset info.</p>

<p>Allowable filter parameters:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dataset_ids</td>
<td>array of strings</td>
<td>limit results to particular dataset_ids or urls (user must have read access to that dataset)</td>
</tr>
<tr>
<td>team</td>
<td>string</td>
<td>url or id of the team to limit results (user must have read access to the team)</td>
</tr>
<tr>
<td>project</td>
<td>string</td>
<td>url or id of the project to limit results (user must have access to the project)</td>
</tr>
<tr>
<td>organization</td>
<td>string</td>
<td>if you are the owner for a given organization, you can filter all of the search results pertaining to the datasets in your organization.</td>
</tr>
<tr>
<td>user</td>
<td>string</td>
<td>url or id of the user that has read access to the datasets to limit results (user must match with the provided one)</td>
</tr>
<tr>
<td>owner</td>
<td>string</td>
<td>url or id of the dataset owner to limit results</td>
</tr>
<tr>
<td>label</td>
<td>string</td>
<td>The dataset must be in a folder or subfolder with the given name.</td>
</tr>
<tr>
<td>start_date</td>
<td>array of strings</td>
<td>array of <code class="prettyprint">[begin, end]</code> range of values in ISO8601 format. Provide same for exact matching.</td>
</tr>
<tr>
<td>end_date</td>
<td>array of strings</td>
<td>array of <code class="prettyprint">[begin, end]</code> range of values in ISO8601 format. Provide same for exact matching.</td>
</tr>
<tr>
<td>modification_time</td>
<td>array of strings</td>
<td>array of <code class="prettyprint">[begin, end]</code> range of values in ISO8601 format. Provide same for exact matching.</td>
</tr>
<tr>
<td>creation_time</td>
<td>array of strings</td>
<td>array of <code class="prettyprint">[begin, end]</code> range of values in ISO8601 format. Provide same for exact matching.</td>
</tr>
</tbody></table>

<aside class="notice">
The query string can only be alpha-numeric characters (including underscores) logical operators are not allowed at this time.
</aside>

<h5 id="fields-searched">Fields Searched</h5>

<p>Here is a list of the fields that are searched by the Crunch search endpoint</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>category_names</td>
<td>List of Strings</td>
<td>Category names (associated with categorical variables)</td>
</tr>
<tr>
<td>dataset_id</td>
<td>String</td>
<td>ID of the dataset</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>description of the variable</td>
</tr>
<tr>
<td>id</td>
<td>String</td>
<td>ID of the variable</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>name of the variable</td>
</tr>
<tr>
<td>owner</td>
<td>String</td>
<td>owner&rsquo;s ID of the variable</td>
</tr>
<tr>
<td>subvar_names</td>
<td>List of Strings</td>
<td>Names of the subvariables associated with the variable</td>
</tr>
<tr>
<td>users</td>
<td>List of Strings</td>
<td>User IDs having read-access to the variable</td>
</tr>
<tr>
<td>group_names</td>
<td>List of Strings</td>
<td>group names (from the variable ordering) associated with the variable</td>
</tr>
<tr>
<td>dataset_labels</td>
<td>List of Objects</td>
<td>dataset_labels associated with the user associated with the variable</td>
</tr>
<tr>
<td>dataset_name</td>
<td>String</td>
<td>dataset_name associated with this variable</td>
</tr>
<tr>
<td>dataset_owner</td>
<td>String</td>
<td>ID of the owner of the dataset associated with the variable</td>
</tr>
<tr>
<td>dataset_users</td>
<td>List of Strings</td>
<td>User IDs having read-access to the dataset associated with the variable</td>
</tr>
<tr>
<td>dataset_teams</td>
<td>List of Strings</td>
<td>Team IDs having read-access to the dataset associated with the variable</td>
</tr>
<tr>
<td>dataset_projects</td>
<td>List of Strings</td>
<td>Project IDs having read-access to the dataset associated with the variable</td>
</tr>
</tbody></table>

<p>Grouping by datasets:</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/search/?q={query}&amp;f={filter}&amp;limit={limit}&amp;offset={offset}&amp;projection={projection}&amp;grouping=datasets</span>  <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight plaintext"><code>import pycrunch
site = pycrunch.connect("me@mycompany.com", "yourpassword", "https://app.crunch.io/api/")
results = site.follow('search', 'q=findme&amp;embedded_variables=True').value
datasets_found = results['groups'][0]['datasets']
variables_by_dataset = {k, v.get('variables', []) for k, v in datasets_found.iteritems()}

```json
{
   "element": "shoji:view",
    "self": "https://app.crunch.io/api/search/?q=blue&amp;grouping=datasets",
    "description": "Returns a view with relevant search information",
    "value": {
        "groups": [
            {
                "group": "Search Results",
                "datasets": {
                    "https://app.crunch.io/api/datasets/173b4eec13f542588b9b0a9cbcd764c9/": {
                        "labels": [],
                        "name": "econ_few_columns_0",
                        "description": ""
                    },
                    "https://app.crunch.io/api/datasets/4473ab4ee84b40b2a7cd5cab4548d584/": {
                        "labels": [],
                        "name": "simple_alltypes",
                        "description": ""
                    }
                },
                "variables": {
                    "https://app.crunch.io/api/datasets/4473ab4ee84b40b2a7cd5cab4548d584/variables/000000/": {
                        "dataset_labels": [],
                        "users": [
                            "00002"
                        ],
                        "alias": "x",
                        "dataset_end_date": null,
                        "category_names": [
                            "red",
                            "green",
                            "blue",
                            "4",
                            "8",
                            "9",
                            "No Data"
                        ],
                        "dataset_start_date": null,
                        "name": "x",
                        "dataset_description": "",
                        "dataset_archived": false,
                        "group_names": null,
                        "dataset": "https://app.crunch.io/api/datasets/4473ab4ee84b40b2a7cd5cab4548d584/",
                        "dataset_id": "bb987b45a5b04caba10dec4dad7b37a8",
                        "dataset_created_time": null,
                        "subvar_names": [],
                        "dataset_name": "export test 94",
                        "description": "Numeric variable with value labels"
                    }
                },
                "variable_count": 14,
                "totals": {
                    "variables": 4,
                    "datasets": 2
                }
            }
        ]
    }
}
</code></pre>

<p>Search results are limited to 1000 variables per dataset.</p>

<p>Grouping by variables:</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/search/?q={query}&amp;f={filter}&amp;limit={limit}&amp;offset={offset}&amp;grouping=variables</span>  <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
 </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
 </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/search/?q=Atchafalaya&amp;grouping=variables"</span><span class="p">,</span><span class="w"> 
 </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Returns a view with relevant search information"</span><span class="p">,</span><span class="w"> 
 </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
      </span><span class="nt">"group"</span><span class="p">:</span><span class="s2">"Search Results"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"totals"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"variables"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nt">"datasets"</span><span class="p">:</span><span class="mi">2</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"buckets"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"Qk9XX0FGX05hbWU"</span><span class="p">:[</span><span class="w">
          </span><span class="s2">"http://app.crunch.io:29668/api/datasets/825b87ff955049128b9d48b614abbe99/variables/000008/"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"http://app.crunch.io:29668/api/datasets/fcd37212fe0d4b8eb8804ffb7ccb933d/variables/000008/"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"order"</span><span class="p">:[</span><span class="w">
        </span><span class="s2">"http://app.crunch.io:29668/api/datasets/825b87ff955049128b9d48b614abbe99/variables/000008/"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"http://app.crunch.io:29668/api/datasets/fcd37212fe0d4b8eb8804ffb7ccb933d/variables/000008/"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"variables"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"http://app.crunch.io:29668/api/datasets/fcd37212fe0d4b8eb8804ffb7ccb933d/variables/000008/"</span><span class="p">:{</span><span class="w">
          </span><span class="nt">"alias"</span><span class="p">:</span><span class="s2">"BOW_AF_Name"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"category_names"</span><span class="p">:[</span><span class="w">
            </span><span class="s2">"East Cote Blanche Bay"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Atchafalaya Bay, Delta, Gulf waters"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Barataria Bay"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Bayou Grand Caillou"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Bayou du Large"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Bays Gardene, Black, American and Crabe"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Calcasieu Lake"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Calcasieu River and Ship Channel"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"California Bay and Breton Sound"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Grid 12"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"..."</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nt">"bucket"</span><span class="p">:</span><span class="s2">"Qk9XX0FGX05hbWU"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"BOW_AF_Name"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"dataset"</span><span class="p">:</span><span class="s2">"http://app.crunch.io:29668/api/datasets/fcd37212fe0d4b8eb8804ffb7ccb933d/"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"http://app.crunch.io:29668/api/datasets/825b87ff955049128b9d48b614abbe99/variables/000008/"</span><span class="p">:{</span><span class="w">
          </span><span class="nt">"alias"</span><span class="p">:</span><span class="s2">"BOW_AF_Name"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"category_names"</span><span class="p">:[</span><span class="w">
            </span><span class="s2">"East Cote Blanche Bay"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Atchafalaya Bay, Delta, Gulf waters"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Barataria Bay"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Bayou Grand Caillou"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Bayou du Large"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Bays Gardene, Black, American and Crabe"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Calcasieu Lake"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Calcasieu River and Ship Channel"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"California Bay and Breton Sound"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"Grid 12"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"..."</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nt">"bucket"</span><span class="p">:</span><span class="s2">"Qk9XX0FGX05hbWU"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"BOW_AF_Name"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"dataset"</span><span class="p">:</span><span class="s2">"http://app.crunch.io:29668/api/datasets/825b87ff955049128b9d48b614abbe99/"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"datasets"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"http://app.crunch.io:29668/api/datasets/fcd37212fe0d4b8eb8804ffb7ccb933d/"</span><span class="p">:{</span><span class="w">
          </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="s2">"2017-06-22T17:00:36.571000"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"archived"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
          </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
          </span><span class="nt">"end_date"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"test_variable_search_matching_2"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"labels"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="s2">"2017-06-22T17:00:37.024000"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"fcd37212fe0d4b8eb8804ffb7ccb933d"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"projects"</span><span class="p">:[</span><span class="w">

          </span><span class="p">],</span><span class="w">
          </span><span class="nt">"start_date"</span><span class="p">:</span><span class="kc">null</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"http://app.crunch.io:29668/api/datasets/825b87ff955049128b9d48b614abbe99/"</span><span class="p">:{</span><span class="w">
          </span><span class="nt">"modification_time"</span><span class="p">:</span><span class="s2">"2017-06-22T17:00:34.681000"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"archived"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
          </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
          </span><span class="nt">"end_date"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"test_variable_search_matching_1"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"labels"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"creation_time"</span><span class="p">:</span><span class="s2">"2017-06-22T17:00:35.151000"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"825b87ff955049128b9d48b614abbe99"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"projects"</span><span class="p">:[</span><span class="w">

          </span><span class="p">],</span><span class="w">
          </span><span class="nt">"start_date"</span><span class="p">:</span><span class="kc">null</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h2 id="sources">Sources</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/sources/</code></p>

<p>A Shoji Catalog representing the Sources added by this User. POST a multipart form
here, with an &ldquo;uploaded_file&rdquo; field containing the file to upload; 201 indicates
success, and the returned Location header refers to the new Source resource.</p>

<p>The uploaded sources will use the file&rsquo;s filename as their .name attribute and
will have blank description.</p>

<p>The catalog will include the sources&rsquo; .name and .description</p>

<p>Alternately, you may POST a urlencoded payload with a <code class="prettyprint">source_url</code> parameter that
 points to a publicly accessible URL. Both &ldquo;http&rdquo; and the &ldquo;s3&rdquo; scheme are
 supported. This endpoint will then download such file synchronously and verify
 that it is a valid source file. It will be made available for the current user
 sources catalog.</p>

<p>Regular Shoji POST payloads are also supported to create new sources from
remote source URLs. A <code class="prettyprint">location</code> attribute should be included in the Shoji:entity
body POSTed.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;url&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Optional name"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Optional description"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/sources/{id}/</code></p>

<p>A Shoji Entity representing a single Source. Its &ldquo;body&rdquo; member contains:</p>

<ul>
<li>name: A friendly name for the Source.</li>
<li>type: a string declaring the media type of the source. One of (&ldquo;csv&rdquo;, &ldquo;spss&rdquo;).</li>
<li>user_id: the id of the User who created the Source.</li>
<li>location: an absolute URI to the data. Currently, the only supported scheme is &ldquo;crunchfile://&rdquo;, which indicates a file uploaded to Crunch.io.</li>
<li>settings: an object containing configuration for translating the source to crunch internals. Its members vary by type:

<ul>
<li>csv:

<ul>
<li>strict: an integer. If 1, extra columns or undefined category ids in the CSV will raise an error. If 0, they will be added to the dataset.</li>
</ul></li>
</ul></li>
</ul>

<p>A PUT must contain a JSON object with members from the Shoji Entity &ldquo;body&rdquo; which the client intends to update. 204 indicates success.</p>

<p>A DELETE destroys the Source resource. 204 indicates success.</p>

<p><code class="prettyprint">/sources/{id}/file/</code></p>

<p>A GET returns the original source file.</p>

          <h3 id="tab-books">Tab books</h3>

<p><code class="prettyprint">/datasets/{dataset_id}/multitables/{multitable_id}/tabbook/</code></p>

<p>The default <code class="prettyprint">tabbook</code> view of a multitable will generate an excel (.xlsx) workbook
containing each variable in the dataset crosstabbed with a given multitable.</p>

<h4 id="post">POST</h4>

<p>A successful POST request to <code class="prettyprint">/datasets/{dataset_id}/multitables/{multitable_id}/tabbook/</code> will generate a download
location to which the exporter will write this file when it is done computing
(it may take some time for large datasets). The server will return a 202 response indicating that the export job started with
a Location header indicating where the final exported file will be available. The response&rsquo;s body will contain the URL for the progress URL where to query
the state of the export job. Clients should note the download URL,
monitor progress, and when complete, GET the download location. See <a href="#progress">Progress</a> for details.</p>

<p>Requesting the same job, if still in progress, will return the same 202 response
indicating the original progress to check. If the export is finished, the server
will 302 redirect to the destination for download.</p>

<p>If there have been changes on the dataset attributes, a new tab book will be
generated regardless of the status of any other pending exports.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/a598c7/multitables/7ab1e/tabbook/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<hr>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">202</span> <span class="ne">Accepted</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://s3-url/filename.xlsx</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:view"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/a598c7/multitables/{id}/tabbook/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/progress/5be83a/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Alternatively, you can request a JSON output for your tab book by adding an Accept request header.</p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/datasets/a598c7/multitables/7ab1e/tabbook/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"dataset"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"weighted_simple_alltypes"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"layout"</span><span class="p">:</span><span class="w"> </span><span class="s2">"many_sheets"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"sheets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"display_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"countsOrPercents"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"percent"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"currentTab"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"decimalPlaces"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"percentageDirection"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"colPct"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"showEmpty"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"showNotes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"slicesOrGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"groups"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"valuesAreMeans"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nt">"vizType"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"filters"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"weight"</span><span class="p">:</span><span class="w"> </span><span class="s2">"z"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="err">...</span><span class="w"> </span><span class="err">(one</span><span class="w"> </span><span class="err">entry</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">each</span><span class="w"> </span><span class="err">sheet)</span><span class="w">  
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"000002"</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">],</span><span class="w">
                        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bin"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00000a"</span><span class="w">
                            </span><span class="p">},</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">],</span><span class="w">
                        </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rollup"</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"sheets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"counts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="w">
                        </span><span class="p">],</span><span class="w">
                        </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Numeric variable with value labels"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
                                        </span><span class="p">}</span><span class="w">
                                    </span><span class="p">],</span><span class="w">
                                    </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"ordinal"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">],</span><span class="w">
                        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">1.234</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">3.14159</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="w">
                                </span><span class="p">],</span><span class="w">
                                </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
                                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
                                        </span><span class="nt">"integer"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                        </span><span class="nt">"missing_reasons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"No Data"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="nt">"missing_rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
                                    </span><span class="p">}</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="nt">"n_missing"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="nt">"n"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"counts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="w">
                        </span><span class="p">],</span><span class="w">
                        </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Numeric variable with value labels"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
                                        </span><span class="p">}</span><span class="w">
                                    </span><span class="p">],</span><span class="w">
                                    </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"ordinal"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">},</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"z"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Numberic variable with missing value range"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"z"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enum"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"elements"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                                </span><span class="nt">"?"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w">
                                            </span><span class="p">}</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                                </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
                                                </span><span class="mf">1.5</span><span class="w">
                                            </span><span class="p">]</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                                </span><span class="mf">1.5</span><span class="p">,</span><span class="w">
                                                </span><span class="mf">2.0</span><span class="w">
                                            </span><span class="p">]</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                                </span><span class="mf">2.0</span><span class="p">,</span><span class="w">
                                                </span><span class="mf">2.5</span><span class="w">
                                            </span><span class="p">]</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                                </span><span class="mf">2.5</span><span class="p">,</span><span class="w">
                                                </span><span class="mf">3.0</span><span class="w">
                                            </span><span class="p">]</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                                </span><span class="mf">3.0</span><span class="p">,</span><span class="w">
                                                </span><span class="mf">3.5</span><span class="w">
                                            </span><span class="p">]</span><span class="w">
                                        </span><span class="p">}</span><span class="w">
                                    </span><span class="p">],</span><span class="w">
                                    </span><span class="nt">"subtype"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
                                        </span><span class="nt">"missing_reasons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"No Data"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="nt">"missing_rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
                                    </span><span class="p">}</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">],</span><span class="w">
                        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">1.234</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">3.14159</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="w">
                                </span><span class="p">],</span><span class="w">
                                </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
                                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
                                        </span><span class="nt">"integer"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                        </span><span class="nt">"missing_reasons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"No Data"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="nt">"missing_rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
                                    </span><span class="p">}</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="nt">"n_missing"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="nt">"n"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"counts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">1</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="p">,</span><span class="w">
                            </span><span class="mi">0</span><span class="w">
                        </span><span class="p">],</span><span class="w">
                        </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Numeric variable with value labels"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
                                        </span><span class="p">}</span><span class="w">
                                    </span><span class="p">],</span><span class="w">
                                    </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"ordinal"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">},</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enum"</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"elements"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-11"</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-12"</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-01"</span><span class="w">
                                        </span><span class="p">}</span><span class="w">
                                    </span><span class="p">],</span><span class="w">
                                    </span><span class="nt">"subtype"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datetime"</span><span class="p">,</span><span class="w">
                                        </span><span class="nt">"missing_reasons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"No Data"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="nt">"missing_rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
                                        </span><span class="nt">"resolution"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="w">
                                    </span><span class="p">}</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">],</span><span class="w">
                        </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">1.234</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">3.14159</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
                                    </span><span class="mf">0.0</span><span class="w">
                                </span><span class="p">],</span><span class="w">
                                </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                                    </span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
                                    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
                                        </span><span class="nt">"integer"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                                        </span><span class="nt">"missing_reasons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                            </span><span class="nt">"No Data"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w">
                                        </span><span class="p">},</span><span class="w">
                                        </span><span class="nt">"missing_rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
                                    </span><span class="p">}</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="nt">"n_missing"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="nt">"n"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="err">...</span><span class="w"> </span><span class="err">(one</span><span class="w"> </span><span class="err">entry</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">each</span><span class="w"> </span><span class="err">sheet)</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="post-body-parameters">POST body parameters</h4>

<p>At the top level, the tab book endpoint can take filtering and variable limiting parameters.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td>filter</td>
<td>object</td>
<td>null</td>
<td>Filter by Crunch Expression.  Variables used in the filter should be fully-expressed urls.</td>
<td>[{&ldquo;filter&rdquo;:&ldquo;https://app.crunch.io/api/datasets/45fc0d5ca0a945dab7d05444efa3310a/filters/5f14133582f34b8b85b408830f4b4a9b/&rdquo;}]</td>
</tr>
<tr>
<td>where</td>
<td>object</td>
<td>null</td>
<td>Crunch Expression signifying which variables to use</td>
<td>{<br>&ldquo;function&rdquo;: &ldquo;select&rdquo;,<br>&ldquo;args&rdquo;: [<br>{<br>&ldquo;map&rdquo;: {<br>&ldquo;https://app.crunch.io/api/datasets/45fc0d5ca0a945dab7d05444efa3310a/variables/000004/&rdquo;: {<br>&ldquo;variable&rdquo;: &ldquo;https://app.crunch.io/api/datasets/45fc0d5ca0a945dab7d05444efa3310a/variables/000004/&rdquo;<br>},<br>&ldquo;https://app.crunch.io/api/datasets/45fc0d5ca0a945dab7d05444efa3310a/variables/000003/&rdquo;: {<br>&ldquo;variable&rdquo;: &ldquo;https://app.crunch.io/api/datasets/45fc0d5ca0a945dab7d05444efa3310a/variables/000003/&rdquo;<br>}<br>}<br>}<br>]<br>}</td>
</tr>
<tr>
<td>options</td>
<td>object</td>
<td>{}</td>
<td>further options defining the tabbook output.</td>
<td></td>
</tr>
<tr>
<td>weight</td>
<td>url</td>
<td>null</td>
<td>Provide a weight for the tabbook generation, if the weight is omitted from the request, the currently selected weight is used. If &ldquo;null&rdquo; is provided, then the tabbook generation will be unweighted.</td>
<td>&ldquo;http://app.crunch.io/api/datasets/45fc0d5ca0a945dab7d05444efa3310a/variables/5f14133582f34b8b85b408830f4b4a9b/&rdquo;</td>
</tr>
</tbody></table>

<h5 id="options">Options</h5>

<p>Options for generating tab books</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td>display_settings</td>
<td>object</td>
<td>{}</td>
<td>a set of settings to define how the output should be displayed</td>
<td>See Below.</td>
</tr>
<tr>
<td>layout</td>
<td>string</td>
<td>many_sheets</td>
<td>&ldquo;many_sheets&rdquo; indicates each variable should have its own Sheet in the  xls spreadsheet.  &ldquo;single_sheet&rdquo; indicates all output should be in the same sheet.</td>
<td>single_sheet</td>
</tr>
</tbody></table>

<h6 id="display-settings">Display Settings</h6>

<p>Further tab book viewing options.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td>decimalPlaces</td>
<td>object</td>
<td>0</td>
<td>number of decimal places to diaplay</td>
<td>{&ldquo;value&rdquo;: 0}</td>
</tr>
<tr>
<td>vizType</td>
<td>object</td>
<td>table</td>
<td>Visialization Type</td>
<td>{value:table},</td>
</tr>
<tr>
<td>countsOrPercents</td>
<td>object</td>
<td>percent</td>
<td>use counts or percents</td>
<td>{value:percent}</td>
</tr>
<tr>
<td>percentageDirection</td>
<td>object</td>
<td>row or column based percents</td>
<td></td>
<td>{value:colPct}</td>
</tr>
<tr>
<td>showNotes</td>
<td>object</td>
<td>display variable notes in sheet header</td>
<td></td>
<td>{value:false}</td>
</tr>
<tr>
<td>slicesOrGroups</td>
<td>object</td>
<td>groups</td>
<td>slices or groups</td>
<td>{value:groups}</td>
</tr>
<tr>
<td>valuesAreMeans</td>
<td>object</td>
<td>false</td>
<td>are values means?</td>
<td>{value:false}</td>
</tr>
</tbody></table>

          <h2 id="table">Table</h2>

<p>All datasets contain a /table/ endpoint which allows access the full data
values. It provides granular control over the rows and columns for each dataset.</p>

<h3 id="fetching-values">Fetching values</h3>

<h4 id="get">GET</h4>

<p>Dataset editors can GET to this resource and obtain a Shoji Table of the 
dataset&rsquo;s data. It will expose all the variables that are visible by the 
authenticated user (Public + personals created by them if requested) as 
well as the exclusion filter applied (if any).</p>

<p>To include the personal variables on the output table the client should
include the <code class="prettyprint">include_personal</code> GET parameter on the request with a True 
value.</p>

<p>A <code class="prettyprint">metadata</code> section contains the definitions of all the variables matched
by variable ID with the corresponding entry under <code class="prettyprint">data</code>.</p>

<p>Dataset viewers can only access the <code class="prettyprint">metadata</code> portion of the response. This 
means they cannot make use of the <code class="prettyprint">limit</code> and <code class="prettyprint">offset</code> parameters to query
data unless the dataset&rsquo;s setting <code class="prettyprint">viewers_can_export</code> is set to True, else
the server will respond with a 403 response.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/datasets/:id/table/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https:\/\/alpha.crunch.io\/api\/datasets\/:id\/table\/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:table"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"000007"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"000004"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"000005"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"000003"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MORE JUNK"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"000000"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"000001"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"2000-01-01T00:00:00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2000-01-02T00:00:00"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"?"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"000008"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"000009"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"00000c"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A Crunch Table of data for this dataset."</span><span class="p">,</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"000004"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bool1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mymrset | Response #1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bool1"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"000005"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bool2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mymrset | Response #2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bool2"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"000003"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"str"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"str"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"missing_reasons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"No Data"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"40 character string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"000000"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Numeric variable with value labels"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"000001"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datetime"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"missing_reasons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"No Data"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"resolution"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Date variable"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"00000c"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"000007"</span><span class="p">,</span><span class="w"> </span><span class="s2">"000008"</span><span class="p">,</span><span class="w"> </span><span class="s2">"000009"</span><span class="p">],</span><span class="w">
      </span><span class="nt">"subreferences"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"000009"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca_subvar_1"</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca_subvar_1"</span><span class="p">,</span><span class="w"> </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">},</span><span class="w">
        </span><span class="nt">"000007"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca_subvar_2"</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca_subvar_2"</span><span class="p">,</span><span class="w"> </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">},</span><span class="w">
        </span><span class="nt">"000008"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca_subvar_3"</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca_subvar_3"</span><span class="p">,</span><span class="w"> </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nt">"selected"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>

<h4 id="filtering">Filtering</h4>

<p>This endpoint accepts the same filter parameters described under 
Filtering Endpoints</p>

          <h2 id="teams">Teams</h2>

<p>Teams contain references to users and datasets. By sharing a dataset with a team, you can grant access to a set of users at once, and by adding a user to a team, you can grant them access to a set of datasets.</p>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/teams/</code></p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight plaintext"><code>// Example team catalog:
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/teams/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of all the teams where the current user is member"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/teams/d07edb/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/41c69d/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The A-Team"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/teams/67fe89/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/41c69d/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Palo Alto Data Science"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight r"><code><span class="n">teams</span> <span class="o">&lt;-</span> <span class="n">getTeams</span><span class="p">()</span>
<span class="n">names</span><span class="p">(</span><span class="n">teams</span><span class="p">)</span>
<span class="c1">## [1] "The A-Team" "Palo Alto Data Science"
</span></code></pre>

<h4 id="post">POST</h4>

<p>To create a new team, POST a Shoji Entity with a team &ldquo;name&rdquo; in the body. No other attributes are required, and you will be automatically assigned as the &ldquo;owner&rdquo;. </p>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/teams/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">...</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "My new team with ytpo"</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">201 Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/teams/03df2a/</span>
</code></pre>
<pre class="highlight r"><code><span class="c1"># Create a new team by assigning into the teams catalog
</span><span class="n">teams</span><span class="p">[[</span><span class="s2">"My new team with ytpo"</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="p">()</span>
<span class="n">names</span><span class="p">(</span><span class="n">teams</span><span class="p">)</span> <span class="c1"># Let's see that it was created
## [1] "The A-Team" "Palo Alto Data Science"
## [3] "My new team with ytpo"
</span>
<span class="c1"># You can also assign members to the team when you create it,
# even though the POST /teams/ API does not support it.
</span><span class="n">teams</span><span class="p">[[</span><span class="s2">"New team with members"</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="p">(</span><span class="n">members</span><span class="o">=</span><span class="s2">"fake.user@example.com"</span><span class="p">)</span>
</code></pre>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/teams/{team_id}/</code></p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/d07edb/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight plaintext"><code>// Example team entity
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/teams/d07edb/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Details for a specific team"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/users/41c69d/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The A-Team"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"catalogs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"datasets"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/teams/d07edb/datasets/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"members"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/teams/d07edb/members/"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight r"><code><span class="c1"># Access a team by name using $ or [[ from the team catalog
</span><span class="n">a.team</span> <span class="o">&lt;-</span> <span class="n">teams</span><span class="p">[[</span><span class="s2">"The A-Team"</span><span class="p">]]</span>
<span class="n">name</span><span class="p">(</span><span class="n">a.team</span><span class="p">)</span>
<span class="c1">## [1] "The A-Team"
</span><span class="n">self</span><span class="p">(</span><span class="n">a.team</span><span class="p">)</span>
<span class="c1">## [1] "https://app.crunch.io/api/teams/d07edb/"
</span></code></pre>

<p>A GET request on a team entity URL returns the same &ldquo;name&rdquo; and &ldquo;owner&rdquo; attributes as shown in the team catalog, as well as references to the &ldquo;datasets&rdquo; and &ldquo;members&rdquo; catalogs corresponding to the team. Authorization is required: if the requesting user is not a member of the team, a 404 response will result.</p>

<h4 id="patch">PATCH</h4>

<p>Team names are editable by PATCHing the team entity. Authorization is required: only the team owner may edit the team&rsquo;s name; other team members will receive a 403 response on PATCH.</p>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/teams/03df2a/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:entity",</span>
<span class="s">    "body": {</span>
<span class="s">        "name": "My new team without typo"</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">204 No Content</span>
</code></pre>
<pre class="highlight r"><code><span class="n">name</span><span class="p">(</span><span class="n">teams</span><span class="p">[[</span><span class="s2">"My new team with ytpo"</span><span class="p">]])</span> <span class="o">&lt;-</span> <span class="s2">"My new team without typo"</span>
<span class="n">names</span><span class="p">(</span><span class="n">teams</span><span class="p">)</span> <span class="c1"># Check that it was updated
## [1] "The A-Team" "Palo Alto Data Science"
## [3] "My new team without typo"
</span></code></pre>

<h3 id="team-members-catalog">Team members catalog</h3>

<p><code class="prettyprint">/teams/{team_id}/members/</code></p>

<p>The team members catalog is a Shoji Catalog similar in nature to the <a href="#permissions">dataset permissions catalog</a>. It collects references to users and defines the authorizations they have with respect to the team. All information about the member relationships is contained in the catalog&ndash;there are no &ldquo;member entities&rdquo;&ndash;and all changes to team membership, whether adding, modifying, or removing users, is done via PATCH.</p>

<h4 id="get">GET</h4>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/teams/d07edb/members/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Catalog of users that belong to this team"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/47193a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B. A. Baracus"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/41c69d/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hannibal"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre class="highlight r"><code><span class="n">members</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>
</code></pre>

<p>Tuple values include:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Display name of the user</td>
</tr>
<tr>
<td>permissions</td>
<td>object</td>
<td>Attributes governing the user&rsquo;s authorization on the team</td>
</tr>
</tbody></table>

<p>Supported <code class="prettyprint">permissions</code>, all boolean, include:</p>

<ul>
<li><strong>manage_members</strong>: Whether the user may add or remove users from the team, as well as modify the permissions of users on the team; i.e., PATCH the member catalog. Default is False, except for the team owner.</li>
</ul>

<h4 id="patch">PATCH</h4>

<p>Authorization is required: team members who do not have the &ldquo;manage_members&rdquo; permission and who attempt to PATCH the member catalog will receive a 403 response. As with the team entity, non-members will receive 404 on attempted PATCH.</p>

<p>PATCH a partial Shoji Catalog to add users to the team, to modify permissions of members already on the team, and to remove team members. The examples below illustrate each of those actions separately, but all can be done together in a single PATCH request, in fact. </p>

<p>In the &ldquo;index&rdquo; attribute of the catalog, object keys must be either (a) URLs of User entities or (b) email addresses. They can be mixed in a single PATCH request. Using email address allows you to invite a user to Crunch while adding them to the team if they do not yet have a Crunch account, but it is also valid as a reference to Users that already exist. </p>

<h5 id="add-and-modify-members">Add and modify members</h5>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:catalog",</span>
<span class="s">    "index": {</span>
<span class="s">        "https://app.crunch.io/api/users/47193a/": {</span>
<span class="s">            "permissions": {</span>
<span class="s">                "manage_members": true</span>
<span class="s">            }</span>
<span class="s">        },</span>
<span class="s">        "https://app.crunch.io/api/users/e3211a/": {},</span>
<span class="s">        "templeton.peck@army.gov": {</span>
<span class="s">            "permissions": {</span>
<span class="s">                "manage_members": true</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">    },</span>
<span class="s">    "send_notification": true,</span>
<span class="s">    "url_base": "https://app.crunch.io/password/change/${token}/"</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">204 No Content</span>
</code></pre>

<p>If the index object keys correspond to users that already appear in the member catalog, their permissions will be updated with the corresponding value. In this example, user <code class="prettyprint">47193a</code>, B. A. Baracus, has been given the <code class="prettyprint">manage_members</code> permission.</p>

<p>If the index object keys do not correspond to users already found in the member catalog, the indicated users will be added to the team. And, if the indicated user, as specified by email address, does not yet exist, they will be invited to Crunch and added to the team. In this example, we added existing user <code class="prettyprint">e3211a</code>, implicitly with <code class="prettyprint">manage_members</code> set to False, to the team, and we also added &ldquo;templeton.peck@army.gov&rdquo;, who did not previously have a Crunch account. </p>

<p>If &ldquo;send_notification&rdquo; was included and true in the request, new-to-Crunch users will receive a notification email informing them that they have been invited to Crunch. New users, unless they have an OAuth provider specified, will need to set a password, and the client application should send a URL template that directs them to a place where they can set that password. To do so, include a &ldquo;url_base&rdquo; attribute in the payload, a URL template with a <code class="prettyprint">${token}</code> variable into which the server will insert the password-setting token. For the Crunch web application, this template is <code class="prettyprint">https://app.crunch.io/password/change/${token}/</code>.</p>

<p>A GET on the members catalog shows the updated catalog.</p>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/teams/d07edb/members/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Catalog of users that belong to this team"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/47193a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B. A. Baracus"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/41c69d/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hannibal"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/e3211a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Howling Mad Murdock"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/89eb3a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"templeton.peck@army.gov"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="removing-members">Removing members</h5>

<p>To remove members from the team, PATCH the catalog with a <code class="prettyprint">null</code> value:</p>
<pre class="highlight http"><code><span class="nf">PATCH</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="s">```json</span>
<span class="s">{</span>
<span class="s">    "element": "shoji:catalog",</span>
<span class="s">    "index": {</span>
<span class="s">        "https://app.crunch.io/api/users/e3211a/": null</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">--------</span>
<span class="s">204 No Content</span>
</code></pre>
<pre class="highlight http"><code><span class="nf">GET</span> <span class="nn">/teams/d07edb/members/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">app.crunch.io</span>
<span class="s">--------</span>
<span class="s">200 OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/teams/d07edb/members/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Catalog of users that belong to this team"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/47193a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B. A. Baracus"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/41c69d/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hannibal"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"https://app.crunch.io/api/users/89eb3a/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"templeton.peck@army.gov"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"manage_members"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="team-datasets-catalog">Team datasets catalog</h3>

<p><code class="prettyprint">/teams/{team_id}/datasets/</code></p>

<p>The team datasets catalog only supports the GET verb. To add a dataset to a team, you must PATCH its <a href="#permissions">permissions catalog</a>. </p>

<h4 id="get">GET</h4>

<p>GET returns a Shoji Catalog of datasets that have been shared with this team. See <a href="#datasets">datasets</a> for details.</p>

          <h2 id="users">Users</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/users/{?email,id}</code></p>

<p>A successful GET on this resource returns a Shoji Catalog whose &ldquo;index&rdquo; URL&rsquo;s 
refer to User objects. If the &ldquo;email&rdquo; or &ldquo;id&rdquo; parameters are provided, the 
result is narrowed to Users matching those parameters.</p>

<p>This method only supports GET requests. To add users they need to be added from 
each account users&rsquo; catalog. This endpoint ensures that the new users belong to 
an account and get an invitation accordingly.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/users/{id}/{?reason_url}</code></p>

<p>A Shoji Entity with the following body members:</p>

<ul>
<li>name</li>
<li>id</li>
<li>email</li>
<li>id_method (optional)</li>
<li>id_provider (optional, and only if id_method == &lsquo;oauth&rsquo;)</li>
</ul>

<p>The id_method member can be one of {&#39;oauth&rsquo;, &#39;pwhash&rsquo;}. If not present, &#39;pwhash&rsquo; is assumed.</p>

<p>The authenticated user can only access another user&rsquo;s entity endpoint IF any
of the following are true:</p>

<ul>
<li>Both belong to the same account</li>
<li>They are both members of a common team</li>
<li>Authenticated user is account admin and viewed user is collaborator on such account</li>
</ul>

<p>A user themselves or with &ldquo;alter_users&rdquo; account permission can PUT new 
attributes via a JSON-like request body. A 200 indicates success.</p>

<h4 id="send-invitation-email">Send invitation email</h4>

<p><code class="prettyprint">/users/{id}/invite/</code></p>

<p>A POST to this resource sends an invitation from the current user to the 
identified User. A 204 indicates success. The current user must have 
&ldquo;can_alter_users&rdquo; account permission or 403 is returned instead.</p>

<p>If a &ldquo;url_base&rdquo; parameter is included in the request body, it will be used to 
form links inside the invitation.</p>

<h4 id="change-password">Change password</h4>

<p><code class="prettyprint">/users/{id}/password/</code></p>

<p>A POST on this resource must consist of a JSON object with the members 
&ldquo;old_pw&rdquo; and &ldquo;new_pw&rdquo;. A 204 indicates success, a 400 indicates failure.</p>

<aside class="notice">
    Please refer to the [password policy](#Password-policy) for information on
    what the requirements are for a password.
</aside>

<h4 id="reset-user-39-s-password">Reset user&rsquo;s password</h4>

<p><code class="prettyprint">/users/{id}/password_reset/</code></p>

<p>A GET on this resource always returns 204. A POST will send a reset password 
notification to the identified user. A 204 indicates success.</p>

<p>If a &ldquo;url_base&rdquo; parameter is included in the request body, it will be used to 
form links inside the notification.</p>

<h4 id="change-user-39-s-email">Change user&rsquo;s email</h4>

<p><code class="prettyprint">/users/{id}/change_email/</code></p>

<p>A POST on this resource must consist of a JSON object with the members &ldquo;pw&rdquo; and 
&ldquo;email&rdquo;. A 204 indicates potential success to change the users email address to 
the newly provided email. The user should check their email and verify they own 
the email address in question.</p>

<p>If the password does not match the users current password they will receive an
error message (400 Bad Request). If the user is an oauth account, then the email
 address may not be changed (409 Conflict).</p>

<p>If the user ID does not match the current signed in user, an 403 Forbidden will be sent back.</p>

<h5 id="expropriate-a-user">Expropriate a user</h5>

<p>An account admin can expropriate a user from the same account. This will change
ownership of all of the affected user&rsquo;s teams, projects and datasets to a new
owner.</p>

<p>The new owner must also be part of the same account and should have 
<code class="prettyprint">create_datasets</code> permissions set to <code class="prettyprint">true</code>.</p>

<p><code class="prettyprint">POST /users/{id}/expropriate/</code></p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://app.crunch.io/api/users/123abc/"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The new owner provided can be a user URL or a user email.</p>

<h5 id="user-datasets">User Datasets</h5>

<p><code class="prettyprint">/account/users/{id}/datasets/</code></p>

<p>This URL is only accessible and available to account admins. </p>

<p>This Shoji catalog lists all the datasets that are owned by this user.</p>

<h5 id="user-visible-datasets">User Visible datasets</h5>

<p><code class="prettyprint">/users/{id}/visible_datasets/</code></p>

<p>This endpoint is only available and accessible to account admins.</p>

<p>Returns a Shoji catalog listing all the datasets (archived or not) that a any
user has access to, either via direct share, via team access or project membership.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"https://app.crunch.io/api/datasets/wsx345/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"survey data"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"last_access_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-02-25"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"access_type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"teams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://app.crunch.io/api/teams/abx/"</span><span class="p">],</span><span class="w">
            </span><span class="nt">"project"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/projects/qwe/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"direct"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"https://app.crunch.io/api/datasets/a2c4b2/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"responses dataset"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"last_access_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-11-09"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"access_type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"teams"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nt">"project"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nt">"direct"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"edit"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
          </span><span class="nt">"view"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nt">"change_permissions"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The tuples contain information of the type of access the user has to each 
dataset via the <code class="prettyprint">access_type</code> attribute. It includes:</p>

<ul>
<li>The list of teams that provide access to this dataset</li>
<li>The project that provides access to this dataset or null</li>
<li>If the user has a direct share to this dataset</li>
</ul>

<p>The <code class="prettyprint">permissions</code> attribute indicates the final coalesced permissions this 
user enjoys on the given dataset.</p>

          <h2 id="variables">Variables</h2>

<h3 id="catalog">Catalog</h3>

<p><code class="prettyprint">/datasets/{id}/variables/{?relative}</code></p>

<p>A Shoji Catalog of variables.</p>

<h4 id="get-catalog">GET catalog</h4>

<p>When authenticated and authorized to view the given dataset, GET returns 200
status with a Shoji Catalog of variables in the dataset. If authorization is
lacking, response will instead be 404.</p>

<p>Array subvariables are not included in the index of this catalog. Their metadata are instead
accessible in each array variable&rsquo;s &ldquo;subvariables_catalog&rdquo;.</p>

<p>Private variables are not included in the index of this catalog, although
entities may be present at <code class="prettyprint">variables/{id}/</code>. See Private Variables for an
index of those.</p>

<p>Catalog tuples contain the following keys:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>More machine-friendly, traditional name for a variable</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Optional longer string</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>Immutable internal identifier</td>
</tr>
<tr>
<td>notes</td>
<td>string</td>
<td>Optional annotations for a variable</td>
</tr>
<tr>
<td>discarded</td>
<td>boolean</td>
<td>Whether the variable should be hidden from most views; default: false</td>
</tr>
<tr>
<td>derived</td>
<td>boolean</td>
<td>Whether the variable is a function of another; default: false</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>The string type name, one of &ldquo;numeric&rdquo;, &ldquo;text&rdquo;, &ldquo;categorical&rdquo;, &ldquo;datetime&rdquo;, &ldquo;categorical_array&rdquo;, or &ldquo;multiple_response&rdquo;</td>
</tr>
<tr>
<td>subvariables</td>
<td>array of URLs</td>
<td>For arrays, array of (ordered) references to subvariables</td>
</tr>
<tr>
<td>subvariables_catalog</td>
<td>URL</td>
<td>For arrays, link to a Shoji Catalog of subvariables</td>
</tr>
<tr>
<td>resolution</td>
<td>string</td>
<td>Present in datetime variables; current resolution of data</td>
</tr>
<tr>
<td>rollup_resolution</td>
<td>string</td>
<td>Present in datetime variables; resolution used for rolled up summaries</td>
</tr>
<tr>
<td>geodata</td>
<td>URL</td>
<td>Present only in variables that have geodata associated; points to the catalog of geodata related to this variable</td>
</tr>
<tr>
<td>uniform_basis</td>
<td>boolean</td>
<td>Whether each subvariable should be considered the same length as the total array. Only on <code class="prettyprint">multiple_response</code></td>
</tr>
</tbody></table>

<p>The catalog has two optional query parameters:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relative</td>
<td>string</td>
<td>If &ldquo;on&rdquo;, all URLs in the &ldquo;index&rdquo; will be relative to the catalog&rsquo;s &ldquo;self&rdquo;</td>
</tr>
</tbody></table>

<p>With the relative flag enabled, the variable catalog looks something like this:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5ee0a0/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"hier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5330a0/variables/hier/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"personal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5330a0/variables/personal/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"weights"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5ee0a0/variables/weights/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/specifications/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of Variables of this dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"a77d9f/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Birth Year"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"birthyear"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a77d9f"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"In what year were you born?"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"9e4c84/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Comments"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"qccomments"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9e4c84"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Global notes about this variable."</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Do you have any comments on your experience of taking this survey (optional)?"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"aad4ad/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"subvariables_catalog"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aad4ad/subvariables/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An Array"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arrayvar"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"439dcf/"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"1c99ea/"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"All variable types can have notes"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aad4ad"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="patch-catalog">PATCH catalog</h4>

<p>Use PATCH to edit the &ldquo;name&rdquo;, &ldquo;description&rdquo;, &ldquo;alias&rdquo;, or &ldquo;discarded&rdquo; state of
one or more variables. A successful request returns a 204 response. The
attributes changed will be seen by all users with access to this dataset;
i.e., names, descriptions, aliases, and discarded state are not merely
attributes of your view of the data but of the datasets themselves.</p>

<p>Authorization is required: you must have &ldquo;edit&rdquo; privileges on the dataset being
modified, as shown in the &ldquo;permissions&rdquo; object in the dataset&rsquo;s catalog tuple.
If you try to PATCH and are not authorized, you will receive a 403 response and
 no changes will be made.</p>

<p>The tuple attributes other than &ldquo;name&rdquo;, &ldquo;description&rdquo;, &ldquo;alias&rdquo;, and &ldquo;discarded&rdquo;
 cannot be modified here by PATCH. Attempting to modify other attributes, or
 including new attributes, will return a 400 response. Variable &ldquo;type&rdquo; can only
 be modified by the &ldquo;cast&rdquo; method, described below. The &ldquo;subvariables&rdquo; can be
 modified by PATCH on the variable entity. &ldquo;subvariables_catalog&rdquo; is a URL to
  a different variable catalog and is thus not editable, though you can navigate
   to its location and modify subvariable attributes there. A variable&rsquo;s &ldquo;id&rdquo;
   and its &ldquo;derived&rdquo; state are immutable.</p>

<p>When PATCHing, you may include only the keys in each tuple that are being
modified, or you may send the complete tuple. As long as the keys that cannot
be modified via PATCH here are not modified, the request will succeed.</p>

<p>Note that, because this catalog contains its entities (rather than collecting
them), you cannot PATCH to add new variables, nor can you PATCH a null tuple to
delete them. Attempting either will return a 400 response. Creating variables is
 allowed only by POST to the catalog, while deleting variables is accomplished
 via a DELETE on the variable entity.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"9e4c84/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>PATCHing this payload on the above catalog will return a 204 status. A
subsequent GET of the catalog returns the following response; note the change in
line 24.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5ee0a0/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"hier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5330a0/variables/hier/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"personal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5330a0/variables/personal/"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"weights"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/datasets/5ee0a0/variables/weights/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.crunch.io/api/specifications/variables/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of Variables of this dataset"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"a77d9f/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Birth Year"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"birthyear"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a77d9f"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"In what year were you born?"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"9e4c84/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Comments"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"qccomments"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9e4c84"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Global notes about this variable."</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Do you have any comments on your experience of taking this survey (optional)?"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"aad4ad/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"subvariables_catalog"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aad4ad/subvariables/"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An Array"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"derived"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"discarded"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arrayvar"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"439dcf/"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"1c99ea/"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nt">"notes"</span><span class="p">:</span><span class="w"> </span><span class="s2">"All variable types can have notes"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aad4ad"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="post-catalog">POST catalog</h4>

<p>A POST to this resource must be a Shoji Entity with the following &ldquo;body&rdquo; attributes:</p>

<ul>
<li><strong>name</strong></li>
<li><strong>type</strong></li>
<li>If &ldquo;type&rdquo; is &ldquo;categorical&rdquo;, &ldquo;multiple_response&rdquo;, or &ldquo;categorical_array&rdquo;: <strong>categories</strong>: an array of category definitions</li>
<li>If &ldquo;type&rdquo; is &ldquo;multiple_response&rdquo; or &ldquo;categorical_array&rdquo;: <strong>subvariables</strong>: an array of URLs of variables to be &ldquo;bound&rdquo; together to form the array variable</li>
<li>If &ldquo;type&rdquo; is &ldquo;multiple_response&rdquo; or &ldquo;categorical_array&rdquo;: <strong>subreferences</strong>: an object keyed by each of the subvariable URLs where each value contains partial variable definitions, which will be created as categorical subvariables of the array. If included, the array definition must include &ldquo;categories&rdquo;, which are shared among the subvariables.</li>
<li>If type is &ldquo;multiple_response&rdquo;, the definition may include <strong>selected_categories</strong>: an array of category names present in the subvariables. This will mark the specified category or categories as the &ldquo;selected&rdquo; response in the multiple response variable. If no &ldquo;selected_categories&rdquo; array is provided, the new variable will use any categories already flagged as &ldquo;selected&rdquo;: true. If no such category exists, the response will return a 400 status.</li>
<li>If &ldquo;type&rdquo; is &ldquo;datetime&rdquo;: <strong>resolution</strong>: a string, such as &ldquo;Y&rdquo;, &ldquo;Q&rdquo;, &ldquo;M&rdquo;, &ldquo;W&rdquo;, &ldquo;D&rdquo;, &ldquo;h&rdquo;, &ldquo;m&rdquo;, &ldquo;s&rdquo;, &ldquo;ms&rdquo;, that indicates the unit size of the datetime data.</li>
</ul>

<p>See <a href="#variable-definitions">Variable Definitions</a> for more details and examples of valid attributes, and
<a href="#array-variables">Feature Guide: Arrays</a> for more information on the various cases for creating
array variables.</p>

<p>It is encouraged, but not required, to include an &ldquo;alias&rdquo; in the body. If
omitted, one will be generated from the required &ldquo;name&rdquo;.</p>

<p>You may also include &ldquo;values&rdquo;, which will create the column of data
corresponding to this variable definition. See <a href="#column-by-column">Importing Data: Column-by-column</a> for details and examples.</p>

<p>You may instead also include an &ldquo;derivation&rdquo; to derive a variable as a function of
other variables. In this case, &ldquo;type&rdquo; is not required because it depends on the
output of the specified derivation function. For details and examples, see
<a href="#deriving-variables">Deriving Variables</a>.</p>

<p>A 201 indicates success and includes the URL of the newly-created variable in
the Location header.</p>

<h4 id="private-variables-catalog">Private variables catalog</h4>

<p><code class="prettyprint">/datasets/{id}/variables/private/{?relative}</code></p>

<p><code class="prettyprint">GET</code> returns a Shoji Catalog of variables, as described above, containing those
 variables that are private to the authenticated user. You may <code class="prettyprint">PATCH</code> this
 catalog to edit names, aliases, descriptions, etc. of the private variables.
 <code class="prettyprint">POST</code>, however, is not supported at this endpoint. To create new private
 variables, <code class="prettyprint">POST</code> to the main variables catalog with a <code class="prettyprint">&quot;private&quot;: true</code> body
 attribute.</p>

<h3 id="hierarchical-order">Hierarchical Order</h3>

<p><code class="prettyprint">/datasets/{id}/variables/hier/</code></p>

<p>Dataset global order containing references to all public variables.</p>

<h4 id="get">GET</h4>

<p>Returns a Shoji Order.</p>

<h4 id="patch">PATCH</h4>

<p>Will expect a Shoji Order representation containing a replacement or new grouped
entities. This allows one to create new groups on the fly or overwrite existing
groups with new &lsquo;entities&rsquo;.</p>

<p>The match happens by each group name and will overwrite the values of each group
 with the received one.</p>

<p>After PATCH any variable not present in the order will always be appended to the
 root of the graph.</p>

<h4 id="put">PUT</h4>

<p>Receives a Shoji Order representation with a completely new graph. Any
previously existing group will be eliminated and any new groups will be added.
 This will overwrite the complete set of current groups.</p>

<p>After PUT any variable not present on any of the groups will always be appended
 to the root of the graph.</p>

<h3 id="personal-variable-order">Personal Variable Order</h3>

<p><code class="prettyprint">/datasets/{id}/variables/personal/</code></p>

<p>Unlike the hierarchical order, the personal variable order returns different
content per user.
Each user can add variable references to it including personal variables and
will not be shared with other users.</p>

<p>The personal variable order defaults to an empty Shoji order until each user
makes changes to it.</p>

<p>The allowed variables on this order are:
 * Any public variable available on the variable catalog
 * Any personal variable or subvariable for the authenticated user
 * Any subvariable of an array variable on the variable catalog</p>

<h4 id="get">GET</h4>

<p>Returns a Shoji Order for this user.</p>

<h4 id="patch">PATCH</h4>

<p>Same as hierarchical order, receives a Shoji Order representation to overwrite
the existing order. Personal variables are allowed here.</p>

<h4 id="put">PUT</h4>

<p>Behaves sames as PATCH.</p>

<h3 id="weights">Weights</h3>

<p><code class="prettyprint">/datasets/{id}/variables/weights/</code></p>

<h4 id="get">GET</h4>

<p>GET a <code class="prettyprint">shoji:order</code> that contains the urls of the variables that have been
designated as possible weight variables.</p>

<h4 id="patch">PATCH</h4>

<p>PATCH the <code class="prettyprint">graph</code> with a list of the desired list of weight variables. The
list will always be overwritten with the new values. This order can only
be a flat list of URLs, any nesting will be rejected with a 400 response.</p>

<p>If the dataset has a default weight variable configured, it will always
be present on the response even if it wasn&rsquo;t included on a PATCH request.</p>

<p>Removing variables from this list will have the side effect of changing any
user&rsquo;s preference that had such variables set as their weight to the current
dataset&rsquo;s default weight.</p>

<p>Only numeric variables are allowed to be used as weight. If a variable of
another type is included in the list, the server will abort and return a 409
response.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://app.crunch.io/api/datasets/42d0a3/variables/42229f"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<aside class="warning">
It is only possible to submit variables that belong to the main dataset. That
is, variables from joined datasets cannot be set as weight.
</aside>

<h4 id="put">PUT</h4>

<p>Behaves sames as PATCH.</p>

<h3 id="entity">Entity</h3>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/</code></p>

<p>A Shoji Entity which exposes most of the metadata about a Variable in the dataset.</p>

<h4 id="get">GET</h4>

<p>Variable entities&rsquo; <code class="prettyprint">body</code> attributes contain the following:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Human-friendly string identifier</td>
</tr>
<tr>
<td>alias</td>
<td>string</td>
<td>More machine-friendly, traditional name for a variable</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Optional longer string</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>Immutable internal identifier</td>
</tr>
<tr>
<td>notes</td>
<td>string</td>
<td>Optional annotations for the variable</td>
</tr>
<tr>
<td>discarded</td>
<td>boolean</td>
<td>Whether the variable should be hidden from most views; default: false</td>
</tr>
<tr>
<td>private</td>
<td>boolean</td>
<td>If true, the variable is only visible to the owner and is only included in the private variables catalog, not the common catalog</td>
</tr>
<tr>
<td>owner</td>
<td>url</td>
<td>If the variable is private it will point to the url of its owner; null for non private variables</td>
</tr>
<tr>
<td>derived</td>
<td>boolean</td>
<td>Whether the variable is a function of another; default: false</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>The string type name</td>
</tr>
<tr>
<td>categories</td>
<td>array</td>
<td>If &ldquo;type&rdquo; is &ldquo;categorical&rdquo;, &ldquo;multiple_response&rdquo;, or &ldquo;categorical_array&rdquo;, an array of category definitions (see below). Other types have an empty array</td>
</tr>
<tr>
<td>subvariables</td>
<td>array of URLs</td>
<td>For array variables, an ordered array of subvariable ids</td>
</tr>
<tr>
<td>subreferences</td>
<td>object of objects</td>
<td>For array variables, an object of {&ldquo;name&rdquo;: &hellip;, &ldquo;alias&rdquo;: &hellip;, &hellip;} objects keyed by subvariable url</td>
</tr>
<tr>
<td>resolution</td>
<td>string</td>
<td>For datetime variables, a string, such as &ldquo;Y&rdquo;, &ldquo;M&rdquo;, &ldquo;D&rdquo;, &ldquo;h&rdquo;, &ldquo;m&rdquo;, &ldquo;s&rdquo;, &ldquo;ms&rdquo;, that indicates the unit size of the datetime data.</td>
</tr>
<tr>
<td>derivation</td>
<td>object</td>
<td>For derived variables, a Crunch expression which was used to derive this variable; or null</td>
</tr>
<tr>
<td>format</td>
<td>object</td>
<td>An object with various members to control the display of Variable data (see below)</td>
</tr>
<tr>
<td>view</td>
<td>object</td>
<td>An object with various members to control the display of Variable data (see below)</td>
</tr>
<tr>
<td>dataset_id</td>
<td>string</td>
<td>The id of the Dataset to which this Variable belongs</td>
</tr>
<tr>
<td>missing_reasons</td>
<td>object</td>
<td>An object whose keys are reason phrases and whose values are missing codes; missing entries in Variable data are represented by a {&ldquo;?&rdquo;: code} missing marker; clients may look up the corresponding reason phrase for each code in this one-to-one map</td>
</tr>
</tbody></table>

<p>Category objects have the following members:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>identifier for the category, corresponding to values in the column of data</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>A unique label identifying the category</td>
</tr>
<tr>
<td>numeric_value</td>
<td>numeric</td>
<td>A quantity assigned to this category for numeric aggregation. May be <code class="prettyprint">null</code>.</td>
</tr>
<tr>
<td>missing</td>
<td>boolean</td>
<td>If true, the given category is marked as &ldquo;missing&rdquo;, and is omitted from most calculations.</td>
</tr>
<tr>
<td>selected</td>
<td>boolean</td>
<td>For categories in multiple response variables, those with <code class="prettyprint">&quot;selected&quot;: true</code> which values correspond to the &ldquo;response&rdquo; being selected. If omitted, the category is treated as not selected. Multiple response variables must have at least one category marked as selected and may have more than one.</td>
</tr>
</tbody></table>

<aside class="notice">
For variables with categories, you can get the &ldquo;missing reasons&rdquo; from the
category definitions. You don&rsquo;t need the &ldquo;missing_reasons&rdquo; body attribute.
</aside>

<p>Format objects may contain:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>data</td>
<td>object</td>
<td>An object with an integer &ldquo;digits&rdquo; member, stating how many digits to display after the decimal point when showing data values</td>
</tr>
<tr>
<td>summary</td>
<td>object</td>
<td>An object with an integer &ldquo;digits&rdquo; member, stating how many digits to display after the decimal point when showing aggregates values</td>
</tr>
</tbody></table>

<p>View objects may contain:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>show_codes</td>
<td>boolean</td>
<td>For categorical types only; if true, numeric values are shown</td>
</tr>
<tr>
<td>show_counts</td>
<td>boolean</td>
<td>If true, show counts; if false, show percents</td>
</tr>
<tr>
<td>include_missing</td>
<td>boolean</td>
<td>For categorical types only; if true, include missing categories</td>
</tr>
<tr>
<td>include_noneoftheabove</td>
<td>boolean</td>
<td>For multiple response types only; if true, display a &ldquo;none of the above&rdquo; category in the requested summary or analysis</td>
</tr>
<tr>
<td>rollup_resolution</td>
<td>string</td>
<td>For datetime variables, a unit to which data should be &ldquo;rolled up&rdquo; by default. See &ldquo;resolution&rdquo; above.</td>
</tr>
</tbody></table>

<h4 id="patch">PATCH</h4>

<p>PATCH variable entities to edit their metadata. Send a Shoji Entity with a
&ldquo;body&rdquo; member containing the attributes to modify. Omitted body attributes will
be unchanged.</p>

<p>Successful requests return 204 status. Among the actions achievable by PATCHing
variable entities:</p>

<ul>
<li>Editing category attributes and adding categories. Include all categories.</li>
<li>Remove categories by sending all categories except for the ones you wish to remove. You can only remove categories that don&rsquo;t have any corresponding data values. Attempting to remove categories that have data associated will fail with a 400 response status.</li>
<li>Reordering or removing subvariables in an array. Unlike categories, subvariables cannot be added via PATCH here.</li>
<li>Editing derivation expressions</li>
<li>Editing format and view settings</li>
<li>Changing a datetime variable&rsquo;s resolution</li>
</ul>

<p>Actions that are best or only achieved elsewhere include:</p>

<ul>
<li>changing variable names, aliases, and descriptions, which is best accomplished by PATCHing the variable catalog, as described above;</li>
<li>changing a variable&rsquo;s type, which can only be done by POSTing to the variable&rsquo;s &ldquo;cast&rdquo; resource (see <a href="#convert-type">Convert type</a> below);</li>
<li>editing names, aliases, and descriptions of subvariables in an array, which is done by PATCHing the array&rsquo;s subvariable catalog;</li>
<li>altering missing rules.</li>
</ul>

<p>Variable &ldquo;id&rdquo; and &ldquo;dataset_id&rdquo; are immutable.</p>

<p>Example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"http://app.crunch.io/api/datasets/d4db9831e08a4922b054e49b47a0045c/variables/00000c/subvariables/0008/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"http://app.crunch.io/api/datasets/d4db9831e08a4922b054e49b47a0045c/variables/00000c/subvariables/0007/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"http://app.crunch.io/api/datasets/d4db9831e08a4922b054e49b47a0045c/variables/00000c/subvariables/0009/"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"subreferences"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/datasets/d4db9831e08a4922b054e49b47a0045c/variables/00000c/subvariables/0008/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvar_2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v2_new_name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/datasets/d4db9831e08a4922b054e49b47a0045c/variables/00000c/subvariables/0007/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvar_1_new_name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v1_new_name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"http://app.crunch.io/api/datasets/d4db9831e08a4922b054e49b47a0045c/variables/00000c/subvariables/0009/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvar_3"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvar_3"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new description"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="post">POST</h4>

<p>Calling POST on an array resource will &ldquo;unbind&rdquo; the variable. On success, <code class="prettyprint">POST</code>
returns 200 status with a Shoji View, containing the URLs of the
(formerly sub-)variables, which are promoted to regular variables.</p>

<h4 id="delete">DELETE</h4>

<p>Calling DELETE on this resource will delete the variable. On success, <code class="prettyprint">DELETE</code>
returns 200 status with an empty Shoji View. Deleting an array deletes all its
subvariable data as well.</p>

<h3 id="summary">Summary</h3>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/summary/{?filter}</code></p>

<p>A collection of summary information describing the variable. A successful GET
returns an object containing various scalars and tabular results in various
formats. The set of included members varies by variable type. Exclusions,
filters, and weights may all alter the output.</p>

<p>For example, given a numeric variable with data [1, 2, 3, 4, 5, 4, {&ldquo;?&rdquo;: -1}, 3,
 5, {&ldquo;?&rdquo;: -1}, 4, 3], a successful GET with no exclusions, filters, or weights returns:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
    </span><span class="nt">"valid_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fivenum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">[</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">],</span><span class="w">
        </span><span class="p">[</span><span class="s2">"0.25"</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">],</span><span class="w">
        </span><span class="p">[</span><span class="s2">"0.5"</span><span class="p">,</span><span class="w"> </span><span class="mf">3.5</span><span class="p">],</span><span class="w">
        </span><span class="p">[</span><span class="s2">"0.75"</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">],</span><span class="w">
        </span><span class="p">[</span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">],</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"missing_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nt">"min"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"median"</span><span class="p">:</span><span class="w"> </span><span class="mf">3.5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"histogram"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"at"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="nt">"bins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">],</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"at"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.5</span><span class="p">,</span><span class="w"> </span><span class="nt">"bins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">],</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"at"</span><span class="p">:</span><span class="w"> </span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="nt">"bins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">],</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"at"</span><span class="p">:</span><span class="w"> </span><span class="mf">4.5</span><span class="p">,</span><span class="w"> </span><span class="nt">"bins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">],</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"stddev"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2649110640673518</span><span class="p">,</span><span class="w">
    </span><span class="nt">"max"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mean"</span><span class="p">:</span><span class="w"> </span><span class="mf">3.4</span><span class="p">,</span><span class="w">
    </span><span class="nt">"missing_frequencies"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Data"</span><span class="p">}],</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>

<h4 id="numeric">numeric</h4>

<p>The members include several counts:</p>

<ul>
<li>count: The number of entries in the variable.</li>
<li>valid_count: The number of entries in the variable which are not missing.</li>
<li>missing_count: The number of entries in the variable which are missing.</li>
<li>missing_frequencies: An array of row objects. Each row represents a distinct missing reason, and includes the reason phrase as the &ldquo;value&rdquo; member and the number of entries which are missing for that reason as the &ldquo;count&rdquo; member.</li>
<li>histogram: An array of row objects. Each row represents a discrete interval in the probability distribution, whose boundaries are given by the &ldquo;bins&rdquo; pair. An &ldquo;at&rdquo; member is included giving the midpoint between the two boundaries. The &ldquo;value&rdquo; member gives a count of entries which fall into the given bin.
as well as basic summary statistics:</li>
<li>fivenum: An array of five [quartile, point] pairs, where the &ldquo;quartile&rdquo; element is one of the strings &ldquo;0&rdquo;, &ldquo;0.25&rdquo;, &ldquo;0.5&rdquo;, &ldquo;0.75&rdquo;, &ldquo;1&rdquo;, representing the min, first quartile, median, third quartile, and max boundaries to divide the data values into four equal groups. The &ldquo;point&rdquo; is the real number at each boundary, and is estimated using the same algorithm as Excel or R&rsquo;s &ldquo;algorithm 7&rdquo;, where h is: (N - 1)p + 1.</li>
<li>min, median, max: taken from &ldquo;fivenum&rdquo;, above.</li>
<li>mean: the sum of the values divided by the number of values, or, if weighted, the sum of weight times value divided by the sum of the weights.</li>
<li>stddev: The standard deviation of the values.</li>
</ul>

<h4 id="categorical">categorical</h4>

<p>The basic counts are included:</p>

<ul>
<li>count: The number of entries in the variable.</li>
<li>valid_count: The number of entries in the variable which are not missing.</li>
<li>missing_count: The number of entries in the variable which are missing.</li>
<li>missing_frequencies: An array of row objects. Each row represents a distinct missing reason, and includes the reason phrase as the &ldquo;value&rdquo; member. The number of entries which are missing for that reason is included as the &ldquo;count&rdquo; member.</li>
</ul>

<p>And the typical &ldquo;frequencies&rdquo; member is expanded into a custom &ldquo;categories&rdquo; member:</p>

<ul>
<li>categories: An array of row objects. Each row represents a distinct category (whether valid or missing), and includes its id the <code class="prettyprint">_id</code> member (note the leading underscore), and its name as the &ldquo;name&rdquo; member. The &ldquo;missing&rdquo; member is true or false depending on whether the category is marked missing or not. The number of entries which possess that value is included as the &ldquo;count&rdquo; member.</li>
</ul>

<h4 id="text">text</h4>

<p>The basic counts are included:</p>

<ul>
<li>count: The number of entries in the variable.</li>
<li>valid_count: The number of entries in the variable which are not missing.</li>
<li>missing_count: The number of entries in the variable which are missing.</li>
<li>nunique: The number of distinct values in the data.</li>
<li>sample: A sample of 5 entries of the data.</li>
</ul>

<p>In addition:</p>

<ul>
<li>max_chars: The number of characters of the longest value in the data.</li>
</ul>

<h4 id="univariate-frequencies">Univariate frequencies</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/frequencies/{?filter,exclude_exclusion_filter}</code></p>

<p>An array of row objects, giving the count of distinct values. The exact members vary by type:</p>

<ul>
<li>numeric: Each row represents a distinct valid value, and includes it as the &ldquo;value&rdquo; member. The number of entries which possess that value is included as the &ldquo;count&rdquo; member.</li>
<li>categorical: Each row represents a distinct category (whether valid or missing), and includes its id the <code class="prettyprint">_id</code> member (note the leading underscore), and its name as the &ldquo;name&rdquo; member. The &ldquo;missing&rdquo; member is true or false depending on whether the category is marked missing or not. The number of entries which possess that value is included as the &ldquo;count&rdquo; member.</li>
<li>text: Each row represents a distinct valid value, and includes it as the &ldquo;value&rdquo; member. The number of entries which possess that value is included as the &ldquo;count&rdquo; member. The length of the array is limited to 10 entries; if more than 10 distinct values are present in the data, an 11th row is added with a &ldquo;value&rdquo; member of &ldquo;(Others)&rdquo;, summing their counts.</li>
</ul>

<h3 id="transforming">Transforming</h3>

<h4 id="convert-type">Convert type</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/cast/</code></p>

<p>A POST to this resource, with a JSON request body of {&ldquo;cast_as&rdquo;: type}, will alter the variable to the given type. If the variable cannot be cast to the given type, 409 is returned. See next to obtain a preview summary of such a cast before committing to it.</p>

<h5 id="casting-to-datetime">Casting to datetime</h5>

<ul>
<li>From Numeric: Need to include keys: <code class="prettyprint">offset</code> as an ISO-8601 date string and <code class="prettyprint">resolution</code> which is one of the following strings:

<ul>
<li>Y: Year</li>
<li>Q: Quarter</li>
<li>M: Month</li>
<li>W: Week</li>
<li>D: Day</li>
<li>h: Hour</li>
<li>m: Minutes</li>
<li>s: Seconds</li>
<li>ms: Milliseconds </li>
</ul></li>
<li>From Text: Need to include a <code class="prettyprint">format</code> key containing a valid strftime string to format with.</li>
<li>From Categorical: Need to include a <code class="prettyprint">format</code> key containing a valid strftime string to format with.</li>
</ul>

<h5 id="casting-from-datetime">Casting from datetime</h5>

<ul>
<li>To Numeric: Not supported</li>
<li>To Text: Need to include a <code class="prettyprint">format</code> key containing a valid strftime string that matches the variable values to parse with.</li>
<li>To Categorical: Need to include a <code class="prettyprint">format</code> key containing a valid strftime string that matches the category names to parse with.</li>
</ul>

<h5 id="array-variables">Array variables</h5>

<ul>
<li>Multiple Response: Not supported</li>
<li>Categorical Array: Not supported</li>
</ul>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/cast/?cast_as={type}</code></p>

<p>A GET on this resource will return the same response as ../summary would if the variable were cast to the given type. If the given type is not valid, 404 is returned.</p>

<h3 id="attributes">Attributes</h3>

<h4 id="missing-values">Missing values</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/missing_rules/</code></p>

<p>A Shoji Entity whose &ldquo;body&rdquo; member contains an array of missing rule objects. POST a {reason: rule} to this URL to add a new rule. Rules take one of the following forms:</p>

<ul>
<li>{&#39;value&rsquo;: v}: Entries which match the given value will be marked as missing for the given reason.</li>
<li>{&#39;set&rsquo;: [v1, v2, &hellip;]}: Entries which are present in the given set will be marked as missing for the given reason.</li>
<li>{&#39;range&rsquo;: [lower, upper], &#39;inclusive&rsquo;: [true, false]}: Entries which exist between the given boundaries will be marked as missing for the given reason. If either &ldquo;inclusive&rdquo; element is null, the corresponding boundary is unbounded.</li>
<li>{&#39;function&rsquo;: &rsquo;&hellip;&rsquo;, &#39;args&rsquo;: [&hellip;]}: Entries which match the given filter function will be marked as missing for the given reason. This is typically a tree of simple rules logical-OR&rsquo;d together.</li>
</ul>

<p>Example:</p>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"Invalid"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w">
    </span><span class="nt">"Sarai doesn't know how to use a calculator :("</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">],</span><span class="w"> </span><span class="nt">"inclusive"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">]}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<aside class="warning">
Missing rules consist on filter expressions that can **only** refer to the same
variable ID where they are defined. Marking values as missing based on the 
contents of another column is not supported.
</aside>

<h4 id="subvariables">Subvariables</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/subvariables/</code></p>

<h5 id="get">GET</h5>

<p>This endpoint will return 404 for any variable that is not an array variable
(Multiple response and Categorical variable).</p>

<p>For array variables, this endpoint will return a Shoji Catalog containing a
tuples for the subvariables. The tuples will have the same shape as the main
variables catalog.</p>

<h5 id="patch">PATCH</h5>

<p>On PATCH, this endpoint allows modification to the variables attributes exposed
 on the tuples (name, description, alias, discarded).</p>

<p>It is possible to add new subvariables to the array variable in question. To do
so include the URL of another variable (currently existing on the dataset) on
the payload with an empty tuple and such variable will be converted into a
subvariable and added at the end.</p>

<p>In the case of derived arrays, an attempt to PATCH this catalog will return a
405 response. This is because the list of subvariables for this array is
a function of its derivation expression. The correct way to make modifications
to derived arrays&rsquo; subvariables is by editing its <code class="prettyprint">derivation</code> attribute with
the desired expressions for each of them.</p>

<h4 id="values">Values</h4>

<p><code class="prettyprint">/datasets/{id}/variables/{id}/values/{?start,total,filter}</code></p>

<p>A GET on this set of resources will return a JSON array of values from the
variable&rsquo;s data. Numeric variables will return numbers, text variables will
return strings, and categorical variables will return category names for valid
categories and {&ldquo;?&rdquo;: code} missing markers for missing categories. The &ldquo;start&rdquo;
and &ldquo;total&rdquo; parameters paginate the results. The &ldquo;filter&rdquo; is a Crunch filter
expression.</p>

<p>Note that this endpoint is only accessible by dataset editors unless the 
<code class="prettyprint">viewers_can_export</code> dataset setting is set to <code class="prettyprint">true</code>, else the server will
return a 403 response.</p>

<h3 id="private-variables">Private Variables</h3>

<p><code class="prettyprint">/datasets/{id}/variables/private/</code></p>

<p>Private variables are variables that, instead of being shared with everyone,
are viewable only by the user that created them. In Crunch, users with view-only
 permissions on a dataset can still make variables of their own–just as they
 can make private filters.</p>

<p>Private variables are not shown in the common variable catalog. Instead, they
have their own Shoji Catalog of private variables belonging to the specified
dataset for the authenticated user. Aside from this separate catalog, private
 variable entities and the catalog behave just as described above for public
 variables.</p>

          <h2 id="versions">Versions</h2>

<p>Datasets have a collection of versions, points in time to which you can roll back. </p>

<h3 id="catalog">Catalog</h3>

<h4 id="get">GET</h4>

<p><code class="prettyprint">GET /datasets/{dataset_id}/savepoints/?limit,offset</code></p>

<p>When authenticated, GET returns 200 status with a (paginated) Shoji Catalog of versions to which the dataset can be reverted. Catalog tuples contain the following attributes:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>user_display_name</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>The name of the user who saved this version</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td></td>
<td>An informative note about the version, as in a commit message</td>
</tr>
<tr>
<td>version</td>
<td>string</td>
<td></td>
<td>An internal identifier for the saved version</td>
</tr>
<tr>
<td>creation_time</td>
<td>datetime</td>
<td></td>
<td>Timestamp for when the version was created</td>
</tr>
<tr>
<td>last_update</td>
<td>datetime</td>
<td></td>
<td>Timestamp for when the version was last updated</td>
</tr>
<tr>
<td>revert</td>
<td>url</td>
<td></td>
<td>URL to POST to in order to roll back to this version; see below</td>
</tr>
</tbody></table>

<p>Query parameters:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>limit</td>
<td>integer</td>
<td>1000</td>
<td>How many versions to include in the catalog response</td>
</tr>
<tr>
<td>offset</td>
<td>integer</td>
<td>0</td>
<td>How many versions to skip before returning <code class="prettyprint">limit</code> versions</td>
</tr>
</tbody></table>

<p>For pagination purposes, catalog tuples are sorted from most to least recent. However, since JSON objects are unordered, you cannot rely on the order of the tuples within the payload you receive.</p>

<h4 id="post">POST</h4>

<p><code class="prettyprint">POST /datasets/{dataset_id}/savepoints/</code></p>

<p>To create a new version, POST a JSON object to the versions catalog. Object attributes may contain: </p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>description</td>
<td>string</td>
<td>No</td>
<td>An informative note about the version, as in a commit message</td>
</tr>
</tbody></table>

<p>A successful POST will return 201 status with the URL of the newly created version entity in the Location header. If the current user is not an editor of the dataset, POSTing will return a 403 status. </p>

<h4 id="patch">PATCH</h4>

<p>No version attributes may be modified by PATCHing the catalog. PATCH will return a 405 status. </p>

<h3 id="entity">Entity</h3>

<h4 id="get">GET</h4>

<p><code class="prettyprint">GET /datasets/{dataset_id}/savepoints/{version_id}/</code></p>

<p>Version entities expose a subset of attributes found in the catalog tuples:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>user_display_name</td>
<td>string</td>
<td>&ldquo;&rdquo;</td>
<td>The name of the user who saved this version</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td></td>
<td>An informative note about the version, as in a commit message</td>
</tr>
<tr>
<td>version</td>
<td>string</td>
<td></td>
<td>An internal identifier for the saved version</td>
</tr>
</tbody></table>

<h4 id="patch">PATCH</h4>

<p><code class="prettyprint">PATCH /datasets/{dataset_id}/savepoints/{version_id}/</code></p>

<p>The version&rsquo;s &ldquo;description&rdquo; may be modified by PATCHing its entity. A successful request returns 204 status. If the current user is not an editor of the dataset, PATCHing will return a 403 status. </p>

<h3 id="reverting">Reverting</h3>

<p><code class="prettyprint">POST /datasets/{dataset_id}/savepoints/{version_id}/revert/</code></p>

<p>To roll back to a saved version, POST an empty body to the version&rsquo;s &ldquo;revert&rdquo; URL, found both inside the catalog tuple and in the &ldquo;views&rdquo; attribute of the entity. A successful request will return 204 status.</p>

<p>Reverting a dataset will not change its current ownership.</p>

          <h2 id="xlsx">Xlsx</h2>

<p>The <code class="prettyprint">xlsx</code> endpoint takes as input a prepared table (intended for use with
multitables) and returns an xlsx file, with some basic formatting conventions.</p>

<p>A POST request to <code class="prettyprint">/api/xlsx/</code> will return an xlsx file directly, with
correct content-disposition and type headers.</p>

<h4 id="post">POST</h4>
<pre class="highlight http"><code><span class="nf">POST</span> <span class="nn">/api/xlsx/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre>

<hr>
<pre class="highlight http"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Disposition</span><span class="p">:</span> <span class="s">attachment; filename=Crunch-export.xlsx</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</span>
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="nt">"etc."</span><span class="p">:</span><span class="w"> </span><span class="s2">"described below"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h4 id="endpoint-parameters">Endpoint Parameters</h4>

<p>At the top level, the xlsx takes a <code class="prettyprint">result</code> <em>array</em> and <code class="prettyprint">display_settings</code> object
which defines some formatting to be used on the values. Multiple tables can be
placed on a single sheet.</p>

<h5 id="result">Result</h5>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Typical element</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>rows</td>
<td>array</td>
<td><code class="prettyprint">{&quot;value&quot;: 30, &quot;class&quot;: &quot;formatted&quot;}</code></td>
<td>Cells are objects with at least a <code class="prettyprint">value</code> member, and optional <code class="prettyprint">class</code>, where a value of <code class="prettyprint">&quot;formatted&quot;</code> prevents the exporter from applying any number format to the result cell</td>
</tr>
<tr>
<td>colLabels</td>
<td>array</td>
<td><code class="prettyprint">{&quot;value&quot;: &quot;All&quot;}</code></td>
<td>Array of objects with a <code class="prettyprint">value</code> member</td>
</tr>
<tr>
<td>colTitles</td>
<td>array</td>
<td><code class="prettyprint">&quot;Age&quot;</code></td>
<td>Array of strings</td>
</tr>
<tr>
<td>spans</td>
<td>array</td>
<td><code class="prettyprint">4</code></td>
<td>array of integers matching the length of colTitles, indicating the number of cells to be joined for each colTitle after the first one. The first colTitle is assumed to be only one column wide.</td>
</tr>
<tr>
<td>rowTitle</td>
<td>string</td>
<td><code class="prettyprint">&quot;Dog food brands&quot;</code></td>
<td>A title, which is formatted bold above the first column of the table (the rowLabels, below)</td>
</tr>
<tr>
<td>rowLabels</td>
<td>array</td>
<td><code class="prettyprint">{&quot;value&quot;: &quot;Canine Crunch&quot;}</code></td>
<td>labels for rows of the table</td>
</tr>
<tr>
<td>rowVariableName</td>
<td>string</td>
<td><code class="prettyprint">&quot;Preferred dog food&quot;</code></td>
<td>title to display at the very top left of the result sheet</td>
</tr>
<tr>
<td>filter_names</td>
<td>array</td>
<td><code class="prettyprint">&quot;Breed: Dachshund&quot;</code></td>
<td>Names of any filters to print beneath the table, will be labeled &ldquo;Filters&rdquo;. If multiple result objects are included in the payload, the filter names from the <em>first</em> result are used, and placed at the bottom of the sheet beneath all results.</td>
</tr>
</tbody></table>

<h5 id="display-settings">Display Settings</h5>

<p>Further customization for the resulting output.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td>decimalPlaces</td>
<td>object</td>
<td>0</td>
<td>number of decimal places to diaplay</td>
<td><code class="prettyprint">{&quot;value&quot;: 0}</code></td>
</tr>
<tr>
<td>countsOrPercents</td>
<td>object</td>
<td>percent</td>
<td>use counts or percents</td>
<td><code class="prettyprint">{&quot;value&quot;: &quot;percent&quot;}</code></td>
</tr>
<tr>
<td>percentageDirection</td>
<td>object</td>
<td>{&ldquo;value&rdquo;: &ldquo;colPct&rdquo;}</td>
<td>row or column based percents</td>
<td><code class="prettyprint">{&quot;value&quot;: &quot;colPct&quot;}</code></td>
</tr>
<tr>
<td>valuesAreMeans</td>
<td>object</td>
<td>false</td>
<td>are values means? (If so, will be formatted with decimal places)</td>
<td><code class="prettyprint">{&quot;value&quot;: false}</code></td>
</tr>
</tbody></table>

<h5 id="quirks">Quirks</h5>

<p>Because the formatted output was designed to display values computed by other clients,
it abuses some assumptions about the tables it is displaying. Some of these are enumerated below.</p>

<ol>
<li>Rows have a ‘marginal’ column positioned first after the row label.</li>
<li>If display settings indicate <code class="prettyprint">rowPct</code>, rows have an additional marginal column intended to show unconditional N for each row.</li>
<li>The remaining row labels are all accounted for in the sum of <code class="prettyprint">spans</code>.</li>
<li>Column titles are placed in merged cells above one or more labels.</li>
<li>The same filter(s) are applied to all tables on a page.</li>
<li>No “freeze panes” are applied to the result.</li>
<li>If the table contains percentages, they should be percentages, not proportions (0 to 100, not 0 to 1).</li>
</ol>

<h3 id="complete-example">Complete example</h3>
<pre class="highlight json"><code><span class="p">{</span><span class="nt">"element"</span><span class="p">:</span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
</span><span class="nt">"body"</span><span class="p">:{</span><span class="w">
    </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"filter_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Name_of_filter"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"colLabels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"All"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"col-0"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"col-1"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"spans"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">2</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"rowLabels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"rowTitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca_subvar_1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rowVariableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"colTitles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"quarter"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">16.666666666666664</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.24821309601845032</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">-0.2482130960184501</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">33.33333333333333</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">-0.5464935495198773</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5464935495198773</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"colLabels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"All"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"col-0"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"col-1"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"spans"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">2</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"rowLabels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"rowTitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca_subvar_2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rowVariableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"colTitles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"quarter"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">33.33333333333333</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.045500259780248964</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">-0.045500259780248964</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">16.666666666666664</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.24821309601845032</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">-0.2482130960184501</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"marginal marginal-percentage"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">-0.0005320055485602548</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-0"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
          </span><span class="nt">"pValue"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0005320055485602548</span><span class="p">,</span><span class="w">
          </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subtable-0 col-1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"colLabels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"All"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2014"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"col-0"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"col-1"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"spans"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">2</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"rowLabels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row-label"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"rowTitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca_subvar_3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rowVariableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"colTitles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"quarter"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">],</span><span class="w">
</span><span class="nt">"display_settings"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"valuesAreMeans"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
        </span><span class="nt">"countsOrPercents"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"percent"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"percentageDirection"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"colPct"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"decimalPlaces"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

          <h1 id="object-reference">Object Reference</h1>

<p>version 0.15</p>

<p>The Crunch REST API takes a decidedly column-oriented approach to data. A &ldquo;column&rdquo; is simply a sequence of values of the same type. A &ldquo;variable&rdquo; binds a name (and other metadata) to the column, and indeed may possess a series of columns over its lifetime as inserts and updates are made to it. A &ldquo;dataset&rdquo; is a set of variables. Each variable in the dataset is sorted the same way; the variables together form a relation. Reading the N&#39;th item from each variable produces a row.</p>

<p>Interaction with the Crunch REST API is by variables and columns. When you add data to Crunch, you send a set of columns. When you fetch data from Crunch, you send a set of variable expressions and receive a set of columns. When you update data in Crunch, you send a set of expressions which tells Crunch how to update variables with new column data.</p>

<p>The Crunch API consists of just a few primitive objects, arranged differently for each request and response. Learning the basic components will help you create the most complicated queries.</p>

<h2 id="response-types">Response types</h2>

<h3 id="shoji-entity">Shoji entity</h3>

<p>A Shoji entity is identified by the <code class="prettyprint">element</code> key having value <code class="prettyprint">shoji:entity</code>.
Its principal attribute is the <code class="prettyprint">body</code> key, which is an object containing the
attributes that describe the entity.</p>

<h3 id="shoji-catalog">Shoji catalog</h3>

<p>A catalog is identified by its <code class="prettyprint">element</code> key having value <code class="prettyprint">shoji:catalog</code> with
its principal attribute being <code class="prettyprint">index</code> that contains an object keyed by the URLs
of the entities it contains and for each key an object (tuple) with attributes
from the referenced entity.</p>

<p>Shoji catalogs are <strong>not</strong> ordered. For its ordered representations they may
provide an <code class="prettyprint">orders</code> set of Shoji order resources.</p>

<h3 id="shoji-view">Shoji view</h3>

<p>A Shoji view is identified by its <code class="prettyprint">element</code> key having value <code class="prettyprint">shoji:view</code> with
its principal attribute being <code class="prettyprint">value</code>. This can contain any arbitrary JSON
object.</p>

<h3 id="shoji-order">Shoji order</h3>

<p>Shoji orders are identified by the <code class="prettyprint">element</code> key having a value <code class="prettyprint">shoji:order</code>.
Their principal attribute is the <code class="prettyprint">graph</code> key which is an array containing the
order of present resources.</p>

<p>A shoji order may be associated with a catalog. In such case it will contain a
subset or totality of the entities present in the catalog. The catalog remains
as the authoritative source of available entities.</p>

<p>Any entity not present on the order but present in the catalog may be
considered to belong at the bottom of the root of the graph in an arbitrary
order, or may be excluded from view.</p>

<h2 id="statistical-data">Statistical data</h2>

<h3 id="identifiers">Identifiers</h3>

<p>Datasets, variables, and other resources are always identified by strings. All identifiers are case-sensitive, and may contain any unicode character, including spaces. Examples:</p>

<ul>
<li>&ldquo;q1&rdquo;</li>
<li>&ldquo;My really useful dataset&rdquo;</li>
<li>&ldquo;变量&rdquo;</li>
</ul>

<h3 id="data-values">Data Values</h3>

<p>Individual data values follow the JSON representations where possible. JSON exposes the following types: number, string, array, object, true, false, null. Crunch adds additional types with special syntax (see Types, below). Examples:</p>

<ul>
<li>13</li>
<li>45.330495</li>
<li>&ldquo;foo&rdquo;</li>
<li>[3, 4, 5]</li>
<li>{&ldquo;bar&rdquo;: {&ldquo;a&rdquo;: [12.4, 89.2, 0]}}</li>
<li>true</li>
<li>null</li>
<li>&ldquo;2014-03-02T14:29:59Z&rdquo;</li>
</ul>

<p>Because a single JSON type may be used to represent multiple Crunch types, you should never rely on the JSON type to interpret the class of a datum. Instead, inspect the type object (see below) to interpret the data.</p>

<h4 id="missing-values">Missing values</h4>

<p>Crunch provides a robust &ldquo;missing entries&rdquo; system. Anywhere a (valid) data value can appear, a missing value may also appear. Missing values are represented by an object with a single &ldquo;?&rdquo; key. The value is a missing integer code (see Missing reasons, below); negative integers are reserved for system-generated reasons, user-defined reasons are automatically assigned positive integers. Examples:</p>

<ul>
<li>{&ldquo;?&rdquo;: -1}</li>
<li>{&ldquo;?&rdquo;: 24}</li>
</ul>

<h4 id="arrays">Arrays</h4>

<p>A set of data values (and/or missing values) which are of the same type can be ordered in an array. All entries in an array are of the same Crunch type.</p>

<p>Examples:</p>

<ul>
<li>[13, 4, 5, {&ldquo;?&rdquo;: -2}, 7, 2]</li>
<li>[&ldquo;foo&rdquo;, &ldquo;bar&rdquo;]</li>
</ul>

<h4 id="enumerations">Enumerations</h4>

<p>Some arrays, rather than repeating a small set of large values, benefit from storing a small integer code instead, moving the larger values they represent into the metadata, and doing lookups when needed to encode/decode. The &ldquo;categorical&rdquo; type is the most common example of this: rather than store an array of large string names like [&ldquo;Internet Explorer&rdquo;, &ldquo;Internet Explorer&rdquo;, &ldquo;Firefox&rdquo;, &hellip;] it instead stores integer codes like: [1, 1, 2], placing the longer strings in the metadata as type.categories = [{&ldquo;id&rdquo;: 1, &ldquo;name&rdquo;: &ldquo;Internet Explorer&rdquo;, &hellip;}, &hellip;]. We call this encoding process enumeration, and its opposite, where the coded are re-expanded into their original values, elaboration.</p>

<p>Enumeration also provides the opportunity to order the possible values, as well as include potential values which do not yet exist in the data array itself.</p>

<p>Enumeration typically causes the volume of data to shrink dramatically, and can speed up very common operations like filtering, grouping, and almost any data transfer. Because of this, it is common to:</p>

<ul>
<li>Enumerate a data array as early as possible. Indeed, when a variable can be enumerated, the fastest way to insert new data is to send the new values as the integer codes.</li>
<li>Elaborate a data array as late as possible. As long as the metadata is shipped along with the enumerated data, the transfer size and therefore time is much smaller. Many cases do not even call for a complete elaboration of the entire column.</li>
</ul>

<h3 id="variable-definitions">Variable Definitions</h3>

<p>Crunch employs a structural type system rather than a nominative one. The variable definition includes more knowledge than just the type name (numeric, text, categorical, etc); we also learn details about range, precision, missing values and reasons, order, etc. For example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Party ID"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Do you consider yourself generally a Democrat, a Republican, or an Independent?"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Republican"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Democrat"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Independent"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This section describes the metadata of a variable as exposed across HTTP, both expected response values and valid input values.</p>

<h4 id="variable-types">Variable types</h4>

<p>The &ldquo;type&rdquo; of a Variable is a string which defines the superset of values from which the variable may draw. The type governs not only the set of values but also their syntax. (See below.)</p>

<p>The following types are defined for public use:</p>

<ul>
<li>text</li>
<li>numeric</li>
<li>categorical</li>
<li>datetime</li>
<li>multiple_response</li>
<li>categorical_array</li>
</ul>

<h4 id="variable-names">Variable names</h4>

<p>Variables in Crunch have multiple attributes that provide identifying information: &ldquo;name&rdquo;, &ldquo;alias&rdquo;, and &ldquo;description&rdquo;.</p>

<h5 id="name">name</h5>

<p>Crunch takes a principled stand that variable &ldquo;names&rdquo; should be for people, not for computers.</p>

<p>You may be used to domains that have variable &ldquo;name&rdquo;, &ldquo;label&rdquo;, and &ldquo;description&rdquo;. Name is some short, unique, machine-friendlier ID like &ldquo;Q2&rdquo;; label is short and human-friendly, something like &ldquo;Brand awareness&rdquo;, and description is where you might put question wording if you have survey data. Crunch has &ldquo;alias&rdquo;, &ldquo;name&rdquo;, and &ldquo;description&rdquo;. What you may be used to thinking of as a variable name, we consider as an alias: something for more internal use, not something appropriate for a polished dataset ready to share with people who didn&rsquo;t create the dataset (See more in the &ldquo;Alias&rdquo; section below). In Crunch, the variable&rsquo;s &ldquo;name&rdquo; is what you may be used to thinking of as a label.</p>

<p>All variables must have a name, and these names must be unique across all variables, including &ldquo;hidden&rdquo; variables (see below) but excluding subvariables (see &ldquo;Subvariables&rdquo; below). Within an array variable, subvariable names must be unique. (You can think of subvariable names within an array as being variable_name.subvariable_name, and with that approach, all &ldquo;variable names&rdquo; must be unique.)</p>

<p>Names must be a string of length greater than zero, and any valid unicode string is allowed. See &ldquo;Identifiers&rdquo; above.</p>

<h5 id="alias">alias</h5>

<p>Alias is a string identifier for variables. It must be unique across all variables, including subvariables, such that it can be used as an identifier. This is what legacy statistical software typically calls a variable name.</p>

<p>Aliases have several uses. Client applications, such as those exposing a scripting interface, may want to use aliases as a more machine-friendly, yet still human-readable, way of referencing variables. Aliases may also be used to help line up variables across different import batches.</p>

<p>When creating variables via the API, alias is not a required field; if omitted, an alias will be generated. If an alias is supplied, it must be unique across all variables, including subvariables, and the new variable request will be rejected if the alias is not unique. When data are imported from file formats that have unique variable names, those names will in many cases be used as the alias in Crunch.</p>

<h5 id="description">description</h5>

<p>Description is an optional string that provides more information about the variable. It is displayed in the web application on variable summary cards and with analyses.</p>

<h4 id="type-specific-attributes">Type-specific attributes</h4>

<p>These attributes must be present for the specified variable types when creating a variable, but they are not defined for other types.</p>

<h5 id="categories">categories</h5>

<p>Categorical variables must contain an array of Category objects, each of which includes:</p>

<ul>
<li><strong>id</strong>: a read-only integer identifier for the category. These correspond to the data values.</li>
<li><strong>name</strong>: the string name which applications should use to identify the category.</li>
<li><strong>numeric_value</strong>: the numeric value bound to each name. If no numeric value should be bound, this should be null. numeric_values need not be unique, and they may be <code class="prettyprint">null</code>.</li>
<li><strong>missing</strong>: boolean indicating whether the data corresponding to this category should be interpreted as missing.</li>
<li><strong>selected</strong>: (optional) boolean indicating whether this category corresponds to a selected value for a dichotomized variable, i.e. part of a multiple response variable. Not required for regular categorical variables, and defaults to <code class="prettyprint">false</code> if omitted. There also is no requirement for Categories in a multiple-response variable that only one Category be marked &ldquo;selected&rdquo;.</li>
</ul>

<p>Categories are valid if:</p>

<ul>
<li>Category names are unique within the set</li>
<li>Category ids are unique within the set</li>
<li>Category ids for user-defined categories are positive integers no greater than 32767. Negative ids are reserved for system missing reasons. See &ldquo;missing_reasons&rdquo; below.</li>
</ul>

<p>The order of the array defines the order of the categories, and thus the order in which aggregate data will be presented. This order can be changed by saving a reordered set of Categories.</p>

<h5 id="subvariables">subvariables</h5>

<p>Multiple Response and Categorical Array variables contain an array of subvariable
 references. In the HTTP API, these are presented as URLs. To create a variable
 of type &ldquo;multiple_response&rdquo; or &ldquo;categorical_array&rdquo;, you must include a
 &ldquo;subvariables&rdquo; member with an array of subvariable references. These variables
 will become the subvariables in the new array variable.</p>

<p>Like Categories, the array of subvariables within an array variable indicate
 the order in which they are presented; to reorder them, save a modified array
 of subvariable ids/urls.</p>

<h5 id="subreferences">subreferences</h5>

<p>Multiple Response and Categorical Array variables contain an object of subvariable
 &ldquo;references&rdquo;: names, alias, description, etc. To create a variable of type
 &ldquo;multiple_response&rdquo; or &ldquo;categorical_array&rdquo; directly, you must include a
 &ldquo;subreferences&rdquo; member with an object of objects. These label the subvariables
 in the new array variable.</p>

<p>The shape of each subreferences member must contain a name and optionally an alias.
Note that the subreferences is an unordered object. The order of the subvariables
is read from the &ldquo;subvariables&rdquo; attribute.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical_array"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example array"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Category 1"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Category 2"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"numeric_value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
            </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"subvariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"/api/datasets/abcdef/variables/abc/subvariables/1/"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"/api/datasets/abcdef/variables/abc/subvariables/2/"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"/api/datasets/abcdef/variables/abc/subvariables/3/"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"subreferences"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"/api/datasets/abcdef/variables/abc/subvariables/2/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvariable 2"</span><span class="p">,</span><span class="w"> </span><span class="nt">"alias"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvar2_alias"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"/api/datasets/abcdef/variables/abc/subvariables/1/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvariable 1"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"/api/datasets/abcdef/variables/abc/subvariables/3/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subvariable 3"</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h5 id="resolution">resolution</h5>

<p>Datetime variables must have a resolution string that indicates the unit size of the datetime data. Valid values include &ldquo;Y&rdquo;, &ldquo;M&rdquo;, &ldquo;D&rdquo;, &ldquo;h&rdquo;, &ldquo;m&rdquo;, &ldquo;s&rdquo;, and &ldquo;ms&rdquo;. Every datetime variable must have a resolution.</p>

<h4 id="other-definition-attributes">Other definition attributes</h4>

<p>These attributes may be supplied on variable creation, and they are included in API responses unless otherwise noted.</p>

<h5 id="format">format</h5>

<p>An object with various members to control the display of Variable data:</p>

<ul>
<li>data: An object with a &ldquo;digits&rdquo; member, stating how many digits to display after the decimal point.</li>
<li>summary: An object with a &ldquo;digits&rdquo; member, stating how many digits to display after the decimal point.</li>
</ul>

<h5 id="view">view</h5>

<p>An object with various members to control the display of Variable data:</p>

<ul>
<li>show_codes: For categorical types only. If true, numeric values are shown.</li>
<li>show_counts: If true, show counts; if false, show percents.</li>
<li>include_missing: For categorical types only. If true, include missing categories.</li>
<li>include_noneoftheabove: For multiple-response types only. If true, display a &ldquo;none of the above&rdquo; category in the requested summary or analysis.</li>
<li>geodata: A list of associations of a variable to Crunch geodatm entities. PATCH a variable entity amending the <code class="prettyprint">view.geodata</code> in order to create, modify, or remove an association. An association is an object with required keys <code class="prettyprint">geodatum</code>, <code class="prettyprint">feature_key</code>, and optional <code class="prettyprint">match_field</code>. The geodatum must exist; <code class="prettyprint">feature_key</code> is the name of the property of each ‘feature’ in the geojson/topojson that corresponds to the <code class="prettyprint">match_field</code> of the variable (perhaps a dotted string for nested properties; e.g. ”properties.postal-code”). By default, <code class="prettyprint">match_field</code> is “name”: a categorical variable will match category names to the <code class="prettyprint">feature_key</code> present in the given geodatum.</li>
</ul>

<h5 id="discarded">discarded</h5>

<p>Discarded is a boolean value indicating whether the variable should be viewed as part of the dataset. Hiding variables by setting discarded to True is like a soft, restorable delete method.</p>

<p>Default is <code class="prettyprint">false</code>.</p>

<h5 id="private">private</h5>

<p>If <code class="prettyprint">true</code>, the variable will not show in the common variable catalog; instead, it will be included in the personal variables catalog. </p>

<h5 id="missing_reasons">missing_reasons</h5>

<p>An object whose keys are reason strings and whose values are the codes used for missing entries.</p>

<p>Crunch allows any entry in a column to be either a valid value or a missing code. Regardless of the class, missing codes are represented in the interface as an object with a single &ldquo;?&rdquo; key mapped to a single missing integer code. For example, a segment of [4.56, 9.23, {&ldquo;?&rdquo;: -1}] includes 2 valid values and 1 missing value.</p>

<p>The missing codes map to a reason phrase via this &ldquo;missing reasons&rdquo; type member. Entries which are missing for reasons determined by the system are negative integers. Users may define their own missing reasons, which receive positive integer codes. Zero is a reserved value.</p>

<p>In the above example, the code of -1 would be looked up in a missing reasons map such as:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"missing reasons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"no data"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type mismatch"</span><span class="p">:</span><span class="w"> </span><span class="mi">-2</span><span class="p">,</span><span class="w">
        </span><span class="nt">"my backup was corrupted"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>See the Endpoint Reference for user-defined missing reasons.</p>

<p>Categorical variables do not require a missing_reasons object because the categories array contains the information about missingness.</p>

<h4 id="values">Values</h4>

<p>When creating a new variable, one can also include a &ldquo;values&rdquo; member that contains the data column corresponding to the variable metadata. See Importing Data: Column-by-column. This subsection outlines how the various variable types have their values formatted both when one supplies values to add to the dataset and when one requests values from a dataset.</p>

<h5 id="text">Text</h5>

<p>Text values are an array of quoted strings. Missing values are indicated as <code class="prettyprint">{&quot;?&quot;: &lt;integer&gt;}</code>, as discussed above, and all integer missing value codes must be defined in the &ldquo;missing_reasons&rdquo; object of the variable&rsquo;s metadata.</p>

<h5 id="numeric">Numeric</h5>

<p>A &ldquo;numeric&rdquo; value will always be e.g. 500 (a number, without quotes) in the JSON request and response messages, not &ldquo;500&rdquo; (a string, with quotes). Missing values are handled as with text variables.</p>

<h5 id="categorical">Categorical</h5>

<p>Insert an array of integers that correspond to the ids of the variable&rsquo;s categories. Only integers found in the category ids are allowed. That is, you cannot insert values for which there is no category metadata. It is, however, permitted to have categories defined for which there are no values.</p>

<h5 id="datetime">Datetime</h5>

<p>Datetime input and output are in ISO-8601 formatted strings.</p>

<h5 id="arrays">Arrays</h5>

<p>Crunch supports array type variables, which contain an array of subvariables. &ldquo;Multiple response&rdquo; and &ldquo;Categorical array&rdquo; are both arrays of categorical subvariables. Subvariables do not exist as independent variables; they are exposed as &ldquo;virtual&rdquo; variables in some places, and can be analyzed independently, but they do not have their own type or categories.</p>

<p>Arrays are currently always categorical, so they sned and receive data in the same format: category ids. The only difference is that regular categorical variables sned and receive one id per row, where arrays send and receive a list of ids (of equal length to the number of subvariables in the array).</p>

<h3 id="variables">Variables</h3>

<p>A complete Variable, then, is simply a Definition combined with its data array.</p>

<h3 id="expressions">Expressions</h3>

<p>Crunch expressions are used to compute on a dataset, to do nuanced selects,
updates, and deletes, and to accomplish many other routine operations.
Expressions are JSON objects in which each term is wrapped in an object which
declares whether the term is a variable, a value, or a function, etc. While
verbose, doing so allows us to be more explicit about the operations we wish
to do.</p>

<p>Expressions generally contain references to <strong>variables</strong>, <strong>values</strong>, or <strong>columns</strong> of values, often composed in <strong>functions</strong>. The output of expressions can be other variables, values, boolean masks, or cube aggregations, depending on the context and expression content. Some endpoints have special semantics, but the general structure of the expressions follows the model described below.</p>

<h4 id="variable-terms">Variable terms</h4>

<p>Terms refer to variables when they include a &ldquo;variable&rdquo; member. The value is the URL for the desired variable. For example:</p>

<ul>
<li><code class="prettyprint">{&quot;variable&quot;: &quot;../variables/X/&quot;}</code></li>
<li><code class="prettyprint">{&quot;variable&quot;: &quot;https://app.crunch.io/api/datasets/48ffc3/joins/abcd/variables/Y/&quot;}</code></li>
</ul>

<p>URLs must either be absolute or relative to the URL of the current request. For example, to refer to a variable in a query at <code class="prettyprint">https://app.crunch.io/api/datasets/48ffc3/cube/</code>, a variable at <code class="prettyprint">https://app.crunch.io/api/datasets/48ffc3/variables/9410fc/</code> may be referenced by its full URL or by &ldquo;../variables/9410fc/&rdquo;.</p>

<h4 id="value-terms">Value terms</h4>

<p>Terms refer to data values when they include a &ldquo;value&rdquo; member. Its value is any individual data value; that is, a value that is addressable by a column and row in the dataset. For example:</p>

<ul>
<li><code class="prettyprint">{&quot;value&quot;: 13}</code></li>
<li><code class="prettyprint">{&quot;value&quot;: [3, 4, 5]}</code></li>
</ul>

<p>Note that individual values may themselves be complex arrays or objects, depending on their type. You may explicitly include a &ldquo;type&rdquo; member in the object, or let Crunch infer the type. One way to do this is to use the &ldquo;typeof&rdquo; function to indicate that the value you&rsquo;re specifying corresponds to the exact type of an existing variable. See &ldquo;functions&rdquo; below for more details.</p>

<h4 id="column-terms">Column terms</h4>

<p>Terms refer to columns (construct them, actually) when they include a &ldquo;column&rdquo; member. The value is an array of data values. You may include &ldquo;type&rdquo; and/or &ldquo;references&rdquo; members as well.</p>

<ul>
<li><code class="prettyprint">{&quot;column&quot;: [1, 2, 3, 17]}</code></li>
<li><code class="prettyprint">{&quot;column&quot;: [{&quot;?&quot;: -2}, 1, 4, 1], &quot;type&quot;: {&quot;class&quot;: &quot;categorical&quot;, &quot;categories&quot;: [...], ...}}</code></li>
</ul>

<h4 id="function-terms">Function terms</h4>

<p>Terms refer to functions (and operators) when they include a &ldquo;function&rdquo; member. The value is the identifier for the desired function. They parameterize the function with an &ldquo;args&rdquo; member, whose value is an array of terms, one for each argument. Examples:</p>

<ul>
<li><code class="prettyprint">{&quot;function&quot;: &quot;==&quot;, &quot;args&quot;: [{&quot;variable&quot;: &quot;../variables/X/&quot;}, {&quot;value&quot;: 13}]}</code></li>
<li><code class="prettyprint">{&quot;function&quot;: &quot;contains&quot;, &quot;args&quot;: [{&quot;variable&quot;: &quot;../joins/abcd/variables/Y/&quot;}, {&quot;value&quot;: &quot;foo&quot;}]}</code></li>
</ul>

<p>You may include a &ldquo;references&rdquo; member to provide a name, alias, description, etc to the output of the function.</p>

<h5 id="supported-functions">Supported functions</h5>

<p>Here is a list of all functions available for crunch expressions.  Note that these functions can be used in conjuction
to compose an expression.</p>

<h5 id="binary-functions">Binary functions</h5>

<ul>
<li><code class="prettyprint">+</code> add</li>
<li><code class="prettyprint">-</code> subtract</li>
<li><code class="prettyprint">*</code> multiply</li>
<li><code class="prettyprint">/</code> div divide</li>
<li><code class="prettyprint">//</code> floor division</li>
<li><code class="prettyprint">^</code> power</li>
<li><code class="prettyprint">%</code> modulus</li>
<li><code class="prettyprint">&amp;</code> bitwise and</li>
<li><code class="prettyprint">|</code> bitwise or</li>
<li><code class="prettyprint">~</code> invert</li>
</ul>

<h5 id="builtin-functions">Builtin functions</h5>

<ul>
<li><code class="prettyprint">array</code> Return the given Frame materialized as an array.</li>
<li><code class="prettyprint">as_selected</code> Return the given variable reduced to the [1, 0, -1] &ldquo;selections&rdquo; type.</li>
<li><code class="prettyprint">bin</code> Return column&rsquo;s values broken into equidistant bins.</li>
<li><code class="prettyprint">case</code> Evaluate the given conditions in order, selecting the corresponding choice.</li>
<li><code class="prettyprint">cast</code> Return a Column of column&rsquo;s values cast to the given type.</li>
<li><code class="prettyprint">char_length</code> Return the length of each string (or missing reason) in the given column.</li>
<li><code class="prettyprint">copy_variable</code> Returns a copy of the column with a copy of its metadata.</li>
<li><code class="prettyprint">combine_categories</code> Return a column of categories combined according to the category_info.</li>
<li><code class="prettyprint">combine_responses</code> Combine the given categorical variables into a new one.</li>
<li><code class="prettyprint">current_batch</code> Return the batch_id of the current frame.</li>
<li><code class="prettyprint">get</code> Return a subvariable from the given column.</li>
<li><code class="prettyprint">lookup</code> Map each row of source through its keys index to a corresponding value.</li>
<li><code class="prettyprint">missing</code> Return the given column as missing for the given reason.</li>
<li><code class="prettyprint">normalize</code> Return a Column with the given values normalized so sum&copy; == len&copy;.</li>
<li><code class="prettyprint">row</code> Return a Numeric column with row indices.</li>
<li><code class="prettyprint">selected_array</code> Return a bool Array from the given categorical, plus None/<strong>none</strong>/<strong>any</strong> .</li>
<li><code class="prettyprint">selected_depth</code> Return a numeric column containing the number of selected categories in each row of the given array.</li>
<li><code class="prettyprint">selections</code> Return the given array, reduced to the [1, 0, -1] &ldquo;selections&rdquo; type, plus an <code class="prettyprint">__any__</code> magic subvariable.</li>
<li><code class="prettyprint">subvariables</code> Return a Frame containing subvariables of the given array.</li>
<li><code class="prettyprint">tiered</code> Return a variable formed by collapsing the given array&rsquo;s subvariables in the given category tiers.</li>
<li><code class="prettyprint">typeof</code> Return (a copy of) the Type of the given column.</li>
<li><code class="prettyprint">unmissing</code> Return the given column with user missing replaced by valid values.</li>
</ul>

<h5 id="comparisons">Comparisons</h5>

<ul>
<li><code class="prettyprint">==</code> equals</li>
<li><code class="prettyprint">!=</code> not equals</li>
<li><code class="prettyprint">=&gt;&lt;=</code> between</li>
<li><code class="prettyprint">between</code> between</li>
<li><code class="prettyprint">&lt;</code> less than</li>
<li><code class="prettyprint">&gt;</code> greater than</li>
<li><code class="prettyprint">&lt;=</code> less than or equal</li>
<li><code class="prettyprint">&gt;=</code> greater than or equal</li>
<li><code class="prettyprint">in</code> in</li>
<li><code class="prettyprint">all</code> True for each row where all subvariables in a multiple_response array are selected</li>
<li><code class="prettyprint">any</code> True for each row where any subvariable in a multiple_response array is selected</li>
<li><code class="prettyprint">is_none_of_the_above</code> True for each row where no subvariables in a multiple_response array are selected, unless all subvariables have missing values</li>
<li><code class="prettyprint">contains</code> Return a mask where A is an element of array B, or a key of object B.</li>
<li><code class="prettyprint">icontains</code> Case-insensitive version of &lsquo;contains&rsquo;</li>
<li><code class="prettyprint">~=</code> compare against regular expression (regex)</li>
<li><code class="prettyprint">and</code> logical and</li>
<li><code class="prettyprint">or</code> logical or</li>
<li><code class="prettyprint">not</code> logical not</li>
<li><code class="prettyprint">is_valid</code> Boolean array of rows which are valid for the given column</li>
<li><code class="prettyprint">is_missing</code> Boolean array of rows which are missing for the given column</li>
<li><code class="prettyprint">any_missing</code> Boolean array of rows where any of the subvariables are missing</li>
<li><code class="prettyprint">all_valid</code> Boolean array of rows where all of the subvariables are valid</li>
<li><code class="prettyprint">all_missing</code> Boolean array of rows where all of the subvariables are missing</li>
</ul>

<h5 id="date-functions">Date Functions</h5>

<ul>
<li><code class="prettyprint">default_rollup_resolution</code> default_rollup_resolution</li>
<li><code class="prettyprint">datetime_to_numeric</code> Convert the given datetime column to numeric.</li>
<li><code class="prettyprint">format_datetime</code> Convert datetime values to strings using the fmt as strftime mask.</li>
<li><code class="prettyprint">numeric_to_datetime</code> Convert the given numeric column to datetime with the given resolution.</li>
<li><code class="prettyprint">parse_datetime</code> Parse string to datetime using optional format string</li>
<li><code class="prettyprint">rollup</code> Return column&rsquo;s values (which must be type datetime) into calendrical bins.</li>
</ul>

<h5 id="frame-functions">Frame Functions</h5>

<p>* <code class="prettyprint">page</code> Return the given frame, limited/offset by the given values.
    * <code class="prettyprint">select</code> Return a Frame of results from the given map of variables.
    * <code class="prettyprint">sheet</code> Return the given frame, limited/offset in the number of variables.
    * <code class="prettyprint">dependents</code> Return the given frame with only dependents of the given variable.
    * <code class="prettyprint">deselect</code> Return a frame NOT including the indicated variables.
    * <code class="prettyprint">adapt</code> Return the given frame adapted to the given to_key.
    * <code class="prettyprint">join</code> Return a JoinedFrame from the given list of subframes.
    * <code class="prettyprint">find</code> Return a Frame with those variables which match the given criteria.
    * <code class="prettyprint">flatten</code> Return a frame including all variables, plus all subvariables at dotted ids.</p>

<h6 id="examples">Examples</h6>

<ul>
<li><strong>select</strong>: Receives an argument which is a map expression in the following shape:
&ldquo;`json</li>
</ul>

<p>{
  &quot;function&rdquo;: &ldquo;select&rdquo;,
  &ldquo;args&rdquo;: [{
    &ldquo;map&rdquo;: {
      <destination id>: {variable: <source frame id>},
      <destination id>: {variable: <source frame id>},
      &hellip;
    }
  }]</p>

<p>}
&ldquo;<code class="prettyprint">
Where</code>destination id<code class="prettyprint">is the ID that the mapped variable will have on the
resulting frame by selecting only the</code>source frame id` variables from the
frame where this function is applied on.</p>

<ul>
<li><strong>deselect</strong>: Same as <code class="prettyprint">select</code> but will exclude the variable ids mentioned
from the source frame. On this usage the <code class="prettyprint">destination id</code> part of the <code class="prettyprint">map</code>
argument are disregarded.
&rdquo;`json</li>
</ul>

<p>{
  &ldquo;function&rdquo;: &ldquo;deselect&rdquo;,
  &ldquo;args&rdquo;: [{
    &ldquo;map&rdquo;: {
      <destination id>: {variable: <source frame id>},
      <destination id>: {variable: <source frame id>},
      &hellip;
    }
  }]</p>

<p>}
&ldquo;`</p>

<h5 id="measures-functions">Measures Functions</h5>

<ul>
<li><code class="prettyprint">cube_count</code></li>
<li><code class="prettyprint">cube_distinct_count</code></li>
<li><code class="prettyprint">cube_max</code> A measure which returns the maximum value in a column.</li>
<li><code class="prettyprint">cube_mean</code></li>
<li><code class="prettyprint">cube_min</code> A measure which returns the minimum value in a column.</li>
<li><code class="prettyprint">cube_missing_frequencies</code> Return an object with parallel &#39;code&rsquo; and &#39;count&rsquo; arrays.</li>
<li><code class="prettyprint">cube_quantile</code></li>
<li><code class="prettyprint">cube_stddev</code> A measure which returns the standard deviation value in a column.</li>
<li><code class="prettyprint">cube_sum</code></li>
<li><code class="prettyprint">cube_valid_count</code></li>
<li><code class="prettyprint">cube_weighted_max</code></li>
<li><code class="prettyprint">cube_weighted_min</code></li>
<li><code class="prettyprint">top</code> Return the given (1D/1M) cube, filtered to its top N members.</li>
</ul>

<h5 id="cube-functions">Cube Functions</h5>

<ul>
<li><code class="prettyprint">autocube</code> Return a cube crossing A by B (which may be None).</li>
<li><code class="prettyprint">autofreq</code> Return a cube of frequencies for A.</li>
<li><code class="prettyprint">cube</code> Return a Cube instance from the given arguments.</li>
<li><code class="prettyprint">each</code> Yield one expression result per item in the given iterable.</li>
<li><code class="prettyprint">multitable</code> Return cubes for each target variable crossed by None + each template variable.</li>
<li><code class="prettyprint">transpose</code> Transpose the given cube, rearranging its (0-based) axes to the given order.</li>
<li><code class="prettyprint">stack</code> Return a cube of 1 more dimension formed by stacking the given array.</li>
</ul>

<h4 id="filter-terms">Filter terms</h4>

<p>Terms that refer to filters entities by URL are shorthand for the boolean expression stored in the entity. So, <code class="prettyprint">{&quot;filter&quot;: &quot;../filters/59fc4d/&quot;}</code> yields the Crunch expression contained in the Filter entity&rsquo;s &quot;expression&rdquo; attribute. Filter terms can be combined together with other expressions as well. For example, <code class="prettyprint">{&quot;function&quot;: &quot;and&quot;, &quot;args&quot;: [{&quot;filter&quot;: &quot;../filters/59fc4d/&quot;}, {&quot;function&quot;: &quot;==&quot;, &quot;args&quot;: [{&quot;variable&quot;: &quot;../variables/X/&quot;}, {&quot;value&quot;: 13}]}]}</code> would &ldquo;and&rdquo; together the boolean expression in filter 59fc4d with the <code class="prettyprint">X == 13</code> expression.</p>

<h2 id="documents">Documents</h2>

<h3 id="shoji">Shoji</h3>

<p>Most representations returned from the API are Shoji Documents. Shoji is a media type designed to foster scalable API&rsquo;s. Shoji is built with JSON, so any JSON parser should be able to at least deserialize Shoji documents. Shoji adds four document types: Entity, Catalog, View, and Order.</p>

<h4 id="entity">Entity</h4>

<p>Anything that can be thought of as &ldquo;a thing by itself&rdquo; will probably be represented by a Shoji Entity Document. Entities possess a &ldquo;body&rdquo; member: a JSON object where each key/value pair is an attribute name and value. For example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:entity"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/users/1/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Details for a User."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/specifications/users/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fragments"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"address/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Genghis"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Khan"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>In general, an HTTP GET to the &ldquo;self&rdquo; URL will return the document, and a PUT of the same will update it. PUT should not be used for partial updates–use PATCH for that instead. In general, each member included in the &ldquo;body&rdquo; of a PATCH message will replace the current representation; attributes not included will not be altered. There is no facility to remove an attribute from an Entity.body via PATCH. In some cases, however, even finer-grained control is possible via PATCH; see the Endpoint Reference for details.</p>

<h4 id="catalog">Catalog</h4>

<p>Catalogs collect or contain entities. They act as an index to a collection, and indeed possess an &ldquo;index&rdquo; member for this:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:catalog"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/users/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A list of all the users."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"specification"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/specifications/users/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default_order/"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"2/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span><span class="w">
        </span><span class="nt">"1/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">},</span><span class="w">
        </span><span class="nt">"4/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span><span class="w">
        </span><span class="nt">"3/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Each key in the index is a URL (possibly relative to &ldquo;self&rdquo;) which refers to a different resource. Often, these are Shoji Entity documents, but not always. The index also allows some attributes to be published as a set, rather than in each individual Entity. This allows clients to act on the collection as a whole, such as when rendering a list of references from which the user might select one entity.</p>

<p>In general, an HTTP GET to the &ldquo;self&rdquo; URL will return the document, and a PUT of the same will update it. Many catalogs allow POST to add a new entity to the collection. PUT should not be used for partial updates&ndash;use PATCH for that instead. In general, each member included in the &ldquo;index&rdquo; of a PATCH message will replace the current representation; tuples not included will not be altered. Tuples included in a PATCH which are not present in the server&rsquo;s current representation of the index may be added; it is up to each resource whether to support (and document!) this approach or prefer POST to add entities to the collection. In general, catalogs that <em>contain</em> entities get new entities created by POST, while catalogs that <em>collect</em> entities that are contained by other catalogs (e.g. a catalog of users who have permissions on a dataset) will have entities added by PATCH.</p>

<p>Similarly, removing entities from catalogs is supported in one of two ways, typically varying by catalog type. For catalogs that contain entities, entities are removed only by DELETE on the entity&rsquo;s URL (its key in the Catalog.index). In contrast, for catalogs that collect entities, entities are removed by PATCHing the catalog with a <code class="prettyprint">null</code> tuple. This removes the entity from the catalog but does not delete the entity (which is contained by a different catalog). T</p>

<h4 id="view">View</h4>

<p>Views cut across entities. They can publish nearly any arrangement of data, and are especially good for exposing arrays of arrays and the like. In general, a Shoji View is read-only, and only a GET will be successful.</p>

<h4 id="order">Order</h4>

<p>Orders can arrange any set of strings into an arbitrarily-nested tree; most often, they are used to provide one or more orderings of a Catalog&rsquo;s index. For example, each user may have their own ordering for an index of variables; the same URL&rsquo;s from the index keys are arranged in the Order. Given the Catalog above, for example, we might produce an Order like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shoji:order"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/users/order/"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"graph"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"2/"</span><span class="p">,</span><span class="w">
        </span><span class="p">{</span><span class="nt">"group A"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"1/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2/"</span><span class="p">]},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"group B"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"4/"</span><span class="p">]}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This represents the tree:</p>
<pre class="highlight plaintext"><code>      /  |  \
     2  {A} {B}
       / | \  \
      1  3  2  4
</code></pre>

<p>The Order object itself allows lots of flexibility. Each of the following decisions are up to the API endpoint to constrain or not as it sees fit (see the Endpoint Reference for these details):</p>

<ul>
<li>Not every string in the original set has to be present, allowing partial orders.</li>
<li>Strings from the original set which are not mentioned may be ignored, or default to an &ldquo;ungrouped&rdquo; group, or other behaviors as each application sees fit.</li>
<li>Groups may contain member strings and other groups interleaved (but still ordered).</li>
<li>Groups may exist without any members.</li>
<li>Members may appear in more than one group.</li>
<li>Group names may be repeated at different points within the tree.</li>
<li>Group member arrays, although represented in a JSON array, may be declared to be non-strict in their order (that is, the array should be treated more like an unordered set).</li>
</ul>

<h3 id="crunch-objects">Crunch Objects</h3>

<p>Most of the other representations returned from the API are Crunch Objects. They are built with JSON, so any JSON parser should be able to at least deserialize Crunch documents. Crunch adds two document types: Table and Cube.</p>

<h4 id="table">Table</h4>

<p>Tables collect columns of data and (optionally) their metadata into two-dimensional relations.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:table"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.../api/datasets/.../table/?limit=7"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The data belonging to this Dataset."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"1ef0455"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Education"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w"> </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w">
        </span><span class="nt">"588392a"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Favorite color"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"1ef0455"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w">
        </span><span class="nt">"588392a"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"RED"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pink"</span><span class="p">,</span><span class="w"> </span><span class="s2">" red"</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Each key in the &ldquo;data&rdquo; member is a variable identifier, and its corresponding value is a column of Crunch data values. The data values in a given column are homogeneous, but across columns they are heterogeneous. The lengths of all columns MUST be the same. The &ldquo;metadata&rdquo; member is optional; if given, it MUST contain matching keys that correspond to variable definitions.</p>

<p>Like any JSON object, the &ldquo;data&rdquo; and &ldquo;metadata&rdquo; objects are explicitly unordered. When supplying a crunch:table, such as when POST&#39;ing to datasets/ to create a new dataset, you must supply an Order if you want an explicit variable order.</p>

<h4 id="cube">Cube</h4>

<p>Cubes have both input and output formats. The &ldquo;crunch:cube&rdquo; element is used for the output only.</p>

<h5 id="cube-input">Cube input</h5>

<p>The input format may vary slightly according to the API endpoint (since some parameters may be inherent in the particular resource), but involves the same basic ingredients.</p>

<p>Example:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/ab8832/variables/3ffd45/"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"variable"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasets/ab8832/variables/2098f1/"</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}]}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cube_count"</span><span class="p">,</span><span class="w"> </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[]}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h6 id="dimensions">dimensions</h6>

<p>An array of input expressions. Each expression contributes one dimension to the output cube. The only exception is when a dimension results in a boolean (true/false) column, in which case the data are filtered by it as a mask instead of adding a dimension to the output.</p>

<p>When a dimension is added, the resulting axis consists of distinct values rather than all values. Variables which are already &ldquo;categorical&rdquo; or &ldquo;enumerated&rdquo; will simply use their &ldquo;categories&rdquo; or &ldquo;elements&rdquo; as the extent. Other variables form their extents from their distinct values.</p>

<h6 id="measures">measures</h6>

<p>A set of cube functions to populate each cell of the cube. You can request multiple functions over the same dimensions (such as “cube_mean” and “cube_stddev”) or more commonly just one (like “cube_count”). Each member MUST be a ZZ9 cube function designed for the purpose. See ZZ9 User Guide:Cube Functions for a list of such functions and their arguments.</p>

<h6 id="filters">filters</h6>

<p>An array containing references to filters that need to be applied to the dataset before starting the cube calculations. It can be an empty array or null, in which case no filtering will be applied.</p>

<h6 id="weight">weight</h6>

<p>A reference to a variable to be used as the weight on all cube operations.</p>

<h5 id="cube-output">Cube output</h5>

<p>Cubes collect columns of measure data in an arbitrary number of dimensions. Multiple measures in the same cube share dimensions, effectively overlaying each other. For example, a cube might contain a &ldquo;count&rdquo; measure and a &ldquo;mean&rdquo; measure with the same shape:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="s2">"crunch:cube"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"n"</span><span class="p">:</span><span class="w"> </span><span class="mi">210</span><span class="p">,</span><span class="w">
    </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
    </span><span class="nt">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w"> </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">]}},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w"> </span><span class="nt">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">]}}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"measures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="nt">"integer"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">},</span><span class="w">
            </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">],</span><span class="w">
            </span><span class="nt">"n_missing"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"mean"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"references"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="err">...}</span><span class="p">},</span><span class="w">
            </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="mf">17.8</span><span class="p">,</span><span class="w"> </span><span class="mf">9.9</span><span class="p">,</span><span class="w"> </span><span class="mf">7.32</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">23.4</span><span class="p">],</span><span class="w">
            </span><span class="nt">"n_missing"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"margins"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">210</span><span class="p">],</span><span class="w">
        </span><span class="nt">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">110</span><span class="p">]},</span><span class="w">
        </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="mi">120</span><span class="p">]}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h6 id="dimensions">dimensions</h6>

<p>The &ldquo;dimensions&rdquo; member is the most straightforward: an array of variable Definition objects. Each one defines an axis of the cube&rsquo;s output. This may be different from the input dimensions&rsquo; definitions. For example, when counting numeric variables, the input dimension might be an expression involving the bin builtin function. Even though the input variable is of type &ldquo;numeric&rdquo;, the output dimension would be of type &ldquo;enum&rdquo; .</p>

<h6 id="n">n</h6>

<p>The number of rows considered for all measures.</p>

<h6 id="measures">measures</h6>

<p>The &ldquo;measures&rdquo; member includes one object for each measure. The &ldquo;metadata&rdquo; member of each tells you the name, type and other definitions of the measure. The &ldquo;data&rdquo; member of each is a flattened array of values for that measure; the dimensions stride into that array in order, with the last dimension varying the fastest. In the example above, the first dimension (&ldquo;A&rdquo;) has 3 categories, while &ldquo;B&rdquo; has 2; therefore, the &ldquo;flat&rdquo; array [10, 20, 30, 40, 50, 60] for the &ldquo;count&rdquo; measure is interpreted as the &ldquo;unflattened&rdquo; array [[10, 20], [30, 40], [50, 60]]. Graphically:</p>

<table><thead>
<tr>
<th></th>
<th>B:11</th>
<th>B:12</th>
</tr>
</thead><tbody>
<tr>
<td>A:1</td>
<td>10</td>
<td>20</td>
</tr>
<tr>
<td>A:2</td>
<td>30</td>
<td>40</td>
</tr>
<tr>
<td>A:3</td>
<td>50</td>
<td>60</td>
</tr>
</tbody></table>

<p>This is known in NumPy and other domains as &ldquo;C order&rdquo; (versus &ldquo;Fortran order&rdquo; which would be interpreted as [[10, 30, 50], [20, 40, 60]] instead).</p>

<h6 id="n_missing">n_missing</h6>

<p>The number of rows that are missing for this measure. Because different measures may have different inputs (the column to take the mean of, for example, or weighted versus unweighted), this number may vary from one measure to another even though the total &ldquo;n&rdquo; is the same for all.</p>

<h6 id="margins">margins</h6>

<p>The &ldquo;margins&rdquo; member is optional. When present, it is a tree of nested margins with one level of depth for each dimension. At the top, we always include the &ldquo;grand total&rdquo; for all dimensions. Then, we include a branch for each axis we &ldquo;unroll&rdquo;. So, for example, for a 3-dimensional cube of X, Y, and Z, the margins member might contain:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
</span><span class="nt">"margins"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">4526</span><span class="p">],</span><span class="w">
    </span><span class="nt">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1755</span><span class="p">,</span><span class="w"> </span><span class="mi">2771</span><span class="p">],</span><span class="w">
        </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="mi">601</span><span class="p">,</span><span class="w"> </span><span class="mi">370</span><span class="p">,</span><span class="w"> </span><span class="mi">322</span><span class="p">,</span><span class="w"> </span><span class="mi">269</span><span class="p">,</span><span class="w"> </span><span class="mi">147</span><span class="p">,</span><span class="w"> </span><span class="mi">46</span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="mi">332</span><span class="p">,</span><span class="w"> </span><span class="mi">215</span><span class="p">,</span><span class="w"> </span><span class="mi">596</span><span class="p">,</span><span class="w"> </span><span class="mi">523</span><span class="p">,</span><span class="w"> </span><span class="mi">437</span><span class="p">,</span><span class="w"> </span><span class="mi">668</span><span class="p">]</span><span class="w">
        </span><span class="p">]},</span><span class="w">
        </span><span class="nt">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="mi">1198</span><span class="p">,</span><span class="w"> </span><span class="mi">557</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">1493</span><span class="p">,</span><span class="w"> </span><span class="mi">1278</span><span class="p">]]}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">933</span><span class="p">,</span><span class="w"> </span><span class="mi">585</span><span class="p">,</span><span class="w"> </span><span class="mi">918</span><span class="p">,</span><span class="w"> </span><span class="mi">792</span><span class="p">,</span><span class="w"> </span><span class="mi">584</span><span class="p">,</span><span class="w"> </span><span class="mi">714</span><span class="p">],</span><span class="w">
        </span><span class="nt">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="mi">601</span><span class="p">,</span><span class="w"> </span><span class="mi">370</span><span class="p">,</span><span class="w"> </span><span class="mi">322</span><span class="p">,</span><span class="w"> </span><span class="mi">269</span><span class="p">,</span><span class="w"> </span><span class="mi">147</span><span class="p">,</span><span class="w"> </span><span class="mi">46</span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="mi">332</span><span class="p">,</span><span class="w"> </span><span class="mi">215</span><span class="p">,</span><span class="w"> </span><span class="mi">596</span><span class="p">,</span><span class="w"> </span><span class="mi">523</span><span class="p">,</span><span class="w"> </span><span class="mi">437</span><span class="p">,</span><span class="w"> </span><span class="mi">668</span><span class="p">]</span><span class="w">
        </span><span class="p">]},</span><span class="w">
        </span><span class="nt">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="mi">825</span><span class="p">,</span><span class="w"> </span><span class="mi">108</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">560</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">325</span><span class="p">,</span><span class="w"> </span><span class="mi">593</span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="mi">417</span><span class="p">,</span><span class="w"> </span><span class="mi">375</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">191</span><span class="p">,</span><span class="w"> </span><span class="mi">393</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">373</span><span class="p">,</span><span class="w"> </span><span class="mi">341</span><span class="p">]</span><span class="w">
        </span><span class="p">]}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2691</span><span class="p">,</span><span class="w"> </span><span class="mi">1835</span><span class="p">],</span><span class="w">
        </span><span class="nt">"0"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="mi">1198</span><span class="p">,</span><span class="w"> </span><span class="mi">557</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">1493</span><span class="p">,</span><span class="w"> </span><span class="mi">1278</span><span class="p">]]},</span><span class="w">
        </span><span class="nt">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">[</span><span class="mi">825</span><span class="p">,</span><span class="w"> </span><span class="mi">108</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">560</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">325</span><span class="p">,</span><span class="w"> </span><span class="mi">593</span><span class="p">],</span><span class="w">
            </span><span class="p">[</span><span class="mi">417</span><span class="p">,</span><span class="w"> </span><span class="mi">375</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">191</span><span class="p">,</span><span class="w"> </span><span class="mi">393</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">373</span><span class="p">,</span><span class="w"> </span><span class="mi">341</span><span class="p">]</span><span class="w">
        </span><span class="p">]}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Again, each branch in the tree is an axis we &ldquo;unroll&rdquo; from the grand total. So margins[0][2] contains the margin where X (axis 0) and Z (axis 2) are unrolled, and only Y (axis 1) is still &ldquo;rolled up&rdquo;.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="http">HTTP</a>
                <a href="#" data-language-name="shell">cURL</a>
                <a href="#" data-language-name="python">Python</a>
                <a href="#" data-language-name="r">R</a>
          </div>
      </div>
    </div>
  </body>
</html>
